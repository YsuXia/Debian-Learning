<map version="1.0.1">
<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->
<node CREATED="1432001536510" ID="ID_24966842" LINK="file" MODIFIED="1455007293417">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#009999"><b>Linux&#x8bbe;&#x5907;&#x9a71;&#x52a8;</b></font></i>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node COLOR="#cc0033" CREATED="1432001536510" FOLDED="true" ID="ID_1355499788" MODIFIED="1576372898512" POSITION="right" TEXT="&#x7b2c;&#x4e00;&#x7ae0;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x4ecb;&#x7ecd;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1432001536510" FOLDED="true" ID="ID_413707106" MODIFIED="1544867539066" TEXT="&#x9a71;&#x52a8;&#x7684;&#x89d2;&#x8272;">
<node CREATED="1432001536510" FOLDED="true" ID="ID_755263179" MODIFIED="1527815355570">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5212;&#x5206;&#x9a71;&#x52a8;&#x7684;&#x673a;&#x5236;&#x7684;&#x548c;&#x7b56;&#x7565;&#xff1a;
    </p>
    <p>
      &#x9a71;&#x52a8;&#x7684;&#x673a;&#x5236;&#xff1a;&#x9a71;&#x52a8;&#x63d0;&#x4f9b;&#x7684;&#x80fd;&#x529b;
    </p>
    <p>
      &#x9a71;&#x52a8;&#x7684;&#x7b56;&#x7565;&#xff1a;&#x5982;&#x4f55;&#x83b7;&#x5f97;&#x80fd;&#x529b;
    </p>
  </body>
</html></richcontent>
<node CREATED="1432001536510" ID="ID_303312917" MODIFIED="1432002140179" TEXT="&#x7f16;&#x5199;&#x9a71;&#x52a8;&#x5c3d;&#x91cf;&#x4e0d;&#x8981;&#x6d89;&#x53ca;&#x7b56;&#x7565;&#x7684;&#x90e8;&#x5206;"/>
</node>
<node CREATED="1432001536510" FOLDED="true" ID="ID_577086635" MODIFIED="1527815352882" TEXT="&#x7b56;&#x7565;&#x900f;&#x660e;&#x7684;&#x9a71;&#x52a8;&#x6240;&#x5177;&#x6709;&#x7684;&#x7279;&#x5f81;">
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x652f;&#x6301;&#x540c;&#x6b65;&#x548c;&#x5f02;&#x6b65;"/>
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x591a;&#x6b21;&#x6253;&#x5f00;&#x7684;&#x80fd;&#x529b;"/>
</node>
<node CREATED="1432001536510" FOLDED="true" ID="ID_1110536121" MODIFIED="1527815360338" TEXT="&#x5185;&#x6838;&#x89d2;&#x8272;&#x7684;&#x5212;&#x5206;">
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x8fdb;&#x7a0b;&#x7ba1;&#x7406;"/>
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x5185;&#x5b58;&#x7ba1;&#x7406;"/>
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x6587;&#x4ef6;&#x7cfb;&#x7edf;"/>
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x8bbe;&#x5907;&#x63a7;&#x5236;"/>
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x7f51;&#x7edc;"/>
</node>
<node CREATED="1432001536510" FOLDED="true" ID="ID_1354787353" MODIFIED="1544867538129" TEXT="&#x9a71;&#x52a8;&#x6a21;&#x5757;&#x7684;&#x5212;&#x5206;">
<node CREATED="1432001536510" FOLDED="true" ID="ID_35820574" MODIFIED="1527815362906" TEXT="&#x5b57;&#x7b26;&#x8bbe;&#x5907;">
<node CREATED="1432001536510" MODIFIED="1432001536510" TEXT="&#x5f53;&#x505a;&#x5b57;&#x8282;&#x6d41;&#x6765;&#x5b58;&#x53d6;&#x7684;&#x8bbe;&#x5907;"/>
<node CREATED="1432001536510" ID="ID_1351821472" MODIFIED="1432002446072">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x6709;&#x63a5;&#x5165;&#x70b9;&#xff1a;
    </p>
    <p>
      /dev/tty1
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432001536510" FOLDED="true" ID="ID_810170604" MODIFIED="1527815369298" TEXT="&#x5757;&#x8bbe;&#x5907;">
<node CREATED="1432001536511" ID="ID_1434743738" MODIFIED="1432001536511" TEXT="&#x901a;&#x8fc7;&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x7684;&#x5165;&#x53e3;&#x6765;&#x5b58;&#x53d6;"/>
<node CREATED="1432001536511" ID="ID_1835962326" MODIFIED="1432001536511" TEXT="linux&#x5141;&#x8bb8;&#x5757;&#x8bbe;&#x5907;&#x50cf;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x90a3;&#x6837;&#x5b58;&#x53d6;"/>
</node>
<node CREATED="1432001536511" FOLDED="true" ID="ID_981641251" MODIFIED="1527815374482">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7f51;&#x7edc;&#x63a5;&#x53e3;:
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x63a5;&#x53e3;&#x53ef;&#x4ee5;&#x662f;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;
    </p>
    <p>
      &#x4e5f;&#x53ef;&#x4ee5;&#x662f;&#x4e00;&#x4e2a;&#x8f6f;&#x4ef6;&#x5b9e;&#x73b0;
    </p>
  </body>
</html></richcontent>
<node CREATED="1432001536511" ID="ID_1951985114" MODIFIED="1432001536511" TEXT="&#x7ecf;&#x5e38;&#x88ab;&#x8bbe;&#x8ba1;&#x6210;&#x53ea;&#x662f;&#x5904;&#x7406;&#x62a5;&#x6587;&#x7684;&#x53d1;&#x9001;&#x548c;&#x63a5;&#x53d7;"/>
</node>
</node>
</node>
<node CREATED="1432001536511" FOLDED="true" ID="ID_1458470954" MODIFIED="1544867540121" TEXT="&#x5b89;&#x5168;&#x95ee;&#x9898;">
<node CREATED="1432001536511" ID="ID_24562969" MODIFIED="1432001536511" TEXT="&#x7cfb;&#x7edf;&#x4e2d;&#x7684;&#x5b89;&#x5168;&#x95ee;&#x9898;&#x662f;&#x7531;&#x5185;&#x6838;&#x5f3a;&#x5236;&#x52a0;&#x4e0a;&#x53bb;&#x7684;"/>
</node>
</node>
<node COLOR="#cc0000" CREATED="1432001536511" FOLDED="true" ID="ID_89389509" MODIFIED="1588642227520" POSITION="right" TEXT="&#x7b2c;&#x4e09;&#x7ae0;&#x5b57;&#x7b26;&#x9a71;&#x52a8;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1432001536511" FOLDED="true" ID="ID_1504972745" MODIFIED="1576372896973" TEXT="SCULL&#x7684;&#x4ecb;&#x7ecd;">
<edge COLOR="#ff0066"/>
<node CREATED="1432001536511" FOLDED="true" ID="ID_1336937959" MODIFIED="1576372886719">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      scull0&#x5230;scull3
    </p>
    <p>
      &#x5bf9;&#x5e94;&#x7684;&#x4ee3;&#x7801;&#x6587;&#x4ef6;&#x5939;&#x662f;<font color="#dc0303"><i>scullc</i></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1432001536511" ID="ID_886513184" MODIFIED="1432001536511" TEXT="&#x7531;&#x5168;&#x5c40;&#x7684;&#x5185;&#x5b58;&#x533a;&#x7ec4;&#x6210;"/>
<node CREATED="1432001536511" ID="ID_945918228" MODIFIED="1432001536511" TEXT="&#x7531;&#x6c38;&#x4e45;&#x7684;&#x5185;&#x5b58;&#x533a;&#x7ec4;&#x6210;"/>
</node>
<node CREATED="1432001536511" FOLDED="true" ID="ID_1823904421" MODIFIED="1576372887706" TEXT="scullpipe0&#x5230;scullpipe3">
<node CREATED="1432001536511" ID="ID_786883843" MODIFIED="1432001536511" TEXT="&#x884c;&#x4e3a;&#x50cf;&#x662f;&#x7ba1;&#x9053;"/>
<node CREATED="1432001536511" ID="ID_134230882" MODIFIED="1432001536511" TEXT="&#x5b9e;&#x73b0;&#x963b;&#x585e;&#x548c;&#x975e;&#x963b;&#x585e;"/>
</node>
<node CREATED="1432001536511" FOLDED="true" ID="ID_1605671330" MODIFIED="1576372890720" TEXT="scullsingle">
<node CREATED="1432001536511" ID="ID_765058061" MODIFIED="1432001536511" TEXT="&#x53ea;&#x5141;&#x8bb8;&#x4e00;&#x6b21;&#x4e00;&#x4e2a;&#x8fdb;&#x7a0b;&#x4f7f;&#x7528;"/>
</node>
<node CREATED="1432001536511" FOLDED="true" ID="ID_145566488" MODIFIED="1576372892754" TEXT="scullpriv">
<node CREATED="1432001536511" ID="ID_1202904424" MODIFIED="1432001536511" TEXT="&#x5bf9;&#x6bcf;&#x4e2a;&#x865a;&#x62df;&#x7ec8;&#x7aef;&#x662f;&#x79c1;&#x6709;&#x7684;"/>
</node>
<node CREATED="1432001536511" FOLDED="true" ID="ID_1695524747" MODIFIED="1576372895566" TEXT="sculluid&#x548c;scullwuid">
<node CREATED="1432001536511" ID="ID_17928343" MODIFIED="1432001536511" TEXT="&#x53ef;&#x4ee5;&#x591a;&#x7528;&#x6237;&#x6b21;&#x6253;&#x5f00;&#x4f46;&#x662f;&#x4e00;&#x6b21;&#x53ea;&#x80fd;&#x4e00;&#x4e2a;&#x7528;&#x6237;"/>
</node>
</node>
<node COLOR="#ff3333" CREATED="1432001536511" ID="ID_991336956" MODIFIED="1587605862505">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e3b;&#x6b21;&#x7f16;&#x53f7;&#xff1a;
    </p>
    <p>
      &#x5b57;&#x7b26;&#x9a71;&#x52a8;&#x662f;&#x901a;&#x8fc7;&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x8fdb;&#x5165;&#x7684;
    </p>
  </body>
</html></richcontent>
<node CREATED="1432001536511" ID="ID_1096034248" MODIFIED="1587605869075" TEXT="&#x4e3b;&#x6b21;&#x7f16;&#x53f7;">
<node CREATED="1432001536512" ID="ID_353294307" MODIFIED="1587605873303" TEXT="&#x4e3b;&#x7f16;&#x53f7;&#xff1a;&#x6807;&#x8bc6;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x4f7f;&#x7528;&#x54ea;&#x4e2a;&#x9a71;&#x52a8;">
<node BACKGROUND_COLOR="#33ff33" CREATED="1432105653336" ID="ID_1035150399" MODIFIED="1432105710224" TEXT="&#x4e5f;&#x6709;&#x591a;&#x4e2a;&#x9a71;&#x52a8;&#x5171;&#x4eab;&#x4e00;&#x4e2a;&#x4e3b;&#x7f16;&#x53f7;&#x7684;&#x60c5;&#x51b5;">
<edge COLOR="#3333ff"/>
</node>
</node>
<node CREATED="1432001536512" ID="ID_183491251" MODIFIED="1432001536512" TEXT="&#x6b21;&#x7f16;&#x53f7;&#xff1a;&#x6807;&#x8bc6;&#x5177;&#x4f53;&#x7684;&#x8bbe;&#x5907;"/>
</node>
<node CREATED="1432001536512" ID="ID_1042749064" MODIFIED="1587605875924" TEXT="&#x4e3b;&#x6b21;&#x7f16;&#x53f7;&#x7684;&#x5185;&#x90e8;&#x6807;&#x8bc6;">
<node COLOR="#ff6666" CREATED="1432001536512" ID="ID_1408585560" MODIFIED="1432105797516" TEXT="dev_t&#x83b7;&#x5f97;&#x4e3b;&#x6b21;&#x7f16;&#x53f7;"/>
<node CREATED="1432001536512" ID="ID_841449011" MODIFIED="1432001536512" TEXT="&#x7531;&#x4e3b;&#x6b21;&#x7f16;&#x53f7;&#x83b7;&#x5f97;dev_t"/>
</node>
<node CREATED="1432001536512" ID="ID_1653444239" MODIFIED="1587605878950" TEXT="&#x5206;&#x914d;&#x8bbe;&#x5907;&#x7f16;&#x53f7;">
<node COLOR="#cc0000" CREATED="1432001536512" ID="ID_837056629" MODIFIED="1587605888998">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;&#x9759;&#x6001;&#x65b9;&#x6cd5;&#x5206;&#x914d;&#x8bbe;&#x5907;&#x7f16;&#x53f7;
    </p>
    <p>
      &#x51fd;&#x6570;&#xff1a;register_chrdev_region(dev_t first, unsigned int count,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char * name)
    </p>
    <p>
      &#x5934;&#x6587;&#x4ef6;&#xff1a; linux/fs.h
    </p>
    <p>
      &#x540d;&#x79f0;name&#x4f1a;&#x51fa;&#x73b0;&#x5728;/proc/devices&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x548c;sysfs&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3c5a1a" face="Verdana, Geneva, Arial, Helvetica, sans-serif" size="2">int register_chrdev_region(dev_t from, unsigned count, const char *name)<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>{<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;struct char_device_struct *cd;<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;dev_t to = from + count;<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;dev_t n, next;<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/><br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;for (n = from; n &lt; to; n = next) {<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;next = MKDEV(MAJOR(n)+1, 0);<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (next &gt; to)<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;next = to;<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cd = __register_chrdev_region(MAJOR(n), MINOR(n), next - n, name);<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (IS_ERR(cd))<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;goto fail;<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;}<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;return 0;<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>fail:<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;to = n;<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;for (n = from; n &lt; to; n = next) {<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;next = MKDEV(MAJOR(n)+1, 0);<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;kfree(__unregister_chrdev_region(MAJOR(n), MINOR(n), next - n));<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;}<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>&#xa0;&#xa0;&#xa0;return PTR_ERR(cd);<br align="start" size="2" color="#3c5a1a" style="background-color: rgb(255, 255, 255); word-spacing: 0px; text-transform: none; text-indent: 0px; letter-spacing: normal; font-variant: normal; white-space: normal; line-height: 19px"/>}</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1471744094824" ID="ID_1793741047" MODIFIED="1471744149806">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#b90f11"><i>static struct char_device_struct { </i></font></b>
    </p>
    <p>
      <b><font color="#b90f11"><i>&#xa0;&#xa0;&#xa0;&#xa0;struct char_device_struct *next; </i></font></b>
    </p>
    <p>
      <b><font color="#b90f11"><i>&#xa0;&#xa0;&#xa0;&#xa0;unsigned int major; </i></font></b>
    </p>
    <p>
      <b><font color="#b90f11"><i>&#xa0;&#xa0;&#xa0;&#xa0;unsigned int baseminor; </i></font></b>
    </p>
    <p>
      <b><font color="#b90f11"><i>&#xa0;&#xa0;&#xa0;&#xa0;int minorct; </i></font></b>
    </p>
    <p>
      <b><font color="#b90f11"><i>&#xa0;&#xa0;&#xa0;&#xa0;char name[64]; </i></font></b>
    </p>
    <p>
      <b><font color="#b90f11"><i>&#xa0;&#xa0;&#xa0;&#xa0;struct cdev *cdev;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* will die */ </i></font></b>
    </p>
    <p>
      <b><font color="#b90f11"><i>} *chrdevs[CHRDEV_MAJOR_HASH_SIZE];</i></font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527760207724" ID="ID_579635941" MODIFIED="1527760366719">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#e30c0c"><i>int register_chrdev_region(dev_t from, unsigned count, const char *name)</i></font> </b>
    </p>
    <p>
      <b>{ </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;struct char_device_struct *cd; </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;dev_t to = from + count; </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;dev_t n, next; </b>
    </p>
    <p>
      
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;for (n = from; n &lt; to; n = next) { </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;next = MKDEV(MAJOR(n)+1, 0); </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (next &gt; to) </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;next = to; </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cd = __register_chrdev_region(MAJOR(n), MINOR(n), </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;next - n, name); </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (IS_ERR(cd)) </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;goto fail; </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;} </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;return 0; </b>
    </p>
    <p>
      <b>fail: </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;to = n; </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;for (n = from; n &lt; to; n = next) { </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;next = MKDEV(MAJOR(n)+1, 0); </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;kfree(__unregister_chrdev_region(MAJOR(n), MINOR(n), next - n)); </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;} </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;return PTR_ERR(cd); </b>
    </p>
    <p>
      <b>} </b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1587607957093" ID="ID_296378359" MODIFIED="1587608195880">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36824;&#26377;&#19968;&#31181;&#38745;&#24577;&#20998;&#37197;&#35774;&#22791;&#32534;&#21495;&#20197;&#21450;&#30452;&#25509;&#27880;&#20876;cdev&#21040;&#31995;&#32479;&#24403;&#20013;&#30340;&#26041;&#27861;&#65292;
    </p>
    <p>
      &#35813;&#26041;&#27861;&#23450;&#20041;&#22312;&#25991;&#20214;fs.h&#24403;&#20013;&#65292;&#34987;&#23450;&#20041;&#25104;&#20102;&#20869;&#32852;&#20989;&#25968;&#30340;&#24418;&#24335;
    </p>
    <p>
      
    </p>
    <p>
      static inline int register_chrdev(unsigned int major, const char *name,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;const struct file_operations *fops)
    </p>
    <p>
      {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;return __register_chrdev(major, 0, 256, name, fops);
    </p>
    <p>
      &#160;&#160;&#160;&#160; <font color="#ff0000"><b>&#36825;&#37324;&#26159;&#19968;&#27425;&#24615;&#20998;&#37197;256&#20010;&#27425;&#35774;&#22791;&#32534;&#21495;&#32473;&#20027;&#35774;&#22791;&#21495;major</b></font>
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<node CREATED="1587608250110" ID="ID_621330136" MODIFIED="1587608342298">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int __register_chrdev(unsigned int major, unsigned int baseminor,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;unsigned int count, const char *name,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;const struct file_operations *fops)
    </p>
    <p>
      {
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct char_device_struct *cd;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct cdev *cdev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int err = -ENOMEM;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;cd = __register_chrdev_region(major, baseminor, count, name);
    </p>
    <p>
      &#160;&#160;&#160;&#160;if (IS_ERR(cd))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return PTR_ERR(cd);
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;cdev = cdev_alloc();
    </p>
    <p>
      &#160;&#160;&#160;&#160;if (!cdev)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto out2;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;cdev-&gt;owner = fops-&gt;owner;
    </p>
    <p>
      &#160;&#160;&#160;&#160;cdev-&gt;ops = fops;
    </p>
    <p>
      &#160;&#160;&#160;&#160;kobject_set_name(&amp;cdev-&gt;kobj, &quot;%s&quot;, name);
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;err = <b>cdev_add(cdev, MKDEV(cd-&gt;major, baseminor), count);&#160; <font color="#3300cc" face="&#x6977;&#x4f53;"><i>&#19968;&#27425;&#24615;&#20851;&#32852;count&#20010;&#27492;&#35774;&#22791;&#32534;&#21495;&#21040;&#35813;cdev&#30340;&#19979;&#38754;</i></font></b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;if (err)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto out;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;cd-&gt;cdev = cdev;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;return major ? 0 : cd-&gt;major;
    </p>
    <p>
      out:
    </p>
    <p>
      &#160;&#160;&#160;&#160;kobject_put(&amp;cdev-&gt;kobj);
    </p>
    <p>
      out2:
    </p>
    <p>
      &#160;&#160;&#160;&#160;kfree(__unregister_chrdev_region(cd-&gt;major, baseminor, count));
    </p>
    <p>
      &#160;&#160;&#160;&#160;return err;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node COLOR="#003399" CREATED="1432001536512" ID="ID_1712262710" MODIFIED="1454920962746">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;&#x52a8;&#x6001;&#x65b9;&#x6cd5;&#x5206;&#x914d;&#x8bbe;&#x5907;&#x7f16;&#x53f7;
    </p>
    <p>
      int alloc_chrdev_region(dev_t *dev, unsigned int firstminor,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int count, char *name)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1467730862286" ID="ID_928482317" MODIFIED="1467731155516">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5185;&#x6838;&#x4e2d;&#x6240;&#x6709;&#x5df2;&#x5206;&#x914d;&#x7684;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x7f16;&#x53f7;&#x90fd;&#x8bb0;&#x5f55;&#x5728;&#x4e00;&#x4e2a;&#x540d;&#x4e3a; chrdevs &#x6563;&#x5217;&#x8868;&#x91cc;&#x3002;
    </p>
    <p>
      &#x8be5;&#x6563;&#x5217;&#x8868;&#x4e2d;&#x7684;&#x6bcf;&#x4e00;&#x4e2a;&#x5143;&#x7d20;&#x662f;&#x4e00;&#x4e2a; char_device_struct &#x7ed3;&#x6784;
    </p>
    <p>
      static struct char_device_struct {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct char_device_struct *next;&#xa0;&#xa0;&#xa0;&#xa0;// &#x6307;&#x5411;&#x6563;&#x5217;&#x51b2;&#x7a81;&#x94fe;&#x8868;&#x4e2d;&#x7684;&#x4e0b;&#x4e00;&#x4e2a;&#x5143;&#x7d20;&#x7684;&#x6307;&#x9488;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int major;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;// &#x4e3b;&#x8bbe;&#x5907;&#x53f7;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int baseminor;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;// &#x8d77;&#x59cb;&#x6b21;&#x8bbe;&#x5907;&#x53f7;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;int minorct;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;// &#x8bbe;&#x5907;&#x7f16;&#x53f7;&#x7684;&#x8303;&#x56f4;&#x5927;&#x5c0f;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char name[64];&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;// &#x5904;&#x7406;&#x8be5;&#x8bbe;&#x5907;&#x7f16;&#x53f7;&#x8303;&#x56f4;&#x5185;&#x7684;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x7684;&#x540d;&#x79f0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct file_operations *fops;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;// &#x6ca1;&#x6709;&#x4f7f;&#x7528;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct cdev *cdev;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;// &#x6307;&#x5411;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x63cf;&#x8ff0;&#x7b26;&#x7684;&#x6307;&#x9488;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;} *chrdevs[CHRDEV_MAJOR_HASH_SIZE];
    </p>
    <p>
      &#x5185;&#x6838;&#x5e76;&#x4e0d;&#x662f;&#x4e3a;&#x6bcf;&#x4e00;&#x4e2a;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x7f16;&#x53f7;&#x5b9a;&#x4e49;&#x4e00;&#x4e2a; char_device_struct &#x7ed3;&#x6784;&#xff0c;
    </p>
    <p>
      &#x800c;&#x662f;&#x4e3a;&#x4e00;&#x7ec4;&#x5bf9;&#x5e94;&#x540c;&#x4e00;&#x4e2a;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x7684;&#x8bbe;&#x5907;&#x7f16;&#x53f7;&#x8303;&#x56f4;&#x5b9a;&#x4e49;&#x4e00;&#x4e2a; char_device_struct &#x7ed3;&#x6784;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432001536512" ID="ID_194646339" MODIFIED="1587605900347" TEXT="&#x91ca;&#x653e;&#x8bbe;&#x5907;&#x7f16;&#x53f7;">
<node CREATED="1432001536512" ID="ID_46282766" MODIFIED="1432108775378" TEXT="&#x91ca;&#x653e;&#x8bbe;&#x5907;&#xff1a;cleanup&#x51fd;&#x6578;&#x5f53;&#x4e2d;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void unregister_chrdev_region(dev_t first, unsigned int count);
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432001536512" ID="ID_1289513604" MODIFIED="1587605895600" TEXT="&#x52a8;&#x6001;&#x5206;&#x914d;&#x4e3b;&#x7f16;&#x53f7;">
<node COLOR="#990099" CREATED="1432001536512" ID="ID_852379625" MODIFIED="1454924875758" TEXT="&#x52a8;&#x6001;&#x5206;&#x914d;&#x4e3b;&#x7f16;&#x53f7;&#x7684;&#x4f18;&#x70b9;"/>
<node COLOR="#990099" CREATED="1432001536512" ID="ID_92675797" MODIFIED="1587606002030" TEXT="&#x52a8;&#x6001;&#x5206;&#x914d;&#x4e3b;&#x7f16;&#x53f7;&#x7684;&#x7f3a;&#x70b9;">
<node COLOR="#ff3333" CREATED="1432001536512" ID="ID_1680690855" MODIFIED="1454924935531">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7f3a;&#x70b9;&#x4e00;&#xff1a;&#x65e0;&#x6cd5;&#x63d0;&#x524d;&#x5efa;&#x7acb;&#x8bbe;&#x5907;&#x8282;&#x70b9;
    </p>
    <p>
      &#x56e0;&#x4e3a;&#x4f60;&#x65e0;&#x6cd5;&#x5f97;&#x77e5;&#x8bbe;&#x5907;&#x7684;&#x4e3b;&#x5e8f;&#x53f7;
    </p>
    <p>
      &#x4f46;&#x662f;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;/proc/devices&#x91cc;&#x9762;&#x7684;&#x6587;&#x4ef6;&#x5f97;&#x5230;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#b0b0b0" DESTINATION="ID_1680690855" ENDARROW="Default" ENDINCLINATION="118;0;" ID="Arrow_ID_1139600246" SOURCE="ID_797593665" STARTARROW="None" STARTINCLINATION="118;0;"/>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
<node COLOR="#006666" CREATED="1432001536512" ID="ID_1467083384" MODIFIED="1587607425620" TEXT="&#x52a0;&#x8f7d;&#x52a8;&#x6001;&#x5206;&#x914d;&#x4e3b;&#x7f16;&#x53f7;&#x7684;&#x6a21;&#x5757;&#x7684;&#x65b9;&#x6cd5;">
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1432001536512" ID="ID_366208074" MODIFIED="1432001536512" TEXT="1.&#x8c03;&#x7528;insmod"/>
<node CREATED="1432001536512" ID="ID_797593665" MODIFIED="1438829765122">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x8bfb;&#x53d6;/proc/devices&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;&#x7f16;&#x53f7;&#x4fe1;&#x606f;&#xff0c;&#x89e3;&#x51b3;&#x4e86;&#x65e0;&#x6cd5;&#x63d0;&#x524d;&#x5efa;&#x7acb;&#x8bbe;&#x5907;&#x8282;&#x70b9;&#x7684;&#x95ee;&#x9898;
    </p>
    <p>
      <b>&#x5f53;&#x6211;&#x4eec;&#x5728;&#x811a;&#x672c;&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x8c03;&#x7528;insmod&#x547d;&#x4ee4;&#x52a0;&#x8f7d;&#x4e86;&#x9a71;&#x52a8;&#x6a21;&#x5757;&#x4e4b;&#x540e;&#xff0c; </b>
    </p>
    <p>
      <b>insmod&#x547d;&#x4ee4;&#x4f1a;&#x5728;/proc/device&#x6587;&#x4ef6;&#x91cc;&#x9762;&#x5199;&#x5165;&#x5f53;&#x524d;&#x52a0;&#x8f7d;&#x7684;&#x9a71;&#x52a8;&#x7684; </b>
    </p>
    <p>
      <b>&#x540d;&#x79f0;&#x548c;&#x5bf9;&#x5e94;&#x7684;&#x4e3b;&#x8282;&#x70b9;&#x53f7;&#xff0c;&#x6211;&#x4eec;&#x6839;&#x636e;&#x8fd9;&#x4e2a;&#x8282;&#x70b9;&#x53f7;&#x5c31;&#x53ef;&#x4ee5;&#x8c03;&#x7528;mknod </b>
    </p>
    <p>
      <b>&#x547d;&#x4ee4;&#x6765;&#x5728;/dev&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x751f;&#x6210;&#x76f8;&#x5e94;&#x7684;&#x8bbe;&#x5907;&#x6587;&#x4ef6;&#x4e86;</b>&#x3002;
    </p>
  </body>
</html></richcontent>
<arrowlink DESTINATION="ID_1680690855" ENDARROW="Default" ENDINCLINATION="118;0;" ID="Arrow_ID_1139600246" STARTARROW="None" STARTINCLINATION="118;0;"/>
</node>
<node CREATED="1432001536512" ID="ID_1199466996" MODIFIED="1438829776314" TEXT="3.mknod &#x5efa;&#x7acb;&#x7279;&#x6b8a;&#x6587;&#x4ef6;"/>
<node CREATED="1566387592093" ID="ID_568266065" MODIFIED="1587607433110">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5229;&#x7528;<b><font color="#ff0000">device_create</font></b>&#x51fd;&#x6570;&#x53ef;&#x4ee5;&#x7701;&#x53bb;mknode&#x7684;&#x52a8;&#x4f5c;&#xff0c;&#x5728;&#x9a71;&#x52a8;&#x52a0;&#x8f7d;&#x7684;&#x65f6;&#x5019;&#x8c03;&#x7528;&#x8be5;&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x4f1a;&#x89e6;&#x53d1;user&#x5c42;&#x7684;uevent&#x673a;&#x5236;&#x53bb;&#x52a8;&#x6001;&#x5730;&#x5728;/dev&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x5efa;&#x7acb;&#x8bbe;&#x5907;&#x8282;&#x70b9;
    </p>
  </body>
</html></richcontent>
<node CREATED="1566388833031" ID="ID_374368843" MODIFIED="1566388909938">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      static class *led_class;
    </p>
    <p>
      <i><b><font size="4">static int __init led_init(void) </font></b></i>
    </p>
    <p>
      <i><b><font size="4">{</font></b></i>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* &#x6ce8;&#x518c;&#x8bbe;&#x5907;&#x53f7; */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ret = alloc_chrdev_region(&amp;devno, 0, 1, "led");
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (ret &lt; 0)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return ret;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* &#x5206;&#x914d;&#x3001;&#x521d;&#x59cb;&#x5316;&#x3001;&#x6ce8;&#x518c;cdev*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;cdev = cdev_alloc();
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (IS_ERR(cdev)) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ret = PTR_ERR(cdev);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;goto out_unregister_devno;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;cdev_init(&amp;cdev, &amp;led_fops);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;cdev.owner = THIS_MODULE;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ret = cdev_add(&amp;cdev, devno, 1);&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (ret)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;goto out_free_cdev;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* &#x521b;&#x5efa;&#x8bbe;&#x5907;&#x7c7b; */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;led_class = class_create(THIS_MODULE, "led_class");
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (IS_ERR(led_class)) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ret = PTR_ERR(led_class);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;goto out_unregister_cdev;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* &#x521b;&#x5efa;&#x8bbe;&#x5907;&#x8282;&#x70b9; */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;dev = device_create(led_class, NULL, devno, NULL, "led");
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (IS_ERR(dev)) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ret = PTR_ERR(dev);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;goto out_del_class;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return 0;
    </p>
    <p>
      
    </p>
    <p>
      out_del_class:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;class_destroy(c78x_class);
    </p>
    <p>
      out_unregister_cdev:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;cdev_del(cdev);
    </p>
    <p>
      out_free_cdev:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;kfree(cdev);
    </p>
    <p>
      out_unregister_devno:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unregister_chrdev_region(devno, 1);
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return ret;
    </p>
    <p>
      <i><b><font size="4">} </font></b></i>
    </p>
    <p>
      <i><b><font size="4">module_init(led_init);</font></b></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node COLOR="#006666" CREATED="1432001536512" ID="ID_657866416" MODIFIED="1587607422843">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6700;&#x597d;&#x7684;&#x65b9;&#x6cd5;&#xff1a;
    </p>
    <p>
      &#x9759;&#x6001;&#x548c;&#x52a8;&#x6001;&#x5206;&#x914d;&#x7efc;&#x5408;&#x4f7f;&#x7528;
    </p>
    <p>
      &#x5728;&#x7f16;&#x8bd1;&#x65f6;&#x6216;&#x8005;&#x4f7f;&#x7528;insmod&#x547d;&#x4ee4;&#x65f6;&#x6307;&#x5b9a;&#x4e3b;&#x8bbe;&#x5907;&#x7f16;&#x53f7;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1454925769685" ID="ID_1462862705" MODIFIED="1454925829870">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (scullc_major)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;result = register_chrdev_region(dev, scullc_devs, "scullc");
    </p>
    <p>
      else {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;result = alloc_chrdev_region(&amp;dev, 0, scullc_devs, "scullc");
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;scullc_major = MAJOR(dev);
    </p>
    <p>
      &#xa0;}&#xa0;&#xa0;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
</node>
</node>
<node CREATED="1432001536512" ID="ID_1336978487" MODIFIED="1587607408583" TEXT="&#x91cd;&#x8981;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;">
<node CREATED="1432001536512" ID="ID_479153915" MODIFIED="1477971432180">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      file_operations&#xff1a;
    </p>
    <p>
      &#x5c06;&#x8bbe;&#x5907;&#x53f7;&#x8ddf;&#x9a71;&#x52a8;&#x7684;&#x64cd;&#x4f5c;
    </p>
    <p>
      &#x8054;&#x7cfb;&#x8d77;&#x6765;
    </p>
  </body>
</html></richcontent>
<edge STYLE="bezier"/>
<arrowlink COLOR="#0066ff" DESTINATION="ID_1658142979" ENDARROW="Default" ENDINCLINATION="472;0;" ID="Arrow_ID_825262927" STARTARROW="None" STARTINCLINATION="410;-75;"/>
<linktarget COLOR="#ff0099" DESTINATION="ID_479153915" ENDARROW="Default" ENDINCLINATION="-160;15;" ID="Arrow_ID_911860929" SOURCE="ID_1008626152" STARTARROW="None" STARTINCLINATION="-153;15;"/>
</node>
<node CREATED="1432001536513" ID="ID_1196680412" MODIFIED="1587607413091" TEXT="file:f_op&#x5b57;&#x6bb5;">
<node CREATED="1432116064073" ID="ID_936260860" MODIFIED="1587607415495" TEXT="1.void *private_data,&#x8c03;&#x7528;open&#x65f6;&#x8fdb;&#x884c;&#x8bbe;&#x7f6e;">
<node COLOR="#ff0099" CREATED="1433831827079" ID="ID_740947904" MODIFIED="1433832217801" TEXT="1.scull_open(struct inode *inode, struct file *filp)"/>
<node CREATED="1433831838824" ID="ID_1767823674" MODIFIED="1433831866854">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.struct scull_dev *dev;
    </p>
    <p>
      dev = container_of(inode-&gt;i_cdev, struct scull_dev, cdev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433831873094" ID="ID_1658142979" MODIFIED="1477971432181">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.filp-&gt;private_data = dev;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#0066ff" DESTINATION="ID_1658142979" ENDARROW="Default" ENDINCLINATION="472;0;" ID="Arrow_ID_825262927" SOURCE="ID_479153915" STARTARROW="None" STARTINCLINATION="410;-75;"/>
</node>
</node>
</node>
<node CREATED="1432001536513" ID="ID_776943990" MODIFIED="1587607418646" TEXT="inode">
<node CREATED="1432001536513" ID="ID_1875008772" MODIFIED="1432001536513" TEXT="2&#x4e2a;&#x91cd;&#x8981;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x548c;2&#x4e2a;&#x91cd;&#x8981;&#x7684;&#x5b8f;&#x5b9a;&#x4e49;"/>
</node>
</node>
<node CREATED="1432001536513" ID="ID_99749949" MODIFIED="1587605823880" TEXT="&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x7684;&#x6ce8;&#x518c;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct cdev *my_cdev = cdev_alloc();
    </p>
    <p>
      my_cdev-&gt;ops = &amp;my_fops;
    </p>
    <p>
      void cdev_init(struct cdev *cdev, struct file_operations *fops);&#xa0;
    </p>
    <p>
      struct cdev &#x6709;&#x4e00;&#x4e2a;&#x62e5;&#x6709;&#x8005;&#x6210;&#x5458;, &#x5e94;&#x5f53;&#x8bbe;&#x7f6e;&#x4e3a; THIS_MODULE.
    </p>
    <p>
      &#x5c06;&#x5efa;&#x7acb;&#x7684;cdev&#x7ed3;&#x6784;&#x901a;&#x77e5;&#x5185;&#x6838;
    </p>
    <p>
      int cdev_add(struct cdev *dev, dev_t num, unsigned int count);
    </p>
    <p>
      num&#x662f;&#x8fd9;&#x4e2a;&#x8bbe;&#x5907;&#x54cd;&#x5e94;&#x7684;&#x7b2c;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x53f7;&#xff0c;count&#x662f;&#x5e94;&#x5f53;&#x5173;&#x8054;&#x5230;&#x8bbe;&#x5907;&#x7684;&#x8bbe;&#x5907;&#x53f7;&#x7684;&#x6570;&#x76ee;&#x3002;
    </p>
    <p>
      &#xa0;&#x65e7;&#x7684;&#x6ce8;&#x518c;&#x65b9;&#x6cd5;
    </p>
    <p>
      int register_chrdev(unsigned int major, const char *name,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct file_operations *fops);
    </p>
    <p>
      &#x65e7;&#x7684;&#x6ce8;&#x9500;&#x65b9;&#x6cd5;&#xff1a;
    </p>
    <p>
      int unregister_chrdev(unsigned int major, const char *name);
    </p>
    <p>
      unregister_chrdev_region | &#x91ca;&#x653e;&#x8bbe;&#x5907;&#x53f7;
    </p>
    <p>
      &#x5728;&#x8c03;&#x7528; cdev_del()&#x51fd;&#x6570;&#x4ece;&#x7cfb;&#x7edf;&#x6ce8;&#x9500;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x4e4b;&#x540e;&#xff0c;unregister_chrdev_region()&#x5e94;&#x8be5;&#x88ab;&#x8c03;&#x7528;&#x4ee5;&#x91ca;&#x653e;&#x539f;&#x5148;&#x7533;&#x8bf7;&#x7684;&#x8bbe;&#x5907;&#x53f7;&#xff0c;&#x5176;&#x51fd;&#x6570;&#x539f;&#x578b;&#x4e3a;&#xff1a;
    </p>
    <p>
      &#x5f15;&#x7528; void unregister_chrdev_region(dev_t first, unsigned int count);
    </p>
    <p>
      first&#x4e3a;&#x7b2c;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x53f7;&#xff0c;count&#x4e3a;&#x7533;&#x8bf7;&#x7684;&#x8bbe;&#x5907;&#x6570;&#x91cf;
    </p>
  </body>
</html></richcontent>
<node CREATED="1432001536513" ID="ID_1008626152" MODIFIED="1587605828530">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5efa;&#x7acb;cdev&#x7ed3;&#x6784;&#x5e76;&#x6ce8;&#x518c;&#xff1a;
    </p>
    <p>
      &#x5728;&#x9a71;&#x52a8;&#x6a21;&#x5757;&#x7684;&#x6ce8;&#x518c;&#x51fd;&#x6570;init&#x4e2d;
    </p>
  </body>
</html></richcontent>
<edge STYLE="bezier"/>
<arrowlink COLOR="#ff0099" DESTINATION="ID_479153915" ENDARROW="Default" ENDINCLINATION="-160;15;" ID="Arrow_ID_911860929" STARTARROW="None" STARTINCLINATION="-153;15;"/>
<node CREATED="1433831660672" ID="ID_262661610" MODIFIED="1433831996509">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.scull_setup_cdev(struct scull_dev *dev, int index)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;devno = MKDEV(scull_major, scull_minor + index);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433831678560" ID="ID_1043942769" MODIFIED="1433831697515">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.cdev_init(&amp;dev-&gt;cdev, &amp;scull_fops);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433831700918" ID="ID_1341259505" MODIFIED="1433831723422">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.cdev_add (&amp;dev-&gt;cdev, devno, 1);
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432001536513" ID="ID_1084941314" MODIFIED="1478697774167" TEXT="cdev&#x7ed3;&#x6784;&#x7684;&#x6ce8;&#x9500;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void cdev_del(struct cdev *dev);
    </p>
    <p>
      &#x8c03;&#x7528;&#x4e86;&#x8be5;&#x51fd;&#x6570;&#x4e4b;&#x540e;&#xff0c;&#x5c31;&#x4e0d;&#x5e94;&#x8be5;&#x518d;&#x6b21;&#x4f7f;&#x7528;cdev&#x4e86;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432001536513" ID="ID_236152283" MODIFIED="1587605847709">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      scull&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff1a;&#x56fe;&#x4f8b;-&gt;
    </p>
  </body>
</html></richcontent>
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct scull_dev {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct scull_qset *data;&#xa0;&#xa0;/* Pointer to first quantum set */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int quantum;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* the current quantum size */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int qset;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* the current array size */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long size;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* amount of data stored here */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int access_key;&#xa0;&#xa0;/* used by sculluid and scullpriv */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct semaphore sem;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* mutual exclusion semaphore&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct cdev cdev;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Char device structure&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      };
    </p>
    <p>
      &#xa0;
    </p>
    <p>
      struct scull_qset {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void **data;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct scull_qset *next;
    </p>
    <p>
      &#xa0;};
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;
    </p>
  </body>
</html></richcontent>
<node CREATED="1437281815462" ID="ID_116468484" MODIFIED="1471709342999">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/scull&#x7ed3;&#x6784;.png"/>
  </body>
</html></richcontent>
</node>
<node COLOR="#009900" CREATED="1437292697018" ID="ID_562626581" MODIFIED="1587605851582">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="2">struct scull_dev { </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;struct scull_qset *data;&#xa0;&#xa0;/* Pointer to first quantum set */ </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;int quantum;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* the current quantum size */ </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;int qset;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* the current array size */ </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;unsigned long size;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* amount of data stored here */ </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;unsigned int access_key;&#xa0;&#xa0;/* used by sculluid and scullpriv */ </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;struct semaphore sem;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* mutual exclusion semaphore&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/ </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;struct cdev cdev;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Char device structure&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/ </font>
    </p>
    <p>
      <font size="2">}; </font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
<node COLOR="#6600ff" CREATED="1438759078292" ID="ID_311454968" MODIFIED="1454933233979">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct scull_qset {
    </p>
    <p>
      &#xa0;void **data;
    </p>
    <p>
      &#xa0;struct scull_qset *next;
    </p>
    <p>
      &#xa0;};&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
<node CREATED="1454933175260" ID="ID_1424866307" MODIFIED="1454933227942">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct cdev {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct kobject kobj;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct module *owner;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const struct file_operations *ops;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct list_head list;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;dev_t dev;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int count;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
</node>
<node CREATED="1432001536513" FOLDED="true" ID="ID_1374754760" MODIFIED="1574904078904" TEXT="file_operations&#x7ed3;&#x6784;&#x4f53;&#x4e2d;&#x5404;&#x4e2a;&#x51fd;&#x6570;&#x5177;&#x4f53;&#x89e3;&#x6790;">
<node CREATED="1432001536513" ID="ID_1655145673" MODIFIED="1432001536513" TEXT="int (*open)(struct inode *inode, struct file *filp);"/>
<node CREATED="1432001536513" ID="ID_1487078488" MODIFIED="1438760864749" TEXT="ssize_t read(struct file *filp, char __user *buff, size_t count, loff_t &#xa;*offp); &#x5728;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;&#x4e0d;&#x8981;&#x76f4;&#x63a5;&#x4f7f;&#x7528;buff,&#x800c;&#x662f;&#x5e94;&#x8be5;&#x4f7f;&#x7528;copy_to_buffer&#x548c;copy_from_buffer&#xa;&#x5728;&#x672c;&#x4f8b;&#x5b50;&#x5f53;&#x4e2d;&#xff0c;&#x6700;&#x591a;&#x8bfb;&#x53d6;quantum&#x5b57;&#x8282;&#x4e2a;&#x6570;&#x636e;"/>
<node CREATED="1432001536513" ID="ID_1682353476" MODIFIED="1438761219013" TEXT="ssize_t write(struct file *filp, const char __user *buff, size_t count, &#xa;loff_t *offp); &#xa;if (dev-&gt;size &lt; *offp)&#xa;dev-&gt;size = *offp;&#xa;"/>
<node CREATED="1454935047524" ID="ID_1064070963" MODIFIED="1454935108517">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      loff_t (*llseek) (struct file *, loff_t, int)
    </p>
    <p>
      &#x5982;&#x679c;&#x8be5;&#x51fd;&#x6570;&#x4e3a;NULL,&#x5219;seek&#x51fd;&#x6570;&#x7684;&#x884c;&#x4e3a;&#x65e0;&#x6cd5;&#x9884;&#x6d4b;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1502348761685" ID="ID_1462092267" MODIFIED="1502348889022">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5173;&#x4e8e;unlocked_ioctl&#x548c;compat_ioctl</b>
    </p>
    <p>
      unlocked_ioctl&#x662f;&#x66ff;&#x4ee3;&#x4f20;&#x7edf;&#x7684;ioctl&#x7684;&#xff0c;&#x4f20;&#x7edf;&#x7684;ioctl&#x5728;&#x6267;&#x884c;&#x7684;&#x65f6;&#x5019;
    </p>
    <p>
      &#x4f1a;&#x8c03;&#x7528;&#x5927;&#x5185;&#x6838;&#x9501;&#xff0c;&#x62d6;&#x6162;&#x771f;&#x4e2a;&#x7cfb;&#x7edf;&#x7684;&#x5b9e;&#x65f6;&#x6027;&#xff0c;unlocked_ioctl&#x5219;&#x8981;&#x6c42;
    </p>
    <p>
      &#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x81ea;&#x5df1;&#x5b9e;&#x73b0;&#x4e92;&#x65a5;&#x7684;&#x64cd;&#x4f5c;&#x3002;
    </p>
    <p>
      compat_ioctl&#x5219;&#x662f;&#x4e3a;&#x4e86;&#x6ee1;&#x8db3;&#x5728;32bit&#x7684;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x8c03;&#x7528;64bit&#x5185;&#x6838;&#x7684;&#x64cd;&#x4f5c;&#x9700;&#x6c42;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432001536513" FOLDED="true" ID="ID_1369221128" MODIFIED="1574904081291" TEXT="scull&#x7684;&#x5185;&#x5b58;&#x4f7f;&#x7528;">
<node CREATED="1432001536513" FOLDED="true" ID="ID_1192511723" MODIFIED="1574904080121" TEXT="&#x51e0;&#x79cd;&#x52a8;&#x6001;&#x6539;&#x53d8;scull&#x5206;&#x914d;&#x7684;&#x5185;&#x5b58;&#x7684;&#x65b9;&#x6cd5;">
<node CREATED="1432001536513" ID="ID_20164375" MODIFIED="1432001536513" TEXT="1&#x7f16;&#x8bd1;&#x65f6;&#x901a;&#x8fc7;&#x6539;&#x53d8;SCULL_QUANTUM&#x548c;SCULL_QSET&#x5728;&#x5934;&#x6587;&#x4ef6;&#x4e2d;&#x7684;&#x503c;"/>
<node CREATED="1432001536513" ID="ID_849331691" MODIFIED="1432001536513" TEXT="2&#x5728;&#x6a21;&#x5757;&#x52a0;&#x8f7d;&#x65f6;&#x8bbe;&#x7f6e;scull_quantum&#x548c;scull_qset&#x7684;&#x503c;"/>
<node CREATED="1432001536513" ID="ID_1173558472" MODIFIED="1432001536513" TEXT="3.&#x5728;&#x8fd0;&#x884c;&#x65f6;&#x901a;&#x8fc7;ioctl&#x6539;&#x53d8;"/>
</node>
<node CREATED="1432001536513" ID="ID_1055152758" MODIFIED="1432001536513" TEXT="&#x4ece;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x83b7;&#x5f97;&#x6570;&#x636e;&#x65f6;&#x5185;&#x6838;&#x63d0;&#x4f9b;&#x4e86;2&#x79cd;&#x51fd;&#x6570;"/>
</node>
<node CREATED="1432001536513" FOLDED="true" ID="ID_903106643" MODIFIED="1574904082820" TEXT="&#x4f7f;&#x7528;read/write&#x51fd;&#x6570;">
<node CREATED="1432001536513" ID="ID_1229006274" MODIFIED="1432001536513" TEXT="&#x9700;&#x8981;&#x5b9e;&#x65f6;&#x66f4;&#x65b0;&#x6587;&#x4ef6;&#x6307;&#x9488;&#x7684;&#x4f4d;&#x7f6e;&#x4e00;&#x904d;&#x5185;&#x6838;&#x540c;&#x6b65;&#x5230;file&#x4e2d;"/>
<node CREATED="1432001536513" ID="ID_1555760555" MODIFIED="1432001536513" TEXT="&#x5982;&#x679c;read/write&#x5728;&#x5b8c;&#x6210;&#x4f20;&#x8f93;&#x4e4b;&#x540e;&#x7cfb;&#x7edf;&#x51fa;&#x73b0;&#x4e86;&#x9519;&#x8bef;&#xff0c;&#x5219;&#x8be5;&#x9519;&#x8bef;&#x4ee3;&#x7801;&#x5728;&#x4e0b;&#x4e00;&#x6b21;&#x8fd4;&#x56de;&#x65f6;&#x8fd4;&#x56de;"/>
<node CREATED="1432001536513" ID="ID_1443812468" MODIFIED="1432001536513" TEXT="pread&#x51fd;&#x6570;"/>
<node CREATED="1432001536513" ID="ID_758859841" MODIFIED="1432001536513" TEXT="unix&#x7248;&#x672c;&#x7684;readv&#x548c;writev&#x51fd;&#x6570;"/>
</node>
</node>
<node CREATED="1432003024602" FOLDED="true" ID="ID_1859888168" MODIFIED="1576372840670" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x5b89;&#x88c5;&#x9a71;&#x52a8;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="14"/>
<icon BUILTIN="flag-yellow"/>
<node CREATED="1432003059320" ID="ID_115436358" MODIFIED="1432003526825" TEXT="&#x7f16;&#x5199;&#x9a71;&#x52a8;&#x7684;&#x5165;&#x53e3;&#x9700;&#x8981;&#x7684;&#x51e0;&#x4e2a;&#x5b8f;&#x5b9a;&#x4e49;"/>
<node CREATED="1432003544975" FOLDED="true" ID="ID_276954039" MODIFIED="1576372839276" TEXT="&#x6ce8;&#x610f;&#x9a71;&#x52a8;&#x7684;&#x5e76;&#x53d1;&#x63a7;&#x5236;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x51e0;&#x4e2a;&#x91cd;&#x8981;&#x7684;&#x5e76;&#x53d1;&#x6765;&#x6e90;&#xff1a;
    </p>
    <p>
      1.&#x591a;&#x8fdb;&#x7a0b;
    </p>
    <p>
      2.&#x4e2d;&#x65ad;
    </p>
    <p style="text-align: left">
      3.&#x591a;&#x5904;&#x7406;&#x5668;&#x7684;&#x60c5;&#x51b5;
    </p>
  </body>
</html></richcontent>
<node CREATED="1432004059322" ID="ID_146018449" MODIFIED="1432004066521" TEXT="&#x5fc5;&#x987b;&#x662f;&#x53ef;&#x91cd;&#x5165;&#x7684;"/>
</node>
<node CREATED="1432004678686" ID="ID_1862245912" MODIFIED="1432004724346" TEXT="&#x627e;&#x5230;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x7684;&#x4fe1;&#x606f;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      printk(KERN_INFO "The process is \"%s\" (pid %i)\n",
    </p>
    <p>
      &#xa0;current-&gt;comm, current-&gt;pid);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432004894109" ID="ID_27978774" MODIFIED="1432004951122">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6ce8;&#x610f;&#x4ee5;"__"&#x5f00;&#x5934;&#x7684;&#x5185;&#x6838;&#x51fd;&#x6570;&#xff1a;
    </p>
    <p>
      &#x8fd9;&#x79cd;&#x51fd;&#x6570;&#x4e00;&#x822c;&#x662f;&#x4f4e;&#x5c42;&#x6b21;&#x7684;&#x7ec4;&#x4ef6;&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x9700;&#x8981;&#x5c0f;&#x5fc3;&#x4f7f;&#x7528;&#x624d;&#x53ef;&#x4ee5;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432005651552" ID="ID_1610355633" MODIFIED="1432005672486" TEXT="&#x7f16;&#x8bd1;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;-Makefile&#x7684;&#x4e66;&#x5199;&#x6280;&#x5de7;"/>
<node CREATED="1432005676359" FOLDED="true" ID="ID_867046733" MODIFIED="1576372834741" TEXT="&#x5b89;&#x88c5;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;">
<node CREATED="1432006476865" ID="ID_98133737" MODIFIED="1432006490556" TEXT="1.&#x88c5;&#x8f7d;&#x65f6;&#x7684;&#x53c2;&#x6570;&#x914d;&#x7f6e;"/>
<node CREATED="1432006548632" ID="ID_226430229" MODIFIED="1432006797846">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.insmod&#x7684;&#x5927;&#x4f53;&#x5b9e;&#x73b0;
    </p>
    <p>
      &#x6ce8;&#x610f;modprobe&#x7684;&#x533a;&#x522b;
    </p>
  </body>
</html></richcontent>
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.kernel/module.c &#x4e2d;&#x7684;&#x51fd;&#x6570;sys_init_module
    </p>
    <p>
      2.&#x901a;&#x8fc7;vmalloc&#x5206;&#x914d;&#x88c5;&#x8f7d;&#x6a21;&#x5757;&#x9700;&#x8981;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;
    </p>
    <p>
      3.&#x89e3;&#x6790;&#x6a21;&#x5757;&#x7684;&#x4e0a;&#x4e0b;&#x6587;&#x5e76;&#x653e;&#x8fdb;&#x5185;&#x6838;&#x7684;&#x7b26;&#x53f7;&#x8868;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432006887718" ID="ID_1457435957" MODIFIED="1432011940949" TEXT="3.&#x7248;&#x672c;&#x4f9d;&#x8d56;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5728;&#x7f16;&#x8bd1;&#x671f;&#x95f4;&#xff0c;&#x5185;&#x6838;&#x4f1a;&#x901a;&#x8fc7;vermagic.o&#x6587;&#x4ef6;&#x5c06;&#x76f8;&#x5173;&#x7684;&#x7248;&#x672c;&#x4fe1;&#x606f;&#x548c;&#x7279;&#x5b9a;&#x7684;&#x5904;&#x7406;&#x5668;&#x7684;&#x914d;&#x7f6e;&#x653e;&#x7f6e;&#x5728;&#x6a21;&#x5757;&#x5f53;&#x4e2d;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x5728;&#x52a0;&#x8f7d;&#x671f;&#x95f4;&#x53d1;&#x73b0;&#x7248;&#x672c;&#x4fe1;&#x606f;&#x548c;&#x5f53;&#x524d;&#x7684;&#x5185;&#x6838;&#x4e0d;&#x5339;&#x914d;&#xff0c;&#x5219;&#x62d2;&#x7edd;&#x8fdb;&#x884c;&#x52a0;&#x8f7d;&#x3002;
    </p>
    <p>
      2.&#x4e0e;&#x7248;&#x672c;&#x76f8;&#x5173;&#x7684;&#x4fe1;&#x606f;&#x653e;&#x7f6e;&#x5728;linux/version.h&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#xff0c;&#x8be5;&#x5934;&#x6587;&#x4ef6;&#x4f1a;&#x88ab;linux/module.h&#x6587;&#x4ef6;&#x6240;&#x5305;&#x542b;
    </p>
    <p>
      UTS_RELEASE
    </p>
    <p>
      This macro expands to a string describing the version of this kernel tree. For
    </p>
    <p>
      example, "2.6.10".
    </p>
    <p>
      LINUX_VERSION_CODE
    </p>
    <p>
      This macro expands to the binary representation of the kernel version, one byte
    </p>
    <p>
      for each part of the version release number. For example, the code for 2.6.10 is
    </p>
    <p>
      132618 (i.e., 0x02060a).* With this information, you can (almost)easily deter-
    </p>
    <p>
      mine what version of the kernel you are dealing with.
    </p>
    <p>
      KERNEL_VERSION(major,minor,release)
    </p>
    <p>
      This is the macro used to build an integer version code from the individual num-
    </p>
    <p>
      bers that build up a version number. For example, KERNEL_VERSION(2,6,10)
    </p>
    <p>
      expands to 132618. This macro is very useful when you need to compare the
    </p>
    <p>
      current version and a known checkpoint.
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432088113214" FOLDED="true" ID="ID_87416828" MODIFIED="1576372833604" TEXT="&#x5185;&#x6838;&#x7b26;&#x53f7;&#x8868;">
<node CREATED="1432088135709" ID="ID_1907481628" MODIFIED="1432088174086" TEXT="&#x6a21;&#x5757;&#x52a0;&#x8f7d;&#x540e;&#xff0c;export&#x8fc7;&#x7684;&#x7b26;&#x53f7;&#x88ab;&#x653e;&#x5230;&#x4e86;&#x5185;&#x6838;&#x7b26;&#x53f7;&#x8868;&#x5f53;&#x4e2d;"/>
<node CREATED="1432088178996" FOLDED="true" ID="ID_1085760862" MODIFIED="1576372832355" TEXT="&#x4e3b;&#x6d41;&#x7684;&#x5185;&#x6838;&#x4ee3;&#x7801;&#x90fd;&#x4f1a;&#x5b9e;&#x73b0;&#x6a21;&#x5757;&#x6808;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e3e;&#x4f8b;&#xff1a; each input USB device module stacks on the usbcore and input modules.
    </p>
  </body>
</html></richcontent>
<node CREATED="1432088619591" ID="ID_366536798" MODIFIED="1432088790413">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5982;&#x679c;&#x4e00;&#x4e2a;&#x62bd;&#x8c61;&#x662f;&#x4ee5;&#x9a71;&#x52a8;&#x7684;&#x65b9;&#x5f0f;&#x5b9e;&#x73b0;&#x7684;
    </p>
    <p>
      &#x5b83;&#x4f1a;&#x4e3a;&#x5177;&#x4f53;&#x7684;&#x5e95;&#x5c42;&#x8bbe;&#x5907;&#x63d0;&#x4f9b;&#x63d2;&#x4ef6;&#x5165;&#x53e3;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432089052476" ID="ID_121937748" MODIFIED="1432089087864">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x901a;&#x8fc7;export&#x5bfc;&#x51fa;&#x7684;&#x7b26;&#x53f7;&#x4f1a;&#x88ab;
    </p>
    <p>
      &#x653e;&#x7f6e;&#x5728;ELF section
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1432092845815" FOLDED="true" ID="ID_444477449" MODIFIED="1576372830975" TEXT="&#x521d;&#x59cb;&#x5316;&#x548c;&#x5173;&#x95ed;">
<node CREATED="1432092863080" ID="ID_474084112" MODIFIED="1432093053784" TEXT="1.&#x521d;&#x59cb;&#x5316;&#x51fd;&#x6570;&#x6ce8;&#x518c;&#x7531;&#x6a21;&#x5757;&#x63d0;&#x4f9b;&#x7684;&#x8bbe;&#x5907;&#x529f;&#x80fd;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      static int __init initialization_function(void)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* Initialization code here */
    </p>
    <p>
      }
    </p>
    <p>
      module_init(initialization_function);
    </p>
    <p>
      __init&#x6807;&#x8bc6;&#x8868;&#x660e;&#x5185;&#x6838;&#x5728;&#x52a0;&#x8f7d;&#x5b8c;&#x4e4b;&#x540e;&#x53ef;&#x4ee5;&#x5c06;&#x8fd9;&#x4e2a;&#x51fd;&#x6570;&#x5360;&#x7528;&#x7684;&#x7a7a;&#x95f4;&#x7ed9;&#x91ca;&#x653e;&#x6389;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432094071834" ID="ID_1731261128" MODIFIED="1432094093452" TEXT="2.&#x5982;&#x679c;&#x6ca1;&#x5b9a;&#x4e49;cleanup&#x51fd;&#x6570;&#xff0c;&#x5219;&#x6a21;&#x5757;&#x4e0d;&#x5141;&#x8bb8;&#x88ab;&#x5378;&#x8f7d;"/>
</node>
<node CREATED="1432094230793" FOLDED="true" ID="ID_1967107879" MODIFIED="1576372829952" TEXT="&#x521d;&#x59cb;&#x5316;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x7684;&#x9519;&#x8bef;&#x5904;&#x7406;">
<node CREATED="1432094673823" ID="ID_1294155116" MODIFIED="1432094689697" TEXT="1.goto&#x8bed;&#x53e5;&#x88ab;&#x5927;&#x91cf;&#x4f7f;&#x7528;"/>
</node>
<node CREATED="1432101460216" FOLDED="true" ID="ID_1474427469" MODIFIED="1576372828750" TEXT="&#x6a21;&#x5757;&#x52a0;&#x8f7d;&#x5f53;&#x4e2d;&#x7684;&#x7adf;&#x6001;&#x6761;&#x4ef6;">
<icon BUILTIN="flag"/>
<node CREATED="1432101545831" ID="ID_422648469" MODIFIED="1432101604359">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5728;&#x5185;&#x90e8;&#x521d;&#x59cb;&#x5316;&#x6ca1;&#x6709;&#x5b8c;&#x5168;&#x6ee1;&#x8db3;
    </p>
    <p>
      &#x5bf9;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x7684;&#x652f;&#x6301;&#x7684;&#x65f6;&#x5019;&#xff0c;
    </p>
    <p>
      &#x4e0d;&#x8981;&#x767b;&#x8bb0;&#x8be5;&#x8bbe;&#x5907;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432101663927" ID="ID_1194441092" MODIFIED="1432101715747">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x5fc5;&#x987b;&#x8ba4;&#x771f;&#x8003;&#x8651;&#x5f53;&#x521d;&#x59cb;&#x5316;&#x51fd;&#x6570;&#x5931;&#x8d25;&#x4f46;&#x662f;
    </p>
    <p>
      &#x5185;&#x6838;&#x5df2;&#x7ecf;&#x5728;&#x4f7f;&#x7528;&#x67d0;&#x4e9b;&#x767b;&#x8bb0;&#x8fc7;&#x7684;&#x8bbe;&#x5907;&#x7684;&#x60c5;&#x51b5;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node COLOR="#cc00cc" CREATED="1432176031777" ID="ID_1432799261" MODIFIED="1597047694130" POSITION="left" TEXT="&#x7b2c;&#x56db;&#x7ae0;debugging&#x6280;&#x672f;">
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1432176050648" FOLDED="true" ID="ID_1785780009" MODIFIED="1495608094367">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;debug&#x652f;&#x6301;&#xff1a;
    </p>
    <p>
      &#x4f60;&#x5e94;&#x8be5;&#x4f7f;&#x7528;&#x81ea;&#x5df1;&#x7f16;&#x8bd1;&#x7684;&#x5185;&#x6838;
    </p>
    <p>
      &#x800c;&#x4e0d;&#x662f;stock kernel(&#x5382;&#x5546;&#x53d1;&#x884c;&#x7684;&#x5185;&#x6838;)
    </p>
  </body>
</html></richcontent>
<node CREATED="1432176333299" ID="ID_376230903" MODIFIED="1432176373458">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CONFIG_DEBUG_KERNEL&#xff1a;
    </p>
    <p>
      &#x7528;&#x4e8e;&#x6253;&#x5f00;&#x5176;&#x4ed6;&#x7684;debug
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432179398988" ID="ID_1257789061" MODIFIED="1432179473367">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CONFIG_DEBUG_SLAB&#xff1a;
    </p>
    <p>
      &#x5206;&#x914d;&#x7684;&#x6bcf;&#x4e2a;&#x5b57;&#x8282;&#x88ab;&#x521d;&#x59cb;&#x5316;&#x6210;0xa5
    </p>
    <p>
      &#x91ca;&#x653e;&#x7684;&#x6bcf;&#x4e2a;&#x5b57;&#x8282;&#x88ab;&#x7f6e;&#x6210;0x6b
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432179771275" ID="ID_367532575" MODIFIED="1432179780174" TEXT="CONFIG_DEBUG_PAGEALLOC"/>
<node CREATED="1432179782834" ID="ID_1576868766" MODIFIED="1432179806466" TEXT="CONFIG_DEBUG_SPINLOCK"/>
<node CREATED="1432179907489" ID="ID_1908142802" MODIFIED="1432179918101" TEXT="CONFIG_DEBUG_SPINLOCK_SLEEP"/>
<node CREATED="1432179956634" ID="ID_1955253812" MODIFIED="1432180001776">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CONFIG_INIT_DEBUG:
    </p>
    <p>
      &#x7528;&#x4e8e;&#x68c0;&#x67e5;&#x90a3;&#x4e9b;&#x8bd5;&#x56fe;&#x8bbf;&#x95ee;
    </p>
    <p>
      &#x5728;&#x521d;&#x59cb;&#x5316;&#x8fc7;&#x7a0b;&#x4e2d;&#x5206;&#x914d;&#x7684;&#x5185;&#x5b58;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432180143681" ID="ID_639435681" MODIFIED="1432180184673">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CONFIG_DEBUG_INFO&#xff1a;
    </p>
    <p>
      &#x7528;&#x4e8e;&#x4f7f;&#x80fd;&#x4e30;&#x5bcc;&#x7684;&#x8c03;&#x8bd5;&#x4fe1;&#x606f;&#xff0c;
    </p>
    <p>
      &#x4f7f;&#x7528;gdb&#x8c03;&#x8bd5;&#x7684;&#x65f6;&#x5019;&#x5f88;&#x91cd;&#x8981;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432180226070" ID="ID_1820053654" MODIFIED="1432180234701" TEXT="CONFIG_MAGIC_SYSRQ"/>
<node CREATED="1432180248263" ID="ID_622631793" MODIFIED="1432180257249" TEXT="CONFIG_DEBUG_STACKOVERFLOW"/>
<node CREATED="1432180269518" ID="ID_1015226471" MODIFIED="1432180288422" TEXT="CONFIG_DEBUG_STACK_USAGE"/>
<node CREATED="1432180579268" ID="ID_1739227196" MODIFIED="1432180652447">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CONFIG_KALLSYMS&#xff1a;
    </p>
    <p>
      &#x5c06;&#x5185;&#x6838;&#x7684;&#x7b26;&#x53f7;&#x4fe1;&#x606f;&#x7f16;&#x8bd1;
    </p>
    <p>
      &#x8fdb;&#x5165;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#xff0c;&#x8fd9;&#x6837;OOPS
    </p>
    <p>
      &#x8f93;&#x51fa;&#x7684;&#x5217;&#x8868;&#x5c31;&#x4e0d;&#x662f;&#x6666;&#x6da9;&#x7684;
    </p>
    <p>
      &#x5341;&#x516d;&#x8fdb;&#x5236;&#x4e86;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432180730576" ID="ID_807610118" MODIFIED="1432180813387">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CONFIG_IKCONFIG,CONFIG_IKCONFIG_PROC&#xff1a;
    </p>
    <p>
      &#x5f00;&#x901a;&#x4ed6;&#x4eec;&#x5c31;&#x53ef;&#x4ee5;&#x5728;/proc&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x53d1;&#x73b0;
    </p>
    <p>
      &#x5f53;&#x524d;&#x5185;&#x6838;&#x5df2;&#x7ecf;&#x6253;&#x5f00;&#x7684;&#x6240;&#x6709;&#x7684;&#x8c03;&#x8bd5;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432185102454" ID="ID_367321518" MODIFIED="1432185115531" TEXT="CONFIG_DEBUG_DRIVER"/>
<node CREATED="1432185251784" ID="ID_446736690" MODIFIED="1432185260303" TEXT="CONFIG_SCSI_CONSTANT"/>
<node CREATED="1432185328829" ID="ID_1818950549" MODIFIED="1432185336758" TEXT="CONFIG_INPUT_EVBUG"/>
<node CREATED="1432185385604" ID="ID_1291419440" MODIFIED="1432185395128" TEXT="CONFIG_PROFILING"/>
</node>
<node CREATED="1432187122236" ID="ID_475538303" MODIFIED="1584683248941" TEXT="2.&#x6700;&#x7b80;&#x5355;&#x7684;&#x65b9;&#x6cd5;&#xff1a;printk">
<node CREATED="1432188029123" ID="ID_934436586" MODIFIED="1432188125830">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      LOGLEVEL:
    </p>
    <p>
      KERN_EMERG KERN_ALERT
    </p>
    <p>
      KERN_CRIT KERN_ERR
    </p>
    <p>
      KERN_WARNING&#xa0;&#xa0;KERN_NOTICE
    </p>
    <p>
      KERN_INFO KERN_DEBUG
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432188440873" ID="ID_21110446" MODIFIED="1432188500262">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.log&#x53ef;&#x80fd;&#x4f1a;&#x88ab;&#x9001;&#x5f80;&#x8bf8;&#x5982;&#x5b57;&#x7b26;&#x7ec8;&#x7aef;&#xff0c;
    </p>
    <p>
      &#x4e32;&#x53e3;&#xff0c;&#x5e76;&#x884c;&#x6253;&#x5370;&#x673a;&#x8fd9;&#x6837;&#x7684;&#x7ec8;&#x7aef;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1432188997835" ID="ID_1392310371" MODIFIED="1587113529433">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff0000">&#x7d27;&#x6025;&#x7a0b;&#x5ea6;&#x9ad8;&#x7684;log&#x4f1a;&#x88ab;&#x9001;&#x5f80;syslogd&#x6216;klogd </font>
    </p>
    <p>
      <font color="#ff0000">&#x4f18;&#x5148;&#x7ea7;&#x5c0f;&#x4e8e;console_loglevel </font>
    </p>
    <p>
      <font color="#ff0000">(&#x9ed8;&#x8ba4;DEFAULT_CONSOLE_LOGLEVEL)</font>
    </p>
  </body>
</html></richcontent>
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p style="font-style: normal; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-size: 14px; letter-spacing: normal; white-space: normal; line-height: 26px; font-variant: normal; font-weight: normal; text-indent: 0px; text-align: left; font-family: Arial; word-spacing: 0px; text-transform: none">
      <font color="rgb(255, 0, 0)">&#22914;&#26524; klogd &#21644; syslogd &#37117;&#36816;&#34892;&#65292;&#21017;&#26080;&#35770; console_loglevel</font>
    </p>
    <p style="font-style: normal; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-size: 14px; letter-spacing: normal; white-space: normal; line-height: 26px; font-variant: normal; font-weight: normal; text-indent: 0px; text-align: left; font-family: Arial; word-spacing: 0px; text-transform: none">
      <font color="rgb(255, 0, 0)">&#20026;&#20309;&#20540;&#65292;&#20869;&#26680;&#28040;&#24687;&#37117;&#23558;&#36861;&#21152;&#21040; /var/log/messages&#20013;&#65292; </font>
    </p>
    <p style="font-style: normal; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-size: 14px; letter-spacing: normal; white-space: normal; line-height: 26px; font-variant: normal; font-weight: normal; text-indent: 0px; text-align: left; font-family: Arial; word-spacing: 0px; text-transform: none">
      <font color="rgb(255, 0, 0)">&#21542;&#21017;&#25353;&#29031;syslogd&#30340;&#37197;&#32622;&#25991;&#20214;&#36827;&#34892;&#22788;&#29702; </font>
    </p>
    <p style="font-style: normal; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-size: 14px; letter-spacing: normal; white-space: normal; line-height: 26px; font-variant: normal; font-weight: normal; text-indent: 0px; text-align: left; font-family: Arial; word-spacing: 0px; text-transform: none">
      <font color="rgb(255, 0, 0)">LINUX&#31995;&#32479;&#21551;&#21160;&#21518;&#65292;&#30001;/etc/init.d/sysklogd&#20808;&#21518;&#21551;&#21160;klogd,syslogd&#20004;&#20010;&#23432;&#25252;&#36827;&#31243;&#12290;</font>
    </p>
    <p style="font-style: normal; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-size: 14px; letter-spacing: normal; white-space: normal; line-height: 26px; font-variant: normal; font-weight: normal; text-indent: 0px; text-align: left; font-family: Arial; word-spacing: 0px; text-transform: none">
      &#20854;&#20013;klogd&#20250;&#36890;&#36807;syslog()&#31995;&#32479;&#35843;&#29992;&#25110;&#32773;&#35835;&#21462;proc&#25991;&#20214;&#31995;&#32479;&#26469;&#20174;&#31995;&#32479;&#32531;&#20914;&#21306;
    </p>
    <p style="font-style: normal; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-size: 14px; letter-spacing: normal; white-space: normal; line-height: 26px; font-variant: normal; font-weight: normal; text-indent: 0px; text-align: left; font-family: Arial; word-spacing: 0px; text-transform: none">
      (ring buffer)&#20013;&#24471;&#21040;&#30001;&#20869;&#26680;printk()&#21457;&#20986;&#30340;&#20449;&#24687;.&#32780;<font color="rgb(255, 0, 0)">syslogd&#26159;&#36890;&#36807;klogd&#26469;&#35835;&#21462;&#31995;&#32479;&#20869;&#26680;&#20449;&#24687;. </font>
    </p>
    <p style="font-style: normal; background-color: rgb(255, 255, 255); color: rgb(54, 46, 43); font-size: 14px; letter-spacing: normal; white-space: normal; line-height: 26px; font-variant: normal; font-weight: normal; text-indent: 0px; text-align: left; font-family: Arial; word-spacing: 0px; text-transform: none">
      <font color="rgb(255, 0, 0)">&#65288;&#22914;&#26524;klogd&#27809;&#26377;&#36816;&#34892;&#65292;&#20869;&#26680;&#28040;&#24687;&#23601;&#19981;&#20250;&#20256;&#36882;&#21040;&#29992;&#25143;&#31354;&#38388;&#65292;&#36825;&#31181;&#24773;&#20917;&#19979;&#21482;&#33021;&#26597;&#30475;/proc/kmsg &#25991;&#20214; gram add&#65289;</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1433142733875" ID="ID_813850252" MODIFIED="1433142762270">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x901a;&#x8fc7;&#x91cd;&#x542f;klogd&#x53ef;&#x4ee5;
    </p>
    <p>
      &#x6307;&#x5b9a;console_loglevel
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433142765727" ID="ID_457578610" MODIFIED="1433142801722">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x901a;&#x8fc7;&#x7f16;&#x5199;&#x7a0b;&#x5e8f;&#x7684;&#x65b9;&#x5f0f;&#x6765;&#x6539;&#x53d8;
    </p>
    <p>
      console_loglevel
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433142805396" ID="ID_80847635" MODIFIED="1433142880712">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x4fee;&#x6539;&#x6587;&#x4ef6;/proc/sys/kernel/printk
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1432190661144" FOLDED="true" ID="ID_707665996" MODIFIED="1486555599159" TEXT="&#x91cd;&#x5b9a;&#x5411;&#x63a7;&#x5236;&#x53f0;&#x7684;&#x6d88;&#x606f;">
<node CREATED="1433829132836" FOLDED="true" ID="ID_341716079" MODIFIED="1475896811510" TEXT="ioctl&#x51fd;&#x6570;&#x7684;&#x8be6;&#x7ec6;&#x8bf4;&#x660e;">
<node CREATED="1433829431554" ID="ID_1117310736" MODIFIED="1433829978014">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7528;&#x6237;&#x7a7a;&#x95f4;ioctl&#x7684;&#x8c03;&#x7528;&#x539f;&#x578b;&#xff1a;
    </p>
    <pre style="font-variant: normal; text-indent: 0px; line-height: normal; word-spacing: 0px; letter-spacing: normal; text-align: start; color: rgb(121, 0, 41); text-transform: none; font-style: normal; font-weight: normal">int ioctl(int fd, unsigned long cmd, ...);</pre>
  </body>
</html></richcontent>
</node>
<node CREATED="1433829981423" FOLDED="true" ID="ID_1434851982" MODIFIED="1468822438066">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5185;&#x6838;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;&#x7684;ioctl&#x8c03;&#x7528;&#x539f;&#x578b;&#xff1a;
    </p>
    <pre style="font-variant: normal; text-indent: 0px; line-height: normal; word-spacing: 0px; letter-spacing: normal; text-align: start; color: rgb(121, 0, 41); text-transform: none; font-style: normal; font-weight: normal">int (*ioctl) (struct inode *inode, struct file *filp,
              unsigned int cmd, unsigned long arg);</pre>
  </body>
</html></richcontent>
<node CREATED="1433832890105" ID="ID_905396273" MODIFIED="1433832948974">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.<font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">optional</font><font face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;</font><tt style="word-spacing: 0px; letter-spacing: normal; line-height: normal; font-family: monospace; color: rgb(121, 0, 41); text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font face="monospace" color="rgb(121, 0, 41)">arg</font></tt><font face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;</font><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">argument is </font>
    </p>
    <p>
      <font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;&#xa0;&#xa0;passed in the form of an</font><font face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;</font><tt style="word-spacing: 0px; letter-spacing: normal; line-height: normal; font-family: monospace; color: rgb(121, 0, 41); text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font face="monospace" color="rgb(121, 0, 41)">unsigned</font></tt><font face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;</font><tt style="word-spacing: 0px; letter-spacing: normal; line-height: normal; font-family: monospace; color: rgb(121, 0, 41); text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font face="monospace" color="rgb(121, 0, 41)">long</font></tt><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">, </font>
    </p>
    <p>
      <font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;&#xa0;&#xa0;regardless of whether it was given by </font>
    </p>
    <p>
      <font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;&#xa0;&#xa0;the user as an integer or a pointer.</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433832952752" ID="ID_450626280" MODIFIED="1433833024272">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.<span style="font-size: medium; word-spacing: 0px; letter-spacing: normal; float: none; line-height: normal; font-family: helvetica, arial, sans-serif; color: rgb(0, 0, 0); display: inline !important; text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">Because type checking is disabled </font></span>
    </p>
    <p>
      <span style="font-size: medium; word-spacing: 0px; letter-spacing: normal; float: none; line-height: normal; font-family: helvetica, arial, sans-serif; color: rgb(0, 0, 0); display: inline !important; text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;&#xa0;&#xa0;on the extra argument, the compiler </font></span>
    </p>
    <p>
      <span style="font-size: medium; word-spacing: 0px; letter-spacing: normal; float: none; line-height: normal; font-family: helvetica, arial, sans-serif; color: rgb(0, 0, 0); display: inline !important; text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;&#xa0;&#xa0;can't warn you if an invalid argument </font></span>
    </p>
    <p>
      <span style="font-size: medium; word-spacing: 0px; letter-spacing: normal; float: none; line-height: normal; font-family: helvetica, arial, sans-serif; color: rgb(0, 0, 0); display: inline !important; text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;&#xa0;&#xa0;is passed to</font></span><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)"><span class="Apple-converted-space">&#xa0;</span><span class="docEmphasis" style="font-size: medium; word-spacing: 0px; letter-spacing: normal; line-height: normal; font-family: helvetica, arial, sans-serif; color: rgb(0, 0, 0); text-indent: 0px; font-weight: normal; font-variant: normal; font-style: italic; white-space: normal; text-align: start; text-transform: none"><i>ioctl</i></span><span style="font-size: medium; word-spacing: 0px; letter-spacing: normal; float: none; line-height: normal; font-family: helvetica, arial, sans-serif; color: rgb(0, 0, 0); display: inline !important; text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none">, and any associated </span></font>
    </p>
    <p>
      <span style="font-size: medium; word-spacing: 0px; letter-spacing: normal; float: none; line-height: normal; font-family: helvetica, arial, sans-serif; color: rgb(0, 0, 0); display: inline !important; text-indent: 0px; font-weight: normal; font-variant: normal; font-style: normal; white-space: normal; text-align: start; text-transform: none"><font size="medium" face="helvetica, arial, sans-serif" color="rgb(0, 0, 0)">&#xa0;&#xa0;&#xa0;bug would be difficult to spot.</font></span>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node COLOR="#0066ff" CREATED="1433835240151" ID="ID_555990805" MODIFIED="1433835368954">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;ioctl(STDIN_FILENO,TIOCLINUX,bytes)
    </p>
    <p>
      &#x6765;&#x8fdb;&#x884c;&#x865a;&#x62df;&#x7ec8;&#x7aef;&#x7684;&#x91cd;&#x5b9a;&#x5411;&#x3002;
    </p>
  </body>
</html></richcontent>
<icon BUILTIN="help"/>
</node>
</node>
</node>
<node CREATED="1433836099543" ID="ID_582463794" MODIFIED="1584683222629">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.printk,syslog&#x7cfb;&#x7edf;&#x8c03;&#x7528;
    </p>
    <p>
      &#xff0c;/proc/kmsg&#x6587;&#x4ef6;
    </p>
  </body>
</html></richcontent>
<node CREATED="1433836183768" ID="ID_291907296" MODIFIED="1433836413857">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.printk&#x4f1a;&#x76f4;&#x63a5;&#x5c06;&#x4fe1;&#x606f;&#x5199;&#x5165;&#x5230;&#x957f;&#x5ea6;&#x4e3a;_LOG_BUF_LEN
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x7684;&#x5faa;&#x73af;&#x7684;&#x7f13;&#x51b2;&#x533a;&#x5f53;&#x4e2d;&#xff0c;&#x8be5;&#x5faa;&#x73af;&#x7f13;&#x51b2;&#x533a;&#x7684;&#x5927;&#x5c0f;&#x53ef;&#x4ee5;&#x5728;&#x7f16;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x8bd1;&#x5185;&#x6838;&#x7684;&#x65f6;&#x5019;&#x6307;&#x5b9a;&#x4ece;4KB&#x5230;1MB&#x7684;&#x7a7a;&#x95f4;&#x5927;&#x5c0f;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433836297041" ID="ID_83272518" MODIFIED="1433836368482">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x6bcf;&#x6b21;printk&#x8c03;&#x7528;&#x5b8c;&#x6bd5;&#x4e4b;&#x540e;&#x90fd;&#x4f1a;&#x5524;&#x9192;&#x4efb;&#x4f55;&#x963b;&#x585e;&#x5728;syslog
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x6216;&#x8005;&#x963b;&#x585e;&#x5728;&#x8bfb;&#x53d6;/proc/kmsg&#x6587;&#x4ef6;&#x4e0a;&#x7684;&#x8fdb;&#x7a0b;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433836444075" ID="ID_582739782" MODIFIED="1433836558041">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x4ece;/proc/kmsg&#x8bfb;&#x53d6;&#x6d88;&#x606f;&#x4f1a;&#x6d88;&#x8017;&#x5185;&#x6838;&#x6d88;&#x606f;&#x7f13;&#x51b2;&#x533a;&#x5f53;&#x4e2d;&#x7684;&#x5185;&#x5bb9;&#xff0c;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#x800c;&#x8c03;&#x7528;syslog&#x4f1a;&#x5728;&#x8fd4;&#x56de;&#x6d88;&#x606f;&#x5185;&#x5bb9;&#x7684;&#x540c;&#x65f6;&#x4fdd;&#x7559;&#x6d88;&#x606f;&#x7ed9;&#x5176;&#x4ed6;&#x7684;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#x8fdb;&#x7a0b;&#x4f7f;&#x7528;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1433838675723" ID="ID_1496785705" MODIFIED="1584683234290" TEXT="4.&#x5982;&#x4f55;&#x5728;&#x5c40;&#x90e8;&#x6216;&#x5168;&#x5c40;&#x73af;&#x5883;&#x4e0b;&#x6253;&#x5f00;&#x548c;&#x5173;&#x95ed;printk">
<node CREATED="1433841585192" ID="ID_1070638651" MODIFIED="1433841669322">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      #define PDEBUG(fmt,args...) printk(KERN_DEBUG"scull:&#xa0;&#xa0;" fmt, ##args)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433843395537" ID="ID_27726491" MODIFIED="1584683237531">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x663e;&#x793a;printk&#x7684;&#x8f93;&#x51fa;&#x9891;&#x7387;&#xff1a;
    </p>
    <p>
      if (printk_ratelimit( ))
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;printk(KERN_NOTICE "The printer is still on fire\n");
    </p>
  </body>
</html></richcontent>
<node CREATED="1433843511784" ID="ID_1230330500" MODIFIED="1433843593259">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x901a;&#x8fc7;&#x4fee;&#x6539;/proc/sys/kernel/rate_limit&#x548c;
    </p>
    <p>
      /proc/sys/kernel/printk_ratelimit_burst
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x63a7;&#x5236;printk_ratelimit()&#x7684;&#x4f7f;&#x80fd;&#x901f;&#x5ea6;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1433844034617" ID="ID_346202796" MODIFIED="1587113529527" TEXT="5.&#x5185;&#x6838;&#x63d0;&#x4f9b;&#x4e86;&#x5c06;&#x8bbe;&#x5907;&#x53f7;&#x8f6c;&#x6362;&#x4e3a;&#x5b57;&#x7b26;&#x4e32;&#x7684;&#x5b8f;&#x5b9a;&#x4e49;">
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int print_dev_t(char *buffer, dev_t dev);
    </p>
    <p>
      char *format_dev_t(char *buffer, dev_t dev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433853570573" FOLDED="true" ID="ID_434256939" MODIFIED="1574938631588">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      6.&#x6709;&#x4e00;&#x4e9b;&#x6280;&#x672f;&#x53ef;&#x4ee5;&#x7528;&#x4e8e;&#x5411;&#x5185;&#x6838;&#x8be2;&#x95ee;&#x4e00;&#x4e9b;&#x4fe1;&#x606f;&#xff1a;
    </p>
    <p>
      1.&#x5728;/proc&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x521b;&#x5efa;&#x4e00;&#x4e9b;&#x6587;&#x4ef6;
    </p>
    <p>
      2.&#x4f7f;&#x7528;ioctl&#x9a71;&#x52a8;&#x7684;&#x65b9;&#x6cd5;
    </p>
    <p>
      3.&#x901a;&#x8fc7;sysfs&#x6765;&#x66b4;&#x9732;&#x4e00;&#x4e9b;&#x5c5e;&#x6027;
    </p>
  </body>
</html></richcontent>
<node CREATED="1433853693127" ID="ID_1421830166" MODIFIED="1433853717125">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      sysfs&#x91cd;&#x70b9;&#x5728;14&#x7ae0;&#x8fdb;&#x884c;
    </p>
    <p>
      &#x4ecb;&#x7ecd;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1433853739522" ID="ID_861178982" MODIFIED="1598249921459">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      7.&#x4f7f;&#x7528;/proc&#x6587;&#x4ef6;&#x7cfb;&#x7edf;
    </p>
  </body>
</html></richcontent>
<node CREATED="1433925949961" FOLDED="true" ID="ID_1095317054" MODIFIED="1486555599160">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      /proc&#x662f;&#x4e00;&#x4e2a;&#x7279;&#x6b8a;&#x7684;&#x7eaf;&#x8f6f;&#x4ef6;&#x6784;&#x9020;&#x7684;&#x6587;&#x4ef6;&#x7cfb;&#x7edf;
    </p>
    <p>
      &#x8be5;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;&#x6bcf;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x90fd;&#x8ddf;&#x5185;&#x6838;&#x7684;&#x4e00;&#x4e2a;
    </p>
    <p>
      &#x51fd;&#x6570;&#x76f8;&#x5173;&#xff0c;&#x5e76;&#x7531;&#x51fd;&#x6570;&#x4ea7;&#x751f;&#x8be5;&#x6587;&#x4ef6;&#x91cc;&#x9762;&#x7684;&#x5185;&#x5bb9;
    </p>
  </body>
</html></richcontent>
<node CREATED="1433926049601" ID="ID_1685977447" MODIFIED="1433926071983">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      /proc/modules&#x8bb0;&#x5f55;&#x5f53;
    </p>
    <p>
      &#x524d;&#x5185;&#x6838;&#x52a0;&#x8f7d;&#x7684;&#x6a21;&#x5757;&#x4fe1;&#x606f;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1433926035333" ID="ID_1426389848" MODIFIED="1433926418218">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      /proc&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x7684;&#x672c;&#x6765;&#x76ee;&#x7684;&#x662f;&#x4e3a;&#x4e86;&#x5f97;&#x5230;&#x7cfb;&#x7edf;&#x8fd0;&#x884c;&#x7684;&#x4fe1;&#x606f;&#xff0c;&#x4f46;&#x662f;&#x73b0;&#x5728;&#x5185;&#x6838;&#x5f00;&#x53d1;&#x4eba;
    </p>
    <p>
      &#x5458;&#x5e76;&#x4e0d;&#x5efa;&#x8bae;&#x5c06;&#x9a71;&#x52a8;&#x7684;&#x4fe1;&#x606f;&#x901a;&#x8fc7;/proc&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x5c55;&#x73b0;&#x51fa;&#x6765;&#xff0c;&#x5efa;&#x8bae;&#x4f7f;&#x7528;&#x7684;&#x662f;sysfs
    </p>
    <p>
      &#x7cfb;&#x7edf;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433926725914" FOLDED="true" ID="ID_401225256" MODIFIED="1486555599160" TEXT="&#x5728;/proc&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x521b;&#x5efa;&#x53ea;&#x8bfb;&#x6587;&#x4ef6;">
<node COLOR="#0066ff" CREATED="1433926759500" ID="ID_1740183262" MODIFIED="1433926841019">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x5fc5;&#x987b;&#x5b9e;&#x73b0;&#x4e00;&#x4e2a;&#x51fd;&#x6570;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x7528;&#x4e8e;&#x5411;&#x8be5;&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x5199;&#x5165;&#x6570;&#x636e;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1433926899129" FOLDED="true" ID="ID_351486175" MODIFIED="1475896811512">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.int (*read_proc)(char *page, char **start, off_t offset, int count,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;int *eof, void *data);
    </p>
  </body>
</html></richcontent>
<richcontent TYPE="NOTE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="2">1.</font><font face="Verdana, Arial, Helvetica, sans-serif" color="rgb(0, 0, 0)" size="2">&#x7b2c;&#x4e00;&#x4e2a;&#x53c2;&#x6570;&#xff1a;&#x4e3a;&#x5565;&#x53eb;page&#xff1f;&#x7b54;&#x6848;&#x5c31;&#x662f;&#x5982;&#x679c;&#x5bf9;proc&#x6587;&#x4ef6;&#x8c03;&#x7528;&#x8bfb;&#x64cd;&#x4f5c;&#xff0c;&#x5185;&#x6838;&#x4f1a;&#x5206;&#x914d;&#x4e00;&#x4e2a;&#x9875;&#x5927;&#x5c0f;&#x7684;&#x7f13;&#x51b2;&#x533a;&#x3002;&#x5982;&#x4f55;&#x8f93;&#x51fa;&#x5927;&#x4e8e;&#x4e00;&#x4e2a;&#x9875;&#x7684;&#x6570;&#x636e;&#x5462;&#xff0c;&#x8fd9;&#x5f97;&#x4f9d;&#x8d56;&#x4e8e;&#x7b2c;&#x4e8c;&#x4e2a;&#x548c;&#x7b2c;&#x4e09;&#x4e2a;&#x53c2;&#x6570;&#x4e86;&#x3002;</font>
    </p>
    <p>
      <font face="Verdana, Arial, Helvetica, sans-serif" color="rgb(0, 0, 0)" size="2">&#x5bf9;&#x4e8e;proc&#x6587;&#x4ef6;&#xff0c;&#x4e00;&#x6b21;read&#x64cd;&#x4f5c;&#x6700;&#x591a;&#x53ea;&#x80fd;&#x8bfb;&#x53d6;&#x4e00;&#x4e2a;page&#x7684;&#x6570;&#x636e;&#xff0c;&#x5982;&#x679c;&#x9700;&#x8981;&#x8bfb;&#x53d6;&#x5927;&#x4e8e;&#x4e00;&#x4e2a;&#x9875;&#x7684;&#x6570;&#x636e;&#x9700;&#x8981;&#x4fdd;&#x5b58;read&#x7684;&#x8fd4;&#x56de;&#x503c;&#xff0c;&#x7136;&#x540e;&#x4f7f;&#x7528;lseek&#x8bbe;&#x5b9a;offset&#xff0c;&#x7136;&#x540e;&#x518d;&#x6b21;&#x8c03;&#x7528;read&#x3002; </font>
    </p>
    <p>
      <font face="Verdana, Arial, Helvetica, sans-serif" color="rgb(0, 0, 0)" size="2">2.</font><font size="2">start&#x548c;off&#x53c2;&#x6570;&#xff1a;off&#x5bf9;&#x5e94;&#x4e8e;lseek&#x91cc;&#x9762;&#x7684;offset&#xff08;lseek whence&#x4e3a;SEEK_END&#xff0c;offset&#x4e3a;&#x8d1f; &#x7684;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x4f20;&#x8fdb;&#x6765;&#x7684;off&#x4e3a;&#x96f6;&#xff0c;&#x5177;&#x4f53;&#x539f;&#x56e0;&#x5f85;&#x8003;&#x53e4;&#xff09;&#x3002; </font>
    </p>
    <p>
      <font size="2">&#x5982;&#x679c;&#x4e0d;&#x8bbe;&#x7f6e;*start&#x7684;&#x503c;&#xff0c;off&#x7684;&#x53d6;&#x503c;&#x53ea;&#x80fd;&#x5728;[0, count - 1]&#x4e4b;&#x95f4;,&#x4e14;&#x80fd;&#x591f;&#x8bfb;&#x53d6;&#x7684;&#x6570;&#x636e;&#x5927;&#x5c0f;&#x4e3a;&#xff1a;count - off&#x3002;&#x53ef;&#x4ee5;&#x7406;&#x89e3;&#x7cfb;&#x7edf;&#x62f7;&#x8d1d;&#x4e86; [page + off, page+count - 1]&#x4e4b;&#x95f4;&#x7684;&#x6570;&#x636e;&#x5230;&#x7528;&#x6237;&#x7684;buffer&#x91cc;&#x3002;&#x5982;&#x679c;off&#x7684;&#x53d6;&#x503c;&#x8d85;&#x51fa;&#x8303;&#x56f4;&#xff0c;read&#x5c06;&#x8bfb;&#x4e0d;&#x5230;&#x6570;&#x636e;&#x3002;&#x5982;&#x679c;&#x8bbe;&#x7f6e;&#x4e86;*start&#x7684;&#x503c;&#xff0c;&#x7cfb;&#x7edf;&#x8ba4;&#x4e3a;*start&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;&#x5c31;&#x662f;off&#x6307;&#x5b9a;&#x7684;&#x5730;&#x5740;&#xff0c;off&#x7684;&#x503c;&#x4f1a;&#x88ab;&#x5ffd;&#x7565;&#xff0c;&#x7cfb;&#x7edf;&#x4f1a;&#x62f7;&#x8d1d;[start&#xff0c; start+count-1]&#x4e4b;&#x95f4;&#x7684;&#x6570;&#x636e;&#x5230;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x3002;</font><font color="#990099" size="2"><b>&#x5f53;&#x7136;&#x6211;&#x4eec;&#x5728;&#x5b9e;&#x73b0;start&#x5730;&#x5740;&#x7684;&#x5b9a;&#x4f4d;&#x65f6;&#xff0c;&#x53ef;&#x80fd;&#x4f1a;&#x9700;&#x8981;off&#x7684;&#x503c;</b></font><font color="#ff0066" size="2">&#x3002;</font><font size="2">&#xa0; </font>
    </p>
    <p>
      <font face="Verdana, Arial, Helvetica, sans-serif" color="rgb(0, 0, 0)" size="2">3. count &#x53c2;&#x6570;&#x4e0e;read&#x4e2d;&#x7684;count&#x4e00;&#x81f4; </font>
    </p>
    <p>
      <font size="2">4. eof&#x53c2;&#x6570;&#xff0c;&#x8bbe;&#x7f6e;&#x4e86;&#x8fd9;&#x4e2a;&#x53c2;&#x6570;&#x8868;&#x660e;&#x4e0d;&#x60f3;&#x518d;&#x63d0;&#x4f9b;&#x6570;&#x636e;&#x4e86;&#xff0c;&#x795e;&#x9a6c;&#x610f;&#x601d;&#x5462;&#xff1f;&#x5982;&#x679c;&#x4e0d;&#x8bbe;&#x7f6e;&#x8fd9;&#x4e2a;&#x53c2;&#x6570;&#xff0c;&#x5bf9;&#x4e8e;&#x4e0a;&#x9762;&#x8bf4;&#x7684;start&#x4e3a;&#x7a7a;&#x7684;&#x60c5;&#x51b5;&#xff0c;read_proc&#x8fd4;&#x56de;&#x540e;&#xff0c;&#x7cfb;&#x7edf;&#x5982;&#x679c;&#x53d1;&#x73b0; &#xff08;count - off&#xff09; &lt; count &#x4f1a;&#x63a5;&#x7740;&#x4e0b;&#x53d1;&#x5199;&#x8bf7;&#x6c42;&#xff0c;&#x8bfb;&#x53d6;off&#x5927;&#x5c0f;&#x7684;&#x6570;&#x636e;&#x3002;&#x4f8b;&#x5982;&#xff1a;&#x6709;&#x8fd9;&#x6837;&#x7684;&#x8bfb;&#x53d6;&#x64cd;&#x4f5c;&#xff1a; </font>
    </p>
  </body>
</html></richcontent>
<node COLOR="#009900" CREATED="1437289477857" ID="ID_1952722668" MODIFIED="1437289716389">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6839;&#x636e;LDDR3&#x7684;&#x89e3;&#x91ca;&#xff1a;
    </p>
    <p>
      start&#x662f;&#x4e3a;&#x4e86;&#x6807;&#x5fd7;&#x8fd4;&#x56de;&#x7ed9;&#x7528;&#x6237;&#x7684;&#x6570;&#x636e;&#x7684;&#x4f4d;&#x7f6e;&#x3002;&#x5982;&#x679c;start&#x6ca1;&#x6709;&#x88ab;&#x8bbe;&#x7f6e;&#xff0c;
    </p>
    <p>
      &#x90a3;&#x4e48;offset&#x503c;&#x5c31;&#x88ab;&#x8ba4;&#x4e3a;&#x4e00;&#x76f4;&#x662f;0.&#x5982;&#x679c;start&#x88ab;&#x8bbe;&#x7f6e;&#x4e86;&#xff0c;&#x90a3;&#x4e48;offset&#x5c31;&#x4f1a;
    </p>
    <p>
      &#x8d77;&#x4f5c;&#x7528;&#xff0c;&#x800c;&#x4e14;&#x6570;&#x636e;&#x4f1a;&#x88ab;&#x653e;&#x7f6e;&#x5728;offset&#x6307;&#x5b9a;&#x7684;&#x4f4d;&#x7f6e;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node COLOR="#ff3366" CREATED="1437290700534" ID="ID_1713940964" MODIFIED="1437290965206">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      start&#x7684;&#x53e6;&#x4e00;&#x4e2a;&#x7528;&#x9014;&#xff1a;
    </p>
    <p>
      &#x5f53;&#x6211;&#x4eec;&#x5927;&#x91cf;&#x8c03;&#x7528;proc_read&#x65f6;&#xff0c;&#xff08;ASCII representation of kernel data structures&#xff09;
    </p>
    <p>
      ASCII&#x4ee3;&#x8868;&#x7684;&#x5185;&#x6838;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x4f1a;&#x5728;2&#x6b21;&#x8c03;&#x7528;&#x4e4b;&#x95f4;&#x53d8;&#x5316;&#xff0c;&#x5bfc;&#x81f4;&#x6570;&#x636e;&#x7684;&#x4e0d;&#x4e00;&#x81f4;&#x6027;&#xff0c;&#x6211;&#x4eec;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x5c06;*start&#x8bbe;&#x7f6e;&#x6210;&#x4e3a;&#x4e00;&#x4e2a;&#x5c0f;&#x7684;&#x6574;&#x6570;&#xff0c;&#x8c03;&#x7528;&#x8005;&#x53ef;&#x4ee5;&#x7528;&#x5b83;&#x6765;&#x8bbe;&#x7f6e;filp-&gt;f_ops&#x6765;&#x8bb0;&#x5f55;
    </p>
    <p>
      read_proc&#x8c03;&#x7528;&#x7684;&#x6b21;&#x6570;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1437396702899" ID="ID_312476130" MODIFIED="1437558473642">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct proc_dir_entry *create_proc_read_entry(const char *name,
    </p>
    <p>
      &#xa0;mode_t mode, struct proc_dir_entry *base,
    </p>
    <p>
      &#xa0;read_proc_t *read_proc, void *data);
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x7528;&#x4e8e;&#x521b;&#x5efa;proc&#x6587;&#x4ef6;
    </p>
    <p>
      remove_proc_entry("scullmem", NULL /* parent dir */);
    </p>
    <p>
      &#x64a4;&#x9500;create_proc_read_entry&#x6240;&#x5efa;&#x7acb;&#x7684;&#x76ee;&#x5f55;&#x6587;&#x4ef6;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1437656532055" ID="ID_76553634" MODIFIED="1598249928169">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff0033">&#x4f7f;&#x7528;seq_file&#x63a5;&#x53e3;</font>
    </p>
    <p>
      &#x7531;&#x4e8e;procfs&#x9ed8;&#x8ba4;&#x53ea;&#x662f;&#x4f7f;&#x7528;&#x4e00;&#x9875;&#x7684;&#x5185;&#x5b58;&#xff0c;&#x6240;&#x4ee5;&#x5728;&#x64cd;&#x4f5c;&#x5927;&#x91cf;&#x7684;&#x6570;&#x636e;&#x7684;&#x65f6;&#x5019;
    </p>
    <p>
      &#x9700;&#x8981;&#x81ea;&#x5df1;&#x5728;read_proc&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x5b9e;&#x73b0;&#x8fed;&#x4ee3;&#xff0c;&#x8fd9;&#x6837;&#x5f88;&#x5bb9;&#x6613;&#x51fa;&#x73b0;&#x9519;&#x8bef;&#xff0c;&#x4e8e;&#x662f;
    </p>
    <p>
      &#x5185;&#x6838;&#x5f00;&#x53d1;&#x8005;&#x62bd;&#x8c61;&#x51fa;seq_file&#x63a5;&#x53e3;&#xff0c;&#x6765;&#x7b80;&#x5316;&#x4e0a;&#x8ff0;&#x7684;&#x64cd;&#x4f5c;
    </p>
  </body>
</html></richcontent>
<node CREATED="1437817384454" ID="ID_113460327" MODIFIED="1598254308821">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/seq_file.jpg" />
  </body>
</html></richcontent>
</node>
<node CREATED="1437817448765" ID="ID_1352229131" MODIFIED="1598250022308">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      seq_file&#x5404;&#x63a5;&#x53e3;&#x51fd;&#x6570;&#x7684;&#x8bf4;&#x660e;
    </p>
    <p>
      struct seq_file {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;char *buf; size_t size; size_t from;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;size_t count; loff_t index; loff_t read_pos;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;u64 version; struct mutex lock;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;<font color="#ff0033">const struct seq_operations *op;</font>&#xa0;void *private;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<node CREATED="1437817767774" ID="ID_1696818725" MODIFIED="1437817851071">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3">1.</font><font size="3" face="Consolas, monospace" color="rgb(0, 0, 240)">void&#xa0;*&#xa0;(*start)&#xa0;(structseq_file&#xa0;*m,&#xa0;loff_t&#xa0;*pos);</font>
    </p>
    <p>
      <font size="3" color="#0000f0">m&#xff1a;&#x6307;&#x5411;&#x7684;&#x662f;&#x672c;seq_file&#x7684;&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x5728;&#x6b63;&#x5e38;&#x60c5;&#x51b5;&#x4e0b;&#x65e0;&#x9700;&#x5904;&#x7406;&#x3002;</font>
    </p>
    <p>
      <font size="3" face="Consolas, monospace" color="#0000f0">pos&#xff1a;&#x662f;&#x4e00;&#x4e2a;&#x6574;&#x578b;&#x4f4d;&#x7f6e;&#x503c;&#xff0c;&#x6307;&#x793a;&#x5f00;&#x59cb;&#x8bfb;&#x53d6;&#x7684;&#x4f4d;&#x7f6e;&#x3002;</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1437817975029" ID="ID_83436741" MODIFIED="1437818095596">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3">2.</font><font size="3" face="Tahoma" color="rgb(102, 102, 102)">seq_file&#x5185;&#x90e8;&#x673a;&#x5236;&#x53ef;&#x80fd;&#x4f1a;&#x4f7f;&#x7528;show&#x65b9;&#x6cd5;&#x83b7;&#x53d6;start&#x8fd4;&#x56de;&#x503c;&#x6307;&#x5411;&#x7684; </font>
    </p>
    <p>
      <font size="3" face="Tahoma" color="rgb(102, 102, 102)">&#x7ed3;&#x6784;&#x4f53;&#x4e2d;&#x7684;&#x6570;&#x636e;&#x5230;&#x5185;&#x90e8;&#x7f13;&#x5b58;&#xff0c;&#x5e76;&#x9002;&#x65f6;&#x9001;&#x5f80;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x3002; </font>
    </p>
    <p>
      <font size="3" color="#0000f0">int&#xa0;(*show)&#xa0;(struct seq_file&#xa0;*m,&#xa0;void&#xa0;*v); </font>
    </p>
    <p>
      <font size="3" face="Tahoma" color="rgb(102, 102, 102)">&#x6240;&#x4ee5;show&#x65b9;&#x6cd5;&#x5c31;&#x662f;&#x8d1f;&#x8d23;&#x5c06;v&#x6307;&#x5411;&#x5143;&#x7d20;&#x4e2d;&#x7684;&#x6570;&#x636e;&#x8f93;&#x51fa;&#x5230;seq_file&#x7684; </font>
    </p>
    <p>
      <font size="3" face="Tahoma" color="rgb(102, 102, 102)">&#x5185;&#x90e8;&#x7f13;&#x5b58;&#xff0c;&#x4f46;&#x662f;&#x5176;&#x4e2d;&#x5fc5;&#x987b;&#x501f;&#x52a9;seq_file&#x63d0;&#x4f9b;&#x7684;&#x4e00;&#x4e9b;&#x7c7b;&#x4f3c; </font>
    </p>
    <p>
      <font size="3" face="Tahoma" color="rgb(102, 102, 102)">printf&#x7684;&#x63a5;&#x53e3;&#x51fd;&#x6570;</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1437818493403" ID="ID_107919400" MODIFIED="1437818554016">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3">3.</font><font class="Apple-style-span" size="3" face="Consolas, monospace" color="#0000f0">void&#xa0;*&#xa0;(*next)&#xa0;(struct seq_file&#xa0;*m,&#xa0;void&#xa0;*v,&#xa0;loff_t&#xa0;*pos);</font>
    </p>
    <p>
      <font class="Apple-style-span" size="3" face="Consolas, monospace" color="#0000f0">v&#xff1a;&#x662f;&#x4e4b;&#x524d;&#x8c03;&#x7528;start&#x6216;next&#x8fd4;&#x56de;&#x7684;&#x5143;&#x7d20;&#x6307;&#x9488; </font>
    </p>
    <p>
      <font class="Apple-style-span" size="3" color="#0000f0">pos&#xff1a;&#x9700;&#x8981;&#x79fb;&#x52a8;&#x5230;&#x7684;&#x5143;&#x7d20;&#x7d22;&#x5f15;&#x503c;&#x3002;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1439028958941" ID="ID_588127660" MODIFIED="1598250016213">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;seq_file&#x63a5;&#x53e3;&#x7684;&#x6b65;&#x9aa4;
    </p>
  </body>
</html></richcontent>
<node CREATED="1439030740675" ID="ID_1540360466" MODIFIED="1439030939551">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff3300"><b>1.</b></font>&#xa0;struct proc_dir_entry *entry;
    </p>
    <p>
      entry = create_proc_entry("scullseq", 0, NULL);
    </p>
    <p>
      &#x521b;&#x5efa;&#x4e00;&#x4e2a;entry&#x7ed3;&#x6784;&#x4f53;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1439030944229" ID="ID_1395278855" MODIFIED="1439125294638">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="2" color="#ff3300">2.&#xa0;&#x58f0;&#x660e;&#x4e00;&#x4e2a;file_operations&#x7ed3;&#x6784;&#x4f53; </font>
    </p>
    <p>
      <font size="2" color="#ff3300">static struct file_operations scull_proc_ops = { </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.owner&#xa0;&#xa0;&#xa0;= THIS_MODULE, </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.open&#xa0;&#xa0;&#xa0;&#xa0;= scull_proc_open, </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.read&#xa0;&#xa0;&#xa0;&#xa0;= seq_read, </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.llseek&#xa0;&#xa0;= seq_lseek, </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.release = seq_release </font>
    </p>
    <p>
      <font size="2" color="#ff3300">}; </font>
    </p>
    <p>
      &#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x7684;open,read,llseek,release&#x51fd;&#x6570;
    </p>
    <p>
      &#x90fd;&#x662f;&#x7cfb;&#x7edf;&#x81ea;&#x5b9a;&#x4e49;&#x7684;&#x51fd;&#x6570;&#xff0c;&#x5728;&#x5b9a;&#x4e49;cdev&#x7684;&#x65f6;&#x5019;&#x5c06;
    </p>
    <p>
      &#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x6ce8;&#x518c;&#x5230;Inode&#x5bf9;&#x5e94;&#x7684;&#x64cd;&#x4f5c;&#x51fd;&#x6570;&#x91cc;&#x9762;
    </p>
    <p>
      <font color="#ff3300">entry-&gt;proc_fops = &amp;scull_proc_ops;&#x8bbe;&#x7f6e;&#x81ea;&#x5df1;&#x7684;proc_fops</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1439124558740" ID="ID_1176615280" MODIFIED="1439125152114">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff3300">3. </font>
    </p>
    <p>
      &#x5728;&#x8c03;&#x7528;&#x6587;&#x4ef6;&#x64cd;&#x4f5c;&#x51fd;&#x6570;&#x7684;open&#x51fd;&#x6570;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5373;&#x8c03;&#x7528;scull_proc_open
    </p>
    <p>
      &#x51fd;&#x6570;&#x7684;&#x65f6;&#x5019;&#x9700;&#x8981;&#x505a;&#x5982;&#x4e0b;&#x7684;&#x64cd;&#x4f5c;&#xff1a;
    </p>
    <p>
      static int scull_proc_open(struct inode *inode, struct file *file)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return seq_open(file, &amp;scull_seq_ops);
    </p>
    <p>
      }
    </p>
    <p>
      <font size="2" color="#ff3300">static struct seq_operations scull_seq_ops = { </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.start = scull_seq_start, </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.next&#xa0;&#xa0;= scull_seq_next, </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.stop&#xa0;&#xa0;= scull_seq_stop, </font>
    </p>
    <p>
      <font size="2" color="#ff3300">&#xa0;&#xa0;&#xa0;&#xa0;.show&#xa0;&#xa0;= scull_seq_show </font>
    </p>
    <p>
      <font size="2" color="#ff3300">};</font>
    </p>
    <p>
      <font color="#330099">scull_seq_ops&#x9700;&#x8981;&#x81ea;&#x5df1;&#x8fdb;&#x884c;&#x5b9a;&#x4e49;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1439130329193" ID="ID_476494284" MODIFIED="1439130370443">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5173;&#x4e8e;&#x4e00;&#x4e9b;&#x5177;&#x4f53;&#x7684;debug&#x5de5;&#x5177;&#x7684;&#x4f7f;&#x7528;&#x4ecb;&#x7ecd;</b>
    </p>
  </body>
</html></richcontent>
<icon BUILTIN="flag-orange"/>
</node>
<node CREATED="1458193894637" ID="ID_1888645789" MODIFIED="1458194028161">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>8.mount debugfs&#x7684;&#x65b9;&#x5f0f;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487914213021" ID="ID_1288142286" MODIFIED="1597047708290">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      9. dynamic debug
    </p>
    <p>
      <font color="#e71010">&#x5141;&#x8bb8;&#x4f60;&#x52a8;&#x6001;&#x5730;&#x4f7f;&#x80fd;&#x6216;&#x8005;&#x7981;&#x6b62;&#x5185;&#x6838;&#x4ee3;&#x7801;&#x6765;&#x83b7;&#x53d6;&#x6f5c;&#x5728;&#x7684;&#x5185;&#x6838;&#x4fe1;&#x606f; </font>
    </p>
    <p>
      <font color="#e71010">&#x5982;&#x679c;CONFIG_DYNAMIC_DEBUG&#x88ab;&#x8bbe;&#x7f6e;&#xff0c;&#x90a3;&#x4e48; </font>
    </p>
    <p>
      <font color="#e71010">&#x6240;&#x6709;&#x7684;pr_debug()/dev_dbg()&#x8c03;&#x7528;&#x548c;print_hex_dump_debug()/print_hex_dump_bytes() </font>
    </p>
    <p>
      <font color="#e71010">&#x53ef;&#x4ee5;&#x5728;&#x6bcf;&#x4e2a;&#x8c03;&#x7528;&#x70b9;&#x88ab;&#x52a8;&#x6001;&#x5730;&#x4f7f;&#x7528;</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1487915123470" ID="ID_1789223037" MODIFIED="1487915396818">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x901a;&#x8fc7;&#x5339;&#x914d;0&#x548c;1&#x7684;&#x7ec4;&#x5408;&#xff0c;&#x7b80;&#x5355;&#x7684;&#x67e5;&#x8be2;&#x8bed;&#x8a00;&#x53ef;&#x4ee5;&#x6253;&#x5f00;&#x6216;&#x8005;&#x5173;&#x95ed;
    </p>
    <p>
      &#x8c03;&#x8bd5;&#x8bed;&#x53e5;&#x3002;
    </p>
    <p>
      &#x901a;&#x8fc7;&#x4e0b;&#x5217;&#x5339;&#x914d;&#x65b9;&#x5f0f;:
    </p>
    <p>
      source filename
    </p>
    <p>
      function name
    </p>
    <p>
      line number (including ranges of line numbers)
    </p>
    <p>
      module name
    </p>
    <p>
      format string
    </p>
    <p>
      2.&#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x4e2a;debug&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x7684;&#x63a7;&#x5236;&#x6587;&#x4ef6;&lt;debugfs&gt;/dynamic_debug/control
    </p>
    <p>
      &#x7528;&#x4e8e;&#x5e2e;&#x52a9;&#x4f60;&#x5c55;&#x793a;&#x5df2;&#x77e5;&#x7684;debug&#x8bed;&#x53e5;&#x7684;&#x5217;&#x8868;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1502783784598" ID="ID_97062507" MODIFIED="1502783905272">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x6253;&#x5f00;&#x52a8;&#x6001;&#x8c03;&#x8bd5;</b>
    </p>
    <p>
      <font color="#ea0909">#echo 'file &#x6587;&#x4ef6;&#x540d; +p' &gt; /sys/kernel/debug/dynamic_debug/control</font>
    </p>
    <p>
      
    </p>
    <p>
      <b>&#x5173;&#x95ed;&#x52a8;&#x6001;&#x8c03;&#x8bd5;</b>
    </p>
    <p>
      <font color="#d10909">#echo 'file &#x6587;&#x4ef6;&#x540d; -p' &gt; /sys/kernel/debug/dynamic_debug/control</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487915420407" ID="ID_254564939" MODIFIED="1487915507042">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x63a7;&#x5236;&#x52a8;&#x6001;debug&#x7684;&#x884c;&#x4e3a;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597903257100" ID="ID_522893566" MODIFIED="1597903371381">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman">#if defined(CONFIG_DYNAMIC_DEBUG) </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#define dev_dbg(dev, format, ...)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">do {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;dynamic_dev_dbg(dev, format, ##__VA_ARGS__); \ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">} while (0) </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#elif defined(DEBUG) </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#define dev_dbg(dev, format, arg...)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;dev_printk(KERN_DEBUG, dev, format, ##arg) </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#else </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#define dev_dbg(dev, format, arg...)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">({&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;if (0)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dev_printk(KERN_DEBUG, dev, format, ##arg); \ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">}) </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#endif </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#21487;&#20197;&#30475;&#21040;&#65292;&#22914;&#26524;&#20869;&#26680;&#37197;&#32622;&#20102;CONFIG_DYNAMIC_DEBUG&#65292;&#37027;&#20040; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">dev_dbg&#20250;&#34987;&#36716;&#25442;&#25104;dynamic_dev_dbg&#20989;&#25968; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#25110;&#32773;&#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#22312;&#39537;&#21160;&#25991;&#20214;&#37324;&#38754; #define DEBUG 1 </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#37027;&#20040;dev_dbg&#23601;&#20250;&#34987;&#36716;&#25442;&#25104;dev_printf&#20102;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1495608114296" FOLDED="true" ID="ID_141978653" MODIFIED="1499823283939">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b><font color="#1a8a8c" size="3">10.</font><font size="3" face="Microsoft Yahei, Hei, Tahoma, SimHei, sans-serif" color="rgb(68, 68, 68)">&#x57fa;&#x4e8e;pstore &#x548c; ramoops&#x5b9e;&#x73b0;&#x5728;&#x975e;&#x6613;&#x5931;&#x6027;&#x5185;&#x5b58;&#x4e2d;&#x4fdd;&#x5b58;panic&#x65e5;&#x5fd7;</font></b>&#xa0; </i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1495612173668" ID="ID_1179732713" MODIFIED="1495612176675" TEXT="http://www.spinics.net/lists/linux-acpi/msg57973.html"/>
</node>
<node CREATED="1503042813268" ID="ID_682983874" MODIFIED="1503042856438">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      11. <b>&#x6253;&#x5f00;kernel lockup and hang detection&#x53ef;&#x4ee5;&#x5b9a;&#x4f4d;&#x7cfb;&#x7edf;hang&#x4f4f; </b>
    </p>
    <p>
      <b>&#x65f6;&#x7684;back trace</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1589530845507" ID="ID_678007105" MODIFIED="1589530882793">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="&#x96b6;&#x4e66;"><b>12. Ram Dump</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1589530888999" ID="ID_555750728" MODIFIED="1597051138928">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#006666" face="Times New Roman" size="4">&#39640;&#36890;&#24179;&#21488;ramdump&#26426;&#21046;&#21644;&#20998;&#26512;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1589530941463" ID="ID_497745324" MODIFIED="1589531412680">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CONFIG_QCOM_DLOAD_MODE
    </p>
    <p>
      &#35813;&#23439;&#20027;&#35201;&#25511;&#21046;&#22914;&#19979;&#30340;&#25991;&#20214;
    </p>
    <p>
      power/reset/msm-poweroff.c
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1589764466421" ID="ID_1840838274" MODIFIED="1589764543301">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="4">python ~/tools/linux-ramdump-parser-v2/ramparse.py --force-hardware sdm845 -v vmlinux --gdb-path /home/yjyxiay/aarch64-linux-android-4.8/bin/aarch64-linux-android-gdb&#160; --nm-path /home/yjyxiay/aarch64-linux-android-4.8/bin/aarch64-linux-android-nm --objdump-path /home/yjyxiay/aarch64-linux-android-4.8/bin/aarch64-linux-android-objdump -a Port_COM88 -o ~/pinctrl-panic/dump -x</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1589795115099" ID="ID_415675941" MODIFIED="1589795118394" TEXT="http://tinylab.org/find-out-the-code-line-of-kernel-panic-address/"/>
<node CREATED="1597050807466" ID="ID_507402342" MODIFIED="1597050875775">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0066">&#25235;&#21462;ramdump&#30340;&#27493;&#39588;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1597050881786" ID="ID_1971946479" MODIFIED="1597050921755">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <ol class="hljs-ln" style="white-space: pre; font-weight: 400; padding-bottom: 0px; margin-right: 0px; word-spacing: 0px; margin-top: 0px; font-size: 16px; padding-right: 0px; list-style: none; text-indent: 0px; font-family: Microsoft YaHei, SF Pro Display, Roboto, Noto, Arial, PingFang SC, sans-serif; text-transform: none; padding-top: 0px; padding-left: 0px; letter-spacing: normal; margin-bottom: 0px; color: rgb(56, 58, 66); text-align: start; margin-left: 0px; font-style: normal">
      <li style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; padding-right: 0px; list-style: none; font-family: Microsoft YaHei, SF Pro Display, Roboto, Noto, Arial, PingFang SC, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
        <div class="hljs-ln-code" style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; float: left; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 8px">
          <div class="hljs-ln-line" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
            adb shell
          </div>
        </div>
      </li>
      <li style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; padding-right: 0px; list-style: none; font-family: Microsoft YaHei, SF Pro Display, Roboto, Noto, Arial, PingFang SC, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
        <div class="hljs-ln-numbers" style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; float: left; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; width: 24px; margin-left: 0px">
          <div data-line-number="2" class="hljs-ln-line hljs-ln-n" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 8px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; text-align: right; margin-left: 0px">
            
          </div>
        </div>
        <div class="hljs-ln-code" style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; float: left; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 8px">
          <div class="hljs-ln-line" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
            <span class="hljs-built_in" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; color: rgb(193, 132, 1); margin-left: 0px"><font color="rgb(193, 132, 1)" face="Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif" size="14px">cd</font></span>&#160;/sys
          </div>
        </div>
      </li>
      <li style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; padding-right: 0px; list-style: none; font-family: Microsoft YaHei, SF Pro Display, Roboto, Noto, Arial, PingFang SC, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
        <div class="hljs-ln-numbers" style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; float: left; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; width: 24px; margin-left: 0px">
          <div data-line-number="3" class="hljs-ln-line hljs-ln-n" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 8px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; text-align: right; margin-left: 0px">
            
          </div>
        </div>
        <div class="hljs-ln-code" style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; float: left; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 8px">
          <div class="hljs-ln-line" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
            find -name download_mod
          </div>
        </div>
      </li>
      <li style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; padding-right: 0px; list-style: none; font-family: Microsoft YaHei, SF Pro Display, Roboto, Noto, Arial, PingFang SC, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
        <div class="hljs-ln-numbers" style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; float: left; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; width: 24px; margin-left: 0px">
          <div data-line-number="4" class="hljs-ln-line hljs-ln-n" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 8px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; text-align: right; margin-left: 0px">
            
          </div>
        </div>
        <div class="hljs-ln-code" style="font-weight: normal; padding-bottom: 0px; height: 22px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; float: left; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 8px">
          <div class="hljs-ln-line" style="font-weight: normal; padding-bottom: 0px; margin-right: 0px; margin-top: 0px; font-size: 14px; padding-right: 0px; font-family: Source Code Pro, DejaVu Sans Mono, Ubuntu Mono, Anonymous Pro, Droid Sans Mono, Menlo, Monaco, Consolas, Inconsolata, Courier, monospace, PingFang SC, Microsoft YaHei, sans-serif; padding-top: 0px; padding-left: 0px; margin-bottom: 0px; margin-left: 0px">
            cat download_mod
          </div>
        </div>
      </li>
    </ol>
    <p>
      &#30830;&#35748;download_mode&#20026;1
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597050926258" ID="ID_965852543" MODIFIED="1597050973322">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#3300cc" face="Times New Roman">&#20351;&#29992;&#39640;&#36890;QPST Configuration&#24037;&#20855;&#25235;&#21462;ramdump</font></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1597050999102" ID="ID_1623798310" MODIFIED="1597051006885">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <a href="https://blog.csdn.net/ldinvicible/article/details/49246109">https://blog.csdn.net/ldinvicible/article/details/49246109</a>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597051088211" ID="ID_643957457" MODIFIED="1597051101764">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="armpic/QPST-ramdump1.png" />
  </body>
</html></richcontent>
</node>
<node CREATED="1597051105414" ID="ID_239084248" MODIFIED="1597051110754">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="armpic/QPST-ramdump2.png" />
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1439130621065" FOLDED="true" ID="ID_385122361" MODIFIED="1486719832121" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#009999"><b>&#x7b2c;&#x4e94;&#x7ae0;&#xff1a;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;&#x7684;&#x5e76;&#x53d1;&#x548c;&#x7adf;&#x6001;&#x6761;&#x4ef6; </b></font></i>
    </p>
    <p>
      <b>&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x5458;&#x5728;&#x4e00;&#x5f00;&#x59cb;&#x5c31;&#x5fc5;&#x987b;&#x6709;&#x5e76;&#x53d1;&#x7684;&#x6982;&#x5ff5;</b>
    </p>
  </body>
</html></richcontent>
<font ITALIC="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1439215247253" ID="ID_1839798648" MODIFIED="1486555597875" TEXT="1.&#x5e76;&#x53d1;&#x548c;&#x5b83;&#x7684;&#x7ba1;&#x7406;">
<node CREATED="1439298508866" FOLDED="true" ID="ID_1135750547" MODIFIED="1486555599160" TEXT="&#x4e00;&#x4e9b;&#x57fa;&#x672c;&#x7684;&#x539f;&#x5219;">
<node CREATED="1439298538694" ID="ID_1447351129" MODIFIED="1439298711075">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x907f;&#x514d;&#x5171;&#x4eab;&#x7684;&#x8d44;&#x6e90;
    </p>
    <p>
      &#x4f46;&#x662f;&#x5171;&#x4eab;&#x8d44;&#x6e90;&#x662f;&#x5fc5;&#x4e0d;&#x53ef;&#x514d;&#x7684;&#xff0c;&#x6bd4;&#x5982;&#x786c;&#x4ef6;&#x8d44;&#x6e90;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1439472332062" ID="ID_306209797" MODIFIED="1439472470497">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e24;&#x4e2a;&#x8981;&#x6c42;&#xff1a;
    </p>
    <p>
      <i>1.&#x5728;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x7684;&#x529f;&#x80fd;&#x53ef;&#x7528;&#x4e4b;&#x524d;&#xff0c;&#x5185;&#x6838;&#x4e0d;&#x80fd;&#x8bbf;&#x95ee;&#x5b83;&#xff1b; </i>
    </p>
    <p>
      <i>2.&#x5185;&#x6838;&#x5fc5;&#x987b;&#x8ffd;&#x8e2a;&#x5bf9;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x7684;&#x4f7f;&#x7528;</i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1439473076964" FOLDED="true" ID="ID_156150571" MODIFIED="1486555599160">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Linux&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x4fe1;&#x53f7;&#x91cf;&#x7684;&#x5b9e;&#x73b0;
    </p>
    <p>
      &#x5934;&#x6587;&#x4ef6;&lt;asm/semaphore.h&gt;,struct semaphore
    </p>
  </body>
</html></richcontent>
<node CREATED="1439473326240" ID="ID_1539179217" MODIFIED="1439473503347">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x53ef;&#x4ee5;&#x9996;&#x5148;&#x58f0;&#x660e;&#x4e00;&#x4e2a;semaphore&#x53d8;&#x91cf;&#xff0c;&#x7136;&#x540e;&#x521d;&#x59cb;&#x5316;&#x5b83;
    </p>
    <p>
      void sema_init(struct semaphore *sem, int val)
    </p>
    <p>
      &#x5185;&#x6838;&#x4e5f;&#x63d0;&#x4f9b;&#x4e86;&#x76f8;&#x5173;&#x7684;&#x5b8f;&#x6765;&#x7b80;&#x5316;semaphore&#x7684;&#x64cd;&#x4f5c;
    </p>
    <p>
      DECLARE_MUTEX(name) <i>&#xa0;initialize to 1</i>
    </p>
    <p>
      DECLARE_MUTEX_LOCKED(name)&#xa0;&#xa0;<i>initialize to 0</i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1439692286509" FOLDED="true" ID="ID_1811177688" MODIFIED="1475896811544" TEXT="">
<node CREATED="1439692289171" ID="ID_1955455592" MODIFIED="1439692377596">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.<i>&#x52a8;&#x6001;&#x5730;&#x521d;&#x59cb;&#x5316;&#x4fe1;&#x53f7;&#x91cf; </i>
    </p>
    <p>
      <i><font color="#cc6600">void init_MUTEX(struct semaphore *sem); </font></i>
    </p>
    <p>
      <i><font color="#cc6600">void init_MUTEX_LOCKED(struct semaphore *sem);</font></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1439692517522" ID="ID_503829488" MODIFIED="1439719592139">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.<i>&#x9488;&#x5bf9;&#x4fe1;&#x53f7;&#x91cf;&#x7684;P&#x64cd;&#x4f5c; </i>
    </p>
    <p>
      <i>void down(struct semaphore *sem);&#xa0;</i>&#xa0;&#x8be5;&#x64cd;&#x4f5c;&#x4f1a;&#x4e00;&#x76f4;&#x963b;&#x585e;
    </p>
    <p>
      <i>int down_interruptible(struct semaphore *sem);</i>&#xa0;&#x8be5;&#x64cd;&#x4f5c;&#x5141;&#x8bb8;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x6253;&#x65ad;&#x963b;&#x585e;&#x5728;
    </p>
    <p>
      &#x4fe1;&#x53f7;&#x91cf;&#x4e0a;&#x7684;&#x8fdb;&#x7a0b;&#xff0c;&#x4e0d;&#x53ef;&#x4e2d;&#x65ad;&#x7684;&#x64cd;&#x4f5c;&#x975e;&#x5e38;&#x9002;&#x5408;&#x521b;&#x9020;&#x4e0d;&#x53ef;&#x6740;&#x6b7b;&#x7684;&#x8fdb;&#x7a0b;
    </p>
    <p>
      <i>int down_trylock(struct semaphore *sem);&#x4e0d;&#x53ef;&#x963b;&#x585e;</i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1439904828488" ID="ID_1348967419" MODIFIED="1441810945781">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      4.&#x9488;&#x5bf9;&#x4fe1;&#x53f7;&#x91cf;&#x7684;V&#x64cd;&#x4f5c;
    </p>
    <p>
      <i>void up(struct semaphore *sem);</i>
    </p>
  </body>
</html></richcontent>
</node>
<node COLOR="#006666" CREATED="1445526354302" FOLDED="true" ID="ID_241890611" MODIFIED="1475896811544">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4"><b>&#x8bfb;&#x5199;&#x4fe1;&#x53f7;&#x91cf;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1445569301141" ID="ID_939407111" MODIFIED="1445569343323">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;&#x8bfb;&#x5199;&#x4fe1;&#x53f7;&#x91cf;&#x5fc5;&#x987b;&#x5305;&#x542b;&#x7684;&#x5934;&#x6587;&#x4ef6;
    </p>
    <p>
      &lt;linux/rwsem.h&gt;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1446898193467" ID="ID_146195882" MODIFIED="1446898226585">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8bfb;&#x5199;&#x4fe1;&#x53f7;&#x91cf;&#x7684;&#x521d;&#x59cb;&#x5316;&#x51fd;&#x6570;
    </p>
    <p>
      void init_rwsem(struct rw_semaphore *sem);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1446898463612" ID="ID_1503650258" MODIFIED="1446898525950">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5bf9;&#x4e8e;&#x8bfb;&#x7684;&#x63a7;&#x5236;
    </p>
    <p>
      void down_read(struct rw_semaphore *sem);
    </p>
    <p>
      int down_read_trylock(struct rw_semaphore *sem);
    </p>
    <p>
      void up_read(struct rw_semaphore *sem);
    </p>
    <p>
      down&#x64cd;&#x4f5c;&#x53ef;&#x80fd;&#x4f1a;&#x4f7f;&#x5f53;&#x524d;&#x7684;&#x8fdb;&#x7a0b;&#x8fdb;&#x5165;&#x4e0d;&#x53ef;&#x4e2d;&#x65ad;&#x7684;&#x7761;&#x7720;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1446901227818" ID="ID_1265080011" MODIFIED="1446901301455">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3">&#x5bf9;&#x4e8e;&#x5199;&#x7684;&#x63a7;&#x5236; </font>
    </p>
    <p>
      <font size="3">void down_write(struct rw_semaphore *sem); </font>
    </p>
    <p>
      <font size="3">int down_write_trylock(struct rw_semaphore *sem); </font>
    </p>
    <p>
      <font size="3">void up_write(struct rw_semaphore *sem); </font>
    </p>
    <p>
      <font size="3">void downgrade_write(struct rw_semaphore *sem); </font>
    </p>
    <p>
      <font size="3" face="arial" color="rgb(102, 102, 102)">&#xa0;</font><font face="arial" size="3" color="rgb(51, 51, 51)">void&#xa0;</font><em style="letter-spacing: normal; font-size: 13px; font-family: arial; font-variant: normal; background-color: rgb(255, 255, 255); font-style: normal; font-weight: normal; color: rgb(204, 0, 0); text-transform: none; text-indent: 0px; text-align: start; line-height: 20px; word-spacing: 0px; white-space: normal"><font face="arial" size="3" color="rgb(204, 0, 0)">downgrade_write</font></em><font face="arial" size="3" color="rgb(51, 51, 51)">(struct rw_semaphore *sem) </font>
    </p>
    <p>
      <font face="arial" size="3" color="rgb(51, 51, 51)">//&#x5b83;&#x5c06;&#x4e00;&#x4e2a;&#x5199;&#x4fe1;&#x53f7;&#x91cf;&#x964d;&#x683c;&#x4e3a;&#x8bfb;&#x4fe1;&#x53f7;&#x91cf;,&#x5e76;&#x5524;&#x9192;&#x7b49;&#x5f85;&#x961f;&#x5217;&#x4e0a;&#x7684;&#x8bfb;&#x4efb;&#x52a1;&#x3002;</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1446902303210" ID="ID_1974197607" MODIFIED="1446902404301">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e00;&#x79cd;&#x901a;&#x7528;&#x7684;&#x5185;&#x6838;&#x7f16;&#x7a0b;&#x6a21;&#x578b;&#x5982;&#x4e0b;&#x6240;&#x793a;&#xff1a;
    </p>
    <p>
      <font color="#006666">struct semaphore sem; </font>
    </p>
    <p>
      <font color="#006666">init_MUTEX_LOCKED(&amp;sem); </font>
    </p>
    <p>
      <font color="#006666">start_external_task(&amp;sem); </font>
    </p>
    <p>
      <font color="#006666">down(&amp;sem);</font>
    </p>
    <p>
      &#x7528;&#x6237;&#x53ef;&#x4ee5;&#x5728;start_external_task&#x5f53;&#x4e2d;&#x65b0;&#x5efa;&#x53e6;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#xff0c;&#x6267;&#x884c;&#x5176;&#x4ed6;&#x4efb;&#x52a1;&#xff0c;
    </p>
    <p>
      &#x5f53;&#x4efb;&#x52a1;&#x6267;&#x884c;&#x5b8c;&#x6210;&#x8fc7;&#x540e;&#x6267;&#x884c;up&#x64cd;&#x4f5c;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node COLOR="#cc0033" CREATED="1454674211713" FOLDED="true" ID="ID_501267520" MODIFIED="1574904086735" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7b2c;&#x516d;&#x7ae0;&#xff1a;&#x9ad8;&#x7ea7;&#x5b57;&#x7b26;&#x9a71;&#x52a8;&#x64cd;&#x4f5c;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1455007337777" FOLDED="true" ID="ID_1410005813" MODIFIED="1515281887282" TEXT="ioctl&#x64cd;&#x4f5c;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1455007365274" ID="ID_1680057345" MODIFIED="1455007547687">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;ioctl&#x58f0;&#x660e;&#xff1a;int ioctl(int fd, unsigned long cmd, ...)
    </p>
    <p>
      &#x5185;&#x6838;&#x7a7a;&#x95f4;&#x7684;ioctl&#x58f0;&#x660e;&#xff1a;int (*ioctl)(struct inode *inode, struct file *filp,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int cmd, unsigned long arg);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455104682941" FOLDED="true" ID="ID_58343841" MODIFIED="1515281882544">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7cfb;&#x7edf;&#x81ea;&#x5b9a;&#x4e49;&#x7684;ioctl&#x547d;&#x4ee4;&#xff1a;
    </p>
    <p>
      &#x6709;&#x4e00;&#x4e9b;ioctl&#x547d;&#x4ee4;&#x662f;&#x7531;&#x5185;&#x6838;&#x91cd;&#x65b0;&#x7ec4;&#x7ec7;&#x7684;&#xff0c;&#x8fd9;&#x4e9b;&#x547d;&#x4ee4;&#x662f;&#x5148;&#x4e8e;&#x4f60;&#x81ea;&#x5df1;&#x5b9a;&#x4e49;&#x7684;&#x6587;&#x4ef6;&#x64cd;&#x4f5c;
    </p>
    <p>
      &#x8d77;&#x4f5c;&#x7528;&#x4e4b;&#x524d;&#x88ab;&#x89e3;&#x6790;&#x7684;&#x3002;&#x6240;&#x4ee5;&#xff0c;&#x5982;&#x679c;&#x4f60;&#x81ea;&#x5df1;&#x5b9a;&#x4e49;&#x7684;&#x63a7;&#x5236;&#x547d;&#x4ee4;&#x548c;&#x7cfb;&#x7edf;&#x5b9a;&#x4e49;&#x7684;&#x63a7;&#x5236;
    </p>
    <p>
      &#x547d;&#x4ee4;&#x6070;&#x597d;&#x76f8;&#x540c;&#xff0c;&#x90a3;&#x4e48;&#x4f60;&#x4e0d;&#x4f1a;&#x770b;&#x5230;&#x4efb;&#x4f55;&#x8ddf;&#x8be5;&#x547d;&#x4ee4;&#x76f8;&#x5173;&#x7684;&#x8bf7;&#x6c42;&#x3002;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x9884;&#x5b9a;&#x4e49;&#x7684;&#x547d;&#x4ee4;&#x88ab;&#x5206;&#x4e3a;&#x4e09;&#x7ec4;&#xff1a;
    </p>
    <p>
      1.&#x53ef;&#x4ee5;&#x4f5c;&#x7528;&#x5728;&#x4efb;&#x4f55;&#x6587;&#x4ef6;&#x7c7b;&#x578b;&#x4e0a;&#x7684;&#x547d;&#x4ee4;(&#x666e;&#x901a;&#x6587;&#x4ef6;&#xff0c;&#x8bbe;&#x5907;&#x6587;&#x4ef6;&#xff0c;fifo&#x6587;&#x4ef6;&#xff0c;socket&#x6587;&#x4ef6;)
    </p>
    <p>
      2.&#x4f5c;&#x7528;&#x5728;&#x666e;&#x901a;&#x6587;&#x4ef6;&#x4e0a;&#x7684;&#x547d;&#x4ee4;
    </p>
    <p>
      3.&#x8ddf;&#x7279;&#x5b9a;&#x7684;&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x76f8;&#x5173;&#x7684;&#x547d;&#x4ee4;
    </p>
    <p>
      &#x4e00;&#x822c;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x7684;&#x4f5c;&#x8005;&#x53ea;&#x662f;&#x5173;&#x5fc3;&#x7b2c;&#x4e00;&#x7c7b;&#x7684;&#x547d;&#x4ee4;&#xff0c;&#x8fd9;&#x4e9b;&#x547d;&#x4ee4;&#x7684;magic number&#x662f;'T'
    </p>
  </body>
</html></richcontent>
<node CREATED="1455105330321" ID="ID_388191817" MODIFIED="1455105439907">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      FIOCLEX&#x547d;&#x4ee4;&#xff1a;
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x547d;&#x4ee4;&#x4f1a;&#x5bfc;&#x81f4;&#x8c03;&#x7528;&#x8fdb;&#x7a0b;&#x5728;&#x6267;&#x884c;&#x65b0;&#x7684;&#x7a0b;&#x5e8f;&#x4e4b;&#x524d;&#xff0c;
    </p>
    <p>
      &#x5173;&#x95ed;&#x76f8;&#x5173;&#x7684;&#x6587;&#x4ef6;&#x63cf;&#x8ff0;&#x7b26;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455105444383" ID="ID_1365497370" MODIFIED="1455105502239">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      FIONCLEX&#x547d;&#x4ee4;&#xff1a;
    </p>
    <p>
      &#x8be5;&#x547d;&#x4ee4;&#x7684;&#x4f5c;&#x7528;&#x5c31;&#x662f;&#x64a4;&#x9500;FIOCLEX&#x547d;&#x4ee4;&#x7684;&#x6548;&#x679c;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455105532694" ID="ID_1197160967" MODIFIED="1455105676209">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      FIOASYNC&#x547d;&#x4ee4;&#xff1a;
    </p>
    <p>
      &#x8be5;&#x547d;&#x4ee4;&#x7684;&#x4f5c;&#x7528;&#x5c31;&#x662f;&#x8bbe;&#x7f6e;&#x6216;&#x8005;&#x91cd;&#x7f6e;&#x6587;&#x4ef6;&#x7684;&#x5f02;&#x6b65;&#x901a;&#x77e5;&#x673a;&#x5236;
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x547d;&#x4ee4;&#x5b9e;&#x9645;&#x4e0a;&#x53ef;&#x4ee5;&#x7531;fcntl&#x51fd;&#x6570;&#x6765;&#x5b8c;&#x6210;&#xff0c;&#x6240;&#x4ee5;&#x6ca1;&#x6709;&#x4eba;
    </p>
    <p>
      &#x771f;&#x6b63;&#x7528;&#x5230;&#x5b83;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455105680294" ID="ID_1467679077" MODIFIED="1455105828543">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      FIOQSIZE&#x547d;&#x4ee4;&#xff1a;
    </p>
    <p>
      &#x8be5;&#x547d;&#x4ee4;&#x7684;&#x4f5c;&#x7528;&#x662f;&#x8fd4;&#x56de;&#x6587;&#x4ef6;&#x6216;&#x8005;&#x662f;&#x76ee;&#x5f55;&#x7684;&#x5927;&#x5c0f;&#x4fe1;&#x606f;
    </p>
    <p>
      &#x5f53;&#x8be5;&#x547d;&#x4ee4;&#x4f5c;&#x7528;&#x4e8e;&#x8bbe;&#x5907;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f1a;&#x4ea7;&#x751f;ENOTTY&#x9519;&#x8bef;&#x4fe1;&#x606f;&#x8fd4;&#x56de;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455105840594" ID="ID_1782143875" MODIFIED="1455105958023">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      FIONBIO&#x547d;&#x4ee4;&#xff1a;
    </p>
    <p>
      &#x8be5;&#x547d;&#x4ee4;&#x4f1a;&#x901a;&#x8fc7;ioctl&#x7684;&#x7b2c;&#x4e09;&#x4e2a;&#x53c2;&#x6570;&#x6765;&#x8bf4;&#x660e;&#x662f;&#x8bbe;&#x7f6e;&#x8fd8;&#x662f;
    </p>
    <p>
      &#x6e05;&#x9664;&#x6587;&#x4ef6;&#x7684;O_NONBLOCK&#x6807;&#x5fd7;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1455106082671" ID="ID_1276403747" MODIFIED="1455106248859">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;ioctl&#x7684;&#x53c2;&#x6570;&#xff1a;
    </p>
    <p>
      &#x5982;&#x679c;ioctl&#x4f20;&#x5165;&#x7684;&#x53c2;&#x6570;&#x662f;&#x6307;&#x9488;&#xff0c;&#x90a3;&#x4e48;&#x6211;&#x4eec;&#x9700;&#x8981;&#x5c0f;&#x5fc3;&#x5730;&#x5bf9;&#x5f85;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1455108600687" FOLDED="true" ID="ID_769253357" MODIFIED="1527909830879">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e0d;&#x4f7f;&#x7528;ioctl&#x7684;&#x8bbe;&#x5907;&#x63a7;&#x5236;&#x65b9;&#x6cd5;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1455108695974" ID="ID_1829786894" MODIFIED="1455109975706">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6709;&#x65f6;&#x5019;&#x901a;&#x8fc7;&#x5411;&#x8bbe;&#x5907;&#x5199;&#x5165;&#x63a7;&#x5236;&#x5e8f;&#x5217;&#x53ef;&#x4ee5;&#x66f4;&#x597d;&#x5730;
    </p>
    <p>
      &#x5b8c;&#x6210;&#x8bbe;&#x5907;&#x7684;&#x63a7;&#x5236;&#x64cd;&#x4f5c;&#x3002;&#x5f53;&#x4f7f;&#x7528;&#x8fd9;&#x79cd;&#x65b9;&#x6cd5;&#x63a7;&#x5236;&#x8bbe;&#x5907;&#x7684;&#x65f6;&#x5019;&#xff0c;
    </p>
    <p>
      &#x63a7;&#x5236;&#x7a0b;&#x5e8f;&#x548c;&#x88ab;&#x63a7;&#x5236;&#x7684;&#x8bbe;&#x5907;&#x751a;&#x81f3;&#x53ef;&#x4ee5;&#x4e0d;&#x7528;&#x8fd0;&#x884c;&#x5728;&#x540c;&#x4e00;&#x4e2a;&#x64cd;&#x4f5c;
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x3002;&#x4f46;&#x662f;&#x8fd9;&#x79cd;&#x63a7;&#x5236;&#x65b9;&#x5f0f;&#x7684;&#x7f3a;&#x70b9;&#x5c31;&#x662f;&#x5b83;&#x4f1a;&#x5411;&#x8bbe;&#x5907;&#x6dfb;&#x52a0;
    </p>
    <p>
      &#x7b56;&#x7565;&#x4e0a;&#x7684;&#x9650;&#x5236;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455110094270" ID="ID_1177604738" MODIFIED="1455110131502" TEXT="&#x901a;&#x8fc7;&#x5199;&#x7684;&#x65b9;&#x5f0f;&#x63a7;&#x5236;&#x8bbe;&#x5907;&#x4f7f;&#x7528;&#x4e8e;&#x90a3;&#x4e9b;&#x4e0d;&#x4f20;&#x9001;&#x6570;&#x636e;&#x4f46;&#x662f;&#x54cd;&#x5e94;&#x547d;&#x4ee4;&#x7684;&#x8bbe;&#x5907;"/>
<node COLOR="#cc3300" CREATED="1455110370968" ID="ID_1852850546" MODIFIED="1455110494550">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6709;&#x65f6;&#x5019;&#x4f60;&#x53ef;&#x80fd;&#x65e2;&#x4e0d;&#x9009;&#x62e9;&#x5199;&#x547d;&#x4ee4;&#x7684;&#x65b9;&#x5f0f;&#x4e5f;&#x4e0d;&#x9009;&#x62e9;Ioctl&#x7684;&#x65b9;&#x5f0f;
    </p>
    <p>
      &#x800c;&#x662f;&#x9009;&#x62e9;&#x9009;&#x53d6;&#x4e00;&#x4e2a;&#x547d;&#x4ee4;&#x884c;&#x7684;&#x5de5;&#x5177;&#x5c06;&#x547d;&#x4ee4;&#x9001;&#x5230;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x91cc;&#x9762;&#x53bb;
    </p>
    <p>
      &#x8fd9;&#x662f;&#x4e00;&#x79cd;&#x9009;&#x62e9;&#x5c06;&#x590d;&#x6742;&#x6027;&#x4ece;&#x5185;&#x6838;&#x4f20;&#x9012;&#x5230;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x65b9;&#x6cd5;&#x3002;
    </p>
  </body>
</html></richcontent>
<font ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
<node CREATED="1455110508552" FOLDED="true" ID="ID_821094301" MODIFIED="1566975193327" TEXT="Blocking I/O">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1455110836184" FOLDED="true" ID="ID_228938913" MODIFIED="1566975191673">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#ff3333" size="4">&#x8fdb;&#x7a0b;&#x4f11;&#x7720;</font></i></b>
    </p>
    <p>
      &#x5f53;&#x8fdb;&#x7a0b;&#x4f11;&#x7720;&#x65f6;&#xff0c;&#x5b83;&#x4f1a;&#x88ab;&#x6807;&#x8bb0;&#x6210;&#x4e00;&#x79cd;&#x7279;&#x6b8a;&#x7684;&#x72b6;&#x6001;&#xff0c;&#x5e76;&#x4e14;&#x4f1a;&#x88ab;
    </p>
    <p>
      &#x79fb;&#x9664;&#x8c03;&#x5ea6;&#x5668;&#x7684;&#x8fd0;&#x884c;&#x65f6;&#x961f;&#x5217;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1455547846588" ID="ID_1733088782" MODIFIED="1527951158815">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff3333"><i>&#x8fdb;&#x7a0b;&#x4f11;&#x7720;&#x65f6;&#x7684;&#x7f16;&#x7801;&#x6ce8;&#x610f;&#x4e8b;&#x9879;</i></font>&#xff1a;
    </p>
    <p>
      1.&#x4f60;&#x7684;&#x4ee3;&#x7801;&#x4e0d;&#x80fd;&#x5728;&#x539f;&#x5b50;&#x6027;&#x7684;&#x4e0a;&#x4e0b;&#x6587;&#x5f53;&#x4e2d;&#x8fdb;&#x884c;&#x4f11;&#x7720;&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x8bf4;&#x5f53;&#x8fdb;&#x7a0b;
    </p>
    <p>
      &#x6301;&#x6709;spinlock,seqlock&#x6216;&#x8005;RCU lock&#x7684;&#x65f6;&#x5019;&#xff0c;&#x9a71;&#x52a8;&#x4e0d;&#x80fd;&#x4f11;&#x7720;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      2.&#x5f53;&#x4ee3;&#x7801;&#x5df2;&#x7ecf;&#x7981;&#x6b62;&#x4e2d;&#x65ad;&#x7684;&#x65f6;&#x5019;&#x4e0d;&#x80fd;&#x8fdb;&#x884c;&#x4f11;&#x7720;
    </p>
    <p>
      
    </p>
    <p>
      3.&#x5f53;&#x6301;&#x6709;&#x4fe1;&#x53f7;&#x91cf;&#x7684;&#x65f6;&#x5019;&#x662f;&#x53ef;&#x4ee5;&#x8fdb;&#x5165;&#x4f11;&#x7720;&#x72b6;&#x6001;&#x7684;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455549109686" FOLDED="true" ID="ID_1280948464" MODIFIED="1566975190051">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f60;&#x5e94;&#x5f53;&#x5f88;&#x6e05;&#x695a;&#x4ec0;&#x4e48;&#x6837;&#x7684;&#x4e8b;&#x4ef6;&#x5bfc;&#x81f4;&#x8fdb;&#x7a0b;&#x4f11;&#x7720;&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x8bf4;&#x5e94;&#x5f53;&#x5c06;
    </p>
    <p>
      &#x4f11;&#x7720;&#x7684;&#x8fdb;&#x7a0b;&#x653e;&#x7f6e;&#x5728;&#x54ea;&#x4e2a;wait queue&#x5f53;&#x4e2d;&#x3002;
    </p>
    <p>
      &#x5728;linux&#x5f53;&#x4e2d;wait queue&#x7531;"wait queue head"&#x6765;&#x8fdb;&#x884c;&#x7ba1;&#x7406;&#xff0c;&#x5b83;&#x7684;&#x6570;&#x636e;
    </p>
    <p>
      &#x7ed3;&#x6784;&#x7c7b;&#x578b;&#x662f;wait_queue_head_t,&#x5b9a;&#x4e49;&#x5728;&lt;linux/wait.h&gt;&#x5f53;&#x4e2d;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1455549316485" ID="ID_1332214976" MODIFIED="1455549420969">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x9759;&#x6001;&#x521d;&#x59cb;&#x5316;wait queue:</b>
    </p>
    <p>
      <i>DECLARE_WAIT_QUEUE_HEAD(name)</i>
    </p>
    <p>
      <b>&#x52a8;&#x6001;&#x521d;&#x59cb;&#x5316;wait queue:</b>
    </p>
    <p>
      <i>wait_queue_head_t my_queue </i>
    </p>
    <p>
      <i>init_waitqueue_head(&amp;my_queue)</i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1455549656602" ID="ID_96256415" MODIFIED="1528160088969">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#181928" size="4"><b>&#x8fdb;&#x7a0b;&#x5524;&#x9192;&#x7684;&#x65f6;&#x5019;&#x5fc5;&#x987b;&#x68c0;&#x6d4b;&#x5b83;&#x6240;&#x7b49;&#x5f85;&#x7684;&#x6761;&#x4ef6;&#x5df2;&#x7ecf;&#x53d8;&#x6210;&#x4e86;TRUE</b></font>
    </p>
    <p>
      <font color="#cc0000"><b><i>&#x8fdb;&#x7a0b;&#x4f11;&#x7720;&#x7684;&#x65b9;&#x6cd5;&#xff1a; </i></b></font>
    </p>
    <p>
      1.&#x6700;&#x7b80;&#x5355;&#x7684;&#x65b9;&#x6cd5;&#xff0c;&#x4f7f;&#x7528;wait_event
    </p>
    <p>
      wait_event(queue, condition)
    </p>
    <p>
      wait_event_interruptible(queue, condition)
    </p>
    <p>
      wait_event_timeout(queue, condition, timeout)
    </p>
    <p>
      wait_event_interruptible_timeout(queue, condition, timeout)
    </p>
    <p>
      &#x5176;&#x4e2d;&#x7684;queue&#x662f;wait queue head&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x91c7;&#x7528;&#x503c;&#x4f20;&#x9012;&#x7684;&#x65b9;&#x5f0f;&#xff0c;condition&#x662f;bool&#x8868;&#x8fbe;&#x5f0f;&#x503c;
    </p>
    <p>
      &#x5f53;condition&#x4e3a;true&#x7684;&#x65f6;&#x5019;&#x8fdb;&#x7a0b;&#x5c31;&#x4e0d;&#x518d;&#x7761;&#x7720;&#x4e86;&#x3002;&#x6ce8;&#x610f;wait_event&#x662f;&#x4e0d;&#x53ef;&#x4e2d;&#x65ad;&#x7684;&#x4f11;&#x7720;&#x65b9;&#x5f0f;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1528161230811" ID="ID_570456357" MODIFIED="1528161776443">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5524;&#x9192;&#x64cd;&#x4f5c;&#xff0c;&#x6ce8;&#x610f;&#xff0c;&#x5524;&#x9192;&#x64cd;&#x4f5c;&#x53ef;&#x4ee5;&#x5728;&#x5176;&#x4ed6;&#x7684;&#x8fdb;&#x7a0b;&#x5f53;&#x4e2d;&#x6267;&#x884c;&#xff0c;&#x4e5f;&#x53ef;&#x4ee5;&#x5728;&#x4e2d;&#x65ad;&#x6267;&#x884c;&#x53e5;&#x67c4;&#x5f53;&#x4e2d;&#x6267;&#x884c;
    </p>
    <p>
      &#x5524;&#x9192;&#x7684;&#x51fd;&#x6570;&#x6709;&#x591a;&#x79cd;&#x5f62;&#x5f0f;&#xff0c;&#x6211;&#x4eec;&#x91cd;&#x70b9;&#x5173;&#x6ce8;&#x5982;&#x4e0b;&#x7684;&#x4e24;&#x4e2a;&#x5f62;&#x5f0f;:
    </p>
    <p>
      
    </p>
    <p>
      void wake_up(wait_queue_head_t *queue)&#xa0;&#xa0;----------------------- &#x5bf9;&#x5e94;&#x4e0e;wait_event
    </p>
    <p>
      void wake_up_interruptible(wait_queue_head_t *queue) ----------------&#x5bf9;&#x5e94;&#x4e8e;wait_event_interruptble
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1455693958735" FOLDED="true" ID="ID_1778348366" MODIFIED="1566975186977">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#c90d0d" size="3">&#x963b;&#x585e;&#x548c;&#x975e;&#x963b;&#x585e;&#x64cd;&#x4f5c;</font></i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1455694321379" FOLDED="true" ID="ID_1044872438" MODIFIED="1566975185573">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x963b;&#x585e;&#x64cd;&#x4f5c;&#xff1a;
    </p>
    <p>
      &#x8fdb;&#x7a0b;&#x8c03;&#x7528;read&#x64cd;&#x4f5c;&#xff0c;&#x5f53;&#x524d;&#x6ca1;&#x6709;&#x6570;&#x636e;&#xff0c;&#x8fdb;&#x7a0b;&#x5fc5;&#x987b;&#x963b;&#x585e;&#xff0e;
    </p>
    <p>
      &#x5f53;&#x6709;&#x6570;&#x636e;&#x6765;&#x4e34;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x65e0;&#x8bba;&#x6709;&#x591a;&#x5c11;&#x6570;&#x636e;&#xff0c;&#x5fc5;&#x987b;&#x5524;&#x9192;&#x8be5;&#x963b;&#x585e;&#x7684;&#x8fdb;&#x7a0b;
    </p>
    <p>
      &#x8fdb;&#x7a0b;&#x8c03;&#x7528;write&#x64cd;&#x4f5c;&#xff0c;&#x4f46;&#x662f;&#x5f53;&#x524d;buffer&#x6ca1;&#x6709;&#x591a;&#x4f59;&#x7684;&#x7a7a;&#x95f4;&#xff0c;&#x8fdb;&#x7a0b;&#x963b;&#x585e;
    </p>
    <p>
      &#x5f53;buffer&#x5f53;&#x4e2d;&#x6709;&#x5269;&#x4f59;&#x7a7a;&#x95f4;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x9700;&#x8981;&#x7acb;&#x5373;&#x5524;&#x9192;&#x4f11;&#x7720;&#x7684;&#x8fdb;&#x7a0b;
    </p>
    <p>
      <i>&#x9a71;&#x52a8;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x5b9e;&#x73b0;&#x963b;&#x585e;&#x64cd;&#x4f5c;&#x6765;&#x652f;&#x6301;&#x7c7b;&#x4f3c;&#x6587;&#x4ef6;&#x9501;&#x4e00;&#x6837;&#x7684;&#x8bbf;&#x95ee;&#x7b56;&#x7565;</i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1528162846088" ID="ID_1705028331" MODIFIED="1528164011613">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8fdb;&#x7a0b;&#x5728;&#x8c03;&#x7528;open&#x51fd;&#x6570;&#x6253;&#x5f00;&#x6587;&#x4ef6;&#x63cf;&#x8ff0;&#x7b26;&#x7684;&#x65f6;&#x5019;&#x53ef;&#x4ee5;&#x6307;&#x5b9a;non-block&#x6807;&#x5fd7;&#xff0c;
    </p>
    <p>
      O_NONBLOCK&#xff0c; &#x8be5;&#x6807;&#x5fd7;&#x662f;&#x88ab;&#x5b58;&#x653e;&#x5728;filp-&gt;f_flags&#x5f53;&#x4e2d;&#x7684;&#x3002;&#x5982;&#x679c;&#x6d4f;&#x89c8;&#x6e90;&#x4ee3;&#x7801;&#xff0c;&#x4f60;&#x4f1a;&#x770b;&#x5230;
    </p>
    <p>
      &#x6709;&#x4e9b;&#x5730;&#x65b9;&#x4f1a;&#x5f15;&#x7528;O_NDELAY&#x6807;&#x5fd7;&#xff0c;&#x8be5;&#x6807;&#x5fd7;&#x7684;&#x4f5c;&#x7528;&#x8ddf;O_NONBLOCK&#x662f;&#x4e00;&#x6837;&#x7684;&#xff0c;&#x8be5;&#x6807;&#x5fd7;
    </p>
    <p>
      &#x662f;&#x4e3a;&#x4e86;&#x517c;&#x5bb9;System V&#x4ee3;&#x7801;&#x7684;&#x3002;&#x5e94;&#x7528;&#x8f6f;&#x4ef6;&#x5728;&#x5904;&#x7406;O_NONBLOCK&#x7684;&#x8bbe;&#x5907;&#x7684;&#x65f6;&#x5019;&#x5fc5;&#x987b;&#x7279;&#x522b;
    </p>
    <p>
      &#x5c0f;&#x5fc3;&#xff0c;&#x56e0;&#x4e3a;&#x9047;&#x5230;EOF&#x7684;&#x60c5;&#x51b5;&#x7684;&#x65f6;&#x5019;&#x7a0b;&#x5e8f;&#x4e5f;&#x4f1a;&#x76f4;&#x63a5;&#x8fd4;&#x56de;&#x3002;&#x53c2;&#x770b;&#x5982;&#x4e0b;&#x4ece;&#x6587;&#x4e2d;&#x7684;&#x6458;&#x5f55;:
    </p>
    <p>
      
    </p>
    <p>
      Applications must be careful when using the stdio func-
    </p>
    <p>
      tions while dealing with nonblocking files, because they can easily mistake a non-
    </p>
    <p>
      blocking return for EOF . They always have to check errno .
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1528165111927" FOLDED="true" ID="ID_1107175581" MODIFIED="1566975184185" TEXT="&#x4ee3;&#x7801;&#x5b9e;&#x73b0;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1528165137720" ID="ID_1123613762" MODIFIED="1528165218926">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">&#x5e26;&#x6709;&#x786c;&#x4ef6;&#x7684;&#x65f6;&#x5019;&#x7684;&#x5b9e;&#x73b0;&#x662f;&#x5728;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x51fd;&#x6570;&#x91cc;&#x9762;&#x5c06;&#x5f53;&#x524d;&#x963b;&#x585e;&#x4f4f;&#x7684;&#x8fdb;&#x7a0b;&#x5524;&#x9192;</font></b>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#dd0606" size="4">Within a driver, a process blocked in a read call is awakened when data arrives; usu- </font>
    </p>
    <p>
      <font color="#dd0606" size="4">ally the hardware issues an interrupt to signal such an event, and the driver awakens </font>
    </p>
    <p>
      <font color="#dd0606" size="4">waiting processes as part of handling the interrupt.</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1528165238112" FOLDED="true" ID="ID_1697310674" MODIFIED="1566975182765">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>scullpipe&#x7684;&#x5b9e;&#x73b0;&#x662f;&#x5b9e;&#x73b0;&#x4e00;&#x4e2a;&#x7ba1;&#x9053;&#x7684;&#x5f62;&#x5f0f;&#xff0c;&#x7531;write&#x8fdb;&#x7a0b;&#x6765;&#x5524;&#x9192; </b>
    </p>
    <p>
      <b>&#x963b;&#x585e;&#x4f4f;&#x7684;read&#x8fdb;&#x7a0b;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1528168392443" ID="ID_1908286061" MODIFIED="1528168551580">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>struct scull_pipe { </b>
    </p>
    <p>
      <b>wait_queue_head_t inq, outq;&#xa0;&#xa0;&#xa0;*******read and write queues </b>
    </p>
    <p>
      <b>char *buffer, *end;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;********begin of buf, end of buf </b>
    </p>
    <p>
      <b>int buffersize;&#xa0;&#xa0;********used in pointer arithmetic </b>
    </p>
    <p>
      <b>char *rp, *wp;&#xa0;&#xa0;******** where to read, where to write </b>
    </p>
    <p>
      <b>int nreaders, nwriters;&#xa0;&#xa0;********** number of openings for r/w </b>
    </p>
    <p>
      <b>struct fasync_struct *async_queue;&#xa0;&#xa0;********asynchronous readers </b>
    </p>
    <p>
      <b>struct semaphore sem; ******** mutual exclusion semaphore </b>
    </p>
    <p>
      <b>struct cdev cdev; ******* Char device structure </b>
    </p>
    <p>
      <b>}; </b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1455698408391" ID="ID_733138319" MODIFIED="1455698472247">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#a70b0b">&#x4e00;&#x4e2a;&#x963b;&#x585e;&#x5f0f;&#x7684;&#x8f93;&#x5165;&#x8f93;&#x51fa;&#x7684;&#x5b9e;&#x4f8b;</font></i></b>&#xff1a;
    </p>
    <p>
      the call to copy_to_user. If scull sleeps while copying data
    </p>
    <p>
      between kernel and user space, it sleeps with the device semaphore held. Holding the
    </p>
    <p>
      semaphore in this case is justified since it does not deadlock the system
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455698550301" FOLDED="true" ID="ID_242657617" MODIFIED="1515281902315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#bc0606">&#x9ad8;&#x7ea7;&#x5f0f;&#x7684;&#x8fdb;&#x7a0b;&#x4f11;&#x7720;</font></i></b>&#xff1a;
    </p>
    <p>
      &#x5728;&#x66f4;&#x52a0;&#x590d;&#x6742;&#x7684;&#x9501;&#x673a;&#x5236;&#x548c;&#x6781;&#x9ad8;&#x7684;&#x6027;&#x80fd;&#x8981;&#x6c42;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;
    </p>
    <p>
      &#x9700;&#x8981;&#x9a71;&#x52a8;&#x5f00;&#x53d1;&#x5de5;&#x7a0b;&#x5e08;&#x8fdb;&#x4e00;&#x6b65;&#x5730;&#x4e86;&#x89e3;&#x8fdb;&#x7a0b;&#x4f11;&#x7720;&#x7684;&#x66f4;&#x52a0;
    </p>
    <p>
      &#x5e95;&#x5c42;&#x7684;&#x77e5;&#x8bc6;&#xff0e;
    </p>
    <p>
      wait_queue_t&#x771f;&#x6b63;&#x4ee3;&#x8868;&#x4e86;&#x4e00;&#x4e2a;&#x8fdb;&#x7a0b;&#x4f11;&#x7720;&#x7684;&#x4fe1;&#x606f;&#x4ee5;&#x53ca;&#x5b83;
    </p>
    <p>
      &#x5982;&#x4f55;&#x88ab;&#x5524;&#x9192;&#xff0e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1455699219712" ID="ID_1923134572" MODIFIED="1455702155509">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8fdb;&#x7a0b;&#x4f11;&#x7720;&#x7684;&#x6b65;&#x9aa4;&#xff1a;
    </p>
    <p>
      1.&#x5206;&#x914d;&#x548c;&#x521d;&#x59cb;&#x5316;wait_queue_t&#x7ed3;&#x6784;&#x4f53;
    </p>
    <p>
      2.&#x5c06;&#x5b83;&#x6dfb;&#x52a0;&#x8fdb;&#x5165;&#x5408;&#x9002;&#x7684;&#x7b49;&#x5f85;&#x961f;&#x5217;&#x5f53;&#x4e2d;
    </p>
    <p>
      3.&#x8bbe;&#x7f6e;&#x8fdb;&#x7a0b;&#x7684;&#x72b6;&#x6001;&#x5c06;&#x5176;&#x6807;&#x8bc6;&#x4e3a;&#x4f11;&#x7720;&#x72b6;&#x6001;
    </p>
    <p>
      <font size="3">TASK_INTERRUPTIBLE,TASK_UNINTERRUPTIBLE</font>
    </p>
    <p>
      linux/sched.h
    </p>
    <p>
      &#x5efa;&#x8bae;&#x4f7f;&#x7528;&#x7684;&#x51fd;&#x6570;&#x662f;void set_current_state(int new_state)
    </p>
    <p>
      4.&#x653e;&#x5f03;&#x5bf9;&#x5904;&#x7406;&#x5668;&#x7684;&#x5360;&#x6709;
    </p>
    <p>
      if (!condition)
    </p>
    <p>
      schedule( );
    </p>
    <p>
      &#x5728;&#x8fd0;&#x884c;schedule&#x4e4b;&#x524d;&#xff0c;&#x5fc5;&#x987b;&#x68c0;&#x67e5;&#x5524;&#x9192;&#x6761;&#x4ef6;&#xff0c;&#x4ee5;&#x9632;&#x5df2;&#x7ecf;&#x6709;&#x4eba;&#x5524;&#x9192;&#x4e86;&#x6211;&#x4eec;&#xff0e;
    </p>
    <p>
      &#x5982;&#x679c;&#x6211;&#x4eec;&#x8df3;&#x8fc7;&#x4e86;schedule()&#x51fd;&#x6570;&#xff0c;&#x5fc5;&#x987b;&#x505a;&#x540e;&#x671f;&#x7684;&#x6e05;&#x7406;&#x5de5;&#x4f5c;&#xff1a;
    </p>
    <p>
      &#x5c06;&#x8fdb;&#x7a0b;&#x72b6;&#x6001;&#x91cd;&#x65b0;&#x8bbe;&#x7f6e;&#x4e3a;TASK_RUNNING
    </p>
    <p>
      &#x5c06;&#x8fdb;&#x7a0b;&#x4ece;&#x7b49;&#x5f85;&#x961f;&#x5217;&#x5f53;&#x4e2d;&#x79fb;&#x9664;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455702559748" ID="ID_1154542942" MODIFIED="1455704698727">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5177;&#x4f53;&#x7684;&#x4ee3;&#x7801;&#x4e66;&#x5199;&#x6d41;&#x7a0b;&#xff1a;
    </p>
    <p>
      1. wait_queue_t my_wait;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;init_wait(&amp;my_wait);
    </p>
    <p>
      2. void prepare_to_wait(wait_queue_head_t *queue,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;wait_queue_t *wait, int state); state&#x6807;&#x5fd7;&#x8fdb;&#x7a0b;&#x7684;&#x65b0;&#x72b6;&#x6001;
    </p>
    <p>
      3. if(!condition) schedule();
    </p>
    <p>
      4. &#x5f53;schedule()&#x8fd4;&#x56de;&#x4e4b;&#x540e;&#x6267;&#x884c;&#x6e05;&#x7406;&#x5de5;&#x4f5c;:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void finish_wait(wait_queue_head_t *queue, wait_queue_t *wait)
    </p>
    <p>
      5. &#x68c0;&#x67e5;&#x5f53;&#x524d;&#x7684;&#x5524;&#x9192;&#x662f;&#x4e0d;&#x662f;&#x7531;&#x4fe1;&#x53f7;&#x7684;&#x9012;&#x9001;&#x800c;&#x5bfc;&#x81f4;&#x7684;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1455705150046" FOLDED="true" ID="ID_949863613" MODIFIED="1486555599162">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#b61010">&#x6392;&#x4ed6;&#x6027;&#x5730;&#x7b49;&#x5f85;&#xff1a; </font></i></b>
    </p>
    <p>
      &#x5f53;&#x8c03;&#x7528;wake_up&#x65f6;&#xff0c;&#x4f11;&#x7720;&#x5728;&#x76f8;&#x540c;&#x7684;&#x961f;&#x5217;&#x4e0a;&#x7684;&#x6240;&#x6709;&#x8fdb;&#x7a0b;&#x90fd;&#x4f1a;&#x88ab;&#x5524;&#x9192;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x5c31;&#x662f;&#xff02;&#x60ca;&#x7fa4;&#x6548;&#x5e94;&#xff02;&#xff0e;&#x5982;&#x679c;&#x8fd9;&#x4e9b;&#x8fdb;&#x7a0b;&#x4e89;&#x593a;&#x7684;&#x662f;&#x76f8;&#x540c;&#x7684;&#x8d44;&#x6e90;&#xff0c;&#x90a3;&#x4e48;
    </p>
    <p>
      &#x90a3;&#x4e9b;&#x6700;&#x7ec8;&#x6ca1;&#x6709;&#x4e89;&#x593a;&#x5230;&#x8d44;&#x6e90;&#x7684;&#x8fdb;&#x7a0b;&#x53c8;&#x4f1a;&#x91cd;&#x65b0;&#x8fdb;&#x5165;&#x4f11;&#x7720;&#x72b6;&#x6001;&#xff0c;&#x8fd9;&#x65e0;&#x7591;&#x662f;
    </p>
    <p>
      &#x5de8;&#x5927;&#x7684;&#x6027;&#x80fd;&#x635f;&#x5931;&#xff0e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1455705618637" ID="ID_96460562" MODIFIED="1455706624392">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5185;&#x6838;&#x5f53;&#x4e2d;&#x89e3;&#x51b3;&#x60ca;&#x7fa4;&#x6548;&#x5e94;&#x7684;&#x65b9;&#x6cd5;&#xff1a;exclusive wait
    </p>
    <p>
      &#x8be5;wait&#x65b9;&#x6cd5;&#x7684;&#xff12;&#x4e2a;&#x91cd;&#x8981;&#x7279;&#x5f81;
    </p>
    <p>
      1.&#x5f53;&#x7b49;&#x5f85;&#x9879;&#x88ab;&#x8bbe;&#x7f6e;WQ_FLAG_EXCLUSIVE&#x6807;&#x5fd7;&#x7684;&#x65f6;&#x5019;&#xff0c;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x8be5;&#x8fdb;&#x7a0b;&#x4f1a;&#x88ab;&#x6dfb;&#x52a0;&#x5230;&#x7b49;&#x5f85;&#x961f;&#x5217;&#x7684;&#x6700;&#x5c3e;&#x90e8;&#x800c;&#x4e0d;&#x662f;&#x9996;&#x90e8;
    </p>
    <p>
      2. &#x5f53;wake_up&#x88ab;&#x8c03;&#x7528;&#x4e4b;&#x540e;&#xff0c;&#x5f53;&#x5177;&#x6709;WQ_FLAG_EXCLUSIVE&#x6807;&#x5fd7;
    </p>
    <p>
      &#x3000;&#x7684;&#x8fdb;&#x7a0b;&#x88ab;&#x5524;&#x9192;&#x4e4b;&#x540e;&#xff0c;&#x5c31;&#x4e0d;&#x518d;&#x5524;&#x9192;&#x8be5;&#x961f;&#x5217;&#x91cc;&#x9762;&#x7684;&#x5176;&#x4ed6;&#x8fdb;&#x7a0b;&#x4e86;&#xff0e;
    </p>
    <p>
      &#x8868;&#x73b0;&#x51fa;&#x6392;&#x4ed6;&#x6027;&#x7b49;&#x5f85;&#x7684;&#x8fdb;&#x7a0b;&#x6bcf;&#x6b21;&#x53ea;&#x88ab;&#x5524;&#x9192;&#x4e00;&#x4e2a;&#xff0c;&#x5e76;&#x4e14;&#x662f;&#x987a;&#x5e8f;&#x5524;&#x9192;&#x7684;&#xff0c;&#x5176;&#x4ed6;
    </p>
    <p>
      &#x6ca1;&#x6709;&#x8bbe;&#x7f6e;&#x6807;&#x5fd7;&#x7684;&#x8fdb;&#x7a0b;&#x4ecd;&#x7136;&#x4f1a;&#x8868;&#x73b0;&#x51fa;&#x60ca;&#x7fa4;&#x6548;&#x5e94;&#x7684;&#xff0e;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455707141289" ID="ID_792122754" MODIFIED="1455707169884">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>void prepare_to_wait_exclusive(wait_queue_head_t *queue, </i></b>
    </p>
    <p>
      <b><i>&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;wait_queue_t *wait, </i></b>
    </p>
    <p>
      <b><i>&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;&#x3000;int state);</i></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1455719423483" ID="ID_442864440" MODIFIED="1455720007511">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#cc0000"><b><i>&#x5524;&#x9192;&#x64cd;&#x4f5c;&#x7684;&#x7ec6;&#x8282;&#xff1a; </i></b></font>
    </p>
    <p>
      &#x5f53;&#x8fdb;&#x7a0b;&#x88ab;&#x5524;&#x9192;&#x4e4b;&#x540e;&#xff0c;&#x771f;&#x6b63;&#x7684;&#x64cd;&#x4f5c;&#x662f;&#x7531;&#x7b49;&#x5f85;&#x961f;&#x5217;&#x5165;&#x53e3;&#x91cc;&#x9762;&#x7684;&#x51fd;&#x6570;&#x5b8c;&#x6210;&#x7684;&#xff0c;
    </p>
    <p>
      &#x9ed8;&#x8ba4;&#x7684;&#x5524;&#x9192;&#x51fd;&#x6570;&#x4f1a;&#x5c06;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x7684;&#x72b6;&#x6001;&#x8bbe;&#x7f6e;&#x6210;&#x53ef;&#x8fd0;&#x884c;&#x72b6;&#x6001;&#x5e76;&#x4e14;&#x5982;&#x679c;&#x8be5;&#x8fdb;&#x7a0b;
    </p>
    <p>
      &#x7684;&#x4f18;&#x5148;&#x7ea7;&#x8db3;&#x591f;&#x9ad8;&#x7684;&#x8bdd;&#xff0c;&#x4f1a;&#x5c06;&#x4e0a;&#x4e0b;&#x6587;&#x5207;&#x6362;&#x5230;&#x8be5;&#x8fdb;&#x7a0b;&#x91cc;&#x9762;&#x3002;
    </p>
    <p>
      <b>&lt;linux/wait.h&gt;&#x91cc;&#x9762;&#x53ef;&#x4ee5;&#x67e5;&#x9605;&#x5230;&#x5982;&#x4f55;&#x8bbe;&#x7f6e;&#x81ea;&#x5df1;&#x7684;&#x5524;&#x9192;&#x51fd;&#x6570;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455792011548" FOLDED="true" ID="ID_1740019152" MODIFIED="1486555599162">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Poll&#x548c;Select</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1455792136092" FOLDED="true" ID="ID_91233728" MODIFIED="1475896811626">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;&#x975e;&#x963b;&#x585e;&#x5f0f;&#x8f93;&#x5165;&#x8f93;&#x51fa;&#x7684;&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x7ecf;&#x5e38;&#x4f1a;&#x4f7f;&#x7528;
    </p>
    <p>
      poll,select&#x548c;epoll&#x7cfb;&#x7edf;&#x8c03;&#x7528;
    </p>
    <p>
      &#x652f;&#x6301;&#x4e0a;&#x9762;&#x7684;&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x9700;&#x8981;&#x9a71;&#x52a8;&#x5c42;&#x9762;&#x652f;&#x6301;&#xff0c;&#x5b9e;&#x73b0;&#x5982;&#x4e0b;&#x51fd;&#x6570;
    </p>
    <p>
      unsigned int (*poll) (struct file *filp, poll_table *wait)
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x4e3b;&#x8981;&#x5730;&#x4f1a;&#x5b9e;&#x73b0;2&#x6b65;&#x64cd;&#x4f5c;
    </p>
  </body>
</html></richcontent>
<node CREATED="1455853485428" ID="ID_410551377" MODIFIED="1455853802029">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x76f8;&#x5173;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;:
    </p>
    <p>
      1.&#x6bcf;&#x4e2a;poll&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x90fd;&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;&#x603b;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;poll_wqueues
    </p>
    <p>
      &#xa0;&#xa0; <i>struct poll_wqueues{ </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;poll_table pt; </i>
    </p>
    <p>
      <i>&#x3000;&#x3000;struct poll_table_page * table; </i>
    </p>
    <p>
      <i>&#x3000;&#x3000;int error; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;};&#x5bf9;&#x5916;&#x7684;&#x63a5;&#x53e3;&#x662f;poll_table pt </i>
    </p>
    <p>
      
    </p>
    <p>
      <i>typedef struct poll_table_struct { </i>
    </p>
    <p>
      <i>&#x3000;&#x3000;poll_queue_proc qproc; </i>
    </p>
    <p>
      <i>}poll_table </i>
    </p>
    <p>
      <i>typedef void (*poll_queue_proc)(struct file *, wait_queue_head_t *, struct poll_table_struct *) </i>
    </p>
    <p>
      
    </p>
    <p>
      <i>struct poll_table_page { </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;struct poll_table_page * next; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;struct poll_table_entry * entry; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;struct poll_table_entry entries[0]; //&#x6307;&#x5411;&#x7ed3;&#x6784;&#x4f53;&#x7684;&#x4e0b;&#x4e00;&#x4e2a;&#x5730;&#x5740;&#xff0c;&#x4e0d;&#x5360;&#x7a7a;&#x95f4;&#x3002; </i>
    </p>
    <p>
      <i>}; </i>
    </p>
    <p>
      <i>struct poll_table_entry { </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;struct file * filp; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;wait_queue_t wait; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;wait_queue_head_t * wait_address; </i>
    </p>
    <p>
      <i>}; poll_table_page&#x662f;&#x4e00;&#x4e2a;&#x94fe;&#x8868;&#xff0c;&#x91cc;&#x9762;&#x5b58;&#x6709;&#x5173;&#x4e8e;&#x5f53;&#x524d;&#x4f11;&#x7720;&#x8fdb;&#x7a0b;&#x7684;&#x4fe1;&#x606f;&#x548c;&#x4f11;&#x7720;&#x7684;&#x961f;&#x5217;&#x4fe1;&#x606f;</i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455854308100" ID="ID_400585129" MODIFIED="1455859763923">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      poll&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x7684;&#x8c03;&#x7528;&#x6d41;&#x7a0b;&#xff1a;int poll(struct pollfd *fds,nfds_t nfds, int timeout)
    </p>
    <p>
      1.&#x9996;&#x5148;&#x8c03;&#x7528;sys_poll&#x8be5;&#x51fd;&#x6570;&#x662f;&#x5c06;timeout&#x8f6c;&#x6362;&#x6210;&#x7cfb;&#x7edf;&#x7684;jiffes
    </p>
    <p>
      2.&#x5176;&#x6b21;&#x8c03;&#x7528;do_sys_poll&#xff0c;&#x8be5;&#x51fd;&#x6570;&#x7684;&#x4f5c;&#x7528;&#x662f;&#x521d;&#x59cb;&#x5316;poll_wqueues-&gt;pt-&gt;qproc
    </p>
    <p>
      3.&#x6700;&#x540e;&#x8c03;&#x7528;do_poll&#x51fd;&#x6570;&#xff0c;do_poll&#x51fd;&#x6570;&#x4f1a;&#x5bf9;pollfd&#x6570;&#x7ec4;&#x91cc;&#x9762;&#x7684;&#x6bcf;&#x4e2a;fd&#x8c03;&#x7528;do_pollfd&#x51fd;&#x6570;
    </p>
    <p>
      4. unsigned int do_pollfd(struct pollfd *pollfd, poll_table *pwait)&#x51fd;&#x6570;&#xff0c;&#x8be5;&#x51fd;&#x6570;&#x6700;&#x7ec8;&#x4f1a;
    </p>
    <p>
      &#x8c03;&#x7528;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x91cc;&#x9762;&#x7684;poll&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455859769818" ID="ID_1188225354" MODIFIED="1455859975046">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x9a71;&#x52a8;&#x91cc;&#x9762;&#x7684;poll&#x51fd;&#x6570;&#x7684;&#x5b9e;&#x73b0;: </b></i>
    </p>
    <p>
      <i><b>scull_p_poll(struct file *filp, poll_table *wait) </b></i>
    </p>
    <p>
      poll&#x51fd;&#x6570;&#x91cc;&#x9762;&#x9700;&#x8981;&#x8c03;&#x7528;poll_wait&#x51fd;&#x6570;&#xff0c;poll_wait&#x51fd;&#x6570;&#x4f1a;&#x8c03;&#x7528;&#x5230;
    </p>
    <p>
      poll_table-&gt;qproc&#x51fd;&#x6570;&#xff0c;&#x76ee;&#x7684;&#x662f;&#x4e3a;&#x4e86;&#x5c06;&#x5f53;&#x524d;&#x8fdb;&#x7a0b;&#x52a0;&#x5165;&#x5230;&#x67d0;&#x4e2a;&#x961f;&#x5217;&#x5f53;&#x4e2d;&#xff0c;
    </p>
    <p>
      &#x56e0;&#x4e3a;&#x8fdb;&#x7a0b;&#x5982;&#x679c;&#x8981;&#x8fdb;&#x884c;&#x4f11;&#x7720;&#x7684;&#x8bdd;&#x5fc5;&#x987b;&#x52a0;&#x5165;&#x67d0;&#x4e2a;&#x7b49;&#x5f85;&#x7684;&#x961f;&#x5217;&#x91cc;&#x9762;&#x624d;&#x53ef;&#x4ee5;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455862683669" ID="ID_1883111812" MODIFIED="1455863728073">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;poll&#x548c;select&#x7684;&#x76ee;&#x7684;&#x662f;&#x63d0;&#x524d;&#x77e5;&#x6653;I/O&#x64cd;&#x4f5c;&#x662f;&#x5426;&#x4f1a;&#x963b;&#x585e;
    </p>
    <p>
      &#x800c;&#x4e14;&#x53ef;&#x4ee5;&#x540c;&#x65f6;&#x76d1;&#x89c6;&#x591a;&#x4e2a;&#x6587;&#x4ef6;&#x63cf;&#x8ff0;&#x7b26;&#x7684;&#x72b6;&#x6001;&#xff0c;&#x6b63;&#x786e;&#x5730;&#x4f7f;&#x7528;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x53ef;&#x4ee5;&#x4fdd;&#x8bc1;&#x5e94;&#x7528;&#x7a0b;&#x5e8f;&#x6b63;&#x786e;&#x5730;&#x5de5;&#x4f5c;&#xff0e;
    </p>
    <p>
      <b>&#x4e0b;&#x9762;&#x603b;&#x7ed3;&#x4e00;&#x4e9b;&#x4f7f;&#x7528;&#x89c4;&#x5219;&#xff1a;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455864373599" ID="ID_1306814719" MODIFIED="1455864393715">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5e95;&#x5c42;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;:</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1455865796200" FOLDED="true" ID="ID_415466477" MODIFIED="1566975177524">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5f02;&#x6b65;&#x901a;&#x77e5;: </b>
    </p>
    <p>
      &#x901a;&#x8fc7;&#x4f7f;&#x80fd;&#x5f02;&#x6b65;&#x901a;&#x77e5;&#xff0c;&#x8fdb;&#x7a0b;&#x53ef;&#x4ee5;&#x5728;&#x8bbe;&#x5907;&#x6709;&#x6570;&#x636e;&#x7684;&#x65f6;&#x5019;
    </p>
    <p>
      &#x83b7;&#x5f97;&#x4fe1;&#x53f7;&#x901a;&#x77e5;&#xff0e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1455868349794" ID="ID_1835765968" MODIFIED="1455868949577">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7528;&#x6237;&#x7a0b;&#x5e8f;&#x9700;&#x8981;&#x6267;&#x884c;&#xff12;&#x4e2a;&#x6b65;&#x9aa4;&#x6765;&#x4f7f;&#x80fd;&#x6765;&#x81ea;&#x8f93;&#x5165;&#x6587;&#x4ef6;&#x7684;&#x5f02;&#x6b65;&#x901a;&#x77e5;:
    </p>
    <p>
      1.&#x6307;&#x5b9a;&#x62e5;&#x6709;&#x8be5;&#x6587;&#x4ef6;&#x7684;&#x8fdb;&#x7a0b;ID&#x53f7;&#xff0e;&#x901a;&#x8fc7;fcntl&#x8bbe;&#x7f6e;F_SETOWN
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x6765;&#x5c06;&#x8fdb;&#x7a0b;&#x7684;ID&#x53f7;&#x4fdd;&#x7559;&#x5728;filp-&gt;f_owner&#x5f53;&#x4e2d;&#x4f9b;&#x540e;&#x9762;&#x4f7f;&#x7528;
    </p>
    <p>
      2.&#x901a;&#x8fc7;fcntl&#x51fd;&#x6570;&#x7684;F_SETFL&#x547d;&#x4ee4;&#x5c06;FASYNC&#x6807;&#x5fd7;&#x4f4d;&#x8bbe;&#x7f6e;&#x5230;&#x8bbe;&#x5907;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x7528;&#x4e8e;&#x4f7f;&#x80fd;&#x8bbe;&#x5907;&#x7684;&#x5f02;&#x6b65;&#x901a;&#x77e5;&#x7684;&#x529f;&#x80fd;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1527909833976" FOLDED="true" ID="ID_920713861" MODIFIED="1566975175959">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#dd1e1e">&#x5f02;&#x6b65;I/O&#x64cd;&#x4f5c;</font></b>
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#1326ee" DESTINATION="ID_998841584" ENDARROW="Default" ENDINCLINATION="-338;-106;" ID="Arrow_ID_1616113988" STARTARROW="None" STARTINCLINATION="628;0;"/>
<node CREATED="1527909926621" ID="ID_1668374088" MODIFIED="1527910052482">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x652f;&#x6301;&#x5f02;&#x6b65;&#x64cd;&#x4f5c;&#x7684;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x5e94;&#x8be5;&#x5305;&#x542b;&#x5934;&#x6587;&#x4ef6;linux/aio.h
    </p>
    <p>
      &#x6211;&#x4eec;&#x6765;&#x770b;&#x770b;&#x5f02;&#x6b65;&#x64cd;&#x4f5c;&#x7684;&#x8bfb;&#x51fd;&#x6570;&#x548c;&#x5199;&#x51fd;&#x6570;
    </p>
    <p>
      ssize_t (*aio_read) (struct kiocb *iocb, char *buffer,
    </p>
    <p>
      size_t count, loff_t offset);
    </p>
    <p>
      ssize_t (*aio_write) (struct kiocb *iocb, const char *buffer,
    </p>
    <p>
      size_t count, loff_t offset);
    </p>
    <p>
      
    </p>
    <p>
      &#x6211;&#x4eec;&#x770b;&#x5230;offset&#x91c7;&#x7528;&#x7684;&#x662f;&#x503c;&#x4f20;&#x9012;&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x56e0;&#x4e3a;&#x5f02;&#x6b65;&#x64cd;&#x4f5c;&#x4e0d;&#x4f1a;&#x6539;&#x53d8;file position,&#x6240;&#x4ee5;&#x6ca1;&#x6709;&#x5fc5;&#x8981;&#x4f20;&#x9012;&#x6307;&#x9488;&#x3002;
    </p>
    <p>
      &#x53e6;&#x5916;&#x8fd8;&#x6709;&#x4e00;&#x4e2a;&#x53c2;&#x6570;iocb,&#x6211;&#x4eec;&#x79f0;&#x4e4b;&#x4e3a;I/O control block
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527923072370" ID="ID_708373387" MODIFIED="1527927352810">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      aio_read&#x548c;aio_write&#x5b58;&#x5728;&#x7684;&#x76ee;&#x7684;&#x5c31;&#x662f;&#x521d;&#x59cb;&#x5316;read&#x548c;write&#x64cd;&#x4f5c;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x64cd;&#x4f5c;&#x5728;&#x8fd4;&#x56de;&#x7684;&#x65f6;&#x5019;&#x6709;&#x53ef;&#x80fd;&#x4ecd;&#x7136;&#x6ca1;&#x6709;&#x5b8c;&#x6210;&#x4efb;&#x52a1;&#x3002;
    </p>
    <p>
      static ssize_t my_aio_read(struct kiocb *iocb, char *buffer,
    </p>
    <p>
      ssize_t count, loff_t offset)
    </p>
    <p>
      {
    </p>
    <p>
      return my_read(iocb-&gt;ki_filp, buffer, count, &amp;offset);
    </p>
    <p>
      }
    </p>
    <p>
      &#x6ce8;&#x610f;file&#x6307;&#x9488;&#x662f;&#x5b58;&#x653e;&#x5728;kiocb&#x7684;ki_filp&#x5b57;&#x6bb5;&#x91cc;&#x9762;&#x7684;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527927356494" ID="ID_212076395" MODIFIED="1527929832150">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5982;&#x679c;&#x4f60;&#x652f;&#x6301;&#x5f02;&#x6b65;I/O, &#x4f60;&#x5fc5;&#x987b;&#x6e05;&#x695a;kernel&#x6709;&#x65f6;&#x5019;&#x4f1a;&#x521b;&#x5efa;synchronous IOCBs&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x662f;&#x5fc5;&#x987b;&#x88ab;&#x540c;&#x6b65;&#x6267;&#x884c;&#x7684;&#x5f02;&#x6b65;&#x64cd;&#x4f5c;&#x3002;
    </p>
    <p>
      &#x540c;&#x6b65;&#x64cd;&#x4f5c;&#x7684;&#x6807;&#x8bc6;&#x88ab;&#x6807;&#x8bb0;&#x5230;&#x4e86;IOCB&#x91cc;&#x9762;&#xff0c;&#x4f60;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x51fd;&#x6570;int is_sync_kiocb(struct kiocb *iocb)
    </p>
    <p>
      &#x67e5;&#x8be2;&#x5f53;&#x524d;&#x7684;&#x72b6;&#x6001;&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x8be5;&#x51fd;&#x6570;&#x8fd4;&#x56de;&#x975e;0&#x503c;&#xff0c;&#x90a3;&#x4e48;&#x4f60;&#x7684;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x5fc5;&#x987b;&#x540c;&#x6b65;&#x6267;&#x884c;&#x8be5;&#x64cd;&#x4f5c;&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x4f60;&#x7684;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x53ef;&#x4ee5;&#x521d;&#x59cb;&#x5316;&#x5f02;&#x6b65;&#x64cd;&#x4f5c;(&#x6216;&#x8005;&#x53ea;&#x662f;&#x7b80;&#x5355;&#x5730;&#x5c06;&#x8be5;&#x64cd;&#x4f5c;&#x6392;&#x8fdb;&#x961f;&#x5217;&#x4ee5;&#x4fbf;&#x5c06;&#x6765;&#x6267;&#x884c;)
    </p>
    <p>
      &#x5b83;&#x5fc5;&#x987b;&#x8981;&#x505a;&#x4e24;&#x4ef6;&#x4e8b;&#x60c5;: &#x4e00;&#x4e2a;&#x662f;&#x8981;&#x8bb0;&#x4f4f;&#x6240;&#x6709;&#x9700;&#x8981;&#x8bb0;&#x4f4f;&#x7684;&#x4fe1;&#x606f;&#xff0c;&#x53e6;&#x4e00;&#x4e2a;&#x662f;&#x5411;&#x4e0a;&#x5c42;&#x8fd4;&#x56de;-EIOCBQUEUED&#x3002;
    </p>
    <p>
      &#x8bb0;&#x4f4f;&#x5fc5;&#x8981;&#x7684;&#x4fe1;&#x606f;&#x5305;&#x62ec;&#x9700;&#x8981;&#x8bb0;&#x4f4f;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7f13;&#x5b58;&#x7684;&#x5730;&#x5740;&#xff0c;&#x56e0;&#x4e3a;&#x4f60;&#x6ca1;&#x6709;&#x673a;&#x4f1a;&#x518d;&#x83b7;&#x53d6;&#x8be5;&#x5730;&#x5740;&#x4e86;&#xff0c;&#x901a;&#x5e38;&#x610f;&#x4e49;&#x4e0a;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x610f;&#x5473;&#x7740;&#x4f60;&#x9700;&#x8981;&#x53bb;&#x8bbe;&#x7f6e;&#x76f4;&#x63a5;&#x5185;&#x5b58;&#x6620;&#x5c04;(get_user_pages)&#x6216;&#x8005;&#x662f;DMA&#x6620;&#x5c04;&#x3002;
    </p>
    <p>
      -EIOCBQUEUED&#x9519;&#x8bef;&#x4ee3;&#x7801;&#x610f;&#x5473;&#x7740;&#x8be5;&#x64cd;&#x4f5c;&#x8fd8;&#x6ca1;&#x6709;&#x5b8c;&#x6210;&#xff0c;&#x5b83;&#x7684;&#x6700;&#x7ec8;&#x72b6;&#x6001;&#x4f1a;&#x5728;&#x7a0d;&#x540e;&#x62a5;&#x544a;&#x5230;&#x4e0a;&#x5c42;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      &#x5f53;&#x9a71;&#x52a8;&#x5b8c;&#x6210;&#x4e86;&#x4efb;&#x52a1;&#x4e4b;&#x540e;&#xff0c;&#x53ef;&#x4ee5;&#x8c03;&#x7528;&#x5982;&#x4e0b;&#x7684;&#x51fd;&#x6570;&#x6765;&#x5411;&#x4e0a;&#x5c42;&#x62a5;&#x544a;
    </p>
    <p>
      int aio_complete(struct kiocb *iocb, long res, long res2);
    </p>
    <p>
      iocb&#x662f;&#x5148;&#x524d;&#x4f20;&#x9012;&#x4e0b;&#x6765;&#x7684;&#xff0c; res&#x662f;&#x6267;&#x884c;&#x7ed3;&#x679c;&#x7684;&#x8fd4;&#x56de;&#x503c;&#xff0c; res2&#x901a;&#x5e38;&#x4f1a;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;0
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1455762629108" FOLDED="true" ID="ID_1460639053" MODIFIED="1576373044163" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#a70606"><i>&#x7279;&#x522b;&#x7ae0;&#x8282;:&#x5173;&#x4e8e;&#x4ee3;&#x7801;&#x7684;&#x7f16;&#x8bd1;</i></font></b>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="16"/>
<node CREATED="1455763244152" FOLDED="true" ID="ID_1570856145" MODIFIED="1574951005479">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x9519;&#x8bef;macro "INIT_WORK" passed 3 arguments, but takes just 2&#x89e3;&#x51b3;:</b>
    </p>
    <p>
      &#x63a8;&#x540e;&#x6267;&#x884c;&#x7684;&#x4efb;&#x52a1;&#x53eb;&#x505a;&#x5de5;&#x4f5c;&#xff0c;&#x63cf;&#x8ff0;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x662f; work_struct
    </p>
    <p>
      &#x5de5;&#x4f5c;&#x7ec4;&#x7ec7;&#x6210;&#x5de5;&#x4f5c;&#x961f;&#x5217;&#xff0c;&#x63cf;&#x8ff0;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x662f; workqueue_struct
    </p>
    <p>
      &#x5de5;&#x4f5c;&#x7ebf;&#x7a0b;&#x8d1f;&#x8d23;&#x6267;&#x884c;&#x5de5;&#x4f5c;&#x961f;&#x5217;&#x91cc;&#x9762;&#x7684;&#x4efb;&#x52a1;&#xff0c;&#x9ed8;&#x8ba4;&#x7684;&#x7ebf;&#x7a0b;&#x662f; events
    </p>
    <p>
      
    </p>
    <p>
      1.create_workqueue()&#x51fd;&#x6570;&#x521b;&#x5efa;&#x4e00;&#x4e2a;workqueue_struct,&#x6bcf;&#x4e2a;workqueue_struct
    </p>
    <p>
      &#x5185;&#x90e8;&#x90fd;&#x6709;struct cpu_workqueue_struct&#x6570;&#x7ec4;&#x6307;&#x9488;&#xff0c;&#x5373;&#x6bcf;&#x4e2a;cpu&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;
    </p>
    <p>
      cpu_workqueue_struct,&#x5f53;&#x524d;&#x7684;&#x5de5;&#x4f5c;&#x961f;&#x5217;&#x4f1a;&#x9488;&#x5bf9;&#x6bcf;&#x4e2a;cpu&#x5efa;&#x7acb;&#x4e00;&#x4e2a;&#x5de5;&#x4f5c;&#x7ebf;&#x7a0b;
    </p>
    <p>
      
    </p>
    <p>
      2.&#x5de5;&#x4f5c;&#x7684;&#x521d;&#x59cb;&#x5316;
    </p>
    <p>
      INIT_WORK(struct work_struct *work, void (*function)(struct work_struct *))
    </p>
    <p>
      INIT_DELAYED_WORK(struct delayed_work *work, void (*function)(struct work_struct *))
    </p>
    <p>
      &#x5373;&#x5c06;&#x5de5;&#x4f5c;&#x5bf9;&#x5e94;&#x7684;&#x6267;&#x884c;&#x51fd;&#x6570;&#x8d4b;&#x503c;&#x5230;work_struct&#x5f53;&#x4e2d;
    </p>
    <p>
      
    </p>
    <p>
      3.&#x5de5;&#x4f5c;&#x961f;&#x5217;&#x7684;&#x8c03;&#x5ea6;&#x6267;&#x884c;
    </p>
    <p>
      schedule_work(&amp;work)
    </p>
    <p>
      schedule_delayed_work(&amp;delay_work,delay)
    </p>
  </body>
</html></richcontent>
<node CREATED="1455775617806" ID="ID_875389956" MODIFIED="1455775873882">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x89e3;&#x51b3;&#x65b9;&#x6cd5;:
    </p>
    <p>
      1.&#x5c06;struct async_work&#x4e2d;&#x7684;&#x6210;&#x5458;struct work_struct work
    </p>
    <p>
      &#x3000;&#x4fee;&#x6539;&#x6210;struct delayed_work delayed_work
    </p>
    <p>
      2.&#x5c06;INIT_WORK(&amp;stuff-&gt;work, scull_do_deferred_op, stuff)
    </p>
    <p>
      &#x3000;&#x4fee;&#x6539;&#x6210;INIT_DELAYED_WORK(&amp;stuff-&gt;delayed_work, scullc_do_deferred_op)
    </p>
    <p>
      &#x3000;&#x56e0;&#x4e3a;&#x65b0;&#x7684;INIT&#x51fd;&#x6570;&#x53ea;&#x9700;&#x8981;2&#x4e2a;&#x53c2;&#x6570;&#x4e86;
    </p>
    <p>
      3.scullp_do_deferred_op&#x8fd9;&#x4e2a;&#x51fd;&#x6570;&#x9700;&#x8981;&#x8fdb;&#x884c;&#x4fee;&#x6539;
    </p>
    <p>
      &#x3000;<font color="#df0808"><i>struct async_work *stuff = </i></font>
    </p>
    <p>
      <font color="#df0808"><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;container_of(p, struct async_work, delayed_work.work)</i></font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1455775946822" ID="ID_1114006347" MODIFIED="1455776063685">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>error: unknown field &#x2018;ioctl&#x2019; specified in initializer&#x89e3;&#x51b3;&#x65b9;&#x6cd5; </b>
    </p>
    <p>
      &#x4ece;2.6&#x67d0;&#x4e2a;&#x7248;&#x672c;&#x7684;&#x5185;&#x6838;&#x5f00;&#x59cb;&#xff0c;filep&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x5df2;&#x7ecf;&#x6ca1;&#x6709;&#x4e86;ioctl&#x6210;&#x5458;&#x4e86;
    </p>
    <p>
      &#x6539;&#x7528;unlock_ioctl&#x51fd;&#x6570;&#x4e86;&#xff0c;&#x65e7;&#x7684;ioctl&#x51fd;&#x6570;&#x4f7f;&#x7528;&#x4e86;&#x5927;&#x5185;&#x6838;&#x9501;&#xff0c;&#x5f71;&#x54cd;&#x6027;&#x80fd;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455776502433" ID="ID_1112717450" MODIFIED="1455777128245">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      aio_read&#x51fd;&#x6570;&#x548c;aio_write&#x51fd;&#x6570;&#x5728;&#x65b0;&#x7248;&#x5185;&#x6838;&#x91cc;&#x9762;&#x7684;&#x58f0;&#x660e;&#x6709;&#x53d8;&#x5316;&#x9700;&#x8981;&#x4fee;&#x6539;&#xff1a;
    </p>
    <p>
      1.scullp_aio_read(struct kiocb *iocb, char __user *buf,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size_t count,loff_t pos)
    </p>
    <p>
      &#x4fee;&#x6539;&#x4e3a;
    </p>
    <p>
      (*aio_read) (struct kiocb *iocb, const struct iovec *iov,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned long niov, loff_t pos);
    </p>
    <p>
      aio_write&#x4e5f;&#x4f1a;&#x505a;&#x540c;&#x6837;&#x7684;&#x4fee;&#x6539;
    </p>
    <p>
      
    </p>
    <p>
      2.&#x5c06;scullp_defer_op(int write, struct kiocb *iocb, char __user *buf,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size_t count, loff_t pos)&#x7684;&#x58f0;&#x660e;&#x4fee;&#x6539;&#x4e3a;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;scullc_defer_op(int write, struct kiocb *iocb, const struct iovec *iov,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned long niov, loff_t pos)
    </p>
    <p>
      
    </p>
    <p>
      3.&#x4fee;&#x6539;scullp_defer_op&#x7684;&#x5185;&#x90e8;
    </p>
    <p>
      scullp_write(iocb-&gt;ki_filp, (char *)(iov-&gt;iov_base), iov-&gt;iov_len, &amp;pos);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1455783787352" ID="ID_1921505971" MODIFIED="1455783807088">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;&#x7ed3;&#x6784;scull_vm_ops&#x521d;&#x59cb;&#x5316;&#x65f6;&#xff1a;
    </p>
    <p>
      &#x53bb;&#x6389;.nopage = scullv_vma_nopage;
    </p>
    <p>
      &#x4fee;&#x6539;&#x4e3a;.fault = scullv_vma_fault
    </p>
  </body>
</html></richcontent>
</node>
<node COLOR="#cc0033" CREATED="1434600032779" FOLDED="true" ID="ID_389670617" MODIFIED="1576372817011">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3" color="#1b43e6">&#x5173;&#x4e8e;&#x9a71;&#x52a8;&#x7f16;&#x8bd1;&#x7684;Makefile&#x5206;&#x6790;</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1434600072078" ID="ID_333258577" MODIFIED="1434600082269" TEXT="1.makefile&#x7684;&#x4e8c;&#x6b21;&#x52a0;&#x8f7d;"/>
<node CREATED="1434600084757" ID="ID_1963536127" MODIFIED="1434600100459" TEXT="2.obj-m&#x6307;&#x5b9a;&#x9700;&#x8981;&#x7f16;&#x8bd1;&#x7684;&#x6a21;&#x5757;"/>
<node CREATED="1434600135900" ID="ID_218827246" MODIFIED="1434600222774">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.$(MAKE) -C $(KERNELDIR) M=$(PWD) LDDINC=$(PWD)/../include modules
    </p>
    <p>
      &#x5173;&#x4e8e;modules&#x76ee;&#x6807;&#x4e2d;&#x7684;<font color="#ff3333">stage</font>&#x90e8;&#x5206;&#x7684;&#x5206;&#x6790;
    </p>
    <p>
      <font color="#ff0033">/lib/modules/2.6.32-279.el6.i686/build/scripts/Makefile.modpost</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1523979493348" ID="ID_92293835" MODIFIED="1523979637510">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;&#x9a71;&#x52a8;&#x7684;makefile&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#xff0c;&#x7ecf;&#x5e38;&#x4f1a;&#x770b;&#x5230;&#x5982;&#x4e0b;&#x7684;&#x8bed;&#x53e5;:
    </p>
    <p>
      
    </p>
    <p>
      depend .depend dep:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;$(CC) $(EXTRA_CFLAGS) -M *.c &gt; .depend
    </p>
    <p>
      
    </p>
    <p>
      ifeq (.depend,$(wildcard .depend))
    </p>
    <p>
      include .depend
    </p>
    <p>
      endif
    </p>
    <p>
      
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x662f;&#x5229;&#x7528;gcc -M&#x7684;&#x529f;&#x80fd;&#x5c06;&#x6240;&#x6709;&#x7684;&#x6e90;&#x6587;&#x4ef6;&#x7684;&#x5934;&#x6587;&#x4ef6;&#x7684;&#x4f9d;&#x8d56;&#x5173;&#x7cfb;&#x5bfc;&#x5165;&#x5230;&#x4e86;.depend&#x5f53;&#x4e2d;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x6837;&#x5f53;&#x67d0;&#x4e00;&#x4e2a;&#x5934;&#x6587;&#x4ef6;&#x88ab;&#x4fee;&#x6539;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x8fd0;&#x884c;make&#x7684;&#x65f6;&#x5019;&#x5305;&#x542b;&#x8be5;&#x5934;&#x6587;&#x4ef6;&#x7684;&#x6e90;&#x6587;&#x4ef6;&#x90fd;&#x4f1a;&#x88ab;&#x91cd;&#x65b0;&#x7f16;&#x8bd1;&#x3002;
    </p>
    <p>
      &#x6bcf;&#x6b21;&#x65b0;&#x6dfb;&#x52a0;&#x4e00;&#x4e2a;&#x5934;&#x6587;&#x4ef6;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x9700;&#x8981;&#x8fd0;&#x884c;&#x4e00;&#x6b21;depend
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1574952681917" FOLDED="true" ID="ID_901852094" MODIFIED="1576372820304">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5982;&#x4f55;&#x5728;&#x6700;&#x65b0;&#x7684;&#x5185;&#x6838;&#x4ee3;&#x7801;&#x4e0a;&#x7f16;&#x8bd1;LDD3&#x7684;&#x4ee3;&#x7801;&#x4f8b;&#x5b50;&#xff1a;</b>
    </p>
    <p>
      
    </p>
    <p>
      1.&#x9996;&#x5148;&#x4ece;github&#x4e0a;&#x627e;&#x5230;&#x522b;&#x4eba;&#x4fee;&#x6539;&#x8fc7;&#x7684;&#x5339;&#x914d;&#x7684;&#x4ee3;&#x7801;
    </p>
    <p>
      git clone git://github.com/martinezjavier/ldd3.git
    </p>
    <p>
      
    </p>
    <p>
      2. &#x6309;&#x7167;&#x4ee3;&#x7801;&#x7684;&#x8bf4;&#x660e;&#xff0c;&#x5728;&#x7f16;&#x8bd1;&#x4e4b;&#x524d;&#x8bbe;&#x7f6e;&#x53d8;&#x91cf;export KERNELDIR=/path/to/linux
    </p>
    <p>
      &#x5230;&#x4f60;&#x4e0b;&#x8f7d;&#x7684;&#x5bf9;&#x5e94;&#x7684;kernel&#x4ee3;&#x7801;&#x91cc;&#x9762;&#xff0c;&#x6bd4;&#x5982;&#x6211;&#x4f1a;&#x8bbe;&#x7f6e;&#x6210;
    </p>
    <p>
      export KERNELDIR=/home/usrname/usr/linux-4.4.40
    </p>
    <p>
      
    </p>
    <p>
      3.&#x5230;ldd3&#x4ee3;&#x7801;&#x7684;&#x67d0;&#x4e2a;&#x5b50;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x6267;&#x884c;make&#x547d;&#x4ee4;&#x5373;&#x53ef;
    </p>
  </body>
</html></richcontent>
<node CREATED="1574955547204" ID="ID_152227" MODIFIED="1574955706239">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ee1111">&#x5982;&#x4f55;&#x9605;&#x8bfb;&#x548c;&#x5f00;&#x53d1;LDD3&#x7684;&#x4ee3;&#x7801;&#xff1f;</font></b>
    </p>
    <p>
      
    </p>
    <ol>
      <li>
        &#x9996;&#x5148;&#x6253;&#x5f00;ldd3&#x7684;&#x67d0;&#x4e2a;&#x6587;&#x4ef6;
      </li>
      <li>
        &#x5728;vim&#x91cc;&#x9762;&#x6309;&#x4e0b;&#x5feb;&#x6377;&#x952e; ",dp", &#x8f93;&#x5165;&#x76ee;&#x6807;linux&#x6e90;&#x4ee3;&#x7801;&#x7684;&#x4f4d;&#x7f6e;&#xff0c;&#x7a0b;&#x5e8f;&#x4f1a;&#x81ea;&#x52a8;&#x5728;&#x5f53;&#x524d;&#x76ee;&#x5f55;&#x4e0b;&#x751f;&#x6210;&#x7d22;&#x5f15;
      </li>
      <li>
        F3&#x952e;&#x52a0;&#x8f7d;&#x7d22;&#x5f15;&#xff0c;&#x7136;&#x540e;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;cscope&#x6d4f;&#x89c8;linux&#x5185;&#x6838;&#xff0c;&#x4f7f;&#x7528;omni&#x6765;&#x5b8c;&#x6210;&#x7a0b;&#x5e8f;&#x8865;&#x5168;
      </li>
    </ol>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1457940670562" ID="ID_32425074" MODIFIED="1598863515518" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#c20c0c"><b>&#x7b2c;&#x5341;&#x56db;&#x7ae0;&#xff1a;&#x8bbe;&#x5907;&#x6a21;&#x578b;</b></font>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1457941273619" ID="ID_1019923209" MODIFIED="1598863533795">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Documents/sysfs.txt&#x9605;&#x8bfb;&#x8bb0;&#x5f55; </b>
    </p>
    <p>
      sysfs&#x662f;&#x4e00;&#x4e2a;&#x57fa;&#x4e8e;ram&#x7684;&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#xff0c;&#x5b83;&#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x79cd;
    </p>
    <p>
      &#x5bfc;&#x51fa;&#x5185;&#x6838;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x548c;&#x5c5e;&#x6027;&#x7684;&#x65b9;&#x6cd5;&#xff0e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1457941683450" ID="ID_1980133334" MODIFIED="1457942541455">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x76ee;&#x5f55;&#x521b;&#x5efa;
    </p>
    <p>
      &#x5bf9;&#x4e8e;&#x6bcf;&#x4e00;&#x4e2a;&#x6ce8;&#x518c;&#x5230;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;kobject, sys&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x76f8;&#x5e94;&#x5730;
    </p>
    <p>
      &#x4e5f;&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;&#x76ee;&#x5f55;&#xff0c;&#x8be5;&#x76ee;&#x5f55;&#x662f;kobject&#x7684;&#x7236;&#x5bf9;&#x8c61;&#x7684;&#x76ee;&#x5f55;&#x7684;&#x5b50;&#x76ee;&#x5f55;&#xff0e;
    </p>
    <p>
      sys&#x7684;&#x9876;&#x5c42;&#x76ee;&#x5f55;&#x5219;&#x4ee3;&#x8868;&#x7740;object&#x6240;&#x5c5e;&#x7684;&#x5404;&#x4e2a;&#x5b50;&#x7cfb;&#x7edf;&#xff0e;
    </p>
    <p>
      sysfs&#x5185;&#x90e8;&#x5b58;&#x50a8;&#x4e86;&#x4e00;&#x4e2a;&#x6307;&#x5411;kobject&#x7684;&#x6307;&#x9488;&#xff0c;&#x8be5;&#x6307;&#x9488;&#x5d4c;&#x5165;&#x5230;&#x4e86;
    </p>
    <p>
      &#x8ddf;&#x6587;&#x4ef6;&#x76ee;&#x5f55;&#x76f8;&#x5173;&#x7684;sysfs_dirent&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#xff0e;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457942855829" ID="ID_1580697406" MODIFIED="1588040310997">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x5c5e;&#x6027;
    </p>
    <p>
      kobject&#x7684;&#x5c5e;&#x6027;&#x662f;&#x901a;&#x8fc7;&#x5e38;&#x89c4;&#x6587;&#x4ef6;&#x7684;&#x65b9;&#x5f0f;&#x66b4;&#x9732;&#x5728;sysfs&#x5f53;&#x4e2d;&#x7684;
    </p>
    <p>
      attribute&#x5e94;&#x8be5;&#x662f;&#x6587;&#x672c;&#x6587;&#x4ef6;&#xff0c;&#x4e00;&#x822c;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x91cc;&#x9762;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#x503c;&#xff0c;
    </p>
    <p>
      &#x4f46;&#x4e5f;&#x6709;&#x4e00;&#x4e2a;type&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;value&#x6570;&#x7ec4;&#x7684;&#x60c5;&#x51b5;&#xff0e;
    </p>
    <p>
      struct attribute {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* name;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct module&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*owner;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;umode_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mode;
    </p>
    <p>
      };
    </p>
    <p>
      int sysfs_create_file(struct kobject * kobj, const struct attribute * attr);
    </p>
    <p>
      void sysfs_remove_file(struct kobject * kobj, const struct attribute * attr);
    </p>
  </body>
</html></richcontent>
<node CREATED="1457943632134" ID="ID_375798370" MODIFIED="1457943847252">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5bf9;&#x4e8e;&#x4e00;&#x4e2a;&#x88f8;&#x5c5e;&#x6027;&#x6765;&#x8bf4;&#xff0c;&#x6ca1;&#x6709;&#x4e00;&#x79cd;&#x65b9;&#x6cd5;&#x53ef;&#x4ee5;&#x8bfb;&#x53d6;&#x6216;&#x8005;&#x5199;&#x5165;
    </p>
    <p>
      &#x5c5e;&#x6027;&#x7684;&#x503c;&#xff0e;&#x5b50;&#x7cfb;&#x7edf;&#x88ab;&#x9f13;&#x52b1;&#x5efa;&#x7acb;&#x81ea;&#x5df1;&#x7684;&#x5c5e;&#x6027;&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x91cc;&#x9762;
    </p>
    <p>
      &#x5c01;&#x88c5;&#x81ea;&#x5df1;&#x7684;&#x51fd;&#x6570;&#x7528;&#x6765;&#x4e3a;&#x4e00;&#x4e2a;&#x7279;&#x5b9a;&#x7684;object&#x6dfb;&#x52a0;&#x6216;&#x8005;&#x79fb;&#x9664;
    </p>
    <p>
      &#x5c5e;&#x6027;&#xff0e;&#x6bd4;&#x5982;&#x9a71;&#x52a8;&#x6a21;&#x578b;&#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x4e2a;device_attribute
    </p>
    <p>
      struct device_attribute {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct attribute&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;attr;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*show)(struct device *dev, struct device_attribute *attr,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char *buf);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*store)(struct device *dev, struct device_attribute *attr,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const char *buf, size_t count);
    </p>
    <p>
      };
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1588042584131" ID="ID_1418233384" MODIFIED="1588043543660">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0000ff"><i><b>struct attribute_group {</b></i></font>
    </p>
    <p>
      const char&#160;&#160;&#160;&#160;&#160;&#160;*name;
    </p>
    <p>
      umode_t&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(*is_visible)(struct kobject *,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct attribute *, int);
    </p>
    <p>
      umode_t&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(*is_bin_visible)(struct kobject *,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct bin_attribute *, int);
    </p>
    <p>
      struct attribute&#160;&#160;&#160;&#160;**attrs;
    </p>
    <p>
      struct bin_attribute&#160;&#160;&#160;&#160;**bin_attrs;
    </p>
    <p>
      <b>}; </b>
    </p>
    <p>
      
    </p>
    <p>
      &#29992;&#20110;&#22768;&#26126;&#19968;&#20010;&#23646;&#24615;group
    </p>
    <p>
      
    </p>
    <p>
      static struct kobj_attribute slpi_boot_attribute =
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;__ATTR(boot, 0220, NULL, slpi_boot_store);
    </p>
    <p>
      static struct kobj_attribute slpi_ssr_attribute =
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;__ATTR(ssr, 0220, NULL, slpi_ssr_store);
    </p>
    <p>
      static struct attribute *attrs[] = {
    </p>
    <p>
      &amp;slpi_boot_attribute.attr,
    </p>
    <p>
      &amp;slpi_ssr_attribute.attr,
    </p>
    <p>
      NULL,
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<arrowlink DESTINATION="ID_1418233384" ENDARROW="Default" ENDINCLINATION="0;0;" ID="Arrow_ID_1021948013" STARTARROW="None" STARTINCLINATION="0;0;"/>
<linktarget COLOR="#b0b0b0" DESTINATION="ID_1418233384" ENDARROW="Default" ENDINCLINATION="0;0;" ID="Arrow_ID_1021948013" SOURCE="ID_1418233384" STARTARROW="None" STARTINCLINATION="0;0;"/>
</node>
</node>
<node CREATED="1457943937701" ID="ID_198196406" MODIFIED="1588040365240">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>#define DEVICE_ATTR(_name, _mode, _show, _store) \ </b>
    </p>
    <p>
      <b>struct device_attribute dev_attr_##_name = __ATTR(_name, _mode, _show, _store) </b>
    </p>
    <p>
      
    </p>
    <p>
      int device_create_file(struct device *, const struct device_attribute *);
    </p>
    <p>
      void device_remove_file(struct device *, const struct device_attribute *);
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1572248158021" ID="ID_86887759" MODIFIED="1572248264559">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff3300"><b>device_create_file&#x662f;&#x5bf9;sys_create_file&#x51fd;&#x6570;&#x7684;&#x5c01;&#x88c5;&#xff0c;&#x91cc;&#x9762;&#x589e;&#x52a0;&#x4e86;&#x6743;&#x9650;&#x68c0;&#x67e5;&#x7684;&#x8b66;&#x544a;&#x4fe1;&#x606f;</b></font>
    </p>
    <p>
      
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">int device_create_file(struct device *dev, </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct device_attribute *attr) </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">{ </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;int error = 0; </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;if (dev) { </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;WARN(((attr-&gt;attr.mode &amp; S_IWUGO) &amp;&amp; !attr-&gt;store), </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"Attribute %s: write permission without 'store'\n", </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;attr-&gt;attr.name); </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;WARN(((attr-&gt;attr.mode &amp; S_IRUGO) &amp;&amp; !attr-&gt;show), </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"Attribute %s: read permission without 'show'\n", </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;attr-&gt;attr.name); </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;error = sysfs_create_file(&amp;dev-&gt;kobj, &amp;attr-&gt;attr); </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;} </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">&#xa0;&#xa0;&#xa0;&#xa0;return error; </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">} </font></i>
    </p>
    <p>
      <i><font size="3" face="Segoe UI" color="#0000ff">EXPORT_SYMBOL_GPL(device_create_file);</font></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1458196495841" ID="ID_1100194257" MODIFIED="1458196700648">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.kobject&#x7684;attribute&#x5206;&#x4e3a;&#x666e;&#x901a;&#x7684;attribute&#x548c;&#x4e8c;&#x8fdb;&#x5236;&#x7684;attribute
    </p>
    <p>
      &#x666e;&#x901a;&#x7684;attribute&#x53ea;&#x80fd;&#x5411;&#x91cc;&#x9762;&#x5199;&#x5165;&#x5b57;&#x7b26;&#x4e32;
    </p>
    <p>
      &#x4e8c;&#x8fdb;&#x5236;&#x7684;attribute&#x7531;&#x4e8e;&#x5b9a;&#x4e49;&#x4e86;&#x81ea;&#x5df1;&#x7684;read/write&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x56e0;&#x800c;&#x53ef;&#x4ee5;&#x5199;&#x5165;&#x4efb;&#x4f55;&#x5f62;&#x5f0f;&#x7684;&#x6570;&#x636e;&#xff0e;
    </p>
    <p>
      &#xa0;struct attribute {
    </p>
    <p>
      &#xa0;const char *name;
    </p>
    <p>
      &#xa0;umode_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mode;
    </p>
    <p>
      &#xa0;#ifdef CONFIG_DEBUG_LOCK_ALLOC
    </p>
    <p>
      &#xa0;bool ignore_lockdep:1;
    </p>
    <p>
      &#xa0;struct lock_class_key&#xa0;&#xa0;&#xa0;*key;
    </p>
    <p>
      &#xa0;struct lock_class_key&#xa0;&#xa0;&#xa0;skey;
    </p>
    <p>
      &#xa0;#endif
    </p>
    <p>
      &#xa0;};
    </p>
    <p>
      &#xa0;/* include/linux/sysfs.h, line 100 */
    </p>
    <p>
      &#xa0;struct bin_attribute {
    </p>
    <p>
      &#xa0;struct attribute&#xa0;&#xa0;&#xa0;&#xa0;attr;
    </p>
    <p>
      &#xa0;size_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size;
    </p>
    <p>
      &#xa0;void *private;
    </p>
    <p>
      &#xa0;ssize_t (*read)(struct file *, struct kobject *, struct bin_attribute *,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char *, loff_t, size_t);
    </p>
    <p>
      &#xa0;ssize_t (*write)(struct file *,struct kobject *, struct bin_attribute *,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char *, loff_t, size_t);
    </p>
    <p>
      &#xa0;int (*mmap)(struct file *, struct kobject *, struct bin_attribute *attr,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct vm_area_struct *vma);
    </p>
    <p>
      &#xa0;};
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1457944429136" ID="ID_1017365841" MODIFIED="1458198351951">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x5b50;&#x7cfb;&#x7edf;&#x6307;&#x5b9a;&#x56de;&#x8c03;&#x51fd;&#x6570;
    </p>
    <p>
      &#x5f53;&#x4e00;&#x4e2a;&#x5b50;&#x7cfb;&#x7edf;&#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x4e2a;&#x65b0;&#x7684;&#x5c5e;&#x6027;&#x7c7b;&#x578b;&#xff0c;&#x5b83;&#x5fc5;&#x987b;&#x5b9e;&#x73b0;&#x4e00;&#x4e2a;sysfs&#x64cd;&#x4f5c;&#x96c6;&#x5408;
    </p>
    <p>
      &#x7528;&#x6765;&#x5c06;&#x4e0a;&#x5c42;&#x7684;read/write&#x64cd;&#x4f5c;&#x8f6c;&#x53d1;&#x7ed9;attribute&#x62e5;&#x6709;&#x8005;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      show&#x548c;store&#x65b9;&#x6cd5;&#x91cc;&#x9762;&#x53bb;&#xff0e;
    </p>
    <p>
      <i><b>attribute&#x6587;&#x4ef6;&#x7684;&#x64cd;&#x4f5c;&#xff0c;&#x4f1a;&#x7531;VFS&#x8f6c;&#x5230;sysfs_file_operations&#x5b9a;&#x4e49;&#x7684;&#x64cd;&#x4f5c;&#x91cc;&#x9762;&#xff0c; </b></i>
    </p>
    <p>
      <i><b>&#x7136;&#x540e;&#x8f6c;&#x5230;sysfs_ops&#x5f53;&#x4e2d;&#x8fdb;&#x884c;&#x5904;&#x7406;&#xff0e;</b></i>
    </p>
    <p>
      
    </p>
    <p>
      struct sysfs_ops {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*show)(struct kobject *, struct attribute *, char *);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*store)(struct kobject *, struct attribute *, const char *, size_t);
    </p>
    <p>
      };
    </p>
    <p>
      &#x5b50;&#x7cfb;&#x7edf;&#x91cc;&#x9762;&#x4f1a;&#x5b9a;&#x4e49;&#x4e00;&#x4e2a;<b>struct kobj_type&#xff0c;</b>&#x4f5c;&#x4e3a;&#x8be5;&#x5c5e;&#x6027;&#x7c7b;&#x578b;&#x7684;&#x63cf;&#x8ff0;&#x7b26;&#xff0c;
    </p>
    <p>
      sysfs_ops&#x6307;&#x9488;&#x5c31;&#x5b58;&#x653e;&#x5728;&#x8fd9;&#x91cc;&#xff0e;<b>&#x6bcf;&#x4e2a;kobject&#x5fc5;&#x987b;&#x6709;&#x4e00;&#x4e2a;ktype,&#x5426;&#x5219; </b>
    </p>
    <p>
      <b>&#x5185;&#x6838;&#x662f;&#x7981;&#x6b62;&#x5c06;&#x5176;&#x6ce8;&#x518c;&#x4e3a;&#x4e00;&#x4e2a;attribute&#x7684;</b>
    </p>
    <p>
      
    </p>
    <p>
      &#x793a;&#x4f8b;&#x4ee3;&#x7801;:
    </p>
    <p>
      #define to_dev(obj) container_of(obj, struct device, kobj)
    </p>
    <p>
      #define to_dev_attr(_attr) container_of(_attr, struct device_attribute, attr)
    </p>
    <p>
      
    </p>
    <p>
      static ssize_t dev_attr_show(struct kobject *kobj, struct attribute *attr,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char *buf)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct device_attribute *dev_attr = to_dev_attr(attr);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct device *dev = to_dev(kobj);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t ret = -EIO;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (dev_attr-&gt;show)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ret = dev_attr-&gt;show(dev, dev_attr, buf);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (ret &gt;= (ssize_t)PAGE_SIZE) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;print_symbol("dev_attr_show: %s returned bad count\n",
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(unsigned long)dev_attr-&gt;show);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return ret;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457946465042" ID="ID_66831925" MODIFIED="1457947701273">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>4.&#x9876;&#x5c42;&#x76ee;&#x5f55;&#x5e03;&#x5c40; </b>
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457947707906" ID="ID_60829519" MODIFIED="1588041273391">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>5.&#x5f53;&#x524d;&#x5b58;&#x5728;&#x4e8e;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;&#x63a5;&#x53e3;&#x5c42;</b></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1457947746618" ID="ID_237724464" MODIFIED="1457947824696">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.devices
    </p>
    <p>
      struct device_attribute {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct attribute&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;attr;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*show)(struct device *dev, struct device_attribute *attr,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;char *buf);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*store)(struct device *dev, struct device_attribute *attr,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const char *buf, size_t count);
    </p>
    <p>
      };
    </p>
    <p>
      DEVICE_ATTR(_name, _mode, _show, _store);
    </p>
    <p>
      int device_create_file(struct device *dev, const struct device_attribute * attr);
    </p>
    <p>
      void device_remove_file(struct device *dev, const struct device_attribute * attr);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457947840356" ID="ID_739810593" MODIFIED="1457947916043">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.bus driver
    </p>
    <p>
      struct bus_attribute {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct attribute&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;attr;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*show)(struct bus_type *, char * buf);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*store)(struct bus_type *, const char * buf, size_t count);
    </p>
    <p>
      };
    </p>
    <p>
      BUS_ATTR(_name, _mode, _show, _store)
    </p>
    <p>
      int bus_create_file(struct bus_type *, struct bus_attribute *);
    </p>
    <p>
      void bus_remove_file(struct bus_type *, struct bus_attribute *);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457947926100" ID="ID_1659328828" MODIFIED="1457948015818">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.device driver
    </p>
    <p>
      struct driver_attribute {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct attribute&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;attr;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*show)(struct device_driver *, char * buf);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ssize_t (*store)(struct device_driver *, const char * buf,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size_t count);
    </p>
    <p>
      };
    </p>
    <p>
      DRIVER_ATTR(_name, _mode, _show, _store)
    </p>
    <p>
      int driver_create_file(struct device_driver *, const struct driver_attribute *);
    </p>
    <p>
      void driver_remove_file(struct device_driver *, const struct driver_attribute *);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1457950439871" ID="ID_1645872669" MODIFIED="1598863530577">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.kobject,ksets&#x548c;subsystem
    </p>
  </body>
</html></richcontent>
<node CREATED="1457950491536" ID="ID_634413747" MODIFIED="1457950827491">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>kobject </b>
    </p>
    <p>
      kobject&#x662f;&#x4e00;&#x4e2a;&#x6700;&#x57fa;&#x672c;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff0c;&#x7528;&#x4e8e;&#x5c06;&#x8bbe;&#x5907;&#x6a21;&#x578b;&#x7ed1;&#x5b9a;&#x5230;&#x4e00;&#x8d77;
    </p>
    <p>
      <i>&#x5bf9;&#x8c61;&#x7684;&#x5f15;&#x7528;&#x8ba1;&#x6570; </i>
    </p>
    <p>
      <i>sys&#x4e2d;&#x5bf9;&#x8c61;&#x5728;kernel&#x91cc;&#x9762;&#x7684;&#x5bf9;&#x5e94; </i>
    </p>
    <p>
      <i>&#x5404;&#x79cd;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x7684;&#x80f6;&#x9ecf;&#x5242; </i>
    </p>
    <p>
      <i>kobject&#x5b50;&#x7cfb;&#x7edf;&#x5904;&#x7406;&#x786c;&#x4ef6;&#x63d2;&#x62d4;&#x7684;&#x4e8b;&#x4ef6;&#x901a;&#x77e5;</i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457950954704" ID="ID_1779660090" MODIFIED="1598863546298">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Kobjects&#x57fa;&#x7840;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1457951095304" ID="ID_1407602802" MODIFIED="1457951436271">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5d4c;&#x5165;&#x5f0f;&#x7684;kobject</b>
    </p>
    <p>
      kobject&#x5f80;&#x5f80;&#x662f;&#x88ab;&#x7528;&#x6765;&#x63a7;&#x5236;&#x5bf9;&#x66f4;&#x5927;&#x7684;&#xff0c;&#x9886;&#x57df;&#x76f8;&#x5173;&#x7684;&#x7ed3;&#x6784;&#x4f53;&#x7684;&#x8bbf;&#x95ee;
    </p>
    <p>
      &#x5b83;&#x53ea;&#x662f;&#x4e3a;&#x4e86;&#x5c06;&#x66f4;&#x9ad8;&#x5c42;&#x7ea7;&#x7684;&#x5bf9;&#x8c61;&#x7ed1;&#x5b9a;&#x5230;&#x8bbe;&#x5907;&#x6a21;&#x578b;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x5e94;&#x5f53;&#x4f7f;&#x7528;container_of&#x5b8f;&#x5b9a;&#x4e49;&#x6765;&#x5c06;&#x4e0a;&#x5c42;&#x8bbe;&#x5907;&#x7684;&#x6307;&#x9488;&#x53d6;&#x51fa;&#x6765;
    </p>
    <p>
      struct cdev *device = container_of(kp, struct cdev, kobj);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457951489158" ID="ID_1380581825" MODIFIED="1458192914344">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font size="3"><b>&#xa0;struct kobject { </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;3:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const char *name; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;4:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct list_head&#xa0;&#xa0;&#xa0;&#xa0;entry; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;5:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct kobject&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*parent; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;6:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct kset&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*kset; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;7:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct kobj_type&#xa0;&#xa0;&#xa0;&#xa0;*ktype; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;8:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct sysfs_dirent *sd; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;9:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct kref&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;kref; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;10:&#xa0;&#xa0;&#xa0;&#xa0;unsigned int state_initialized:1; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;11:&#xa0;&#xa0;&#xa0;&#xa0;unsigned int state_in_sysfs:1; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;12:&#xa0;&#xa0;&#xa0;&#xa0;unsigned int state_add_uevent_sent:1; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;13:&#xa0;&#xa0;&#xa0;&#xa0;unsigned int state_remove_uevent_sent:1; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;14:&#xa0;&#xa0;&#xa0;&#xa0;unsigned int uevent_suppress:1; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;15: };</b></font></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1520265245787" ID="ID_1829764744" MODIFIED="1520265288733">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ee1111"><i>kobj&#x7684;&#x5206;&#x914d;&#x548c;&#x91ca;&#x653e;</i></font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1520265689462" ID="ID_62943729" MODIFIED="1598863550439">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x901a;&#x8fc7;kmalloc&#x52a8;&#x6001;&#x5206;&#x914d;&#xff0c;&#x5e76;&#x5728;&#x521d;&#x59cb;&#x5316;&#x4e4b;&#x540e;&#x6dfb;&#x52a0;&#x5230;&#x5185;&#x6838;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
<node CREATED="1520347347465" ID="ID_1844931411" MODIFIED="1520347447565">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>void kobject_init(struct kobject *kobj, struct kobj_type *ktype)</b>
    </p>
    <p>
      <font color="#b60c0c"><b><i>&#x521d;&#x59cb;&#x5316;struct kobject&#x6307;&#x9488;</i></b></font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1520348324813" ID="ID_971544683" MODIFIED="1520348452104">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>int kobject_add(struct kobject *kobj, struct kobject *parent, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const char *fmt, ...)</b>
    </p>
    <p>
      <font color="#ca1010">&#x5c06;&#x521d;&#x59cb;&#x5316;&#x5b8c;&#x6210;&#x7684;kobject&#x6dfb;&#x52a0;&#x5230;&#x5185;&#x6838;&#x5f53;&#x4e2d;</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1520348497430" ID="ID_312647447" MODIFIED="1520348566993">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>int kobject_init_and_add(struct kobject *kobj, struct kobj_type *ktype, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct kobject *parent, const char *fmt, ...)</b>
    </p>
    <p>
      <b><i><font color="#cd0909">&#x4e0a;&#x9762;&#x4e24;&#x4e2a;&#x63a5;&#x53e3;&#x7684;&#x96c6;&#x5408;</font></i></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1458187049204" ID="ID_1192180758" MODIFIED="1598863553352">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Ksets</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1458187064948" ID="ID_227574197" MODIFIED="1458187083187">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#xa0;2: struct kset { </b></i>
    </p>
    <p>
      <i><b>&#xa0;3:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct list_head list; </b></i>
    </p>
    <p>
      <i><b>&#xa0;4:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;spinlock_t list_lock; </b></i>
    </p>
    <p>
      <i><b>&#xa0;5:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct kobject kobj; </b></i>
    </p>
    <p>
      <i><b>&#xa0;6:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct kset_uevent_ops *uevent_ops; </b></i>
    </p>
    <p>
      <i><b>&#xa0;7: };</b></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1458187102241" ID="ID_190739162" MODIFIED="1598863556099">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>Ktype</b></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1458187116993" ID="ID_299876167" MODIFIED="1458187148800">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font size="3"><b>struct kobj_type { </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;3:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void (*release)(struct kobject *kobj); </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;4:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct sysfs_ops *sysfs_ops; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;5:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct attribute **default_attrs; </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;6:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct kobj_ns_type_operations *(*child_ns_type)(struct kobject *kobj); </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;7:&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const void *(*namespace)(struct kobject *kobj);= </b></font></i>
    </p>
    <p>
      <i><font size="3"><b>&#xa0;8: };</b></font></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1460273055228" FOLDED="true" ID="ID_1354610669" MODIFIED="1567327269704">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      subsystem&#x7684;&#x6982;&#x5ff5;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1460273088467" ID="ID_1677947546" MODIFIED="1460277531373">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>subsystem&#x53ef;&#x4ee5;&#x89c6;&#x4e3a;&#x662f;kset&#x7684;&#x96c6;&#x5408;</b>
    </p>
    <p>
      <i><font size="3">linux2.6.30.4&#x7248;&#x672c;&#x4e2d;bus_register()&#x4e2d;&#x7684;struct bus_type_private *priv&#x7684;&#x673a;&#x6784;&#x4f5c;&#x4e3a;bus&#x7684;susbsystem </font></i>
    </p>
    <p>
      <i><font size="3">linux3.0&#x7248;&#x672c;&#x540e;&#x88ab;struct subsys_private *priv; &#x53d6;&#x4ee3; </font></i>
    </p>
    <p>
      <i><font size="3">struct bus_type_private { </font></i>
    </p>
    <p>
      <i><font size="3">struct kset subsys; </font></i>
    </p>
    <p>
      <i><font size="3">struct kset *drivers_kset; </font></i>
    </p>
    <p>
      <i><font size="3">struct kset *devices_kset; </font></i>
    </p>
    <p>
      <i><font size="3">struct klist klist_devices; </font></i>
    </p>
    <p>
      <i><font size="3">struct klist klist_drivers; </font></i>
    </p>
    <p>
      <i><font size="3">struct blocking_notifier_head bus_notifier; </font></i>
    </p>
    <p>
      <i><font size="3">unsigned int drivers_autoprobe:1; </font></i>
    </p>
    <p>
      <i><font size="3">struct bus_type *bus; </font></i>
    </p>
    <p>
      <i><font size="3">};</font></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1458184304797" ID="ID_1323385442" MODIFIED="1589520308181">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Bus,Class,Device,DeviceDriver&#x56db;&#x7c7b;&#x6982;&#x5ff5;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1458192622483" ID="ID_1116864092" MODIFIED="1458192638882">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i>&#x4ece;&#x9762;&#x5411;&#x5bf9;&#x8c61;&#x7684;&#x89d2;&#x5ea6;&#x6765;&#x770b;&#xff1a; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;- struct kobj&#xff08;&#x53ca;&#x5176;&#x76f8;&#x5173;&#x7ed3;&#x6784;&#x5982;kset, ktype&#x7b49;&#xff09;&#x5c5e;&#x4e8e;&#x6700;&#x62bd;&#x8c61;&#x7684;&#x57fa;&#x7c7b;&#xff0c;&#x4ee3;&#x7801;&#x6700;&#x7b80;&#x6d01;&#xff0c;&#x6700;&#x4e0d;&#x5177;&#x4f53;&#xff1b; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;- struct device&#xff08;&#x53ca;&#x5176;&#x76f8;&#x5173;&#x7ed3;&#x6784;&#x5982;device_driver&#xff0c;device_type&#x7b49;&#xff09;&#x662f;&#x5bf9;kobj&#x7684;&#x5c01;&#x88c5;&#xff0c;&#x662f;&#x7b2c;&#x4e00;&#x5c42;&#x6d3e;&#x751f;&#x7c7b;&#xff1b; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;- &#x518d;&#x4e0a;&#x5c42;&#x7684;&#x7ed3;&#x6784;&#xff08;&#x5982;platform_device&#x7b49;&#xff09;&#xff0c;&#x662f;&#x5728;struct device&#x7684;&#x57fa;&#x7840;&#x4e0a;&#x518d;&#x5c01;&#x88c5;&#x4e00;&#x6b21;&#xff0c;&#x662f;&#x7b2c;&#x4e8c;&#x5c42;&#x6d3e;&#x751f;&#x7c7b;&#x3002; </i>
    </p>
    <p>
      
    </p>
    <p>
      <i>&#x56e0;&#x6b64;&#xff0c;&#x4f8b;&#x5982;&#x6211;&#x4eec;&#x521b;&#x5efa;&#x4e86;&#x4e00;&#x4e2a;struct platform_device&#x7684;&#x5b9e;&#x4f8b;&#xff0c;&#x4f7f;&#x7528;&#x5b8c;&#x6bd5;&#x540e;&#x8981;&#x91ca;&#x653e;&#x5b83;&#x3002;&#x90a3;&#x4e48;&#x8fd9;&#x4e2a;&#x8fc7;&#x7a0b;&#x6309;&#x9053;&#x7406;&#x5e94;&#x8be5;&#x662f;&#xff1a; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;- &#x7cfb;&#x7edf;&#x5185;&#x90e8;&#x5148;&#x8c03;&#x7528;platform_device&#x7684;remove&#x51fd;&#x6570;&#xff0c;&#x5b83;&#x53ea;&#x5904;&#x7406;&#x81ea;&#x5df1;&#x5c42;&#x7279;&#x6709;&#x7684;&#x53d8;&#x91cf;&#xff1b; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;- &#x5b8c;&#x6bd5;&#x540e;&#xff0c;&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x7b2c;&#x4e00;&#x5c42;&#x6d3e;&#x751f;&#x7c7b;struct device&#x7684;release&#x51fd;&#x6570;&#xff0c;&#x5904;&#x7406;&#x4e86;&#x81ea;&#x5df1;&#x8fd9;&#x4e00;&#x5c42;&#x7684;&#x7279;&#x6709;&#x53d8;&#x91cf;&#xff1b; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;- &#x6700;&#x540e;&#xff0c;&#x8c03;&#x7528;&#x57fa;&#x7c7b;kobject&#x7684;release&#x51fd;&#x6570;&#xff0c;&#x5c06;&#x6574;&#x4e2a;&#x7a7a;&#x95f4;&#x91ca;&#x653e;&#x6389;&#x3002; </i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1458209777467" ID="ID_430165846" MODIFIED="1458209859009">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x8bbe;&#x5907;driver probe&#x7684;&#x65f6;&#x673a; </b></i>
    </p>
    <p>
      
    </p>
    <p>
      <i><b>&#xa0;&#xa0;&#xa0;&#xa0;1.&#x5c06;struct device&#x7c7b;&#x578b;&#x7684;&#x53d8;&#x91cf;&#x6ce8;&#x518c;&#x5230;&#x5185;&#x6838;&#x4e2d;&#x65f6;&#x81ea;&#x52a8;&#x89e6;&#x53d1;&#xff08;device_register&#xff0c;device_add&#xff0c;device_create_vargs&#xff0c;device_create&#xff09; </b></i>
    </p>
    <p>
      <i><b>&#xa0;&#xa0;&#xa0;&#xa0;2.&#x5c06;struct device_driver&#x7c7b;&#x578b;&#x7684;&#x53d8;&#x91cf;&#x6ce8;&#x518c;&#x5230;&#x5185;&#x6838;&#x4e2d;&#x65f6;&#x81ea;&#x52a8;&#x89e6;&#x53d1;&#xff08;driver_register&#xff09; </b></i>
    </p>
    <p>
      <i><b>&#xa0;&#xa0;&#xa0; 3.&#x624b;&#x52a8;&#x67e5;&#x627e;&#x540c;&#x4e00;bus&#x4e0b;&#x7684;&#x6240;&#x6709;device_driver&#xff0c;&#x5982;&#x679c;&#x6709;&#x548c;&#x6307;&#x5b9a;device&#x540c;&#x540d;&#x7684;driver&#xff0c;&#x6267;&#x884c;probe&#x64cd;&#x4f5c;&#xff08;device_attach&#xff09; </b></i>
    </p>
    <p>
      <i><b>&#xa0;&#xa0;&#xa0; 4.&#x624b;&#x52a8;&#x67e5;&#x627e;&#x540c;&#x4e00;bus&#x4e0b;&#x7684;&#x6240;&#x6709;device&#xff0c;&#x5982;&#x679c;&#x6709;&#x548c;&#x6307;&#x5b9a;driver&#x540c;&#x540d;&#x7684;device&#xff0c;&#x6267;&#x884c;probe&#x64cd;&#x4f5c;&#xff08;driver_attach&#xff09; </b></i>
    </p>
    <p>
      <i><b>&#xa0;&#xa0;&#xa0; 5.&#x81ea;&#x884c;&#x8c03;&#x7528;driver&#x7684;probe&#x63a5;&#x53e3;&#xff0c;&#x5e76;&#x5728;&#x8be5;&#x63a5;&#x53e3;&#x4e2d;&#x5c06;&#x8be5;driver&#x7ed1;&#x5b9a;&#x5230;&#x67d0;&#x4e2a;device&#x7ed3;&#x6784;&#x4e2d;----&#x5373;&#x8bbe;&#x7f6e;dev-&gt;driver&#xff08;device_bind_driver&#xff09; </b></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1458285267059" ID="ID_693296357" MODIFIED="1458285777019">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Class</b>
    </p>
    <p>
      class&#x5b58;&#x5728;&#x7684;&#x76ee;&#x7684;&#x662f;&#x4e3a;&#x4e86;&#x5c06;&#x4e00;&#x4e9b;&#x76f8;&#x4f3c;&#x7684;device&#x7684;&#x76f8;&#x4f3c;&#x63a5;&#x53e3;&#x62bd;&#x8c61;&#x51fa;&#x6765;
    </p>
    <p>
      &#x4f9b;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x6765;&#x4f7f;&#x7528;&#xff0c;&#x8fd9;&#x6837;&#x5c31;&#x907f;&#x514d;&#x4e86;&#x5404;&#x4e2a;&#x8bbe;&#x5907;&#x7684;&#x9a71;&#x52a8;&#x5c06;&#x8fd9;&#x4e9b;&#x76f8;&#x4f3c;&#x7684;&#x63a5;&#x53e3;
    </p>
    <p>
      &#x90fd;&#x5b9e;&#x73b0;&#x4e00;&#x904d;&#xff0c;&#x907f;&#x514d;&#x4e86;&#x4ee3;&#x7801;&#x7684;&#x5197;&#x4f59;&#xff0e;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1458194488422" ID="ID_600559022" MODIFIED="1458194866652">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Uevent&#x7684;&#x6982;&#x5ff5;&#x548c;&#x4f5c;&#x7528; </b>
    </p>
    <p>
      uevent&#x662f;kobject&#x7684;&#x4e00;&#x90e8;&#x5206;&#xff0c;&#x7528;&#x4e8e;&#x5728;&#x7cfb;&#x7edf;kobject
    </p>
    <p>
      &#x53d1;&#x751f;&#x53d8;&#x5316;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x901a;&#x77e5;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7a0b;&#x5e8f;&#xff0c;&#x5e38;&#x5e38;&#x7528;&#x5728;
    </p>
    <p>
      &#x70ed;&#x63d2;&#x62d4;&#x8bbe;&#x5907;&#x5f53;&#x4e2d;&#xff0e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1588642304522" ID="ID_1033821255" MODIFIED="1588642337947">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x6977;&#x4f53;" size="4"><b>&#29992;&#25143;&#23618;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1588642353075" ID="ID_533621154" MODIFIED="1588642392435">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#29992;&#25143;&#23618;&#25171;&#21360;uevent&#20107;&#20214;
    </p>
    <p>
      
    </p>
    <p>
      udevadm&#160;&#160;monitor --env
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1588647189010" ID="ID_326418180" MODIFIED="1588647227582">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman"><i>static const char *netlink_message_parse(const char *buffer, size_t len, const char *key)</i></font>
    </p>
    <p>
      {
    </p>
    <p>
      &#160;&#160;&#160;&#160;const char *end = buffer + len;
    </p>
    <p>
      &#160;&#160;&#160;&#160;size_t keylen = strlen(key);
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;while (buffer &lt; end &amp;&amp; *buffer) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (strncmp(buffer, key, keylen) == 0 &amp;&amp; buffer[keylen] == '=')
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return buffer + keylen + 1;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;buffer += strlen(buffer) + 1;
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;return NULL;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1588642314028" ID="ID_828423868" MODIFIED="1588642349926">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="&#x6977;&#x4f53;"><b>&#20869;&#26680;&#23618;</b></font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1458286112588" ID="ID_297001465" MODIFIED="1589520368850">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Platform&#x8bbe;&#x5907;
    </p>
    <p>
      Platform&#x8bbe;&#x5907;&#x5305;&#x62ec;&#xff1a;&#x57fa;&#x4e8e;&#x7aef;&#x53e3;&#x7684;&#x8bbe;&#x5907;&#xff08;&#x5df2;&#x4e0d;&#x63a8;&#x8350;&#x4f7f;&#x7528;&#xff0c;&#x4fdd;&#x7559;&#x4e0b;&#x6765;&#x53ea;&#x4e3a;&#x517c;&#x5bb9;&#x65e7;&#x8bbe;&#x5907;&#xff0c;legacy&#xff09;&#xff1b;
    </p>
    <p>
      &#x8fde;&#x63a5;&#x7269;&#x7406;&#x603b;&#x7ebf;&#x7684;&#x6865;&#x8bbe;&#x5907;&#xff1b;&#x96c6;&#x6210;&#x5728;SOC&#x5e73;&#x53f0;&#x4e0a;&#x9762;&#x7684;&#x63a7;&#x5236;&#x5668;&#xff1b;&#x8fde;&#x63a5;&#x5728;&#x5176;&#x5b83;bus&#x4e0a;&#x7684;&#x8bbe;&#x5907;&#xff08;&#x5f88;&#x5c11;&#x89c1;&#xff09;&#x3002;&#x7b49;&#x7b49;&#x3002;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x8bbe;&#x5907;&#x6709;&#x4e00;&#x4e2a;&#x57fa;&#x672c;&#x7684;&#x7279;&#x5f81;&#xff1a;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;CPU bus&#x76f4;&#x63a5;&#x5bfb;&#x5740;&#xff08;&#x4f8b;&#x5982;&#x5728;&#x5d4c;&#x5165;&#x5f0f;&#x7cfb;&#x7edf;&#x5e38;&#x89c1;&#x7684;&#x201c;&#x5bc4;&#x5b58;&#x5668;&#x201d;&#xff09;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1504766931841" ID="ID_736192438" MODIFIED="1589520372114">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>Platform &#x9a71;&#x52a8;&#x548c;&#x8bbe;&#x5907;&#x7684;&#x7ed1;&#x5b9a;&#x8fc7;&#x7a0b;&#x5206;&#x6790;</i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1504766961778" ID="ID_229695315" MODIFIED="1504767010979">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x6700;&#x7ec8;&#x8fdb;&#x884c;&#x5339;&#x914d;&#x7684;&#x51fd;&#x6570;
    </p>
    <p>
      int platform_match(struct device *dev, struct device_driver *drv)
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1589520464545" ID="ID_1187891696" MODIFIED="1589520516268">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300cc" face="&#x6977;&#x4f53;" size="4"><b>&#39537;&#21160;&#20195;&#30721;&#27880;&#20876;&#36827;&#20869;&#26680;&#20043;&#21518;Probe&#30340;&#36807;&#31243;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1589520853474" ID="ID_128069056" MODIFIED="1589520905854">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="&#x96b6;&#x4e66;"><i>int driver_attach(struct device_driver *drv) </i></font>
    </p>
    <p>
      <font size="4" face="&#x96b6;&#x4e66;"><i>{ </i></font>
    </p>
    <p>
      <font size="4" face="&#x96b6;&#x4e66;"><i>&#160;&#160;&#160;&#160;return bus_for_each_dev(drv-&gt;bus, NULL, drv, __driver_attach); </i></font>
    </p>
    <p>
      <font size="4" face="&#x96b6;&#x4e66;"><i>} </i></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1589520942734" ID="ID_12204959" MODIFIED="1589520947691" TEXT="driver_match_device(drv, dev)"/>
<node CREATED="1589520958444" ID="ID_1320003734" MODIFIED="1589520960901" TEXT="driver_probe_device(drv, dev);">
<node CREATED="1589520990684" ID="ID_1828187806" MODIFIED="1589520992869" TEXT="really_probe(dev, drv)">
<node CREATED="1589521026480" ID="ID_870695363" MODIFIED="1589521369896">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22312;really_probe&#37324;&#38754;&#35843;&#29992;&#20102;&#20989;&#25968;
    </p>
    <p>
      <b>pinctrl_bind_pins(dev)</b>
    </p>
    <p>
      &#35813;&#20989;&#25968;&#20250;&#35774;&#32622;&#35774;&#22791;&#23545;&#24212;&#30340;pinctrl&#29366;&#24577;&#65292;&#36873;&#25321;default&#29366;&#24577;
    </p>
    <p>
      
    </p>
    <p>
      dev-&gt;pins-&gt;default_state = pinctrl_lookup_state(dev-&gt;pins-&gt;p,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PINCTRL_STATE_DEFAULT)
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ff0000" DESTINATION="ID_650426908" ENDARROW="Default" ENDINCLINATION="514;0;" ID="Arrow_ID_1319629169" STARTARROW="None" STARTINCLINATION="-9;77;"/>
</node>
</node>
</node>
</node>
</node>
</node>
<node COLOR="#cc0033" CREATED="1458395797887" FOLDED="true" ID="ID_897771791" MODIFIED="1589521626864" POSITION="right" TEXT="&#x7279;&#x522b;&#x7ae0;&#x8282;:GPIO&#x5b50;&#x7cfb;&#x7edf;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1458440850768" FOLDED="true" ID="ID_1906210875" MODIFIED="1560959515790">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>SOC&#x4e2d;GPIO&#x5b50;&#x7cfb;&#x7edf;&#x91cc;&#x9762;&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x5206;&#x7c7b;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1458440899717" ID="ID_870382772" MODIFIED="1487916914464">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i>1.</i><b>&#x7528;&#x4e8e;&#x8bbe;&#x7f6e;&#x786c;&#x4ef6;I/O&#x53e3;&#x7684;&#x529f;&#x80fd;&#x914d;&#x7f6e;&#xff0c;&#x6211;&#x4eec;&#x79f0;&#x8be5;&#xa0;<font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">HW block&#x4e3a;pin controller</font>&#xa0; </b>
    </p>
    <p>
      a. &#x8bbe;&#x7f6e;&#x5f15;&#x811a;&#x529f;&#x80fd;&#xff0c; &#x662f;&#x666e;&#x901a;&#x7684;I/O&#x53e3;&#x8fd8;&#x662f;&#x7279;&#x6b8a;&#x529f;&#x80fd;
    </p>
    <p>
      b. &#x5f15;&#x811a;&#x7279;&#x6027;&#x7684;&#x8bbe;&#x7f6e;&#xff0c; pull up/pull down&#x7b49;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="12"/>
</node>
<node CREATED="1458440906797" ID="ID_1374039587" MODIFIED="1458441720910">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.&#x6709;&#x7684;&#x5f15;&#x811a;&#x88ab;&#x914d;&#x7f6e;&#x6210;spi&#x529f;&#x80fd;&#xff0c;&#x90a3;&#x4e48; </b>
    </p>
    <p>
      <b>&#x7531;spi controller&#x8fdb;&#x884c;&#x63a7;&#x5236;&#xff0c; </b>
    </p>
    <p>
      <b>&#x5982;&#x679c;&#x88ab;&#x914d;&#x7f6e;&#x6210;gpio&#x529f;&#x80fd;&#xff0c;&#x90a3;&#x4e48;&#x7531; </b>
    </p>
    <p>
      <b>gpio controller&#x8fdb;&#x884c;&#x63a7;&#x5236;</b>&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1458440912894" ID="ID_59399985" MODIFIED="1459758009418">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3<b>.&#x914d;&#x7f6e;&#x6210;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x529f;&#x80fd; </b>
    </p>
    <p>
      <i><b>&#x901a;&#x8fc7;&#x8bbf;&#x95ee;GPIO&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668; </b></i>
    </p>
    <p>
      <i><b>&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x53ef;&#x4ee5;&#x5bf9;GPIO&#x53e3;&#x7684;&#x529f;&#x80fd;&#x8fdb;&#x884c; </b></i>
    </p>
    <p>
      <i><b>&#x914d;&#x7f6e;</b></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1458444006543" FOLDED="true" ID="ID_117120831" MODIFIED="1589521625973" TEXT="GPIO&#x5b50;&#x7cfb;&#x7edf;&#x7684;&#x8f6f;&#x4ef6;&#x5206;&#x7c7b;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1458444050579" FOLDED="true" ID="ID_345597075" MODIFIED="1589521625005">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.pin control subsystem
    </p>
    <p>
      <b>&#x9a71;&#x52a8;pin control&#x786c;&#x4ef6;&#x7684;&#x8f6f;&#x4ef6;</b>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1458446261967" FOLDED="true" ID="ID_1518217915" MODIFIED="1589521571037" TEXT="pin control&#x5b50;&#x7cfb;&#x7edf;&#x7684;&#x8f6f;&#x4ef6;&#x67b6;&#x6784;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1458446288669" ID="ID_1963969073" MODIFIED="1458446695190">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Driver0&#xa0;&#xa0;&#xa0;Driver1&#xa0;&#xa0;&#xa0;Driver2......Drivern
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Pin Control Core-----&gt; HW Abstract Layer
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Pin Controller Driver Layer
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;HW&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;HW&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;HW
    </p>
    <p>
      <b>&#x5e95;&#x5c42;&#x7684;&#x5404;&#x4e2a;pin controller driver&#x4f1a;&#x5411;pin control core&#x6ce8;&#x518c; </b>
    </p>
    <p>
      <b>&#x5404;&#x4e2a;&#x8bbe;&#x5907;&#xff0c;&#x901a;&#x8fc7;pinctrl_register&#x5e95;&#x5c42;&#x63a5;&#x53e3;&#x8fdb;&#x884c;&#x6ce8;&#x518c;&#x3002;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1458482662613" ID="ID_1421130126" MODIFIED="1458483689380">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Arial, Helvetica, sans-serif" size="4" color="rgb(50, 50, 50)">linux/drivers/pinctrl&#x662f;pinctrl&#x5b50;&#x7cfb;&#x7edf;&#x7684;&#x6838;&#x5fc3;&#x4ee3;&#x7801;&#x6240;&#x5728;&#x5730; </font>
    </p>
    <p>
      <font face="Arial, Helvetica, sans-serif" size="4" color="rgb(50, 50, 50)">1.core.c core.h&#xa0;&#xa0;&#x6838;&#x5fc3;&#x9a71;&#x52a8;&#x4ee3;&#x7801; </font>
    </p>
    <p>
      <font size="4">2.</font><font face="Arial, Helvetica, sans-serif" size="4" color="rgb(50, 50, 50)">pinctrl-utils.c pinctrl-utils.h &#x6838;&#x5fc3;&#x9a71;&#x52a8;&#x4ee3;&#x7801;&#x7684;utility&#x63a5;&#x53e3; </font>
    </p>
    <p>
      <font face="Arial, Helvetica, sans-serif" size="4" color="rgb(50, 50, 50)">3.pinmux.c pinmux.h&#xa0;&#xa0;&#x6838;&#x5fc3;&#x4ee3;&#x7801;&#x90e8;&#x5206;&#x7684;pin mux </font>
    </p>
    <p>
      <font face="Arial, Helvetica, sans-serif" size="4" color="rgb(50, 50, 50)">4.pinconf.c pinconf.h&#xa0;&#xa0;&#xa0;&#x6838;&#x5fc3;&#x4ee3;&#x7801;&#x90e8;&#x5206;&#x7684;config&#x90e8;&#x5206; </font>
    </p>
    <p>
      <font face="Arial, Helvetica, sans-serif" size="4" color="rgb(50, 50, 50)">5.devicetree.c devicetree.h&#xa0;&#xa0;&#xa0;&#x6838;&#x5fc3;&#x4ee3;&#x7801;&#x7684;device tree&#x90e8;&#x5206; </font>
    </p>
    <p>
      <font face="Arial, Helvetica, sans-serif" size="4" color="rgb(50, 50, 50)">6.pinctrl-xxxx.c&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x5404;&#x79cd;pin controller&#x7684;low level driver</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
</node>
<node CREATED="1458484071049" ID="ID_1403963975" MODIFIED="1459760502620">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">&#x8ddf;&#x5176;&#x4ed6;&#x5185;&#x6838;&#x6a21;&#x5757;&#x63a5;&#x53e3;&#x5934;&#x6587;&#x4ef6; </font></b>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">linux/include/linux/pinctrl&#x5916;&#x90e8;&#x63a5;&#x53e3;&#x5934;&#x6587;&#x4ef6; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">consumer.h&#xa0;&#xa0;&#xa0;&#x4f9b;&#x5176;&#x4ed6;driver&#x4f7f;&#x7528;&#x7684;pinctrl subsystem&#x7684;&#x63a5;&#x53e3;&#xff0c; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x8bbe;&#x7f6e;&#x5f15;&#x811a;&#x590d;&#x7528;&#x529f;&#x80fd;&#xff0c;&#x8bbe;&#x7f6e;&#x5f15;&#x811a;&#x7535;&#x5668;&#x7279;&#x6027; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">devinfo.h&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x7ed9;linux&#x7684;&#x9a71;&#x52a8;&#x6a21;&#x578b;&#x4f7f;&#x7528;&#x7684;&#x63a5;&#x53e3; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct device&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#x6709;&#x4e00;&#x4e2a;&#x53eb;&#x505a; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct dev_pin_info *pins&#x7684;&#x6210;&#x5458;&#xff0c;&#x7528;&#x4e8e;&#x8bbe;&#x5b9a; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x8be5;&#x8bbe;&#x5907;&#x7684;&#x5f15;&#x811a;&#x7684;&#x521d;&#x59cb;&#x72b6;&#x6001;</font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">machine.h&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x8ddf;machine&#x6a21;&#x5757;&#x7684;&#x63a5;&#x53e3;</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1458485095825" ID="ID_139933814" MODIFIED="1459760541482">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">&#x6838;&#x5fc3;&#x9a71;&#x52a8;&#x63d0;&#x4f9b;&#x7ed9;&#x5e95;&#x5c42;controller&#x7684;&#x63a5;&#x53e3;&#x6587;&#x4ef6;</font></b><span style="font-weight: normal; text-align: left; line-height: 20px; white-space: normal; font-variant: normal; word-spacing: 0px; text-indent: 0px; float: none; font-size: 13px; letter-spacing: normal; color: rgb(50, 50, 50); font-style: normal; font-family: Arial, Helvetica, sans-serif; text-transform: none; background-color: rgb(255, 255, 255); display: inline !important"><font size="13px" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">linux/include/linux/pinctrl</font></span>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">pinconf-generic.h&#xa0;&#xa0;&#x63d0;&#x4f9b;&#x7ed9;&#x5404;&#x79cd;pin controller&#x4f7f;&#x7528; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">pinconf.h&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pin configuration </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">pinctrl-state.h&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pin state&#x72b6;&#x6001;&#x5b9a;&#x4e49; </font>
    </p>
    <p>
      <font size="4" color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">pinmux.h&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pin mux&#x5b9a;&#x4e49;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1459761171090" FOLDED="true" ID="ID_353188260" MODIFIED="1589521593896">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>pin control subsystem&#x548c;&#x5176;&#x4ed6;&#x5185;&#x6838;&#x6a21;&#x5757;&#x7684;&#x63a5;&#x53e3;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1459761914877" FOLDED="true" ID="ID_1073168285" MODIFIED="1589521592984">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;drivers that use pinctrl subsystems
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Pin&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Control&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Subsystems------GPIO subsystem
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;driver model&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;device tree&#xa0;&#xa0;&#xa0;&#xa0;machine driver
    </p>
  </body>
</html></richcontent>
<node CREATED="1459775491727" FOLDED="true" ID="ID_48223857" MODIFIED="1589521591740" TEXT="1.pinctrl&#x5411;&#x5176;&#x4ed6;driver&#x63d0;&#x4f9b;&#x7684;&#x63a5;&#x53e3;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1459775543674" FOLDED="true" ID="ID_706896912" MODIFIED="1589521584710">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8bbe;&#x5b9a;&#x8be5;&#x8bbe;&#x5907;&#x7684;&#x529f;&#x80fd;&#x590d;&#x7528;
    </p>
    <p>
      <font size="3"><b><i>&#x4e24;&#x4e2a;&#x6982;&#x5ff5;: </i></b></font><b><i><font size="3" color="#e91616">function</font><font size="3">&#xa0;&#x548c; </font><font size="3" color="#e40b0b">group</font></i></b>
    </p>
    <p>
      <font size="3">function&#x5c31;&#x662f;&#x786c;&#x4ef6;&#x903b;&#x8f91;&#x533a;&#x5757;&#xff0c;&#x5bf9;&#x5e94;&#x786c;&#x4ef6;&#x4e0a;&#x7684;&#x4e00;&#x79cd;&#x529f;&#x80fd;&#xff0c;&#x6bd4;&#x5982;spi0 </font>
    </p>
    <p>
      <font size="3">group&#x5c31;&#x662f;&#x4e00;&#x7ec4;gpio&#x7684;&#x96c6;&#x5408;&#xff0c;&#x7528;&#x4e8e;&#x7ec4;&#x6210;&#x67d0;&#x4e2a;&#x786c;&#x4ef6;&#x903b;&#x8f91;&#x533a;&#x5757;</font>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1490174810699" ID="ID_1968848989" MODIFIED="1490174838956">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x6587;&#x4ef6;board-&lt;soc&gt;-gpiomux.c&#x7528;&#x4e8e;&#x6307;&#x5b9a; </b></i>
    </p>
    <p>
      <i><b>function setting</b></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1459775573746" FOLDED="true" ID="ID_1003800495" MODIFIED="1589521583751">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8bbe;&#x5b9a;&#x8be5;device&#x5bf9;&#x5e94;&#x7684;&#x90a3;&#x4e9b;pin&#x811a;&#x7684;&#x7535;&#x6c14;&#x7279;&#x6027;
    </p>
    <p>
      &#x9700;&#x8981;&#x4e86;&#x89e3;pinctrl state holder&#x7684;&#x6982;&#x5ff5;
    </p>
    <ol>
      <li>
        <font color="#ea0c0c">&#x83b7;&#x53d6;pin control state holder, &#x5373;&#x7ed3;&#x6784;&#x4f53;struct pinctrl </font>
      </li>
      <li>
        <font color="#ea0c0c">&#x8bbe;&#x5b9a;pin control&#x7684;&#x72b6;&#x6001; </font>
      </li>
      <li>
        <font color="#ea0c0c">&#x91ca;&#x653e;pin control state holder&#x7684;&#x53e5;&#x67c4;</font>
      </li>
    </ol>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1459777867480" FOLDED="true" ID="ID_1307995723" MODIFIED="1589521581094" TEXT="&#x6570;&#x636e;&#x7ed3;&#x6784;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1459776584339" ID="ID_1346475980" MODIFIED="1459778181371">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct pinctrl {<br/>&#xa0;&#xa0;&#xa0;&#xa0;struct list_head node;&#xff0d;&#xff0d;&#x7cfb;&#x7edf;&#x4e2d;&#x7684;&#x6240;&#x6709;device&#x7684;pin control state holder&#x88ab;&#x6302;&#x5165;&#x5230;&#x4e86;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x94fe;&#x8868;&#x4e2d;<br/>&#xa0;&#xa0;&#xa0;&#xa0;struct device *dev;&#xff0d;&#xff0d;&#xff0d;&#x8be5;pin control state holder&#x5bf9;&#x5e94;&#x7684;device<br/>&#xa0;&#xa0;&#xa0;&#xa0;struct list_head states;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;&#x8bbe;&#x5907;&#x7684;&#x6240;&#x6709;&#x7684;&#x72b6;&#x6001;&#x88ab;&#x6302;&#x5165;&#x5230;&#x8fd9;&#x4e2a;&#x94fe;&#x8868;&#x4e2d;<br/>&#xa0;&#xa0;&#xa0;&#xa0;struct pinctrl_state *state;&#xff0d;&#xff0d;&#xff0d;&#x5f53;&#x524d;&#x7684;pin control state<br/>&#xa0;&#xa0;&#xa0;&#xa0;struct list_head dt_maps;&#xff0d;&#xff0d;&#xff0d;&#xff0d;mapping table<br/>&#xa0;&#xa0;&#xa0;&#xa0;struct kref users;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;reference count<br/>};&#xa0;
    </p>
    <p>
      <b><i>&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;&#x6240;&#x6709;&#x9a71;&#x52a8;&#x5728;&#x548c;pinctrl subsystem&#x8fdb;&#x884c;&#x4ea4;&#x4e92;&#x4e4b;&#x524d;&#x90fd;&#x9700;&#x8981;&#x83b7;&#x53d6;pinctrl_state&#x53e5;&#x67c4;</i></b>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
</node>
<node CREATED="1459776755273" ID="ID_1949587463" MODIFIED="1459778183841">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct pinctrl_state {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct list_head node;&#xff0d;&#xff0d;&#xff0d;&#x6302;&#x5165;&#x94fe;&#x8868;&#x5934;&#x7684;&#x8282;&#x70b9;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char *name;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;state&#x7684;&#x540d;&#x5b57;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct list_head settings;&#xff0d;&#xff0d;&#xff0d;&#x5c5e;&#x4e8e;&#x8be5;&#x72b6;&#x6001;&#x7684;&#x6240;&#x6709;&#x7684;settings
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
</node>
<node CREATED="1459776992359" FOLDED="true" ID="ID_482818732" MODIFIED="1589521578407">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct pinctrl_setting {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct list_head node;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;enum pinctrl_map_type type;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct pinctrl_dev *pctldev;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char *dev_name;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;union {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct pinctrl_setting_mux mux;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct pinctrl_setting_configs configs;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;} data;
    </p>
    <p>
      };
    </p>
    <p>
      &#x5f53;driver&#x8bbe;&#x5b9a;&#x4e00;&#x4e2a;pin&#x7684;state&#x7684;&#x65f6;&#x5019;&#xff0c;pin control subsystem&#x5185;&#x90e8;
    </p>
    <p>
      &#x4f1a;&#x904d;&#x5386;&#x8be5;pin state&#x7684;&#x5185;&#x90e8;&#x7684;settings&#x94fe;&#x8868;&#xff0c;&#x5c06;&#x4e00;&#x4e2a;&#x4e2a;&#x7684;settings&#x8fdb;&#x884c;
    </p>
    <p>
      &#x8bbe;&#x7f6e;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1459777149118" FOLDED="true" ID="ID_452436352" MODIFIED="1589521577407">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      enum pinctrl_map_type {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;PIN_MAP_TYPE_INVALID,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;PIN_MAP_TYPE_DUMMY_STATE,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;PIN_MAP_TYPE_MUX_GROUP,&#xff0d;&#xff0d;&#xff0d;&#x529f;&#x80fd;&#x590d;&#x7528;&#x7684;setting
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;PIN_MAP_TYPE_CONFIGS_PIN,&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8bbe;&#x5b9a;&#x5355;&#x4e00;&#x4e00;&#x4e2a;pin&#x7684;&#x7535;&#x6c14;&#x7279;&#x6027;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;PIN_MAP_TYPE_CONFIGS_GROUP,&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8bbe;&#x5b9a;&#x5355;pin group&#x7684;&#x7535;&#x6c14;&#x7279;&#x6027;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<node CREATED="1490167405709" ID="ID_417174568" MODIFIED="1490167424045">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>struct pinctrl_setting_configs</i></b>&#xa0;{
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned group_or_pin;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long *configs;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned num_configs;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1459777239645" FOLDED="true" ID="ID_1440417104" MODIFIED="1589521576401">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct pinctrl_setting_mux {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned group;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;setting&#x6240;&#x5bf9;&#x5e94;&#x7684;group selector
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned func;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;setting&#x6240;&#x5bf9;&#x5e94;&#x7684;function selector
    </p>
    <p>
      };
    </p>
    <p>
      &#x6709;&#x4e86;function&#x548c;group&#x5c31;&#x53ef;&#x4ee5;&#x8fdb;&#x884c;&#x8be5;device&#x548c;pin mux&#x76f8;&#x5173;&#x7684;&#x8bbe;&#x5b9a;&#x4e86;
    </p>
  </body>
</html></richcontent>
<node CREATED="1459777723626" ID="ID_1166578164" MODIFIED="1488207651044">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#f10e0e"><b><i>&#x5f15;&#x811a;&#x7684;&#x7535;&#x6c14;&#x7279;&#x6027;</i></b></font>
    </p>
    <p>
      struct pinctrl_map_configs {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char *group_or_pin;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;pin&#x6216;&#x8005;pin group&#x7684;&#x540d;&#x5b57;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long *configs;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8981;&#x8bbe;&#x5b9a;&#x7684;&#x503c;&#x7684;&#x5217;&#x8868;&#x3002;&#x8fd9;&#x4e2a;&#x503c;&#x88ab;&#x7528;&#x6765;&#x5199;&#x5165;HW
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned num_configs;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x5217;&#x8868;&#x4e2d;&#x503c;&#x7684;&#x4e2a;&#x6570;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
</node>
</node>
<node CREATED="1459778041480" FOLDED="true" ID="ID_512155678" MODIFIED="1589521582700" TEXT="&#x51fd;&#x6570;&#x63a5;&#x53e3;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1459778065448" ID="ID_758197521" MODIFIED="1459778352807">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.devm_pinctrl_get&#x548c;pinctrl_get
    </p>
    <p>
      &#x7528;&#x4e8e;&#x83b7;&#x53d6;device&#x5bf9;&#x5e94;&#x7684;state&#x53e5;&#x67c4;struct pinctrl
    </p>
    <p>
      state holder&#x4e00;&#x822c;&#x662f;&#x7b2c;&#x4e00;&#x6b21;&#x8c03;&#x7528;&#x7684;&#x65f6;&#x5019;&#x52a8;&#x6001;&#x83b7;&#x53d6;&#x7684;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="16"/>
</node>
<node CREATED="1459778274446" ID="ID_1190967587" MODIFIED="1459778355175" TEXT="2.devm_pinctrl_put&#x548c;pinctrl_put&#x662f;1&#x4e2d;&#x7684;&#x9006;&#x51fd;&#x6570;">
<font NAME="SansSerif" SIZE="16"/>
</node>
<node CREATED="1459778319790" ID="ID_650426908" MODIFIED="1589521357398">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.pinctrl_lookup_state&#x3002;&#x6839;&#x636e;
    </p>
    <p>
      state name&#x5728;pin control state holder&#x627e;&#x5230;&#x5bf9;&#x5e94;&#x7684;pin control state
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ff0000" DESTINATION="ID_650426908" ENDARROW="Default" ENDINCLINATION="514;0;" ID="Arrow_ID_1319629169" SOURCE="ID_870695363" STARTARROW="None" STARTINCLINATION="-9;77;"/>
<font NAME="SansSerif" SIZE="16"/>
</node>
<node CREATED="1459778382819" ID="ID_21238797" MODIFIED="1459778403039">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      4.pinctrl_select_state&#x3002;&#x8bbe;&#x5b9a;&#x4e00;&#x4e2a;&#x5177;&#x4f53;&#x7684;pin control state&#x63a5;&#x53e3;&#x3002;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="16"/>
</node>
</node>
</node>
</node>
<node CREATED="1459779838155" FOLDED="true" ID="ID_1860691904" MODIFIED="1589521589194" TEXT="2.pinctrl subsystem&#x548c;gpio subsystem&#x7684;&#x4ea4;&#x4e92;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1459779886162" FOLDED="true" ID="ID_1296719661" MODIFIED="1589521588078" TEXT="1.&#x5177;&#x4f53;&#x7684;&#x63a5;&#x53e3;&#x5f62;&#x6001;">
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1459780026289" FOLDED="true" ID="ID_443208363" MODIFIED="1589521587023">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>pinctrl_request_gpio</b>&#x63d0;&#x4f9b;&#x7ed9;gpio subsystem&#x7528;&#x6765;&#x7533;&#x8bf7;gpio&#x7684;&#x8d44;&#x6e90;
    </p>
    <p>
      &#x7531;&#x4e8e;&#x67d0;&#x4e9b;&#x786c;&#x4ef6;&#x7ed3;&#x6784;&#x4e0a;&#x7684;&#x5173;&#x7cfb;&#xff0c;pinctrl&#x63d0;&#x4f9b;&#x8be5;&#x63a5;&#x53e3;&#x7ed9;gpio&#x4f7f;&#x7528;&#xff0c;&#x5176;&#x4ed6;
    </p>
    <p>
      &#x7684;driver&#x4e0d;&#x5e94;&#x8be5;&#x4f7f;&#x7528;&#x8be5;&#x63a5;&#x53e3;&#x3002;
    </p>
    <p>
      &#x4e5f;&#x5c31;&#x662f;&#x8bf4;pinctrl&#x4e0d;&#x4ec5;&#x8981;&#x7ef4;&#x62a4;pin space&#x4e2d;&#x7684;ID,&#x540c;&#x65f6;&#x8fd8;&#x8981;&#x7ef4;&#x62a4;
    </p>
    <p>
      gpio id&#x8ddf;pin id&#x4e4b;&#x95f4;&#x7684;&#x6620;&#x5c04;&#x5173;&#x7cfb;
    </p>
  </body>
</html></richcontent>
<font ITALIC="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1459780567517" ID="ID_550866431" MODIFIED="1459780755286">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x6839;&#x636e;GPIO ID&#x627e;&#x5230;&#x8be5;ID&#x5bf9;&#x5e94;&#x7684;pin control device&#xff08;struct pinctrl_dev&#xff09;&#x548c;GPIO rang&#xff08;pinctrl_gpio_range&#xff09;
    </p>
    <p>
      &#x6bcf;&#x4e2a;pin controller&#x90fd;&#x4f1a;&#x88ab;&#x6620;&#x5c04;&#x6210;&#x4e00;&#x4e2a;pinctrl_dev&#x7684;&#x8bbe;&#x5907;&#xff0c;
    </p>
    <p>
      &#x7531;&#x4e8e;&#x786c;&#x4ef6;&#x4e0a;&#x7684;&#x8bbe;&#x8ba1;&#xff0c;pin controller&#x63a7;&#x5236;&#x7684;gpio&#x4f1a;&#x88ab;&#x5206;&#x6210;&#x591a;&#x4e2a;&#x5757;&#x533a;
    </p>
    <p>
      &#x6bcf;&#x4e2a;&#x5757;&#x533a;&#x5c31;&#x4f1a;&#x7528;pinctrl_gpio_range&#x6765;&#x8868;&#x793a;
    </p>
    <p>
      <b><i>pinctrl_add_gpio_range</i></b>&#x5c06;&#x6bcf;&#x4e2a;GPIO bank&#x8868;&#x793a;&#x7684;gpio range&#x6302;&#x5165;&#x5230;pin control device&#x7684;range list&#x4e2d;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
</node>
<node CREATED="1459780898315" ID="ID_919523363" MODIFIED="1459780916516">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x8fdb;&#x884c;&#x590d;&#x7528;&#x529f;&#x80fd;&#x7684;&#x8bbe;&#x5b9a;&#xff0c;&#x6bd5;&#x7adf;GPIO&#x4e5f;&#x662f;&#x5f15;&#x811a;&#x7684;&#x4e00;&#x4e2a;&#x7279;&#x5b9a;&#x7684;&#x529f;&#x80fd;&#x3002;pinmux_request_gpio&#x51fd;&#x6570;&#x7684;&#x4f5c;&#x7528;&#x4e3b;&#x8981;&#x6709;&#x4e24;&#x4e2a;&#xff0c;&#x4e00;&#x4e2a;&#x662f;&#x5728;core driver&#x4e2d;&#x6807;&#x8bb0;&#x8be5;pin&#x5df2;&#x7ecf;&#x7528;&#x4f5c;GPIO&#x4e86;&#xff0c;&#x8fd9;&#x6837;&#xff0c;&#x5982;&#x679c;&#x6709;&#x6a21;&#x5757;&#x540e;&#x7eed;request&#x8be5;&#x8d44;&#x6e90;&#xff0c;&#x90a3;&#x4e48;core driver&#x53ef;&#x4ee5;&#x62d2;&#x7edd;&#x4e0d;&#x5408;&#x7406;&#x7684;&#x8981;&#x6c42;&#x3002;&#x7b2c;&#x4e8c;&#x6b65;&#x5c31;&#x662f;&#x8c03;&#x7528;&#x5e95;&#x5c42;pin controller driver&#x7684;callback&#x51fd;&#x6570;&#xff0c;&#x8fdb;&#x884c;&#x5e95;&#x5c42;&#x5bc4;&#x5b58;&#x5668;&#x76f8;&#x5173;&#x7684;&#x64cd;&#x4f5c;&#x3002;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
</node>
</node>
<node CREATED="1459780990146" ID="ID_1610048941" MODIFIED="1459781003140">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>pinctrl_free_gpio</b>&#x3002;&#x6709;&#x7533;&#x8bf7;&#x5c31;&#x6709;&#x91ca;&#x653e;&#xff0c;&#x8fd9;&#x662f;pinctrl_request_gpio&#x7684;&#x9006;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
</node>
<node CREATED="1459781018786" ID="ID_615115281" MODIFIED="1459781035851">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pinctrl_gpio_direction_input&#x548c;pinctrl_gpio_direction_output
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
</node>
</node>
</node>
<node CREATED="1459781573811" ID="ID_925287204" MODIFIED="1490613805500">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3.&#x8ddf;devicetree&#x6216;&#x8005;&#x662f;machine driver&#x7684;&#x63a5;&#x53e3;</b>
    </p>
    <p>
      &#x4e3b;&#x8981;&#x662f;&#x4e3a;pinctrl subsystem&#x63d0;&#x4f9b;pin mapping database&#x7684;&#x652f;&#x6301;
    </p>
    <p>
      &#x8be5;database&#x7684;&#x6bcf;&#x4e2a;entry&#x7684;&#x5b9a;&#x4e49;&#x5982;&#x4e0b;
    </p>
    <p>
      struct pinctrl_map {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char *dev_name;&#xff0d;&#xff0d;&#xff0d;&#x4f7f;&#x7528;&#x8fd9;&#x4e2a;mapping entry&#x7684;&#x8bbe;&#x5907;&#x540d;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char *name;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;&#x540d;&#x5b57;&#x8868;&#x793a;&#x4e86;&#x8be5;mapping entry
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;enum pinctrl_map_type type;&#xff0d;&#xff0d;&#xff0d;&#x8fd9;&#x4e2a;entry&#x7684;mapping type
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char *ctrl_dev_name; &#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;pin controller&#x8fd9;&#x4e2a;&#x8bbe;&#x5907;&#x7684;&#x540d;&#x5b57;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;union {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct pinctrl_map_mux mux;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct pinctrl_map_configs configs;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;} data;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<font ITALIC="true" NAME="SansSerif" SIZE="14"/>
</node>
<node CREATED="1490612992970" ID="ID_1534118675" MODIFIED="1490613781908">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>4.&#x8ddf;&#x9a71;&#x52a8;&#x6a21;&#x578b;&#x7684;&#x63a5;&#x53e3;</i></b>
    </p>
    <p>
      &#x5728;&#x9a71;&#x52a8;&#x6a21;&#x578b;&#x7684;&#x7ed1;&#x5b9a;&#x51fd;&#x6570;really_probe&#x5f53;&#x4e2d;&#x4f1a;&#x8c03;&#x7528;&#x51fd;&#x6570;
    </p>
    <p>
      pinctrl_bind_pins(dev)&#xff0c;
    </p>
    <p>
      &#x5728;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x4f1a;&#x751f;&#x6210;device&#x5f53;&#x4e2d;&#x7684;pins&#x6210;&#x5458;&#xff0c;&#x7528;&#x4e8e;&#x8bbe;&#x7f6e;
    </p>
    <p>
      &#x8be5;device&#x5bf9;&#x5e94;&#x7684;pinctrl&#x7684;&#x9ed8;&#x8ba4;&#x7684;&#x72b6;&#x6001;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1459762131859" FOLDED="true" ID="ID_304684176" MODIFIED="1589521597556" TEXT="pin control subsystem&#x5185;&#x90e8;&#x6a21;&#x5757;&#x56fe;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1459762153899" ID="ID_1054135346" MODIFIED="1459762340458">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;driver0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;driver1&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;driver2&#xa0;&#xa0; ...................&#xa0;&#xa0;drivern
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;^
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;pin configuration driver------------&gt;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pin control core driver
    </p>
    <p>
      &#xa0;&#xa0;pin mux driver ------------------------&gt;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;specific pin controller driver0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;......&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;specific pin controller driver1
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1488207393442" ID="ID_944801834" MODIFIED="1488207400071">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/pinctrl-inner.gif"/>
  </body>
</html></richcontent>
</node>
<node CREATED="1490175170640" FOLDED="true" ID="ID_200428281" MODIFIED="1577887249883" TEXT="&#x6587;&#x6863;msm-pinctrl.txt&#x9605;&#x8bfb;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1490175442996" ID="ID_1694769749" MODIFIED="1490176448827">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9ad8;&#x901a;&#x82af;&#x7247;&#x878d;&#x5408;&#x4e86;&#x4e00;&#x4e2a;gpio&#x548c;pin&#x811a;mux/config&#x7684;&#x786c;&#x4ef6;(TOP Level Mode Multiplexer)
    </p>
    <p>
      <b>compatible&#x5c5e;&#x6027;&#xff0c;&#x7528;&#x4e8e;&#x533a;&#x5206;TLMM&#x7684;&#x7248;&#x672c;</b>
    </p>
    <p>
      "qcom,msm-tlmm-8916"
    </p>
    <p>
      "qcom,msm-tlmm-8226"
    </p>
    <p>
      "qcom,msm-tlmm-8974"
    </p>
    <p>
      "qcom,msm-tlmm-mdm9640"
    </p>
    <p>
      "qcom,msm-tlmm-vpipa"
    </p>
    <p>
      <b>reg&#x5c5e;&#x6027;:</b>
    </p>
    <p>
      &#x4ee3;&#x8868;gpio&#x63a7;&#x5236;&#x5668;&#x7684;&#x914d;&#x7f6e;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x57fa;&#x5730;&#x5740;&#x548c;&#x5176;&#x8303;&#x56f4;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1490176455403" FOLDED="true" ID="ID_1394610283" MODIFIED="1540394781042">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f5c;&#x4e3a;&#x5b50;&#x8282;&#x70b9;&#x7684;pin&#x811a;&#x7c7b;&#x578b;:
    </p>
    <p>
      &#x7531;&#x4e00;&#x4e2a;&#x7279;&#x5b9a;&#x7684;&#x63a7;&#x5236;&#x5668;&#x5b9e;&#x4f8b;&#x6240;&#x652f;&#x6301;&#x7684;pin&#x811a;&#x7c7b;&#x578b;&#x662f;&#x7531;&#x63a7;&#x5236;&#x5668;&#x8282;&#x70b9;&#x7684;
    </p>
    <p>
      &#x5b50;&#x8282;&#x70b9;&#x6765;&#x4ee3;&#x8868;&#x7684;&#x3002;&#x6bcf;&#x4e2a;pin&#x811a;&#x7c7b;&#x578b;&#x7684;&#x8282;&#x70b9;&#x7684;&#x540d;&#x79f0;&#x5fc5;&#x987b;&#x662f;&#x72ec;&#x7279;&#x7684;&#xff0c;&#x5e76;&#x4e14;
    </p>
    <p>
      &#x5fc5;&#x987b;&#x662f;&#x4e0b;&#x5217;&#x7684;&#x540d;&#x79f0;&#x4e4b;&#x4e00;:
    </p>
    <p>
      &#xa0;&#xa0;- gp : General purpose pins
    </p>
    <p>
      &#xa0;&#xa0;- sdc : SDC pins
    </p>
    <p>
      &#xa0;&#xa0;- qdsc : QDSC pins
    </p>
    <p>
      &#x6bcf;&#x4e2a;pin&#x811a;&#x7c7b;&#x578b;&#x8282;&#x70b9;&#x5fc5;&#x987b;&#x5305;&#x542b;&#x4e0b;&#x5217;&#x7684;&#x5c5e;&#x6027;:
    </p>
    <p>
      #qcom,pin-cells &#x5f15;&#x811a;&#x63cf;&#x8ff0;&#x7b26;&#x5f53;&#x4e2d;&#x7684;cell&#x7684;&#x6570;&#x91cf;
    </p>
    <p>
      qcom,num-pins &#x7ed9;&#x5b9a;&#x7c7b;&#x578b;&#x7684;&#x5f15;&#x811a;&#x7684;&#x6570;&#x91cf;
    </p>
  </body>
</html></richcontent>
<node CREATED="1490176935059" ID="ID_1785125209" MODIFIED="1490180175273">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e00;&#x4e2a;pin&#x811a;&#x7c7b;&#x578b;&#x53ef;&#x80fd;&#x4f1a;&#x652f;&#x6301;gpio&#x7684;&#x64cd;&#x4f5c;&#xff0c;&#x5728;&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#x4e4b;&#x4e0b;&#xff0c;&#x4e00;&#x4e2a;pin&#x811a;&#x7c7b;&#x578b;&#x8282;&#x70b9;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x62e5;&#x6709;&#x4e00;&#x4e2a;&#x4ee3;&#x8868;gpio&#x63a7;&#x5236;&#x5668;&#x7684;&#x5b50;&#x8282;&#x70b9;&#x3002;&#x53ef;&#x9009;&#x7684;&#xff0c;&#x4e00;&#x4e2a;pin&#x811a;&#x7c7b;&#x578b;&#x4e5f;&#x652f;&#x6301;&#x7528;pin&#x811a;&#x6765;&#x4f5c;&#x4e3a;
    </p>
    <p>
      &#x4e2d;&#x65ad;&#x89e6;&#x53d1;&#xff0c;&#x5728;&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#x4e0b;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x5728;gpio&#x63a7;&#x5236;&#x5668;&#x8282;&#x70b9;&#x5f53;&#x4e2d;&#x589e;&#x52a0;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x5c5e;&#x6027;&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x6709;&#x4e86;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#xff0c;&#x90a3;&#x4e48;&#x6211;&#x4eec;&#x9700;&#x8981;&#x6307;&#x5b9a;&#x80fd;&#x591f;&#x89e6;&#x53d1;&#x4e2d;&#x65ad;&#x7684;&#x5f15;&#x811a;&#x7684;&#x6570;&#x76ee;&#x548c;&#x4e2d;&#x65ad;&#x88ab;&#x8def;&#x7531;&#x5230;&#x7684;
    </p>
    <p>
      &#x5904;&#x7406;&#x5668;&#x7684;id&#x53f7;&#x3002;
    </p>
    <p>
      gpio-controller&#xff1a; &#x6307;&#x5b9a;gpio &#x63a7;&#x5236;&#x5668;
    </p>
    <p>
      #gpio-cells: &#x5e94;&#x8be5;&#x662f;2, &#x7b2c;&#x4e00;&#x4e2a;&#x7528;&#x6765;&#x6307;&#x5b9a;&#x5f15;&#x811a;&#x53f7;&#xff0c;&#x7b2c;&#x4e8c;&#x4e2a;&#x7528;&#x6765;&#x6307;&#x5b9a;&#x53c2;&#x6570;
    </p>
    <p>
      interrupt-controller: &#x6307;&#x5b9a;&#x4e3a;&#x7ec8;&#x7aef;&#x63a7;&#x5236;&#x5668;
    </p>
    <p>
      compatible: &#x7528;&#x4e8e;&#x6807;&#x8bc6;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#xff0c;&#x4f8b;&#x5982;"qcom,msm-tlmm-gp"
    </p>
    <p>
      num_irqs: &#x53ef;&#x4ee5;&#x7528;&#x4f5c;&#x4e2d;&#x65ad;&#x7684;&#x5f15;&#x811a;&#x7684;&#x6570;&#x91cf;
    </p>
    <p>
      apps_id: &#x7528;&#x4e8e;&#x8986;&#x76d6;&#x9ed8;&#x8ba4;&#x7684;TLMM&#x5bf9;&#x5e94;&#x7684;&#x5904;&#x7406;&#x5668;&#x6838;&#x5fc3;id&#x53f7;
    </p>
    <p>
      #interrupt-cells: &#x5e94;&#x8be5;&#x662f;2,&#x7b2c;&#x4e00;&#x4e2a;&#x7528;&#x6765;&#x6307;&#x5b9a;&#x4e2d;&#x65ad;&#x53f7;&#xff0c; &#x7b2c;&#x4e8c;&#x4e2a;&#x6307;&#x5b9a;&#x53ef;&#x9009;&#x7684;&#x6807;&#x5fd7;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1490180403710" FOLDED="true" ID="ID_393075270" MODIFIED="1540394779093">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pin mux&#x548c;pin config&#x529f;&#x80fd;&#x90fd;&#x53ef;&#x4ee5;&#x4f5c;&#x4e3a;pin controller&#x7684;
    </p>
    <p>
      &#x5b50;&#x8282;&#x70b9;&#x6765;&#x4ee3;&#x8868;&#x3002;&#x5bf9;&#x4e8e;&#x8fd9;&#x6837;&#x7684;&#x5b50;&#x8282;&#x70b9;&#x7684;&#x6570;&#x91cf;&#x5e76;&#x6ca1;&#x6709;&#x9650;&#x5236;&#x3002;
    </p>
    <p>
      qcom,pins: &#x6307;&#x5b9a;pin&#x811a;&#x7c7b;&#x578b;&#x548c;pin&#x811a;&#x53f7;
    </p>
    <p>
      qcom,num-grp-pins: &#x5f53;&#x524d;&#x7ec4;&#x5f53;&#x4e2d;&#x7684;pin&#x811a;&#x6570;&#x91cf;
    </p>
    <p>
      label: &#x6807;&#x8bc6;&#x5f53;&#x524d;&#x7684;pin group, &#x7531;client&#x6765;&#x4f7f;&#x7528;
    </p>
    <p>
      qcom,pin-func: &#x8be5;pin group&#x7684;function&#x8bbe;&#x7f6e;
    </p>
    <p>
      &#x8be5;&#x5b50;&#x8282;&#x70b9;&#x5e94;&#x8be5;&#x5305;&#x542b;&#x4e00;&#x4e2a;pin&#x811a;&#x7684;&#x5217;&#x8868;&#xff0c;&#x529f;&#x80fd;&#x9009;&#x62e9;&#x548c;&#x914d;&#x7f6e;&#x53ef;&#x4ee5;&#x5e94;&#x7528;&#x5230;&#x8be5;&#x7ec4;&#x5217;&#x8868;&#x4e0a;&#x9762;&#x3002;
    </p>
    <p>
      &#x8be5;&#x5217;&#x8868;&#x5c31;&#x662f;&#x901a;&#x8fc7;&#x5c5e;&#x6027;"qcom,pins"&#x6765;&#x6307;&#x5b9a;&#x7684;&#x3002;&#x8be5;&#x5c5e;&#x6027;&#x81f3;&#x5c11;&#x8981;&#x6307;&#x5b9a;&#x4e00;&#x4e2a;pin&#x811a;&#x53f7;&#xff0c;&#x4e14;
    </p>
    <p>
      pin&#x811a;&#x7684;&#x6570;&#x76ee;&#x6ca1;&#x6709;&#x4e0a;&#x9650;&#x3002;&#x901a;&#x8fc7;&#x5c5e;&#x6027;"qcom,pin-func"&#x53ef;&#x4ee5;&#x6307;&#x5b9a;pin&#x811a;&#x7684;function&#x9009;&#x62e9;&#x3002;
    </p>
    <p>
      <b>&#x5bf9;&#x4e8e;pin&#x811a;group&#x8282;&#x70b9;&#xff0c;&#x5fc5;&#x987b;&#x989d;&#x5916;&#x5730;&#x6709;&#x4e00;&#x4e2a;pin&#x811a;&#x914d;&#x7f6e;&#x8282;&#x70b9;&#x4f5c;&#x4e3a;&#x5b83;&#x7684;&#x5b50;&#x8282;&#x70b9;</b>&#x3002;&#x4e00;&#x7ec4;pin&#x811a;
    </p>
    <p>
      &#x53ef;&#x80fd;&#x5bf9;&#x5e94;&#x7740;&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x591a;&#x4e2a;&#x914d;&#x7f6e;&#x5b50;&#x8282;&#x70b9;&#xff0c;&#x4e00;&#x4e2a;&#x914d;&#x7f6e;&#x5b50;&#x8282;&#x70b9;&#x53ef;&#x80fd;&#x5bf9;&#x5e94;&#x7740;&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x591a;&#x4e2a;&#x914d;&#x7f6e;&#x3002;
    </p>
    <p>
      &#x67e5;&#x8be2;&#x6587;&#x6863;Documentation/devicetree/bindings/pinctrl/pinctrl-bindings.txt&#x83b7;&#x53d6;&#x914d;&#x7f6e;&#x5c5e;&#x6027;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1490257435878" ID="ID_1467097056" MODIFIED="1490257455458">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#000000"><b>pinctrl@fd511000 { </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.... </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.. </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pmx-spi-bus { </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* MOSI, MISO and CLK lines </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* all sharing same function and config </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* settings for each configuration node. </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;qcom,pins = &lt;&amp;gp 0&gt;, &lt;&amp;gp 1&gt;, &lt;&amp;gp 3&gt;; </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;qcom,num-grp-pins = &lt;3&gt;; </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;qcom,pin-func = &lt;1&gt;; </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;label = "spi-bus"; </b></font></i>
    </p>
    <p>
      
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Active configuration of bus pins */ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;spi-bus-active: spi-bus-active { </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Property names as specified in </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* pinctrl-bindings.txt </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;drive-strength = &lt;8&gt;; /* 8 MA */ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bias-disable; /* No PULL */ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}; </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Sleep configuration of bus pins */ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;spi-bus-sleep: spi-bus-sleep { </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Property values as specified in HW </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* manual. </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;drive-strength = &lt;2&gt;; /* 2 MA */ </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bias-disable; </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}; </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}; </b></font></i>
    </p>
    <p>
      <i><font color="#000000"><b>}</b></font></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1490185957189" ID="ID_1269760393" MODIFIED="1490185982391">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#xa0;<b><i>pinctrl@fd5110000 { </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;compatible = "qcom,msm-tlmm-8974"; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;reg = &lt;0xfd5110000 0x4000&gt;; </i></b>
    </p>
    <p>
      
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* General purpose pin type */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gp: gp { </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;qcom,num-pins = &lt;117&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#qcom,pin-cells = &lt;1&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Supports Gpio controller */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;msm_gpio: msm_gpio { </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpio-controller; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#gpio-cells = &lt;2&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;compatible = "qcom,msm-tlmm-gp"; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;interrupt-controller; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#interrupt-cells &lt;2&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;num_irqs = &lt;117&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;apps_id = &lt;4&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Sdc pin type */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;sdc: sdc { </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;qcom,num-pins = &lt;6&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#qcom,pin-cells = &lt;1&gt;; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;};&#xa0; </i></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1490233528087" FOLDED="true" ID="ID_357125436" MODIFIED="1577887242524" TEXT="&#x6587;&#x6863;gpio.txt&#x9605;&#x8bfb;">
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1490233551814" FOLDED="true" ID="ID_54356047" MODIFIED="1540394789688">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1) gpios property
    </p>
    <p>
      &#x4f7f;&#x7528;gpio&#x7684;&#x65f6;&#x5019;&#x5e94;&#x8be5;&#x901a;&#x8fc7;&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x591a;&#x4e2a;&#x5c5e;&#x6027;&#x6765;&#x6307;&#x5b9a;&#x5b83;&#x4eec;&#x3002;
    </p>
    <p>
      &#x6bcf;&#x4e2a;&#x5c5e;&#x6027;&#x5305;&#x542b;&#x4e00;&#x4e2a;'gpio-list'&#xff0c; 'gpio-list'&#x7684;&#x5b9a;&#x4e49;&#x5982;&#x4e0b;&#x6240;&#x793a;:
    </p>
    <p>
      gpio-list ::= &lt;single-gpio&gt; [gpio-list]
    </p>
    <p>
      single-gpio ::= &lt;gpio-phandle&gt; &lt;gpio-specifier&gt;
    </p>
    <p>
      gpio-phandle : phandle to gpio controller node
    </p>
    <p>
      gpio-specifier : Array of #gpio-cells specifying specific gpio
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(controller specific)
    </p>
    <p>
      gpio&#x7684;&#x5c5e;&#x6027;&#x5e94;&#x8be5;&#x88ab;&#x547d;&#x540d;&#x4e3a;"[&lt;name&gt;-]gpios"&#xff0c;&#x6bcf;&#x4e2a;gpio&#x7684;&#x5c5e;&#x6027;&#x7684;&#x786e;&#x5207;&#x542b;&#x4e49;
    </p>
    <p>
      &#x7684;&#x6587;&#x6863;&#x5e94;&#x8be5;&#x653e;&#x7f6e;&#x5230;binding&#x91cc;&#x9762;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1490234605069" ID="ID_1780700668" MODIFIED="1490235046730">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>&#x4e0b;&#x9762;&#x7684;&#x4f8b;&#x5b50;&#x88ab;&#x7528;&#x6765;&#x63cf;&#x8ff0;gpio&#x7684;pin&#x811a;&#xff0c;&#x7528;&#x4e8e;&#x82af;&#x7247;&#x9009;&#x62e9;</i></b>
    </p>
    <p>
      gpio1: gpio1 {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpio-controller
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#gpio-cells = &lt;2&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;};
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;gpio2: gpio2 {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpio-controller
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#gpio-cells = &lt;1&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;};
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;[...]
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;chipsel-gpios = &lt;&amp;gpio1 12 0&gt;,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;&amp;gpio1 13 0&gt;,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;0&gt;, /* holes are permitted, means no GPIO 2 */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;&amp;gpio2 2&gt;;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x770b;&#x5230;&#x82af;&#x7247;&#x9009;&#x62e9;&#x5f15;&#x811a;2&#x6ca1;&#x6709;&#x88ab;&#x8bbe;&#x7f6e;&#xff0c;&#x8fd8;&#x662f;&#x4fdd;&#x6301;&#x7a7a;&#x7684;&#x72b6;&#x6001;
    </p>
    <p>
      gpio-specifier&#x7684;&#x957f;&#x5ea6;&#x662f;&#x7531;gpio controller&#x6765;&#x5b9a;&#x4e49;&#x7684;&#xff0c;&#x6bd4;&#x5982;&#x4e0a;&#x9762;&#x7684;&#x4f8b;&#x5b50;&#xff0c;
    </p>
    <p>
      gpio1&#x7684;cell&#x662f;2, gpio2&#x7684;cell&#x662f;1
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1490235053544" ID="ID_1273623932" MODIFIED="1490236009824">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2)GPIO specifier best practices
    </p>
    <p>
      gpio-specifier&#x5e94;&#x8be5;&#x5305;&#x542b;&#x4e00;&#x4e2a;flag&#x7528;&#x6765;&#x6307;&#x793a;GPIO&#x7684;&#x6781;&#x6027;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1490236013703" ID="ID_186215042" MODIFIED="1490256691787">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.1) gpio- and pin-controller interaction
    </p>
    <p>
      &#x7531;gpio&#x63a7;&#x5236;&#x5668;&#x63d0;&#x4f9b;&#x7684;&#x4e00;&#x4e9b;&#x6216;&#x8005;&#x6240;&#x6709;&#x7684;gpios,&#x901a;&#x8fc7;pin controller&#xff0c;&#x90fd;&#x53ef;&#x4ee5;&#x88ab;
    </p>
    <p>
      &#x8def;&#x7531;&#x5230;&#x82af;&#x7247;&#x5c01;&#x88c5;&#x7684;&#x5f15;&#x811a;&#x4e0a;&#x9762;&#x53bb;&#x3002;&#x8fd9;&#x79cd;&#x65b9;&#x5f0f;&#x5141;&#x8bb8;&#x5c06;pin&#x811a;&#x5728;gpio&#x548c;&#x5176;&#x4ed6;&#x529f;&#x80fd;&#x4e4b;&#x95f4;
    </p>
    <p>
      &#x8fdb;&#x884c;&#x590d;&#x7528;(mux)&#x3002;
    </p>
    <p>
      &#x660e;&#x786e;&#x6307;&#x660e;&#x4e00;&#x4e2a;gpio&#x5bf9;&#x5e94;&#x7740;&#x54ea;&#x4e2a;pin controller&#x7684;&#x54ea;&#x4e00;&#x4e2a;pin&#x811a;&#x662f;&#x975e;&#x5e38;&#x6709;&#x7528;&#x7684;&#xff0c;
    </p>
    <p>
      gpio-ranges&#x5c5e;&#x6027;&#x53ef;&#x4ee5;&#x5b8c;&#x6210;&#x8fd9;&#x4e2a;&#x4efb;&#x52a1;&#xff0c;&#x5e76;&#x4e14;&#x5305;&#x542b;&#x7740;&#x5982;&#x4e0b;&#x6240;&#x793a;&#x7684;&#x4fe1;&#x606f;&#x7ed3;&#x6784;:
    </p>
    <p>
      <i><font color="#ed0a0a">gpio-range-list ::= &lt;single-gpio-range&gt; [gpio-range-list] </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">single-gpio-range ::= &lt;numeric-gpio-range&gt; | &lt;named-gpio-range&gt; </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">numeric-gpio-range ::= </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;pinctrl-phandle&gt; &lt;gpio-base&gt; &lt;pinctrl-base&gt; &lt;count&gt; </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">named-gpio-range ::= &lt;pinctrl-phandle&gt; &lt;gpio-base&gt; '&lt;0 0&gt;' </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">gpio-phandle : phandle to pin controller node. </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">gpio-base : Base GPIO ID in the GPIO controller </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">pinctrl-base : Base pinctrl pin ID in the pin controller </font></i>
    </p>
    <p>
      <i><font color="#ed0a0a">count : The number of GPIOs/pins in this range</font></i>
    </p>
    <p>
      &#x5728;named-gpio-range&#x88ab;&#x4f7f;&#x7528;&#x7684;&#x60c5;&#x51b5;&#x4e4b;&#x4e0b;&#xff08;&#x5728;&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#x4e0b;pinctrl-base&#x548c;count&#x90fd;&#x662f;0&#xff09;
    </p>
    <p>
      &#x5c5e;&#x6027;gpio-ranges-group-names&#x4e3a;&#x6bcf;&#x4e00;&#x4e2a;&#x5728;gpio-range&#x5f53;&#x4e2d;&#x7684;single-gpio-range&#x8282;&#x70b9;
    </p>
    <p>
      &#x5305;&#x542b;&#x4e86;&#x4e00;&#x4e2a;string&#x3002;<b><i>gpio-ranges-group-names&#x6309;&#x7167;&#x4e0b;&#x9762;&#x7684;&#x65b9;&#x5f0f;&#x8fdb;&#x884c;&#x7ec4;&#x7ec7;:</i></b>
    </p>
    <p>
      gpiorange-names-list ::= &lt;gpiorange-name&gt; [gpiorange-names-list]
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;gpiorange-name : &#x8fd9;&#x662f;pin controller&#x5f53;&#x4e2d;&#x7684;pingroup&#x7684;&#x540d;&#x79f0;&#xff0c;&#x8ddf;&#x5bf9;&#x5e94;&#x7684;GPIO range
    </p>
    <p>
      &#x76f8;&#x8054;&#x7cfb;&#x3002;&#x4e3e;&#x4f8b;&#x5982;&#x4e0b;:
    </p>
    <p>
      <i>gpio_pio_i: gpio-controller@14B0 { </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#gpio-cells = &lt;2&gt;; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;compatible = "fsl,qe-pario-bank-e", "fsl,qe-pario-bank"; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;reg = &lt;0x1480 0x18&gt;; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpio-controller; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpio-ranges =&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;&amp;pinctrl1 0 20 10&gt;, </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;&amp;pinctrl2 10 0 0&gt;, </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;&amp;pinctrl1 15 0 10&gt;, </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&lt;&amp;pinctrl2 25 0 0&gt;; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpio-ranges-group-names =&#xa0;&#xa0;&#xa0;"", </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"foo", </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"", </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"bar"; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;}; </i>
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1567406552401" FOLDED="true" ID="ID_669223274" MODIFIED="1589521619772">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">tiny4412 pinctrl&#x5b50;&#x7cfb;&#x7edf;&#x9a71;&#x52a8;&#x5b66;&#x4e60;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1567406613498" FOLDED="true" ID="ID_1847682778" MODIFIED="1589521618697">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pinctrl-samsung.c&#xa0;&#xa0;&#x6587;&#x4ef6;&#x662f;&#x5e73;&#x53f0;&#x9a71;&#x52a8;&#x6ce8;&#x518c;&#x7684;&#x5730;&#x65b9;
    </p>
    <p>
      &#x6211;&#x4eec;&#x5206;&#x6790;&#x4e00;&#x4e0b;
    </p>
  </body>
</html></richcontent>
<node CREATED="1567406649581" ID="ID_412627489" MODIFIED="1567407043625">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9a71;&#x52a8;&#x7684;&#x5165;&#x53e3;&#x51fd;&#x6570;&#x662f;&#x5982;&#x4f55;&#x6ce8;&#x518c;&#x5230;&#x7cfb;&#x7edf;&#x7684;&#xff1a;
    </p>
    <p>
      static int __init samsung_pinctrl_drv_register(void)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/*
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Register syscore ops for save/restore of registers across suspend.
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* It's important to ensure that this driver is running at an earlier
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* initcall level than any arch-specific init calls that install syscore
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* ops that turn off pad retention (like exynos_pm_resume).
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;register_syscore_ops(&amp;samsung_pinctrl_syscore_ops);&#xa0;&#xa0;-----&gt;&#xa0; <b>syscore&#x7cfb;&#x7edf;&#xff0c;&#x4fdd;&#x8bc1;suspend&#x548c;resume&#x8fc7;&#x7a0b;pinctrl&#x72b6;&#x6001;</b>
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return platform_driver_register(&amp;samsung_pinctrl_driver);
    </p>
    <p>
      }
    </p>
    <p>
      postcore_initcall(samsung_pinctrl_drv_register);
    </p>
    <p>
      
    </p>
    <p>
      <b><i>&#x91c7;&#x7528;postcore_initcall &#x5c06;&#x5165;&#x53e3;&#x51fd;&#x6570;&#x6ce8;&#x518c;&#x5230;&#x7cfb;&#x7edf;&#xff0c;postcore_initcall &#x4fdd;&#x8bc1;pinctrl&#x6bd4;&#x5176;&#x4ed6;&#x9a71;&#x52a8;&#x66f4;&#x65e9;&#x5730;&#x6267;&#x884c; </i></b>
    </p>
    <p>
      <b><i>#define postcore_initcall(fn)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__define_initcall(fn, 2)</i></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1567407110833" FOLDED="true" ID="ID_609937862" MODIFIED="1589521615686">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x770b;&#x4e00;&#x4e0b;&#x5e73;&#x53f0;&#x9a71;&#x52a8;&#x662f;&#x5982;&#x4f55;&#x5b9a;&#x4e49;&#x7684;:
    </p>
    <p>
      
    </p>
    <p>
      static struct platform_driver samsung_pinctrl_driver = {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.probe&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= samsung_pinctrl_probe,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.driver = {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.name&#xa0;&#xa0;&#xa0;= "samsung-pinctrl",
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.of_match_table = samsung_pinctrl_dt_match,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.suppress_bind_attrs = true,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;},
    </p>
    <p>
      };
    </p>
    <p>
      
    </p>
    <p>
      &#x5339;&#x914d;&#x8868; of_match_table&#x662f;&#x4e00;&#x4e2a;&#x975e;&#x5e38;&#x5927;&#x7684;&#x6570;&#x7ec4;&#xff0c;&#x7528;&#x6765;&#x9002;&#x914d;&#x4e09;&#x661f;&#x7684;exynos, s3c64xx, s3c24xx &#x7cfb;&#x5217;&#x7684;&#x82af;&#x7247;
    </p>
    <p>
      &#x6211;&#x4eec;&#x53ea;&#x5173;&#x5fc3;exynos4412&#x82af;&#x7247;
    </p>
    <p>
      <b><i>static const struct of_device_id samsung_pinctrl_dt_match[] = {</i></b>
    </p>
    <p>
      #ifdef CONFIG_PINCTRL_EXYNOS
    </p>
    <p>
      { .compatible = "samsung,exynos4x12-pinctrl",
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;.data = (void *)exynos4x12_pin_ctrl },
    </p>
    <p>
      {}
    </p>
    <p>
      #endif
    </p>
    <p>
      
    </p>
    <p>
      }&#xff1b;
    </p>
    <p>
      <b><font color="#b726d4"><i>exynos4x12_pin_ctrl&#x662f;&#x4e00;&#x4e2a;struct samsung_pin_ctrl&#x7c7b;&#x578b;&#x7684;&#x6570;&#x7ec4;&#xff0c;&#x5185;&#x6db5;4&#x4e2a;&#x6570;&#x7ec4;&#x5143;&#x7d20;&#xff0c; </i></font></b>
    </p>
    <p>
      <b><font color="#b726d4"><i>&#x8fd9;&#x5bf9;&#x5e94;&#x4e8e;dts&#x5f53;&#x4e2d;&#x58f0;&#x660e;&#x7684;4&#x4e2a;pinctrl &#x8bbe;&#x5907;</i></font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1578126223845" FOLDED="true" ID="ID_1327964592" MODIFIED="1589521609830">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#f40f0f">static int samsung_pinctrl_probe(struct platform_device *pdev)</font></b>
    </p>
    <p>
      
    </p>
    <p>
      &#x5f00;&#x59cb;&#x5206;&#x6790;probe&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<node CREATED="1578148628138" ID="ID_54934902" MODIFIED="1578150277947">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6838;&#x5fc3;&#x6570;&#x636e;&#x58f0;&#x660e;
    </p>
    <p>
      struct samsung_pinctrl_drv_data *drvdata;
    </p>
    <p>
      const struct samsung_pin_ctrl *ctrl;
    </p>
    <p>
      &#x4e0b;&#x9762;&#x7684;&#x9a71;&#x52a8;&#x4ee3;&#x7801;&#x91cc;&#x9762;&#x4f1a;&#x6839;&#x636e;dts&#x91cc;&#x9762;&#x7684;pinctrl&#x8282;&#x70b9;&#x7684;&#x5e8f;&#x53f7;&#x627e;&#x5230;&#x5176;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      struct samsung_pin_ctrl&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x7136;&#x540e;drvdata&#x91cc;&#x9762;&#x7684;&#x5f88;&#x591a;&#x6210;&#x5458;&#x4f1a;&#x6839;&#x636e;
    </p>
    <p>
      ctrl&#x6765;&#x8fdb;&#x884c;&#x521d;&#x59cb;&#x5316;
    </p>
    <p>
      
    </p>
    <p>
      &#x52a8;&#x6001;&#x5206;&#x914d;&#x51fa;drvdata&#x7684;&#x5185;&#x5b58;
    </p>
    <p>
      drvdata = devm_kzalloc(dev, sizeof(*drvdata), GFP_KERNEL);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1578149677845" FOLDED="true" ID="ID_1239774545" MODIFIED="1589521608184">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5f00;&#x59cb;&#x5206;&#x6790;dts&#x6570;&#x636e;
    </p>
    <p>
      ctrl = samsung_pinctrl_get_soc_data(drvdata, pdev)
    </p>
    <p>
      
    </p>
    <p>
      &#x51fd;&#x6570;&#x539f;&#x578b;&#x5982;&#x4e0b;:
    </p>
    <p>
      struct samsung_pin_ctrl *
    </p>
    <p>
      samsung_pinctrl_get_soc_data(struct samsung_pinctrl_drv_data *d,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct platform_device *pdev)
    </p>
  </body>
</html></richcontent>
<node CREATED="1578150283171" ID="ID_1943301600" MODIFIED="1578189992232">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x53d8;&#x91cf;&#x58f0;&#x660e;
    </p>
    <p>
      const struct of_device_id *match;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct device_node *node = pdev-&gt;dev.of_node;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct device_node *np;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const struct samsung_pin_bank_data *bdata;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const struct samsung_pin_ctrl *ctrl;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct samsung_pin_bank *bank;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1578190012794" ID="ID_346699697" MODIFIED="1578190272824">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      id = of_alias_get_id(node, "pinctrl");
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (id &lt; 0) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dev_err(&amp;pdev-&gt;dev, "failed to get alias id\n");
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return ERR_PTR(-ENOENT);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;match = of_match_node(samsung_pinctrl_dt_match, node);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ctrl = (struct samsung_pin_ctrl *)match-&gt;data + id;
    </p>
    <p>
      &#x6839;&#x636e;dts&#x91cc;&#x9762;&#x58f0;&#x660e;&#x7684;pinctrl&#x8bbe;&#x5907;&#x7684;&#x5e8f;&#x53f7;&#xff0c;&#x5bfb;&#x627e;&#x5230;&#x5bf9;&#x5e94;&#x7684;struct samsung_pin_ctrl
    </p>
    <p>
      samsung_pinctrl_drv_data&#x4f1a;&#x6839;&#x636e;samsung_pin_ctrl&#x7ed3;&#x6784;&#x4f53;&#x6765;&#x8fdb;&#x884c;&#x521d;&#x59cb;&#x5316;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1578191823188" ID="ID_172855459" MODIFIED="1578191946428">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      d-&gt;suspend = ctrl-&gt;suspend;
    </p>
    <p>
      d-&gt;resume&#xa0;&#xa0;&#xa0;= ctrl-&gt;resume;
    </p>
    <p>
      d-&gt;nr_banks = ctrl-&gt;nr_banks;
    </p>
    <p>
      d-&gt;pin_banks = devm_kcalloc(&amp;pdev-&gt;dev, d-&gt;nr_banks,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;sizeof(*d-&gt;pin_banks), GFP_KERNEL);
    </p>
    <p>
      &#x5c06;samsung_pin_ctrl&#x5185;&#x90e8;&#x7684;suspend,resumt&#x51fd;&#x6570;&#x590d;&#x5236;&#x7ed9;drv_data,
    </p>
    <p>
      &#x5e76;&#x4e14;&#x6839;&#x636e;pin_banks&#x7684;&#x6570;&#x91cf;&#xff0c;&#x52a8;&#x6001;&#x7533;&#x8bf7;pin_banks&#x6570;&#x7ec4;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1578192003452" ID="ID_591102338" MODIFIED="1578192063626">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#d40e0e">&#x5c06;&#x4e24;&#x79cd;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x5185;&#x90e8;&#x7684;banks&#x6570;&#x7ec4;&#x7684;&#x6307;&#x9488;&#x53d6;&#x51fa;&#x6765;</font></i></b>
    </p>
    <p>
      bank&#xa0;&#xa0;=&#xa0;&#xa0;d-&gt;pin_banks;
    </p>
    <p>
      bdata =&#xa0;&#xa0;ctrl-&gt;pin_banks;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1578192718302" ID="ID_1355312397" MODIFIED="1578192807404">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; ctrl-&gt;nr_banks; ++i, ++bdata, ++bank) {&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;type = bdata-&gt;type;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;pctl_offset = bdata-&gt;pctl_offset;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;nr_pins = bdata-&gt;nr_pins;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;eint_func = bdata-&gt;eint_func;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;eint_type = bdata-&gt;eint_type;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;eint_mask = bdata-&gt;eint_mask;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;eint_offset = bdata-&gt;eint_offset;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;name = bdata-&gt;name;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;spin_lock_init(&amp;bank-&gt;slock);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;drvdata = d;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bank-&gt;pin_base = d-&gt;nr_pins;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;d-&gt;nr_pins += bank-&gt;nr_pins;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      &#x8fdb;&#x5165;for&#x5faa;&#x73af;&#xff0c;&#x521d;&#x59cb;&#x5316;&#x5f53;&#x524d;drv data&#x91cc;&#x9762;&#x7684;pin bank&#x6570;&#x7ec4;
    </p>
    <p>
      &#x6ce8;&#x610f;bank&#x91cc;&#x9762;&#x7684;pin_base&#x662f;&#x524d;&#x9762;&#x7684;bank&#x5f53;&#x4e2d;&#x6240;&#x6709;pin&#x7684;&#x7d2f;&#x8ba1;&#x503c;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1578197945888" FOLDED="true" ID="ID_410724649" MODIFIED="1589521604354">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e0b;&#x9762;&#x8fdb;&#x5165;&#x4e00;&#x4e2a;&#x5faa;&#x73af;&#xff0c;&#x641c;&#x7d22;&#x5f53;&#x524d;pinctrl&#x8bbe;&#x5907;&#x5bf9;&#x5e94;&#x7684;&#x8282;&#x70b9;&#x7684;&#x5b50;&#x8282;&#x70b9;&#xff0c;
    </p>
    <p>
      &#x7528;&#x6765;&#x5904;&#x7406;&#x5b50;&#x8282;&#x70b9;&#x662f;gpio controller&#x7684;&#x60c5;&#x51b5;
    </p>
    <p>
      <b>for_each_child_of_node(node, np)</b>
    </p>
    <p>
      
    </p>
    <p>
      &#x901a;&#x8fc7;&#x53cd;&#x7f16;&#x8bd1;dtbo&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x770b;&#x5230;gpio controller&#x662f;&#x5982;&#x4f55;&#x8fdb;&#x884c;&#x58f0;&#x660e;&#x7684;
    </p>
    <p>
      pinctrl@11400000 {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;compatible = "samsung,exynos4x12-pinctrl";
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;reg = &lt;0x11400000 0x1000&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;interrupts = &lt;0x0 0x2f 0x0&gt;;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpa0 {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gpio-controller;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#gpio-cells = &lt;0x2&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;interrupt-controller;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#interrupt-cells = &lt;0x2&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;};
    </p>
  </body>
</html></richcontent>
<node CREATED="1578198096120" ID="ID_1919865024" MODIFIED="1578198122915">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      of_find_property(np, "gpio-controller", NULL)
    </p>
    <p>
      &#x9996;&#x5148;&#x5bfb;&#x627e;&#x5177;&#x6709;gpio-controller&#x5c5e;&#x6027;&#x7684;&#x5b50;node
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1578198156746" ID="ID_1037914386" MODIFIED="1578198256430">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      bank = d-&gt;pin_banks;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;for (i = 0; i &lt; d-&gt;nr_banks; ++i, ++bank) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (!strcmp(bank-&gt;name, np-&gt;name)) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; <b><i><font color="#d11212">bank-&gt;of_node = np;</font></i></b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;break;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      &#x5728;&#x5f53;&#x524d;pin ctroller&#x91cc;&#x9762;&#x7684;&#x6240;&#x6709;bank&#x5f53;&#x4e2d;&#x5bfb;&#x627e;&#x8ddf;gpio controller&#x5b50;node&#x540d;&#x79f0;
    </p>
    <p>
      &#x4e00;&#x6837;&#x7684;bank,&#x7136;&#x540e;&#x5c06;gpio controller&#x7684;&#x8bbe;&#x5907;&#x6811;&#x8282;&#x70b9;&#x8d4b;&#x503c;&#x7ed9;&#x914d;&#x5bf9;&#x7684;bank
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1578198884746" ID="ID_417059371" MODIFIED="1578198984512">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6700;&#x540e;&#x5904;&#x7406;drv data&#x91cc;&#x9762;&#x7684;pin base
    </p>
    <p>
      
    </p>
    <p>
      d-&gt;pin_base = pin_base;&#xa0;&#xa0;&#x7b2c;&#x4e00;&#x4e2a;drv data&#x7684;pin&#x5e8f;&#x53f7;&#x5f53;&#x7136;&#x662f;0&#x4e86;
    </p>
    <p>
      pin_base += d-&gt;nr_pins;
    </p>
    <p>
      
    </p>
    <p>
      drv data&#x91cc;&#x9762;&#x7684;pin base&#x4ee3;&#x8868;&#x8fd9;&#x8be5;drv data&#x91cc;&#x9762;&#x7684;pin&#x8d77;&#x59cb;&#x5e8f;&#x53f7;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1578149334255" FOLDED="true" ID="ID_1083609677" MODIFIED="1589521614172">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/tiny4412-pinctrl-data.png"/>
  </body>
</html></richcontent>
<node CREATED="1578149375346" ID="ID_1798379573" MODIFIED="1578149392002">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/tiny4412-pinctrl-dts.png"/>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1458444473730" FOLDED="true" ID="ID_1382263222" MODIFIED="1589521621894">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.<b>GPIO subsystem </b>
    </p>
    <p>
      <b>&#x9a71;&#x52a8;gpio controller&#x786c;&#x4ef6;&#x7684;&#x8f6f;&#x4ef6;&#x5b50;&#x7cfb;&#x7edf;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1458447111848" FOLDED="true" ID="ID_922373483" MODIFIED="1589521620812" TEXT="GPIO&#x5b50;&#x7cfb;&#x7edf;&#x7684;&#x6a21;&#x5757;&#x56fe;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1458447141976" ID="ID_1774644299" MODIFIED="1458447257353">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Driver0&#xa0;&#xa0;&#xa0;Driver1&#xa0;&#xa0;&#xa0;Driver2&#xa0;&#xa0;&#xa0;......&#xa0;&#xa0;&#xa0;Drivern
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;GPIO lib---------------&gt;HW abstract layer
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;GPIO controller driver layer
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;|
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;HW&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;layer
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1488207307525" ID="ID_1095119898" MODIFIED="1488207324667" TEXT="ACPI gpio&#x6a21;&#x578b;"/>
<node CREATED="1488207327837" ID="ID_160084636" MODIFIED="1488207344709" TEXT="ARM devicetree gpio"/>
</node>
<node CREATED="1458444544466" ID="ID_1494822762" MODIFIED="1458444579024">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.<b>GPIO interrupt chip driver </b>
    </p>
    <p>
      <b>&#x8fd9;&#x662f;&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x7684;&#x4e00;&#x90e8;&#x5206;</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1493715764749" FOLDED="true" ID="ID_710540631" MODIFIED="1560959546811">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x9ad8;&#x901a;&#x5e73;&#x53f0;&#x5bf9;&#x5916;&#x56f4;&#x8bbe;&#x5907;&#x7684;&#x7ba1;&#x7406;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1493715794275" ID="ID_934446208" MODIFIED="1493716253596">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>BLSP</b>: BAM Low-Speed Peripheral
    </p>
    <p>
      <b>BAM</b>: Bus Access Module
    </p>
    <p>
      <b>QUP</b>: Qualcomm universal Peripheral
    </p>
    <p>
      &#x6bcf;&#x4e2a;BLSP&#x533a;&#x5757;&#x5305;&#x542b;&#x591a;&#x4e2a;QUP&#x548c;UART&#x6838;&#x5fc3;&#xff0c;BAM&#x662f;&#x7528;&#x4e8e;&#x79fb;&#x52a8;&#x5916;&#x56f4;&#x8bbe;&#x5907;
    </p>
    <p>
      &#x5f53;&#x4e2d;&#x7684;&#x6570;&#x636e;&#x7f13;&#x5b58;&#x7684;&#x3002;&#x6bcf;&#x4e2a;&#x5916;&#x56f4;&#x8bbe;&#x5907;&#x90fd;&#x4f1a;&#x8fde;&#x63a5;&#x5230;&#x4e00;&#x5bf9;BAM&#x7684;&#x7ba1;&#x9053;&#x4e0a;&#x9762;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1455869533894" FOLDED="true" ID="ID_1951293954" MODIFIED="1588555144049" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ee0404" size="4"><b>&#x7b2c;&#x4e03;&#x7ae0;&#xff1a;&#x8ba1;&#x65f6;&#x5668;&#xff0c;&#x5ef6;&#x65f6;&#x548c;&#x5ef6;&#x65f6;&#x5de5;&#x4f5c; </b></font>
    </p>
    <p>
      &#x89e3;&#x51b3;&#x8ba1;&#x65f6;&#x7684;&#x95ee;&#x9898;&#x5305;&#x542b;&#x7740;&#x4e0b;&#x9762;&#x7684;&#x4e00;&#x4e9b;&#x4efb;&#x52a1;:
    </p>
    <p>
      1.&#x6d4b;&#x91cf;&#x65f6;&#x95f4;&#x7684;&#x6d41;&#x901d;&#x548c;&#x6bd4;&#x8f83;&#x65f6;&#x95f4;
    </p>
    <p>
      2.&#x77e5;&#x6653;&#x5f53;&#x524d;&#x7684;&#x65f6;&#x95f4;
    </p>
    <p>
      3.&#x5ef6;&#x8fdf;&#x64cd;&#x4f5c;&#x8fbe;&#x6307;&#x5b9a;&#x7684;&#x65f6;&#x95f4;
    </p>
    <p>
      4.&#x5728;&#x968f;&#x540e;&#x7684;&#x65f6;&#x95f4;&#x91cc;&#x8c03;&#x5ea6;&#x5f02;&#x6b65;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<node CREATED="1455874380392" ID="ID_1825272736" MODIFIED="1588055334599">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>1.&#x6d4b;&#x91cf;&#x65f6;&#x95f4;&#x7684;&#x6d41;&#x901d;</b>
    </p>
    <p>
      &#x5185;&#x6838;&#x901a;&#x8fc7;&#x5b9a;&#x65f6;&#x5668;&#x4e2d;&#x65ad;&#x7684;&#x65b9;&#x5f0f;&#x6765;&#x8ddf;&#x8e2a;&#x65f6;&#x95f4;&#x7684;&#x6d41;&#x52a8;&#xff0c;&#x5b9a;&#x65f6;&#x5668;&#x4e2d;&#x65ad;&#x7531;&#x7cfb;&#x7edf;&#x7684;&#x786c;&#x4ef6;&#x6bcf;&#x9694;&#x4e00;&#x5b9a;&#x7684;&#x65f6;&#x95f4;&#x4ea7;&#x751f;&#xff0e;
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x95f4;&#x9694;&#x65f6;&#x95f4;&#x662f;&#x5728;boot&#x9636;&#x6bb5;&#x4ee5;Hz&#x503c;&#x7684;&#x65b9;&#x5f0f;&#x8bbe;&#x5b9a;&#x7684;&#xff0e;
    </p>
    <p>
      &#x6bcf;&#x53d1;&#x751f;&#x4e00;&#x6b21;&#x5b9a;&#x65f6;&#x5668;&#x4e2d;&#x65ad;&#x5185;&#x6838;&#x5185;&#x90e8;&#x7684;64&#x4f4d;&#x7684;&#x8ba1;&#x6570;&#x5668;&#x5c31;&#x4f1a;&#x52a0;1
    </p>
    <p>
      <i><b>&#x8be5;&#x8ba1;&#x6570;&#x5668;&#x53d8;&#x91cf;&#x7684;&#x7c7b;&#x578b;&#x662f;jiffies_64&#xff0c;&#x7136;&#x800c;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x4e2d;&#x901a;&#x5e38;&#x63a5;&#x89e6;&#x7684;&#x662f;jiffies&#x7c7b;&#x578b;&#x7684;&#x53d8;&#x91cf; </b></i>
    </p>
    <p>
      <i><b>&#x4f7f;&#x7528;jiffies&#x662f;&#x56e0;&#x4e3a;&#x5b83;&#x66f4;&#x52a0;&#x5feb;&#x6377;&#xff0c;&#x5e76;&#x4e14;&#x4e0d;&#x662f;&#x5728;&#x6240;&#x6709;&#x7684;&#x5e73;&#x53f0;&#x4e0a;&#x83b7;&#x53d6;jiffies_64&#x90fd;&#x662f;&#x539f;&#x5b50;&#x64cd;&#x4f5c;</b></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1455874965355" ID="ID_1358329263" MODIFIED="1456107806952">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i>&#x4f7f;&#x7528;jiffies&#x8ba1;&#x6570;&#x5668; </i>
    </p>
    <p>
      <i>1. &#x4e0b;&#x9762;&#x662f;&#x6bd4;&#x8f83;&#x65f6;&#x95f4;&#x503c;&#x7684;&#x5b8f;&#x5b9a;&#x4e49;&#xff0c;&#x4e3a;&#x4e86;&#x514d;&#x53bb;&#x56de;&#x7ed5;&#x7684;&#x9ebb;&#x70e6;&#xff0c;&#x4f7f;&#x7528;&#x7cfb;&#x7edf;&#x5b9a;&#x4e49;&#x7684;&#x5b8f;&#x6bd4;&#x8f83;&#x597d; </i>
    </p>
    <p>
      <i>int time_after(unsigned long a, unsigned long b) </i>
    </p>
    <p>
      <i>&#x5f53;a&#x4ee3;&#x8868;&#x7684;&#x65f6;&#x95f4;&#x6bd4;b&#x4ee3;&#x8868;&#x7684;&#x65f6;&#x95f4;&#x8fdc;&#x65f6;&#xff0c;&#x8fd4;&#x56de;1 </i>
    </p>
    <p>
      <i>int time_before(unsigned long a, unsigned long b) </i>
    </p>
    <p>
      <i>int time_after_eq(unsigned long a, unsigned long b) </i>
    </p>
    <p>
      <i>int time_before_eq(unsigned long a, unsigned long b) </i>
    </p>
    <p>
      
    </p>
    <p>
      <i>2. &#x5c06;struct timespec &#x548c;struct timeval&#x5728;jiffies&#x4e4b;&#x95f4;&#x505a;&#x8f6c;&#x6362; </i>
    </p>
    <p>
      <i>unsigned long timespec_to_jiffies(struct timespec *value); </i>
    </p>
    <p>
      <i>void jiffies_to_timespec(unsigned long jiffies, struct timespec *value); </i>
    </p>
    <p>
      <i>unsigned long timeval_to_jiffies(struct timeval *value); </i>
    </p>
    <p>
      <i>void jiffies_to_timeval(unsigned long jiffies, struct timeval *value); </i>
    </p>
    <p>
      
    </p>
    <p>
      <i>3.&#x7528;&#x4e8e;&#x8bfb;&#x53d6;64bit&#x65f6;&#x95f4;&#x8ba1;&#x6570;&#x5668;&#x7684;&#x539f;&#x5b50;&#x65b9;&#x6cd5; </i>
    </p>
    <p>
      <i>#include &lt;linux/jiffies.h&gt; </i>
    </p>
    <p>
      <i><b>u64 get_jiffies_64(void);</b></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1456111150952" ID="ID_1715602663" MODIFIED="1456114508801">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5904;&#x7406;&#x5668;&#x7279;&#x5b9a;&#x7684;&#x5bc4;&#x5b58;&#x5668;TSC(time stamp counter)</b>
    </p>
    <p>
      &#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x4f9d;&#x8d56;&#x4e8e;&#x7279;&#x5b9a;&#x7684;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#xff0c;&#x6709;&#x7684;cpu&#x91cc;&#x9762;&#x53ef;&#x80fd;&#x5c31;&#x6ca1;&#x6709;&#x8be5;&#x5bc4;&#x5b58;&#x5668;&#xff0c;
    </p>
    <p>
      &#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x4f5c;&#x7528;&#x5c31;&#x662f;&#x8ba1;&#x6570;cpu&#x7684;&#x65f6;&#x949f;&#x6570;&#xff0c;&#x53ef;&#x7528;&#x4e8e;&#x7cbe;&#x786e;&#x8ba1;&#x6570;&#xff0e;<br/>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1456113073815" ID="ID_74961794" MODIFIED="1456114489923">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.struct clocksource&#x7ed3;&#x6784;&#x4f53;&#x4ee3;&#x8868;&#x4e86;&#x4e00;&#x4e2a;&#x65f6;&#x949f;&#x8bbe;&#x5907;&#xff0c;&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x7684;
    </p>
    <p>
      &#xa0;&#xa0;read&#x65b9;&#x6cd5;&#x53ef;&#x4ee5;&#x7528;&#x6765;&#x8bfb;&#x53d6;&#x5f53;&#x524d;&#x65f6;&#x949f;&#x4e2d;&#x65ad;&#x7684;&#x8ba1;&#x6570;&#x503c;.
    </p>
    <p>
      &#xa0;&#xa0;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x4e00;&#x5171;&#x6709;&#xff12;&#x79cd;clocksource,&#x4e00;&#x79cd;&#x662f;&#x7cfb;&#x7edf;&#x81ea;&#x5df1;&#x6ce8;&#x518c;&#x7684;clocksource
    </p>
    <p>
      &#xa0;&#xa0;&#x63d0;&#x4f9b;1/HZ&#x7684;&#x7cbe;&#x5ea6;&#xff0c;&#x53e6;&#x4e00;&#x79cd;&#x662f;&#x4f9d;&#x8d56;&#x5177;&#x4f53;&#x7684;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x786c;&#x4ef6;&#x8bbe;&#x8ba1;&#x6ce8;&#x518c;&#x7684;
    </p>
    <p>
      &#xa0;&#xa0;clocksource.
    </p>
    <p>
      &#xa0;&#xa0;&#x5728;clocksource&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x6709;&#x4e00;&#x4e2a;rating&#x6210;&#x5458;&#x53d8;&#x91cf;
    </p>
    <p>
      &#xa0;&#xa0;rating&#x503c;&#x9ad8;&#x7684;clocksource&#x4f1a;&#x88ab;&#x7cfb;&#x7edf;&#x91c7;&#x7528;
    </p>
    <p>
      
    </p>
    <p>
      2.linux&#x5185;&#x6838;&#x7684;&#x5899;&#x4e0a;&#x65f6;&#x949f;struct timespec xtime __attribute__ ((aligned (16)));
    </p>
    <p>
      xtime&#x7684;&#x503c;&#x5728;&#x65f6;&#x949f;&#x4e2d;&#x65ad;&#x91cc;&#x9762;&#x88ab;&#x66f4;&#x65b0;&#xff0c;&#x5373;xtime&#x4f1a;&#x4f9d;&#x8d56;&#x6ce8;&#x518c;&#x7684;clocksource&#x800c;&#x88ab;
    </p>
    <p>
      &#x66f4;&#x65b0;&#xff0c;&#x5177;&#x4f53;&#x4f7f;&#x7528;&#x54ea;&#x4e2a;clocksource&#x4f9d;&#x8d56;&#x4e8e;&#x6211;&#x4eec;&#x7684;&#x6ce8;&#x518c;&#x4e86;&#xff0e;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1456126417397" ID="ID_1349886471" MODIFIED="1588044353453">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x5ef6;&#x65f6;</b></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1456126446598" ID="ID_1906033982" MODIFIED="1456135834640">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x957f;&#x5ef6;&#x65f6;: </b>
    </p>
    <p>
      &#x6709;&#x65f6;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x9700;&#x8981;&#x5ef6;&#x8fdf;&#x8f83;&#x957f;&#x7684;&#x65f6;&#x95f4;&#x6267;&#x884c;&#xff0d;&#x8d85;&#x8fc7;&#x4e00;&#x4e2a;&#x65f6;&#x949f;&#x6ef4;&#x7b54;&#x7684;&#x65f6;&#x95f4;
    </p>
    <p>
      1.&#x91c7;&#x7528;&#x5fd9;&#x7b49;&#x5f85;&#x7684;&#x65b9;&#x6cd5;
    </p>
    <p>
      &#x3000;while (time_before(jiffies, j1))
    </p>
    <p>
      &#x3000;cpu_relax( );
    </p>
    <p>
      &#xa0;cpu_relax()&#x5728;&#x8bb8;&#x591a;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x4ec0;&#x4e48;&#x4e8b;&#x60c5;&#x4e5f;&#x4e0d;&#x505a;&#xff0c;&#x5728;&#x5bf9;&#x79f0;&#x591a;&#x7ebf;&#x7a0b;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x5b83;&#x53ef;&#x80fd;&#x4f1a;&#x653e;&#x5f03;&#x5f53;&#x524d;&#x7684;&#x6838;&#x5fc3;&#xff0c;&#x8fd9;&#x79cd;
    </p>
    <p>
      &#x5ef6;&#x65f6;&#x7684;&#x65b9;&#x6cd5;&#x4e0d;&#x63a8;&#x4ecb;&#x4f7f;&#x7528;&#xff0e;&#x5fd9;&#x7b49;&#x5f85;&#x7684;&#x65b9;&#x6cd5;&#x65e0;&#x8bba;&#x662f;&#x5728;&#x53ef;&#x62a2;&#x5360;&#x5185;&#x6838;&#x8fd8;&#x662f;&#x4e0d;&#x53ef;&#x62a2;&#x5360;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x90fd;&#x4f1a;&#x964d;&#x4f4e;&#x7cfb;&#x7edf;&#x6027;&#x80fd;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x4f60;&#x5728;&#x8fdb;&#x5165;while&#x5faa;&#x73af;&#x4e4b;&#x524d;&#x5173;&#x95ed;&#x4e86;&#x4e2d;&#x65ad;&#x90a3;&#x4e48;&#x8be5;&#x5faa;&#x73af;&#x4f1a;&#x6c38;&#x8fdc;&#x6267;&#x884c;&#x4e0b;&#x53bb;&#xff0c;&#x8fd9;&#x79cd;&#x60c5;&#x51b5;&#x66f4;&#x52a0;&#x7cdf;&#x7cd5;&#xff0e;&#x5728;&#x7cfb;&#x7edf;&#x8d1f;&#x8f7d;&#x6bd4;&#x8f83;
    </p>
    <p>
      &#x91cd;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x5fd9;&#x7b49;&#x5f85;&#x7684;&#x65f6;&#x95f4;&#x751a;&#x81f3;&#x4f1a;&#x8d85;&#x8fc7;&#x4f60;&#x81ea;&#x5df1;&#x8bbe;&#x7f6e;&#x7684;&#x65f6;&#x95f4;&#xff0e;
    </p>
    <p>
      
    </p>
    <p>
      2.&#x91c7;&#x7528;&#x8c03;&#x5ea6;&#x7684;&#x529e;&#x6cd5;
    </p>
    <p>
      &#x3000;while (time_before(jiffies, j1)) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;schedule( );
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;}
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x867d;&#x7136;&#x8c03;&#x7528;&#x4e86;schedule()&#x4f46;&#x662f;&#x8be5;&#x8fdb;&#x7a0b;&#x4ecd;&#x7136;&#x5904;&#x4e8e;running&#x961f;&#x5217;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x3000;&#x800c;&#x4e14;&#x5f53;&#x7cfb;&#x7edf;&#x6bd4;&#x8f83;&#x7e41;&#x5fd9;&#x65f6;&#xff0c;&#x7b49;&#x5f85;&#x7684;&#x65f6;&#x95f4;&#x4f1a;&#x8d85;&#x8fc7;&#x6211;&#x4eec;&#x8bbe;&#x5b9a;&#x7684;&#x503c;&#xff0e;
    </p>
    <p>
      
    </p>
    <p>
      3.&#x8d85;&#x65f6;&#x7684;&#x65b9;&#x6cd5;
    </p>
    <p>
      &#x3000;&#x4e0a;&#x9762;&#x7684;&#x65b9;&#x6cd5;&#x90fd;&#x662f;&#x901a;&#x8fc7;&#x89c2;&#x5bdf;jiffies&#x6765;&#x8ba1;&#x7b97;&#x5ef6;&#x8fdf;&#xff0c;<i><font color="#e30707">&#x4f46;&#x662f;&#x6700;&#x597d;&#x7684;&#x65b9;&#x6cd5;&#x662f;&#x8bf7;&#x5185;&#x6838;&#x5e2e;&#x52a9;&#x4f60;&#x505a;&#x5ef6;&#x65f6;&#x7684;&#x5de5;&#x4f5c;&#xff0e; </font></i>
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x4e0b;&#x9762;&#x7684;&#x65b9;&#x6cd5;&#xff1a;
    </p>
    <p>
      #include &lt;linux/wait.h&gt;
    </p>
    <p>
      long wait_event_timeout(wait_queue_head_t q, condition, long timeout);
    </p>
    <p>
      long wait_event_interruptible_timeout(wait_queue_head_t q,
    </p>
    <p>
      condition, long timeout);&#x3000;&#x7531;&#x4e8e;&#x6211;&#x4eec;&#x9700;&#x8981;&#x7684;&#x662f;delay&#xff0c;&#x6240;&#x4ee5;&#x5e76;&#x6ca1;&#x6709;&#x4eba;&#x4f1a;&#x5524;&#x9192;&#x6211;&#x4eec;&#xff0e;
    </p>
    <p>
      <i>#include &lt;linux/sched.h&gt; </i>
    </p>
    <p>
      <i>set_current_state(TASK_INTERRUPTIBLE)</i>
    </p>
    <p>
      <i>signed long schedule_timeout(signed long timeout);&#x7528;&#x4e8e;&#x5355;&#x7eaf;&#x5730;&#x5ef6;&#x65f6;</i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1456136235439" ID="ID_1630472719" MODIFIED="1456193983357">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x77ed;&#x5ef6;&#x65f6;&#xff1a; </b></i>
    </p>
    <p>
      &#x5f53;&#x9a71;&#x52a8;&#x9700;&#x8981;&#x89e3;&#x51b3;&#x8bbe;&#x5907;&#x7684;&#x5ef6;&#x65f6;&#x95ee;&#x9898;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x6709;&#x5173;&#x7684;&#x5ef6;&#x65f6;&#x6700;&#x591a;&#x4e5f;&#x5c31;&#x51e0;&#x5341;&#x5fae;&#x5999;
    </p>
    <p>
      #include &lt;linux/delay.h&gt;
    </p>
    <p>
      void ndelay(unsigned long nsecs);&#x7eb3;&#x79d2;&#x7ea7;&#x522b;&#x7684;&#x5ef6;&#x65f6;
    </p>
    <p>
      void udelay(unsigned long usecs);&#x5fae;&#x5999;&#x7ea7;&#x522b;&#x7684;&#x5ef6;&#x65f6;
    </p>
    <p>
      void mdelay(unsigned long msecs);&#x6beb;&#x79d2;&#x7ea7;&#x522b;&#x7684;&#x5ef6;&#x65f6;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x51fd;&#x6570;&#x7684;&#x5b9e;&#x73b0;&#x662f;&#x5728;asm/delay.h&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x7684;&#xff0c;udelay&#x51fd;&#x6570;&#x5728;&#x5404;&#x4e2a;&#x67b6;&#x6784;&#x91cc;&#x9762;
    </p>
    <p>
      &#x5fc5;&#x987b;&#x88ab;&#x5b9e;&#x73b0;&#xff0e;&#x8fd9;&#x4e09;&#x4e2a;&#x51fd;&#x6570;&#x5c5e;&#x4e8e;&#x5fd9;&#x7b49;&#x5f85;&#x7684;&#x5b9e;&#x73b0;&#xff0e;
    </p>
    <p>
      
    </p>
    <p>
      void msleep(unsigned int millisecs);
    </p>
    <p>
      unsigned long msleep_interruptible(unsigned int millisecs);
    </p>
    <p>
      void ssleep(unsigned int seconds)
    </p>
    <p>
      &#x8fd9;&#x51e0;&#x4e2a;&#x51fd;&#x6570;&#x53ef;&#x4ee5;&#x5b9e;&#x73b0;&#x8fdb;&#x7a0b;&#x7684;&#x4f11;&#x7720;&#xff0c;&#x53ef;&#x4ee5;&#x5b9e;&#x73b0;&#x6beb;&#x79d2;&#x7ea7;&#x7684;&#x7b49;&#x5f85;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1456194928610" ID="ID_551100703" MODIFIED="1588044309601">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x5185;&#x6838;&#x5b9a;&#x65f6;&#x5668;: </b></i>
    </p>
    <p>
      &#x5185;&#x6838;&#x5b9a;&#x65f6;&#x5668;&#x662f;&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff0c;&#x7528;&#x4e8e;&#x5728;&#x6307;&#x5b9a;&#x7684;&#x65f6;&#x95f4;&#x901a;&#x8fc7;&#x7528;&#x6237;&#x6307;&#x5b9a;&#x7684;&#x51fd;&#x6570;&#x548c;&#x6307;&#x5b9a;&#x7684;
    </p>
    <p>
      &#x53c2;&#x6570;&#x6765;&#x6267;&#x884c;&#x76f8;&#x5173;&#x4efb;&#x52a1;&#xff0e;&#x5185;&#x6838;&#x5b9a;&#x65f6;&#x5668;&#x548c;&#x6ce8;&#x518c;&#x5b83;&#x7684;&#x8fdb;&#x7a0b;&#x662f;<b>&#x5f02;&#x6b65;&#x7684;&#xff0c;</b>&#x5373;&#x5f53;&#x5b9a;&#x65f6;&#x5668;&#x5185;&#x7684;&#x51fd;&#x6570;
    </p>
    <p>
      &#x6267;&#x884c;&#x7684;&#x65f6;&#x5019;&#x5e76;&#x4e0d;&#x662f;&#x5728;&#x6ce8;&#x518c;&#x5b83;&#x7684;&#x8fdb;&#x7a0b;&#x4e0a;&#x4e0b;&#x6587;&#x91cc;&#x9762;&#x6267;&#x884c;&#x7684;&#xff0e;
    </p>
    <p>
      &#x5b9a;&#x65f6;&#x5668;&#x51fd;&#x6570;&#x5b9e;&#x9645;&#x4e0a;&#x662f;&#x4e00;&#x79cd;&#x8f6f;&#x4e2d;&#x65ad;&#x7684;&#x5f62;&#x5f0f;&#xff0c;&#x5b83;&#x5fc5;&#x987b;&#x662f;&#x5728;&#x539f;&#x5b50;&#x4e0a;&#x4e0b;&#x6587;&#x5f53;&#x4e2d;&#x6267;&#x884c;&#x7684;&#xff0e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1456195590826" ID="ID_695455106" MODIFIED="1456196194545">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x5b9a;&#x65f6;&#x5668;&#x51fd;&#x6570;&#x7684;&#x7f16;&#x7a0b;&#x89c4;&#x5219;: </b></i>
    </p>
    <p>
      1.&#x8bbf;&#x95ee;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x662f;&#x4e0d;&#x88ab;&#x5141;&#x8bb8;&#x7684;&#xff0c;&#x56e0;&#x4e3a;&#x6ca1;&#x6709;&#x8fdb;&#x7a0b;&#x4e0a;&#x4e0b;&#x6587;&#xff0c;&#x6240;&#x4ee5;&#x6ca1;&#x6709;&#x8fdb;&#x5165;&#x5230;&#x7528;&#x6237;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#x7a7a;&#x95f4;&#x7684;&#x9053;&#x8def;&#xff0e;
    </p>
    <p>
      2.current&#x6307;&#x9488;&#x6ca1;&#x6709;&#x610f;&#x4e49;
    </p>
    <p>
      3.&#x4e0d;&#x80fd;&#x6267;&#x884c;&#x8c03;&#x5ea6;&#x6216;&#x8005;&#x4f11;&#x7720;&#x7684;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1456196548109" ID="ID_80499259" MODIFIED="1456198017178">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5e2e;&#x52a9;&#x51fd;&#x6570;: </b>
    </p>
    <p>
      in_interrupt( )&#x8be5;&#x51fd;&#x6570;&#x8fd4;&#x56de;&#x975e;&#xff10;&#x5982;&#x679c;&#x5f53;&#x524d;&#x662f;&#x5728;&#x4e2d;&#x65ad;&#x5f53;&#x4e2d;&#x7684;&#x8bdd;
    </p>
    <p>
      in_atomic( )&#x8be5;&#x51fd;&#x6570;&#x8fd4;&#x56de;&#x975e;&#xff10;&#x503c;&#xff0c;&#x5982;&#x679c;&#x5f53;&#x524d;&#x4e0d;&#x5141;&#x8bb8;&#x8fdb;&#x884c;&#x8c03;&#x5ea6;
    </p>
    <p>
      &#x5185;&#x6838;&#x5b9a;&#x65f6;&#x5668;&#x7684;&#x4e00;&#x4e2a;&#x91cd;&#x8981;&#x7684;&#x7279;&#x70b9;&#x5c31;&#x662f;&#x5728;task&#x5f53;&#x4e2d;&#x53ef;&#x4ee5;&#x518d;&#x6b21;&#x8fdb;&#x884c;&#x6ce8;&#x518c;&#xff0c;
    </p>
    <p>
      &#x4ee5;&#x4fbf;&#x5728;&#x672a;&#x6765;&#x7684;&#x67d0;&#x4e2a;&#x65f6;&#x523b;&#x518d;&#x6b21;&#x6267;&#x884c;&#xff0c;&#x8fd9;&#x4e2a;&#x7279;&#x70b9;&#x5f88;&#x6709;&#x7528;&#xff0c;&#x6bd4;&#x5982;&#x5728;<br/>&#x8bbe;&#x5907;&#x7684;poll&#x8c03;&#x7528;&#x5f53;&#x4e2d;&#xff0e;&#x5728;SMP&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#xff0c;&#x8fd0;&#x884c;&#x5b9a;&#x65f6;&#x5668;&#x51fd;&#x6570;&#x7684;cpu&#x4e5f;&#x662f;
    </p>
    <p>
      &#x6ce8;&#x518c;&#x8be5;&#x5b9a;&#x65f6;&#x5668;&#x7684;cpu&#xff0e;<br/>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1456198327014" ID="ID_436199294" MODIFIED="1456198369165">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9700;&#x8981;&#x6ce8;&#x610f;&#x7684;&#x662f;&#x5b9a;&#x65f6;&#x5668;&#x51fd;&#x6570;&#x5f80;&#x5f80;&#x662f;&#x7ade;&#x4e89;&#x7684;&#x6e90;&#x5934;&#xff0c;&#x6240;&#x4ee5;&#x5728;<br/>&#x5b9a;&#x65f6;&#x5668;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x4f7f;&#x7528;&#x539f;&#x5b50;&#x53d8;&#x91cf;&#x548c;&#x81ea;&#x65cb;&#x9501;&#xff0e;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1456204611769" ID="ID_1297645966" MODIFIED="1456205098614">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>&#x5b9a;&#x65f6;&#x5668;API:</b></i>
    </p>
    <p>
      #include &lt;linux/timer.h&gt;
    </p>
    <p>
      struct timer_list {
    </p>
    <p>
      /* ... */
    </p>
    <p>
      unsigned long expires;
    </p>
    <p>
      void (*function)(unsigned long);
    </p>
    <p>
      unsigned long data;
    </p>
    <p>
      };
    </p>
    <p>
      void init_timer(struct timer_list *timer);
    </p>
    <p>
      struct timer_list TIMER_INITIALIZER(_function, _expires, _data);
    </p>
    <p>
      void add_timer(struct timer_list * timer);
    </p>
    <p>
      int del_timer(struct timer_list * timer);
    </p>
    <p>
      
    </p>
    <p>
      int mod_timer(struct timer_list *timer, unsigned long expires)&#x66f4;&#x65b0;&#x5b9a;&#x65f6;&#x5668;&#x7684;expires
    </p>
    <p>
      int del_timer_sync(struct timer_list *timer)&#x8ddf;del_timer&#x7684;&#x51fd;&#x6570;&#x4e00;&#x6837;&#xff0c;&#x4f46;&#x662f;&#x53ef;&#x4ee5;&#x7528;&#x4e8e;smp&#x7cfb;&#x7edf;
    </p>
    <p>
      int timer_pending(const struct timer_list * timer)&#x8fd4;&#x56de;&#x503c;&#x8868;&#x660e;&#x5b9a;&#x65f6;&#x5668;&#x662f;&#x5426;&#x5df2;&#x7ecf;&#x88ab;&#x8c03;&#x5ea6;&#x6267;&#x884c;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1457923936486" ID="ID_1033231398" MODIFIED="1588044362253">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Tasklets </b>
    </p>
    <p>
      &#x5728;&#x8f6f;&#x4e2d;&#x65ad;&#x5f53;&#x4e2d;&#x6267;&#x884c;&#xff0c;&#x7ecf;&#x5e38;&#x88ab;&#x7528;&#x5728;&#x786c;&#x4ef6;&#x4e2d;&#x65ad;&#x4e2d;&#xff0c;&#x901a;&#x8fc7;&#x6ce8;&#x518c;
    </p>
    <p>
      tasklets&#x6765;&#x5728;&#x540e;&#x9762;&#x9002;&#x5f53;&#x7684;&#x8f6f;&#x4e2d;&#x65ad;&#x4e2d;&#x5904;&#x7406;&#x6570;&#x636e;&#x76f8;&#x5173;&#x7684;&#x4e1c;&#x897f;
    </p>
  </body>
</html></richcontent>
<node CREATED="1457924166804" ID="ID_939541267" MODIFIED="1457924213969">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5148;&#x521d;&#x59cb;&#x5316;tasklets&#x6570;&#x636e;&#x7ed3;&#x6784;
    </p>
    <p>
      <i>void tasklet_init(struct tasklet_struct *t, </i>
    </p>
    <p>
      <i>void (*func)(unsigned long), unsigned long data); </i>
    </p>
    <p>
      <i>DECLARE_TASKLET(name, func, data); </i>
    </p>
    <p>
      <i>DECLARE_TASKLET_DISABLED(name, func, data);</i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457924228305" ID="ID_792232811" MODIFIED="1457926862848">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.tasklets&#x5177;&#x6709;&#x7684;&#x4e00;&#x4e9b;&#x7279;&#x70b9;</b>
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x88ab;enable&#x548c;disable&#x591a;&#x6b21;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x6ce8;&#x518c;&#x4ed6;&#x81ea;&#x5df1;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x4ee5;&#x5e73;&#x5e38;&#x7684;&#x6216;&#x8005;&#x662f;&#x9ad8;&#x7684;&#x4f18;&#x5148;&#x7ea7;&#x6765;&#x6267;&#x884c;
    </p>
    <p>
      &#x5982;&#x679c;&#x7cfb;&#x7edf;&#x8d1f;&#x8f7d;&#x4e0d;&#x91cd;&#x7684;&#x8bdd;&#xff0c;tasklet&#x53ef;&#x4ee5;&#x88ab;&#x7acb;&#x5373;&#x6267;&#x884c;&#xff0c;&#x4f46;&#x6700;&#x665a;&#x4e0d;&#x4f1a;&#x5728;&#x4e0b;&#x4e00;&#x4e2a;ticket&#x6765;&#x4e34;&#x4e4b;&#x524d;
    </p>
    <p>
      tasklets&#x53ef;&#x4ee5;&#x5e76;&#x53d1;&#x6267;&#x884c;&#xff0c;&#x4f46;&#x662f;&#x76f8;&#x540c;&#x7684;tasklet&#x4e0d;&#x4f1a;&#x5728;&#x591a;&#x4e2a;cpu&#x4e0a;&#x540c;&#x65f6;&#x6267;&#x884c;
    </p>
    <p>
      <i><b>&#x5185;&#x6838;&#x63d0;&#x4f9b;&#x4e86;ksoftirqd&#x5185;&#x6838;&#x7ebf;&#x7a0b;&#xff0c;&#x6bcf;&#x4e2a;CPU&#x4e00;&#x4e2a;&#x8fd9;&#x6837;&#x7684;&#x7ebf;&#x7a0b;&#xff0c;&#x8be5;&#x7ebf;&#x7a0b;&#x8d1f;&#x8d23;&#x5728;&#x7cfb;&#x7edf;&#x7a7a;&#x95f2;&#x7684; </b></i>
    </p>
    <p>
      <i><b>&#x65f6;&#x5019;&#x6267;&#x884c;&#x8f6f;&#x4e2d;&#x65ad;</b></i><b>&#xff0e;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457934111049" ID="ID_435234553" MODIFIED="1457934196295">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x63a5;&#x53e3;&#x51fd;&#x6570;
    </p>
    <p>
      <i>void tasklet_disable(struct tasklet_struct *t) </i>
    </p>
    <p>
      <i>void tasklet_disable_nosync(struct tasklet_struct *t) </i>
    </p>
    <p>
      <i>void tasklet_enable(struct tasklet_struct *t) </i>
    </p>
    <p>
      <i>void tasklet_schedule(struct tasklet_struct *t) </i>
    </p>
    <p>
      <i>void tasklet_hi_schedule(struct tasklet_struct *t) </i>
    </p>
    <p>
      <i>void tasklet_kill(struct tasklet_struct *t)</i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1457936506692" ID="ID_591379314" MODIFIED="1588044332465">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Workqueues
    </p>
    <p>
      workqueues&#x662f;&#x7531;&#x7cfb;&#x7edf;&#x7684;&#x67d0;&#x4e2a;&#x8fdb;&#x7a0b;&#x6765;&#x8d1f;&#x8d23;&#x6267;&#x884c;&#x7684;&#xff0c;&#x4e0d;&#x50cf;tasklets
    </p>
    <p>
      &#x6267;&#x884c;workqueues&#x7684;&#x65f6;&#x5019;&#x7cfb;&#x7edf;&#x53ef;&#x4ee5;&#x8fdb;&#x884c;&#x4f11;&#x7720;&#xff0c;&#x4f46;&#x662f;workqueues
    </p>
    <p>
      &#x7684;&#x5ef6;&#x65f6;&#x53ef;&#x80fd;&#x6bd4;tasklets&#x7684;&#x5927;&#xff0e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1457938414416" ID="ID_1342819077" MODIFIED="1457938490187">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5185;&#x6838;&#x91cc;&#x9762;&#x7ef4;&#x62a4;&#x4e86;&#x81ea;&#x5df1;&#x7684;&#x5168;&#x5c40;&#x5de5;&#x4f5c;&#x961f;&#x5217;static struct workqueue_struct *keventd_wq
    </p>
    <p>
      &#x5f53;&#x7136;&#x6211;&#x4eec;&#x4e5f;&#x53ef;&#x4ee5;&#x81ea;&#x5df1;&#x521b;&#x5efa;&#x81ea;&#x5df1;&#x7684;&#x5de5;&#x4f5c;&#x961f;&#x5217;
    </p>
    <p>
      struct workqueue_struct *create_workqueue(const char *name);
    </p>
    <p>
      struct workqueue_struct *create_singlethread_workqueue(const char *name);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457938594535" ID="ID_209195314" MODIFIED="1457939486532">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.
    </p>
    <p>
      &#x9759;&#x6001;&#x58f0;&#x660e;work_struct
    </p>
    <p>
      DECLARE_WORK(name, void (*function)(void *), void *data)
    </p>
    <p>
      &#x52a8;&#x6001;&#x5206;&#x914d;work_struct
    </p>
    <p>
      INIT_WORK(struct work_struct *work, void (*function)(void *), void *data);
    </p>
    <p>
      &#x4f1a;&#x521d;&#x59cb;&#x5316;&#x6389;work&#x94fe;&#x63a5;&#x5230;workqueue&#x7684;&#x6307;&#x9488;
    </p>
    <p>
      PREPARE_WORK(struct work_struct *work, void (*function)(void *), void *data);
    </p>
    <p>
      &#x4e0d;&#x4f1a;&#x521d;&#x59cb;&#x5316;work&#x94fe;&#x63a5;&#x5230;workqueue&#x7684;&#x6307;&#x9488;&#xff0c;&#x56e0;&#x800c;&#x5728;work&#x52a0;&#x5165;&#x5230;workqueue&#x4e4b;&#x540e;
    </p>
    <p>
      &#x8fd8;&#x80fd;&#x591f;&#x5bf9;work&#x8fdb;&#x884c;&#x4e00;&#x5b9a;&#x7a0b;&#x5ea6;&#x7684;&#x4fee;&#x6539;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457939506561" ID="ID_1720605126" MODIFIED="1457939536328">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x63d0;&#x4ea4;&#x5de5;&#x4f5c;&#x5230;&#x5de5;&#x4f5c;&#x961f;&#x5217;&#x91cc;&#x9762;
    </p>
    <p>
      <i>int queue_work(struct workqueue_struct *queue, struct work_struct *work); </i>
    </p>
    <p>
      <i>int queue_delayed_work(struct workqueue_struct *queue, </i>
    </p>
    <p>
      <i>struct work_struct *work, unsigned long delay);</i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1468229217652" FOLDED="true" ID="ID_572194135" MODIFIED="1576373047657" POSITION="left" TEXT="Kbuild&#x7cfb;&#x7edf;&#x5b66;&#x4e60;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1468229234101" FOLDED="true" ID="ID_999465662" MODIFIED="1544867563417">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Linux&#x5185;&#x6838;makefile&#x6587;&#x4ef6;&#x5206;&#x7c7b;
    </p>
  </body>
</html></richcontent>
<node CREATED="1468229365699" ID="ID_235898352" MODIFIED="1468232043614">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.kernel makefile
    </p>
    <p>
      &#x4f4d;&#x4e8e;&#x6e90;&#x4ee3;&#x7801;&#x7684;&#x9876;&#x5c42;&#x76ee;&#x5f55;&#x5f53;&#x4e2d;&#xff0c;&#x7f16;&#x8bd1;&#x5185;&#x6838;&#x6216;&#x8005;&#x662f;&#x6a21;&#x5757;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x6587;&#x4ef6;&#x9996;&#x5148;&#x4f1a;&#x88ab;&#x8bfb;&#x53d6;&#xff0c;&#x6839;&#x636e;&#x8bfb;&#x53d6;&#x5230;&#x7684;&#x5185;&#x5bb9;&#x914d;&#x7f6e;&#x7f16;&#x8bd1;
    </p>
    <p>
      &#x5f00;&#x53d1;&#x73af;&#x5883;&#xff0c;&#x5185;&#x6838;&#x6216;&#x8005;&#x662f;&#x9a71;&#x52a8;&#x5f00;&#x53d1;&#x4eba;&#x5458;&#x4e0d;&#x9700;&#x8981;&#x4fee;&#x6539;&#x8be5;&#x6587;&#x4ef6;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468229547716" FOLDED="true" ID="ID_279059387" MODIFIED="1544867561929">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.Kbuild makefile
    </p>
    <p>
      kbuild&#x7cfb;&#x7edf;&#x4f7f;&#x7528;kbuild makefile&#x6765;&#x7f16;&#x8bd1;&#x6587;&#x4ef6;&#xff0c;&#x6307;&#x5b9a;&#x4e86;&#x9700;&#x8981;&#x7f16;&#x8bd1;&#x90a3;&#x4e9b;&#x6a21;&#x5757;&#x8fdb;&#x5165;
    </p>
    <p>
      &#x5185;&#x6838;&#x5f53;&#x4e2d;&#xff0c;&#x6e90;&#x6587;&#x4ef6;&#x7684;&#x4f4d;&#x7f6e;&#x3002;&#x9a71;&#x52a8;&#x548c;&#x5185;&#x6838;&#x5f00;&#x53d1;&#x4eba;&#x5458;&#x9700;&#x8981;&#x4fee;&#x6539;&#x8be5;&#x6587;&#x4ef6;&#x3002;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1468230408214" ID="ID_1607031889" MODIFIED="1468231999734">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      kbuild makefile&#x6700;&#x91cd;&#x8981;&#x7684;&#x529f;&#x80fd;&#x5c31;&#x662f;&#x6307;&#x5b9a;&#x9700;&#x8981;&#x7f16;&#x8bd1;&#x54ea;&#x4e9b;&#x6587;&#x4ef6;
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x901a;&#x8fc7;&#x4e0b;&#x9762;&#x4e24;&#x4e2a;&#x5bf9;&#x8c61;&#x6765;&#x6307;&#x5b9a;:
    </p>
    <p>
      obj-?&#x548c; xxx-objs &#x6765;&#x6307;&#x5b9a;
    </p>
    <p>
      obj-?=$(target).o
    </p>
    <p>
      target&#x4e3a;&#x7f16;&#x8bd1;&#x5bf9;&#x8c61;&#x7684;&#x540d;&#x5b57;&#xff0c;&#x5982;&#x679c;&#x6ca1;&#x6709;&#x6307;&#x5b9a;xxx-obj&#x5219;&#x5bf9;&#x5e94;&#x9700;&#x8981;
    </p>
    <p>
      &#x7f16;&#x8bd1;&#x7684;&#x6e90;&#x6587;&#x4ef6;&#x5c31;&#x662f;$(target).c&#x6216;&#x8005;&#x662f;$(target).s
    </p>
    <p>
      &#x5982;&#x679c;&#x6307;&#x5b9a;&#x4e86;$(target)-objs,&#x5219;&#x7f16;&#x8bd1;&#x7684;&#x6587;&#x4ef6;&#x7531;$(target)-objs
    </p>
    <p>
      &#x6307;&#x5b9a;&#xff0c;&#x5e76;&#x4e14;&#x4e0d;&#x80fd;&#x6709;$(target).c&#x6216;&#x8005;$(target).s&#x6587;&#x4ef6;&#x5b58;&#x5728;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468229986900" ID="ID_1488774037" MODIFIED="1468230166169">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.ARCH Makefile
    </p>
    <p>
      &#x4f4d;&#x4e8e;arch/$(ARCH)/makefile,kernel top makefile
    </p>
    <p>
      &#x4f1a;&#x5305;&#x542b;&#x8be5;&#x6587;&#x4ef6;&#x6307;&#x5b9a;&#x5e73;&#x53f0;&#x76f8;&#x5173;&#x7684;&#x4fe1;&#x606f;&#x3002;&#x5e73;&#x53f0;&#x76f8;&#x5173;&#x5f00;&#x53d1;&#x7684;
    </p>
    <p>
      &#x4eba;&#x5458;&#x4f1a;&#x4fee;&#x6539;&#x8be5;&#x6587;&#x4ef6;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468249463723" FOLDED="true" ID="ID_1791617227" MODIFIED="1544867560521">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7cfb;&#x7edf;&#x5b8c;&#x6210;&#x7f16;&#x8bd1;&#x4e4b;&#x540e;&#x8f93;&#x51fa;&#x7684;
    </p>
    <p>
      &#x6587;&#x4ef6;&#x7684;&#x4f5c;&#x7528;&#x89e3;&#x6790;
    </p>
  </body>
</html></richcontent>
<node CREATED="1468249534826" ID="ID_1506903968" MODIFIED="1468249625123">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      module.order&#x6587;&#x4ef6;
    </p>
    <p>
      &#x8be5;&#x6587;&#x4ef6;&#x8bb0;&#x5f55;&#x4e86;&#x5728;Makefile&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x51fa;&#x73b0;&#x7684;&#x6a21;&#x5757;
    </p>
    <p>
      modprobe&#x547d;&#x4ee4;&#x53ef;&#x4ee5;&#x6839;&#x636e;&#x8be5;&#x6587;&#x4ef6;&#x6765;&#x89e3;&#x51b3;&#x5339;&#x914d;&#x591a;&#x4e2a;&#x6a21;&#x5757;&#x7684;
    </p>
    <p>
      &#x91cd;&#x547d;&#x540d;&#x95ee;&#x9898;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468249632098" ID="ID_573761193" MODIFIED="1468249743867">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      modules.builtin
    </p>
    <p>
      &#x8be5;&#x6587;&#x4ef6;&#x5217;&#x4e3e;&#x51fa;&#x4e86;&#x6240;&#x6709;&#x7684;&#x7f16;&#x8bd1;&#x8fdb;&#x5165;&#x5185;&#x6838;&#x7684;&#x6a21;&#x5757;&#xff0c;
    </p>
    <p>
      modprobe&#x6587;&#x4ef6;&#x4f7f;&#x7528;&#x5b83;&#x6765;&#x4fdd;&#x8bc1;&#x52a0;&#x8f7d;&#x5185;&#x5d4c;&#x7684;&#x6a21;&#x5757;&#x7684;
    </p>
    <p>
      &#x65f6;&#x5019;&#x4e0d;&#x4f1a;&#x5931;&#x8d25;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468249761361" FOLDED="true" ID="ID_37184477" MODIFIED="1491269981734" TEXT="&#x8ddf;&#x7f16;&#x8bd1;&#x7cfb;&#x7edf;&#x76f8;&#x5173;&#x7684;&#x73af;&#x5883;&#x53d8;&#x91cf;">
<node CREATED="1468250159742" ID="ID_526143328" MODIFIED="1468250168887" TEXT="KCPPFLAGS&#x7528;&#x4e8e;&#x9884;&#x5904;&#x7406;&#x7684;&#x9009;&#x9879;"/>
<node CREATED="1468250232533" ID="ID_496396200" MODIFIED="1468250255865">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KAFLAGS&#x7ed9;&#x6c47;&#x7f16;&#x5668;&#x7684;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468250323773" ID="ID_1036893408" MODIFIED="1491198706626" TEXT="&#x7ed9;$(AS)&#x4f7f;&#x7528;&#x7684;&#x73af;&#x5883;&#x53d8;&#x91cf;">
<node CREATED="1468250343380" ID="ID_1283940558" MODIFIED="1468250372915">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      AFLAGS_MODULE
    </p>
    <p>
      &#x7ed9;&#x6a21;&#x5757;&#x4f7f;&#x7528;&#x7684;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468250376012" ID="ID_943866007" MODIFIED="1468250422278">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      AFLAGS_KERNEL
    </p>
    <p>
      &#x7ed9;&#x5185;&#x5d4c;&#x5230;&#x5185;&#x6838;&#x7684;&#x4ee3;&#x7801;&#x7684;&#x7f16;&#x8bd1;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468250852721" ID="ID_1184336307" MODIFIED="1468250867365" TEXT="KCFLAGS&#x8ddf;c&#x7f16;&#x8bd1;&#x5668;&#x76f8;&#x5173;&#x7684;&#x53ef;&#x9009;&#x9879;"/>
<node CREATED="1468250978256" ID="ID_1596889748" MODIFIED="1491198721544" TEXT="&#x8ddf;$(CC)&#x6709;&#x5173;&#x7684;&#x73af;&#x5883;&#x53d8;&#x91cf;">
<node CREATED="1468251018807" ID="ID_1582604069" MODIFIED="1468251034363" TEXT="CFLAGS_KERNEL&#x7f16;&#x8bd1;&#x5d4c;&#x5165;&#x5230;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;&#x4ee3;&#x7801;"/>
<node CREATED="1468251050519" ID="ID_727515669" MODIFIED="1468251061649" TEXT="CFLAGS_MODULE&#x8ddf;&#x7f16;&#x8bd1;&#x6a21;&#x5757;&#x76f8;&#x5173;&#x7684;&#x53ef;&#x9009;&#x9879;"/>
</node>
<node CREATED="1468251096696" ID="ID_1178370193" MODIFIED="1468251133974">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      LDFLAGS_MODULE
    </p>
    <p>
      &#x5728;&#x94fe;&#x63a5;&#x6a21;&#x5757;&#x7684;&#x65f6;&#x5019;&#x8ddf;$(LD)&#x76f8;&#x5173;&#x7684;
    </p>
    <p>
      &#x53ef;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468251163502" ID="ID_1728487361" MODIFIED="1468251310191">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      LDFLAGS_vmlinux
    </p>
    <p>
      &#x5728;vmlinux&#x5b8c;&#x6210;&#x6700;&#x540e;&#x4e00;&#x6b65;&#x7684;&#x94fe;&#x63a5;&#x65f6;
    </p>
    <p>
      &#x4f20;&#x9012;&#x8fdb;&#x53bb;&#x7684;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468287252332" ID="ID_1050194300" MODIFIED="1468287266727" TEXT="KBUILD_DEBARCH&#x7528;&#x4e8e;debian&#x7cfb;&#x7edf;&#xff0c;&#x6307;&#x5b9a;&#x5f53;&#x524d;&#x7684;&#x7cfb;&#x7edf;&#x67b6;&#x6784;"/>
<node CREATED="1468287281800" ID="ID_362930055" MODIFIED="1468287289967" TEXT="ARCH&#x6307;&#x5b9a;&#x7f16;&#x8bd1;&#x7684;&#x8ba1;&#x7b97;&#x673a;&#x67b6;&#x6784;"/>
<node CREATED="1468287358705" ID="ID_1218971233" MODIFIED="1468287371783" TEXT="CROSS_COMPILE&#x6307;&#x5b9a;binutils&#x7684;&#x53ef;&#x9009;&#x540d;&#x79f0;&#x7684;&#x56fa;&#x5b9a;&#x90e8;&#x5206;"/>
<node CREATED="1468287421016" ID="ID_647386158" MODIFIED="1468287434623" TEXT="INSTALLKERNEL&#x6307;&#x5b9a;&#x5b89;&#x88c5;&#x5185;&#x6838;&#x955c;&#x50cf;&#x7684;&#x811a;&#x672c;"/>
<node CREATED="1468287533694" ID="ID_1112455509" MODIFIED="1468287572929">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      MODLIB
    </p>
    <p>
      &#x6307;&#x5b9a;&#x5b89;&#x88c5;&#x6a21;&#x5757;&#x7684;&#x4f4d;&#x7f6e;&#xff0c;&#x9ed8;&#x8ba4;&#x7684;&#x4f4d;&#x7f6e;&#x662f;
    </p>
    <p>
      $(INSTALL_MOD_PATH)/lib/modules/$(KERNELRELEASE)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468287626481" ID="ID_1199625776" MODIFIED="1468287700747">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      INSTALL_MOD_STRIP
    </p>
    <p>
      &#x5982;&#x679c;&#x5b9a;&#x4e49;&#x4e86;&#x8be5;&#x9009;&#x9879;&#xff0c;&#x90a3;&#x4e48;&#x5b89;&#x88c5;&#x5b8c;&#x6bd5;&#x6a21;&#x5757;&#x4e4b;&#x540e;&#x5c31;&#x4f1a;
    </p>
    <p>
      &#x8c03;&#x7528;strip&#x547d;&#x4ee4;&#x5904;&#x7406;&#x8be5;&#x6a21;&#x5757;
    </p>
    <p>
      &#x8be5;&#x53d8;&#x91cf;&#x662f;&#x4f5c;&#x4e3a;strip&#x547d;&#x4ee4;&#x7684;&#x53ef;&#x9009;&#x9879;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468287780304" ID="ID_445098742" MODIFIED="1468287812899">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      INSTALL_FW_PATH
    </p>
    <p>
      &#x6307;&#x5b9a;&#x5b89;&#x88c5;&#x56fa;&#x4ef6;&#x7684;&#x4f4d;&#x7f6e;&#xff0c;&#x9ed8;&#x8ba4;&#x7684;&#x4f4d;&#x7f6e;&#x662f;
    </p>
    <p>
      $(INSTALL_MOD_PATH)/lib/firmware
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468287858953" ID="ID_804078487" MODIFIED="1468287938838">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      INSTALL_HDR_PATH
    </p>
    <p>
      &#x7528;&#x4e8e;&#x6307;&#x5b9a;&#x5f53;&#x8fd0;&#x884c; "make headers_*"&#x5b89;&#x88c5;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x5934;&#x6587;&#x4ef6;&#x7684;&#x4f4d;&#x7f6e;
    </p>
    <p>
      &#x9ed8;&#x8ba4;&#x7684;&#x4f4d;&#x7f6e;&#x662f;$(objtree)/usr
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468288115320" ID="ID_1357607365" MODIFIED="1468288167006">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_MODPOST_WARN
    </p>
    <p>
      &#x5bf9;&#x4e8e;&#x5728;&#x6a21;&#x5757;&#x94fe;&#x63a5;&#x7684;&#x6700;&#x540e;&#x9636;&#x6bb5;&#xff0c;&#x8be5;&#x9009;&#x9879;&#x5c06;
    </p>
    <p>
      &#x672a;&#x5b9a;&#x4e49;&#x7684;&#x7b26;&#x53f7;&#x7684;&#x9519;&#x8bef;&#x6539;&#x6210;&#x8b66;&#x544a;&#x63d0;&#x9192;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468288223640" ID="ID_113898251" MODIFIED="1468288263812">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_MODPOST_NOFINAL
    </p>
    <p>
      &#x8be5;&#x9009;&#x9879;&#x7528;&#x4e8e;&#x8df3;&#x8fc7;&#x6a21;&#x5757;&#x6700;&#x540e;&#x7684;&#x94fe;&#x63a5;&#x7684;&#x9636;&#x6bb5;
    </p>
    <p>
      &#x8be5;&#x9009;&#x9879;&#x4ec5;&#x4ec5;&#x662f;&#x7528;&#x4e8e;&#x7f16;&#x8bd1;&#x7684;&#x6d4b;&#x8bd5;&#x7684;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468288469768" ID="ID_1090767586" MODIFIED="1468288552285">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_ENABLE_EXTRA_GCC_CHECKS
    </p>
    <p>
      &#x5982;&#x679c;&#x5728;make&#x547d;&#x4ee4;&#x542f;&#x52a8;"W=1"&#x7684;&#x9009;&#x9879;&#x7684;&#x65f6;&#x5019;
    </p>
    <p>
      &#x5f00;&#x542f;&#x8be5;&#x9009;&#x9879;&#xff0c;&#x5219;&#x4f1a;&#x8ba9;gcc&#x8fdb;&#x884c;&#x66f4;&#x52a0;&#x4e25;&#x683c;&#x7684;&#x7f16;&#x8bd1;
    </p>
    <p>
      &#x68c0;&#x67e5;gcc -W...
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468288669704" ID="ID_371100232" MODIFIED="1468288736128">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_BUILD_USER, KBUILD_BUILD_HOST
    </p>
    <p>
      &#x7528;&#x4e8e;&#x8986;&#x76d6;&#x5728;boot&#x9636;&#x6bb5;&#x5728;&#x7ec8;&#x7aef;&#x754c;&#x9762;&#x4e0a;&#x663e;&#x793a;&#x7684;user@host,
    </p>
    <p>
      &#x4ee5;&#x53ca;&#x5728;/proc/version&#x4e2d;&#x663e;&#x793a;&#x7684;user@host
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468288785520" ID="ID_757742801" MODIFIED="1468288829382">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_VMLINUX_INIT
    </p>
    <p>
      &#x6307;&#x5b9a;vmlinux&#x7684;init&#x90e8;&#x5206;&#x7684;&#x6240;&#x6709;&#x7684;&#x76ee;&#x6807;&#x6587;&#x4ef6;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x6307;&#x5b9a;&#x7684;&#x76ee;&#x6807;&#x6587;&#x4ef6;&#x5c06;&#x4f1a;&#x88ab;&#x4f18;&#x5148;&#x94fe;&#x63a5;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468288859904" ID="ID_449889598" MODIFIED="1468288894761">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_VMLINUX_MAIN
    </p>
    <p>
      &#x7528;&#x4e8e;&#x6307;&#x5b9a;vmlinux&#x7684;&#x4e3b;&#x4f53;&#x90e8;&#x5206;&#x7684;&#x76ee;&#x6807;&#x6587;&#x4ef6;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468290646801" FOLDED="true" ID="ID_111318205" MODIFIED="1544867559265" TEXT="&#x5185;&#x6838;makefile">
<node CREATED="1468290662337" FOLDED="true" ID="ID_1324818214" MODIFIED="1544867558016">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.makefile&#x62e5;&#x6709;&#x4e94;&#x4e2a;&#x90e8;&#x5206;
    </p>
    <p>
      Makefile &#x9876;&#x5c42;&#x7684;makefile
    </p>
    <p>
      .config &#x5185;&#x6838;&#x7684;&#x914d;&#x7f6e;&#x6587;&#x4ef6;
    </p>
    <p>
      arch/$(ARCH)/Makefile arch&#x76f8;&#x5173;&#x7684;&#x6587;&#x4ef6;
    </p>
    <p>
      scripts/Makefile.* &#x4e00;&#x4e9b;&#x63d0;&#x524d;&#x5b9a;&#x4e49;&#x597d;&#x7684;rule&#x6587;&#x4ef6;
    </p>
    <p>
      kbuild Makefiles&#xa0;&#xa0;&#xa0;&#x5927;&#x6982;&#x6709;500&#x4e2a;&#x5de6;&#x53f3;&#x7684;&#x8fd9;&#x6837;&#x6587;&#x4ef6;
    </p>
  </body>
</html></richcontent>
<node CREATED="1468290916202" ID="ID_578477515" MODIFIED="1468293599110">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x9876;&#x5c42;&#x7684;Makefile&#x4f1a;&#x8bfb;&#x53d6;&#x5185;&#x6838;&#x914d;&#x7f6e;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x4ea7;&#x751f;&#x7684;.config&#x6587;&#x4ef6;&#xff0c;&#x9876;&#x5c42;&#x7684;Makefile&#x6587;&#x4ef6;&#x8d1f;&#x8d23;&#x7f16;&#x8bd1;&#x4e24;&#x4e2a;&#x4e3b;&#x8981;
    </p>
    <p>
      &#x7684;&#x90e8;&#x5206;:vmlinux&#x548c;module
    </p>
    <p>
      &#x5b83;&#x901a;&#x8fc7;&#x9012;&#x5f52;&#x626b;&#x63cf;&#x5b50;&#x76ee;&#x5f55;&#x6765;&#x7f16;&#x8bd1;&#x3002;
    </p>
    <p>
      &#x8bbf;&#x95ee;&#x5b50;&#x76ee;&#x5f55;&#x7684;&#x5217;&#x8868;&#x662f;&#x901a;&#x8fc7;&#x914d;&#x7f6e;&#x5f97;&#x5230;&#x7684;&#xff0c;$(ARCH)&#x76ee;&#x5f55;&#x8d1f;&#x8d23;&#x63d0;&#x4f9b;
    </p>
    <p>
      &#x8ddf;&#x5177;&#x4f53;&#x7684;&#x67b6;&#x6784;&#x76f8;&#x5173;&#x7684;&#x4fe1;&#x606f;&#x7ed9;&#x9876;&#x5c42;&#x7684;&#x76ee;&#x5f55;
    </p>
    <p>
      2.&#x6bcf;&#x4e2a;&#x5b50;&#x76ee;&#x5f55;&#x91cc;&#x9762;&#x90fd;&#x6709;kbuild makefile,&#x5b83;&#x63a5;&#x6536;&#x6765;&#x81ea;&#x4e0a;&#x5c42;&#x7684;&#x547d;&#x4ee4;&#x3002;
    </p>
    <p>
      &#x540c;&#x65f6;kbuild&#x5229;&#x7528;.config&#x91cc;&#x9762;&#x7684;&#x4fe1;&#x606f;&#x6765;&#x6784;&#x5efa;&#x9700;&#x8981;&#x7f16;&#x8bd1;&#x7684;&#x6587;&#x4ef6;&#x7684;&#x5217;&#x8868;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1478596740219" ID="ID_1131988071" MODIFIED="1478597133085">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      scripts/Makefile.* &#x6587;&#x4ef6;&#x7684;&#x7ec4;&#x6210;
    </p>
    <p>
      Makefile.build &#x88ab;&#x9876;&#x5c42;&#x7684;Makefile&#x6587;&#x4ef6;&#x6240;&#x8c03;&#x7528;&#xff0c;&#x8ddf;&#x5404;&#x7ea7;&#x5b50;&#x76ee;&#x5f55;&#x5f53;&#x4e2d;&#x7684;Makefile
    </p>
    <p>
      &#x5408;&#x8d77;&#x6765;&#x6784;&#x6210;&#x4e00;&#x4e2a;&#x5b8c;&#x6574;&#x7684;Makefile&#x6587;&#x4ef6;&#xff0c;&#x5b9a;&#x4e49;&#x4e86;.lib, built-in.o, *.o&#x6587;&#x4ef6;&#x7684;&#x751f;&#x6210;&#x89c4;&#x5219;&#x3002;
    </p>
    <p>
      Makefile.clean&#x88ab;&#x9876;&#x5c42;&#x7684;Makefile&#x6587;&#x4ef6;&#x8c03;&#x7528;&#xff0c;&#x7528;&#x6765;&#x5220;&#x9664;&#x76ee;&#x6807;&#x6587;&#x4ef6;
    </p>
    <p>
      Makefile.lib &#x88ab;Makefile.build&#x6587;&#x4ef6;&#x6240;&#x8c03;&#x7528;&#xff0c;&#x5bf9;&#x4e00;&#x4e9b;&#x53d8;&#x91cf;&#x8fdb;&#x884c;&#x5904;&#x7406;.
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468293614186" FOLDED="true" ID="ID_102844332" MODIFIED="1544867556601">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2. kbuild&#x6587;&#x4ef6;
    </p>
    <p>
      kbuild makefile&#x7684;&#x6587;&#x4ef6;&#x540d;&#x79f0;&#x53ef;&#x4ee5;&#x662f;Makefile&#x6216;&#x8005;Kbuild
    </p>
    <p>
      &#x4f46;&#x662f;&#x5982;&#x679c;&#x4e24;&#x4e2a;&#x6587;&#x4ef6;&#x540d;&#x79f0;&#x90fd;&#x5b58;&#x5728;&#xff0c;&#x90a3;&#x4e48;kbuild&#x6587;&#x4ef6;&#x5c06;&#x4f1a;&#x88ab;&#x8bfb;&#x53d6;
    </p>
  </body>
</html></richcontent>
<node CREATED="1468311504627" FOLDED="true" ID="ID_763019342" MODIFIED="1544867555289" TEXT="&#x7b2c;&#x4e09;&#x90e8;&#x5206;">
<node CREATED="1468302210735" ID="ID_576654895" MODIFIED="1468305044759">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <ol>
      <li>
        &#x5185;&#x5d4c;&#x7684;&#x5bf9;&#x8c61;&#x76ee;&#x6807;
      </li>
    </ol>
    <p>
      kbuild&#x5728;$(obj-y)&#x4e2d;&#x4e3a;vmlinux&#x6307;&#x5b9a;&#x5bf9;&#x8c61;&#x76ee;&#x6807;&#x6587;&#x4ef6;
    </p>
    <p>
      &#x5217;&#x8868;&#x3002;&#x8fd9;&#x4e2a;&#x5217;&#x8868;&#x4f9d;&#x8d56;&#x4e8e;&#x5185;&#x6838;&#x7684;&#x914d;&#x7f6e;&#x3002;
    </p>
    <p>
      &#x5728;$(obj-y)&#x5f53;&#x4e2d;&#x7684;&#x6587;&#x4ef6;&#x7684;&#x987a;&#x5e8f;&#x975e;&#x5e38;&#x5730;&#x91cd;&#x8981;
    </p>
    <p>
      &#x94fe;&#x63a5;&#x7684;&#x987a;&#x5e8f;&#x975e;&#x5e38;&#x91cd;&#x8981;&#xff0c;&#x56e0;&#x4e3a;&#x67d0;&#x4e9b;&#x51fd;&#x6570;(module_init() / __initcall)
    </p>
    <p>
      &#x5c06;&#x4f1a;&#x5728;boot&#x9636;&#x6bb5;&#x6309;&#x7167;&#x4ed6;&#x4eec;&#x51fa;&#x73b0;&#x7684;&#x987a;&#x5e8f;&#x88ab;&#x8c03;&#x7528;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468305217480" ID="ID_1440319413" MODIFIED="1468307441825">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2. &#x53ef;&#x52a0;&#x8f7d;&#x7684;&#x6a21;&#x5757;&#x76ee;&#x6807;
    </p>
    <p>
      $(obj-m) &#x6307;&#x5b9a;&#x90a3;&#x4e9b;&#x53ef;&#x4ee5;&#x88ab;&#x6784;&#x5efa;&#x6210;&#x4e3a;&#x53ef;&#x52a0;&#x8f7d;&#x7684;
    </p>
    <p>
      &#x6a21;&#x5757;&#x7684;&#x76ee;&#x6807;&#x6587;&#x4ef6;&#x3002;
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x6a21;&#x5757;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x7f16;&#x8bd1;&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x662f;&#x591a;&#x4e2a;&#x6587;&#x4ef6;&#x6765;&#x6784;&#x5efa;&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x662f;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#xff0c;&#x5219;&#x8be5;&#x6587;&#x4ef6;&#x53ef;&#x4ee5;&#x7b80;&#x5355;&#x5730;&#x6dfb;&#x52a0;&#x5230;$(obj-m)
    </p>
    <p>
      Example:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#drivers/isdn/i4l/Makefile
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;obj-$(CONFIG_ISDN_PPP_BSDCOMP) += isdn_bsdcomp.o
    </p>
    <p>
      &#x5982;&#x679c;&#x5185;&#x6838;&#x6a21;&#x5757;&#x662f;&#x7531;&#x591a;&#x4e2a;&#x6587;&#x4ef6;&#x6784;&#x5efa;&#x5b8c;&#x6210;&#x7684;&#xff0c;&#x5e94;&#x8be5;&#x5982;&#x4e0b;
    </p>
    <p>
      Example:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#drivers/isdn/i4l/Makefile
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;obj-$(CONFIG_ISDN_I4L) += isdn.o
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;isdn-y := isdn_net_lib.o isdn_v110.o isdn_common.o
    </p>
    <p>
      &#x5728;&#x8fd9;&#x4e2a;&#x4f8b;&#x5b50;&#x5f53;&#x4e2d;&#x6a21;&#x5757;&#x7684;&#x540d;&#x5b57;&#x662f;isdn,&#x7531;isdn-y&#x6307;&#x5b9a;&#x9700;&#x8981;&#x7f16;&#x8bd1;&#x7684;&#x6587;&#x4ef6;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468307455505" ID="ID_86765280" MODIFIED="1468309030234">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3. &#x5e93;&#x6587;&#x4ef6;&#x76ee;&#x6807;
    </p>
    <p>
      &#x4e5f;&#x6709;&#x53ef;&#x80fd;&#x5217;&#x51fa;&#x76ee;&#x6807;&#x6587;&#x4ef6;&#x5217;&#x8868;&#xff0c;&#x7528;&#x4e8e;&#x5c06;&#x4ed6;&#x4eec;&#x7f16;&#x8bd1;
    </p>
    <p>
      &#x8fdb;&#x5165;&#x5230;&#x5e93;&#x5f53;&#x4e2d;,lib.a.
    </p>
    <p>
      &#x6240;&#x6709;&#x7684;&#x901a;&#x8fc7;lib-y&#x6307;&#x5b9a;&#x7684;&#x5bf9;&#x8c61;&#x6587;&#x4ef6;&#x5c06;&#x4f1a;&#x88ab;&#x7f16;&#x8bd1;&#x8fdb;&#x5165;&#x5230;
    </p>
    <p>
      &#x90a3;&#x4e2a;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;&#x5e93;
    </p>
    <p>
      &#x5305;&#x542b;&#x5728;lib-m&#x91cc;&#x9762;&#x7684;&#x5bf9;&#x8c61;&#x6587;&#x4ef6;&#x4e5f;&#x4f1a;&#x88ab;&#x5305;&#x542b;&#x5230;lib.a
    </p>
    <p>
      &#x5f53;&#x4e2d;&#x3002;
    </p>
    <p>
      &#x5728;&#x76f8;&#x540c;&#x7684;makefile&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#xff0c;&#x6709;&#x53ef;&#x80fd;&#x5373;&#x5217;&#x51fa;&#x4e86;&#x7f16;&#x8bd1;&#x5230;
    </p>
    <p>
      &#x5185;&#x6838;&#x5f53;&#x4e2d;&#x6587;&#x4ef6;&#x53c8;&#x5217;&#x51fa;&#x4e86;&#x53ef;&#x4ee5;&#x7f16;&#x8bd1;&#x5230;&#x5e93;&#x91cc;&#x9762;&#x7684;&#x6587;&#x4ef6;&#x3002;
    </p>
    <p>
      &#x90a3;&#x4e48;&#x8fd9;&#x4e2a;&#x65f6;&#x5019;&#xff0c;&#x8be5;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x4f1a;&#x6709;built-in.o&#x6587;&#x4ef6;&#x548c;lib.a
    </p>
    <p>
      &#x6587;&#x4ef6;&#x540c;&#x65f6;&#x51fa;&#x73b0;&#x3002;
    </p>
    <p>
      lib-y&#x88ab;&#x9650;&#x5236;&#x4f7f;&#x7528;&#x5728;&#x5982;&#x4e0b;&#x76ee;&#x5f55;lib/ and arch/*/lib
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468309118186" ID="ID_1020075039" MODIFIED="1468309604970">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      4.&#x76ee;&#x5f55;&#x626b;&#x63cf;
    </p>
    <p>
      &#x4e00;&#x4e2a;makefile&#x6587;&#x4ef6;&#x53ea;&#x662f;&#x8d1f;&#x8d23;&#x7f16;&#x8bd1;&#x5b83;&#x6240;&#x5728;&#x7684;&#x76ee;&#x5f55;&#x7684;&#x5bf9;&#x8c61;&#xff0c;
    </p>
    <p>
      &#x5b50;&#x76ee;&#x5f55;&#x91cc;&#x9762;&#x7684;&#x6587;&#x4ef6;&#x5e94;&#x8be5;&#x7531;&#x5b50;&#x76ee;&#x5f55;&#x91cc;&#x9762;&#x7684;makefile&#x6587;&#x4ef6;
    </p>
    <p>
      &#x6765;&#x8d1f;&#x8d23;&#x3002;
    </p>
    <p>
      271&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      &#xa0;272&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#fs/Makefile
    </p>
    <p>
      &#xa0;273&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;obj-$(CONFIG_EXT2_FS) += ext2/
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x7ed9;obj-y&#x6216;&#x8005;obj-m&#x590d;&#x5236;&#x8def;&#x5f84;&#x540d;&#x79f0;&#x6765;&#x8ba9;kbuild
    </p>
    <p>
      &#x8fdb;&#x5165;&#x76ee;&#x5f55;&#x3002;
    </p>
    <p>
      &#x4f7f;&#x7528;CONFIG_&#x7684;&#x597d;&#x5904;&#x662f;&#x53ef;&#x4ee5;&#x5728;&#x4e0d;&#x9700;&#x8981;&#x7684;&#x65f6;&#x5019;&#x8df3;&#x8fc7;&#x8be5;&#x76ee;&#x5f55;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468309618427" ID="ID_812318928" MODIFIED="1468311265423">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      5. &#x7f16;&#x8bd1;&#x7684;flag
    </p>
    <p>
      ccflags-y, asflags-y and ldflags-y
    </p>
    <p>
      subdir-ccflags-y, subdir-asflags-y
    </p>
    <p>
      &#x4ee5;subdir-&#x5f00;&#x5934;&#x7684;&#x6807;&#x5fd7;&#x4f7f;&#x5f97;kbuild&#x5728;&#x5f53;&#x524d;&#x76ee;&#x5f55;&#x8fd8;&#x662f;&#x5b50;&#x76ee;&#x5f55;
    </p>
    <p>
      &#x90fd;&#x53d7;&#x5230;&#x8fd9;&#x4e9b;&#x6807;&#x5fd7;&#x7684;&#x5f71;&#x54cd;&#x3002;
    </p>
    <p>
      CFLAGS_$@, AFLAGS_$@
    </p>
    <p>
      &#x4ee5;&#x4e0a;&#x7684;&#x4e24;&#x4e2a;&#x6807;&#x5fd7;&#x4f4d;&#x53ea;&#x662f;&#x4f5c;&#x7528;&#x4e8e;&#x5f53;&#x524d;&#x7684;Makefile
    </p>
    <p>
      337&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      &#xa0;338&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;# drivers/scsi/Makefile
    </p>
    <p>
      &#xa0;339&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;CFLAGS_aha152x.o =&#xa0;&#xa0;&#xa0;-DAHA152X_STAT -DAUTOCONF
    </p>
    <p>
      &#xa0;340&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;CFLAGS_gdth.o&#xa0;&#xa0;&#xa0;&#xa0;= # -DDEBUG_GDTH=2 -D__SERIAL__ -D__COM2__ \
    </p>
    <p>
      &#xa0;341&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;-DGDTH_STATISTICS
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468311760892" ID="ID_167108045" MODIFIED="1468312077220">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      6. &#x4f9d;&#x8d56;&#x8ffd;&#x8e2a;
    </p>
    <p>
      kbuild&#x4f1a;&#x8ffd;&#x8e2a;&#x4e0b;&#x5217;&#x7684;&#x4f9d;&#x8d56;&#x5173;&#x7cfb;
    </p>
    <ol>
      <li>
        &#x6240;&#x6709;&#x5fc5;&#x987b;&#x7684;&#x6587;&#x4ef6;
      </li>
      <li>
        &#x6240;&#x6709;&#x5fc5;&#x987b;&#x6587;&#x4ef6;&#x91cc;&#x9762;&#x7684;CONFIG_&#x9009;&#x9879;
      </li>
      <li>
        &#x7528;&#x4e8e;&#x7f16;&#x8bd1;&#x76ee;&#x6807;&#x7684;&#x547d;&#x4ee4;&#x884c;
      </li>
    </ol>
  </body>
</html></richcontent>
</node>
<node CREATED="1468312308164" FOLDED="true" ID="ID_431558417" MODIFIED="1526886192871">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      7.&#x7279;&#x6b8a;&#x89c4;&#x5219;
    </p>
    <p>
      &#x5f53;kbuild&#x65e0;&#x6cd5;&#x63d0;&#x4f9b;&#x9700;&#x8981;&#x7684;&#x652f;&#x6301;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x7279;&#x6b8a;&#x7684;&#x89c4;&#x5219;&#x5c31;&#x4f1a;&#x88ab;&#x542f;&#x7528;&#x3002;
    </p>
    <p>
      &#x6bd4;&#x5982;&#x5728;&#x7f16;&#x8bd1;&#x7684;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x751f;&#x6210;&#x5934;&#x6587;&#x4ef6;&#x6216;&#x8005;&#x6839;&#x636e;&#x67d0;&#x4e2a;&#x7279;&#x6b8a;&#x7684;&#x7cfb;&#x7edf;&#x67b6;&#x6784;
    </p>
    <p>
      &#x6765;&#x91cd;&#x65b0;&#x7ec4;&#x7ec7;boot image&#x3002;
    </p>
    <p>
      special rules&#x662f;&#x4ee5;&#x6b63;&#x5e38;&#x7684;make rules&#x6765;&#x4e66;&#x5199;&#x7684;
    </p>
  </body>
</html></richcontent>
<node CREATED="1468312854492" ID="ID_1926206255" MODIFIED="1468313351031">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5f53;&#x4e66;&#x5199;special rules&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4e24;&#x79cd;&#x53d8;&#x91cf;&#x4f1a;&#x88ab;&#x4f7f;&#x7528;&#x5230;
    </p>
    <p>
      $(src)&#x662f;&#x4e00;&#x4e2a;&#x76f8;&#x5bf9;&#x7684;&#x8def;&#x5f84;&#xff0c;&#x6307;&#x5411;&#x5b58;&#x653e;makefile&#x6587;&#x4ef6;&#x7684;&#x4f4d;&#x7f6e;
    </p>
    <p>
      $(obj)&#x662f;&#x4e00;&#x4e2a;&#x76f8;&#x5bf9;&#x8def;&#x5f84;&#xff0c;&#x7528;&#x4e8e;&#x6307;&#x5411;&#x76ee;&#x6807;&#x4fdd;&#x5b58;&#x7684;&#x8def;&#x5f84;
    </p>
    <p>
      &#xa0;390&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      &#xa0;391&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#drivers/scsi/Makefile
    </p>
    <p>
      &#xa0;392&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(obj)/53c8xx_d.h: $(src)/53c7,8xx.scr $(src)/script_asm.pl
    </p>
    <p>
      &#xa0;393&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(CPP) -DCHIP=810 - &lt; $&lt; | ... $(src)/script_asm.pl
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468313658405" FOLDED="true" ID="ID_1452523954" MODIFIED="1526886191207">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      8.$(CC)&#x652f;&#x6301;&#x7684;&#x51fd;&#x6570;
    </p>
    <p>
      &#x5185;&#x6838;&#x53ef;&#x80fd;&#x4f1a;&#x88ab;&#x4e0d;&#x540c;&#x7248;&#x672c;&#x7684;$(CC)&#x7f16;&#x8bd1;
    </p>
    <p>
      kbuild&#x4f1a;&#x63d0;&#x4f9b;&#x4e00;&#x4e9b;&#x57fa;&#x672c;&#x7684;&#x652f;&#x6301;&#x51fd;&#x6570;&#x7528;&#x6765;&#x68c0;&#x67e5;$(CC)&#x7684;&#x6709;&#x6548;&#x7684;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
<node CREATED="1468313946309" ID="ID_1865887727" MODIFIED="1468314094675">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.as-option
    </p>
    <p>
      &#x7528;&#x4e8e;&#x68c0;&#x67e5;$(CC)&#x662f;&#x5426;&#x652f;&#x6301;&#x7ed9;&#x5b9a;&#x7684;&#x9009;&#x9879;&#xff0c;&#x5982;&#x679c;&#x7b2c;&#x4e00;&#x4e2a;&#x9009;&#x9879;&#x4e0d;&#x652f;&#x6301;
    </p>
    <p>
      &#x90a3;&#x4e48;&#x7b2c;&#x4e8c;&#x4e2a;&#x53ef;&#x9009;&#x9879;&#x53ef;&#x80fd;&#x4f1a;&#x88ab;&#x6307;&#x5b9a;&#x3002;
    </p>
    <p>
      429&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      430&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/sh/Makefile
    </p>
    <p>
      431&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cflags-y += $(call as-option,-Wa$(comma)-isa=$(isa-y),)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468314173085" ID="ID_416715775" MODIFIED="1468314218298">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.cc-ldoption
    </p>
    <p>
      &#x7528;&#x4e8e;&#x6d4b;&#x8bd5;&#x5f53;&#x8fdb;&#x884c;&#x94fe;&#x63a5;&#x52a8;&#x4f5c;&#x7684;&#x65f6;&#x5019;&#xff0c;$(CC)&#x662f;&#x5426;&#x4f1a;&#x652f;&#x6301;
    </p>
    <p>
      &#x67d0;&#x4e9b;&#x9009;&#x9879;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468314261685" ID="ID_828013567" MODIFIED="1468314712987">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3. as-instr
    </p>
    <p>
      &#x7528;&#x4e8e;&#x68c0;&#x67e5;&#x6c47;&#x7f16;&#x5668;&#x662f;&#x5426;&#x652f;&#x6301;&#x67d0;&#x4e2a;&#x6307;&#x4ee4;&#xff0c;
    </p>
    <p>
      &#x5e76;&#x4e14;&#x8f93;&#x51fa;&#x9009;&#x9879;1&#x6216;&#x8005;&#x662f;&#x9009;&#x9879;2
    </p>
    <p>
      
    </p>
    <p>
      cc-option
    </p>
    <p>
      &#x7528;&#x4e8e;&#x68c0;&#x67e5;$(CC)&#x662f;&#x5426;&#x652f;&#x6301;&#x67d0;&#x4e2a;&#x5177;&#x4f53;&#x7684;&#x9009;&#x9879;
    </p>
    <p>
      462&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      463&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/x86/Makefile
    </p>
    <p>
      464&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cflags-y += $(call cc-option,-march=pentium-mmx,-march=i586)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468314807333" ID="ID_1576238347" MODIFIED="1468314941945">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      4.cc-option-yn
    </p>
    <p>
      &#x7528;&#x4e8e;&#x68c0;&#x67e5;$(CC)&#x662f;&#x5426;&#x652f;&#x6301;&#x67d0;&#x4e00;&#x4e2a;&#x9009;&#x9879;&#xff0c;&#x5982;&#x679c;&#x652f;&#x6301;&#x8be5;&#x9009;&#x9879;&#x7684;&#x8bdd;
    </p>
    <p>
      &#x5219;&#x8fd4;&#x56de;y,&#x5426;&#x5219;&#x8fd4;&#x56de;n
    </p>
    <p>
      476&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      477&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/ppc/Makefile
    </p>
    <p>
      478&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;biarch := $(call cc-option-yn, -m32)
    </p>
    <p>
      479&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;aflags-$(biarch) += -a32
    </p>
    <p>
      480&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cflags-$(biarch) += -m32
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468317432694" ID="ID_125544140" MODIFIED="1468317546815">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      5.cc-cross-prefix
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x7528;&#x4e8e;&#x68c0;&#x6d4b;&#x662f;&#x5426;&#x5b58;&#x5728;&#x7ed9;&#x5b9a;&#x7684;&#x524d;&#x7f00;&#x7684;$(CC)&#x5b58;&#x5728;&#xff0c;
    </p>
    <p>
      &#x591a;&#x4e2a;&#x7ed9;&#x5b9a;&#x7684;&#x524d;&#x7f00;&#x4e4b;&#x95f4;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x7a7a;&#x683c;&#x6765;&#x5206;&#x9694;
    </p>
    <p>
      578&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      579&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/m68k/Makefile
    </p>
    <p>
      580&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ifneq ($(SUBARCH),$(ARCH))
    </p>
    <p>
      581&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ifeq ($(CROSS_COMPILE),)
    </p>
    <p>
      582&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;CROSS_COMPILE := $(call cc-cross-prefix, m68k-linux-gnu-)
    </p>
    <p>
      583&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;endif
    </p>
    <p>
      584&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;endif
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1468317622574" FOLDED="true" ID="ID_1729345163" MODIFIED="1526886189512" TEXT="&#x7b2c;&#x56db;&#x90e8;&#x5206;:&#x7b80;&#x5355;&#x7684;&#x4e3b;&#x673a;&#x7a0b;&#x5e8f;&#x652f;&#x6301;">
<node CREATED="1468822940777" ID="ID_1155308987" MODIFIED="1468822965219">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x901a;&#x8fc7;&#x5b9a;&#x4e49;hostprogs-y&#x8868;&#x660e;&#x4e3b;&#x673a;&#x7a0b;&#x5e8f;&#x7684;&#x6587;&#x4ef6;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468317870159" FOLDED="true" ID="ID_204563732" MODIFIED="1491199315043" TEXT="&#x7b2c;&#x4e94;&#x90e8;&#x5206;:kbuild clean&#x5de5;&#x5177;">
<node CREATED="1468318600959" ID="ID_1836860729" MODIFIED="1468318959116">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      $(clean-files)
    </p>
    <p>
      &#x901a;&#x8fc7;&#x8be5;&#x53d8;&#x91cf;&#x6307;&#x5b9a;&#x67d0;&#x4e9b;&#x6587;&#x4ef6;&#xff0c;&#x53ef;&#x4ee5;&#x5bf9;&#x5176;&#x8fdb;&#x884c;&#x5220;&#x9664;
    </p>
    <p>
      764&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      &#xa0;765&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#scripts/package/Makefile
    </p>
    <p>
      &#xa0;766&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;clean-dirs := $(objtree)/debian/
    </p>
    <p>
      $(no-clean-files)
    </p>
    <p>
      &#x8be5;&#x53d8;&#x91cf;&#x53ef;&#x4ee5;&#x6307;&#x5b9a;&#x4e0d;&#x9700;&#x8981;&#x88ab;&#x5220;&#x9664;&#x7684;&#x6587;&#x4ef6;&#xff0c;&#x4f46;&#x662f;&#x8be5;&#x53d8;&#x91cf;
    </p>
    <p>
      &#x5fc5;&#x987b;&#x5728;&#x9876;&#x5c42;&#x76ee;&#x5f55;&#x7684;kbuild&#x5f53;&#x4e2d;&#x6307;&#x5b9a;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468319498824" ID="ID_810252003" MODIFIED="1468319629450">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x901a;&#x5e38;kbuild&#x4f7f;&#x7528; "obj-* := dir/"
    </p>
    <p>
      &#x6765;&#x6307;&#x5b9a;&#x9700;&#x8981;&#x9012;&#x5f52;&#x7684;&#x76ee;&#x5f55;&#xff0c;&#x4f46;&#x662f;&#x5728;&#x67d0;&#x4e9b;&#x67b6;&#x6784;&#x7684;makefile&#x4e2d;&#x8fd9;&#x4e2a;&#x529f;&#x80fd;
    </p>
    <p>
      &#x4e0d;&#x80fd;&#x6ee1;&#x8db3;&#x9700;&#x8981;,&#x6240;&#x4ee5;&#x5728;&#x6267;&#x884c;make clean&#x7684;&#x65f6;&#x5019;&#x9700;&#x8981;&#x7cbe;&#x786e;&#x6307;&#x5b9a;
    </p>
    <p>
      subdir
    </p>
    <p>
      782&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      783&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/x86/boot/Makefile
    </p>
    <p>
      784&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;subdir- := compressed/
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468337897909" FOLDED="true" ID="ID_697366277" MODIFIED="1526886187632" TEXT="&#x7b2c;&#x516d;&#x90e8;&#x5206;:&#x67b6;&#x6784;&#x76f8;&#x5173;&#x7684;makefile">
<node CREATED="1468338050509" FOLDED="true" ID="ID_1613029233" MODIFIED="1526886185640">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      arch/$(ARCH)/Makefile
    </p>
    <p>
      &#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x4e9b;&#x53d8;&#x91cf;&#xff0c;&#x5e76;&#x4e14;&#x8bbe;&#x7f6e;&#x4e86;&#x4e00;&#x4e9b;&#x76ee;&#x6807;&#xff0c;
    </p>
    <p>
      &#x5f53;kbuild&#x5f00;&#x59cb;&#x6267;&#x884c;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4e0b;&#x9762;&#x7684;&#x6b65;&#x9aa4;&#x5f00;&#x59cb;&#x7d27;&#x968f;&#x5176;&#x540e;
    </p>
    <p>
      1.&#x5c06;&#x5185;&#x6838;&#x7684;&#x914d;&#x7f6e;&#x653e;&#x7f6e;&#x5230;.config&#x6587;&#x4ef6;&#x5f53;&#x4e2d;
    </p>
    <p>
      2.&#x5c06;&#x5185;&#x6838;&#x7684;&#x7248;&#x672c;&#x5b58;&#x50a8;&#x5230;&#x6587;&#x4ef6;include/linux/version.h
    </p>
    <p>
      3.&#x66f4;&#x65b0;&#x6240;&#x6709;&#x7684;&#x5fc5;&#x987b;&#x6761;&#x4ef6;:
    </p>
    <p>
      &#x6f5c;&#x5728;&#x7684;&#x5fc5;&#x987b;&#x6761;&#x4ef6;&#x5728;arch/$(ARCH)/Makefile&#x4e2d;&#x88ab;&#x6307;&#x5b9a;
    </p>
    <p>
      4.&#x9012;&#x5f52;&#x4e0b;&#x964d;&#x5230;&#x6240;&#x6709;&#x7684;&#x7531;init-* core* drivers-* net-* libs-*
    </p>
    <p>
      &#x6807;&#x8bc6;&#x7684;&#x76ee;&#x5f55;&#x5f53;&#x4e2d;&#xff0c;&#x5e76;&#x4e14;&#x7f16;&#x8bd1;&#x6240;&#x6709;&#x7684;&#x76ee;&#x6807;------&#x4e0a;&#x9762;&#x7684;&#x6240;&#x6709;&#x7684;
    </p>
    <p>
      &#x53d8;&#x91cf;&#x7684;&#x503c;&#x90fd;&#x4f1a;&#x5728;arch/$(ARCH)/Makefile&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x88ab;&#x6269;&#x5c55;
    </p>
    <p>
      5.&#x6240;&#x6709;&#x7684;object&#x6587;&#x4ef6;&#x90fd;&#x88ab;&#x94fe;&#x63a5;&#xff0c;&#x5e76;&#x4e14;&#x6700;&#x540e;&#x751f;&#x6210;&#x7684;vmlinux&#x6587;&#x4ef6;
    </p>
    <p>
      &#x88ab;&#x653e;&#x7f6e;&#x5728;object tree&#x7684;&#x6839;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#xff0c;&#x6700;&#x5148;&#x88ab;&#x94fe;&#x63a5;&#x7684;object&#x6587;&#x4ef6;
    </p>
    <p>
      &#x7531;head-y&#x6307;&#x5b9a;&#xff0c;&#x7531;arch/$(ARCH)/Makefile&#x6587;&#x4ef6;&#x8fdb;&#x884c;&#x8d4b;&#x503c;&#x3002;
    </p>
    <p>
      6.&#x6700;&#x7ec8;&#xff0c;&#x7531;&#x5177;&#x4f53;&#x7684;&#x67b6;&#x6784;&#x6307;&#x5b9a;&#x7684;&#x90e8;&#x5206;&#x4f1a;&#x505a;&#x4e00;&#x4e9b;&#x540e;&#x5904;&#x7406;&#xff0c;&#x7136;&#x540e;&#x7f16;&#x8bd1;&#x51fa;
    </p>
    <p>
      &#x6700;&#x7ec8;&#x7684;bootimage-------&#x8fd9;&#x5305;&#x62ec;&#x5efa;&#x7acb;boot&#x8bb0;&#x5f55;&#xff0c;&#x51c6;&#x5907;initrd images
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1468339624384" FOLDED="true" ID="ID_1431066623" MODIFIED="1526886183907" TEXT="1.&#x8bbe;&#x7f6e;&#x53d8;&#x91cf;&#x8c03;&#x6574;&#x5bf9;&#x67b6;&#x6784;&#x7684;&#x6784;&#x5efa;">
<node CREATED="1468339776327" ID="ID_862426094" MODIFIED="1468339817481">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      LDFLAGS&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Generic $(LD) options
    </p>
    <p>
      &#x5bf9;&#x4e8e;&#x6240;&#x6709;&#x88ab;&#x5524;&#x8d77;&#x4f7f;&#x7528;&#x7684;&#x94fe;&#x63a5;&#x5668;&#x90fd;&#x9002;&#x7528;&#x7684;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468339846463" ID="ID_1185250536" MODIFIED="1468339946626">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      LDFLAGS_MODULE
    </p>
    <p>
      &#x7528;&#x4e8e;&#x94fe;&#x63a5;&#x5668;&#x5728;&#x94fe;&#x63a5;&#x6a21;&#x5757;&#x7684;&#x65f6;&#x5019;&#x4f7f;&#x7528;&#x7684;&#x9009;&#x9879;
    </p>
    <p>
      &#x9ed8;&#x8ba4;&#x7684;&#x9009;&#x9879;&#x662f;"-r"&#x4ee3;&#x8868;&#x91cd;&#x5b9a;&#x4f4d;&#x8f93;&#x51fa;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468373410256" ID="ID_1569791204" MODIFIED="1468373459105">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      LDFLAGS_vmlinux
    </p>
    <p>
      &#x5f53;&#x94fe;&#x63a5;&#x6700;&#x7ec8;&#x7684;vmlinux&#x955c;&#x50cf;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f7f;&#x7528;&#x7684;
    </p>
    <p>
      &#x94fe;&#x63a5;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468373861729" ID="ID_257233508" MODIFIED="1468373966604">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      OBJCOPYFLAGS
    </p>
    <p>
      &#x5f53;&#x8c03;&#x7528;$(call if_changed,objcopy)&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4e0a;&#x9762;&#x7684;&#x53d8;&#x91cf;
    </p>
    <p>
      &#x6307;&#x5b9a;&#x7684;&#x9009;&#x9879;&#x5c06;&#x4f1a;&#x88ab;&#x4f7f;&#x7528;
    </p>
    <p>
      872&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      873&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/s390/Makefile
    </p>
    <p>
      874&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;OBJCOPYFLAGS := -O binary
    </p>
    <p>
      875
    </p>
    <p>
      876&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/s390/boot/Makefile
    </p>
    <p>
      877&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(obj)/image: vmlinux FORCE
    </p>
    <p>
      878&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(call if_changed,objcopy)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468374087313" ID="ID_1977032466" MODIFIED="1468374156216">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_AFLAGS
    </p>
    <p>
      &#x6c47;&#x7f16;&#x5668;&#x7684;&#x9009;&#x9879;&#xff0c;&#x9876;&#x5c42;&#x7684;makefile&#x5bf9;&#x5176;&#x505a;&#x4e86;&#x6269;&#x5c55;&#xff0c;
    </p>
    <p>
      &#x6bcf;&#x4e2a;&#x67b6;&#x6784;&#x5e95;&#x4e0b;&#x5177;&#x4f53;&#x7684;makefile&#x5bf9;&#x5176;&#x505a;&#x4e86;&#x4fee;&#x6539;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468374185560" ID="ID_898074996" MODIFIED="1468374187548" TEXT="KBUILD_CFLAGS"/>
<node CREATED="1468374329961" ID="ID_1934722852" MODIFIED="1468374360236">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_AFLAGS_KERNEL
    </p>
    <p>
      &#x6c47;&#x7f16;&#x5668;&#x7684;&#x9009;&#x9879;&#xff0c;&#x7528;&#x4e8e;&#x7f16;&#x8bd1;&#x5185;&#x6838;&#x5185;&#x5d4c;&#x7684;&#x4ee3;&#x7801;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468374381425" ID="ID_1894800286" MODIFIED="1468374417267">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_AFLAGS_MODULE
    </p>
    <p>
      &#x6c47;&#x7f16;&#x5668;&#x9009;&#x9879;&#xff0c;&#x7528;&#x4e8e;&#x7f16;&#x8bd1;&#x5185;&#x6838;&#x6a21;&#x5757;&#xff0c;
    </p>
    <p>
      &#x6307;&#x5b9a;&#x8ddf;&#x5177;&#x4f53;&#x7684;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76f8;&#x5173;&#x7684;&#x7279;&#x6027;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468374451961" ID="ID_1889110162" MODIFIED="1468374455545" TEXT="KBUILD_CFLAGS_KERNEL"/>
<node CREATED="1468374464849" ID="ID_1382600643" MODIFIED="1468374529835" TEXT="KBUILD_CFLAGS_MODULE"/>
<node CREATED="1468374549233" ID="ID_1680091953" MODIFIED="1468374551571" TEXT="KBUILD_LDFLAGS_MODULE"/>
<node CREATED="1468374574713" ID="ID_1402116796" MODIFIED="1468374679527">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      KBUILD_ARFLAGS
    </p>
    <p>
      &#x7528;&#x4e8e;&#x6253;&#x5305;&#x547d;&#x4ee4;$(AR)&#x7684;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468374699192" ID="ID_533615964" MODIFIED="1468374757680">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ARCH_CPPFLAGS, ARCH_AFLAGS, ARCH_CFLAGS
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x7528;&#x6765;&#x6307;&#x5b9a;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76f8;&#x5173;&#x7684;&#x9009;&#x9879;&#xff0c;&#x53ef;&#x4ee5;&#x7528;&#x6765;&#x8986;&#x76d6;KBUILD_
    </p>
    <p>
      &#x76f8;&#x5173;&#x7684;&#x9009;&#x9879;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1468375391513" ID="ID_1413507409" MODIFIED="1468375631385">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      "archheaders: rule"
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x76ee;&#x6807;&#x548c;&#x89c4;&#x5219;&#x88ab;&#x7528;&#x6765;&#x751f;&#x6210;&#x5fc5;&#x8981;&#x7684;&#x5934;&#x6587;&#x4ef6;&#xff0c;&#x4ece;&#x800c;&#x53ef;&#x4ee5;&#x5b89;&#x88c5;&#x5230;
    </p>
    <p>
      &#x7528;&#x6237;&#x7a7a;&#x95f4;&#x5f53;&#x4e2d;&#x53bb;(&#x901a;&#x8fc7;"make header_install"&#x547d;&#x4ee4;&#x6216;&#x8005;&#x662f;
    </p>
    <p>
      "make headers_install_all"&#x547d;&#x4ee4;)
    </p>
    <p>
      &#x8be5;&#x76ee;&#x6807;&#x548c;&#x89c4;&#x5219;&#x5fc5;&#x987b;&#x53ef;&#x4ee5;&#x8fd0;&#x884c;&#x5728;&#x6ca1;&#x6709;&#x8fdb;&#x884c;&#x914d;&#x7f6e;&#x7684;&#x6e90;&#x4ee3;&#x7801;&#x6811;&#x4e0b;&#x6216;&#x8005;&#x662f;
    </p>
    <p>
      &#x4e5f;&#x53ef;&#x4ee5;&#x8fd0;&#x884c;&#x5728;&#x5f53;&#x914d;&#x7f6e;&#x662f;&#x6307;&#x5411;&#x5176;&#x4ed6;&#x7c7b;&#x578b;&#x7684;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x7684;&#x65f6;&#x5019;&#x3002;
    </p>
    <p>
      &#x5b83;&#x8fd0;&#x884c;&#x5728; "make archprepare"&#x4e4b;&#x524d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468375636337" ID="ID_116631783" MODIFIED="1468375769052">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      "archprepare: rule"
    </p>
    <p>
      &#x8be5;&#x76ee;&#x6807;&#x89c4;&#x5219;&#x7528;&#x4e8e;&#x5728;&#x9012;&#x5f52;&#x4e0b;&#x964d;&#x5230;&#x5b50;&#x76ee;&#x5f55;&#x4e4b;&#x524d;&#xff0c;&#x5217;&#x51fa;&#x5fc5;&#x8981;&#x7684;
    </p>
    <p>
      &#x6761;&#x4ef6;&#x3002;&#x5982;&#x4e0b;&#x9762;&#x7684;&#x4f8b;&#x5b50;:
    </p>
    <p>
      982&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      983&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/arm/Makefile
    </p>
    <p>
      984&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;archprepare: maketools
    </p>
    <p>
      &#x6761;&#x4ef6;&#x76ee;&#x6807;&#x6587;&#x4ef6;maketools&#x5c06;&#x4f1a;&#x88ab;&#x9996;&#x5148;&#x5904;&#x7406;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468376016002" ID="ID_1402505665" MODIFIED="1468376299921">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>head-y, init-y, core-y, libs-y, drivers-y, net-y </b>
    </p>
    <p>
      head-y &#x6307;&#x51fa;&#x9996;&#x5148;&#x88ab;&#x94fe;&#x63a5;&#x5230;vmlinux&#x5f53;&#x4e2d;&#x7684;object
    </p>
    <p>
      libs-y &#x6307;&#x51fa;lib.a&#x538b;&#x7f29;&#x6587;&#x4ef6;&#x53ef;&#x4ee5;&#x88ab;&#x653e;&#x7f6e;&#x7684;&#x4f4d;&#x7f6e;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x53d8;&#x91cf;&#x4e00;&#x822c;&#x653e;&#x7f6e;&#x7684;&#x4f4d;&#x7f6e;:
    </p>
    <p>
      $(head-y) $(init-y) $(core-y), $(libs-y), $(drivers-y) $(net-y)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468377165499" FOLDED="true" ID="ID_735254119" MODIFIED="1475896811700">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5177;&#x4f53;&#x7684;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76f8;&#x5173;&#x7684;boot&#x955c;&#x50cf;
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76f8;&#x5173;&#x7684;Makefile&#x4f1a;&#x5b9a;&#x4e49;&#x4e00;&#x4e9b;&#x76ee;&#x6807;&#x5229;&#x7528;vmlinux&#x6587;&#x4ef6;&#xff0c;&#x538b;&#x7f29;&#x8be5;&#x6587;&#x4ef6;&#xff0c;
    </p>
    <p>
      &#x5c06;&#x5b83;&#x653e;&#x7f6e;&#x5728;bootstrapping code,&#x7136;&#x540e;&#x5c06;&#x6587;&#x4ef6;&#x62f7;&#x8d1d;&#x653e;&#x5728;&#x67d0;&#x4e2a;&#x4f4d;&#x7f6e;&#x3002;
    </p>
    <p>
      &#x8fd9;&#x9700;&#x8981;&#x4e00;&#x7cfb;&#x5217;&#x7684;&#x5b89;&#x88c5;&#x547d;&#x4ee4;&#xff0c;&#x5b9e;&#x9645;&#x7684;&#x76ee;&#x6807;&#x5728;&#x4e0d;&#x540c;&#x7684;&#x4f53;&#x7cfb;&#x67b6;&#x6784;&#x91cc;&#x9762;&#x4e5f;&#x662f;&#x4e0d;&#x4e00;&#x6837;&#x7684;&#x3002;
    </p>
    <p>
      &#x5c06;&#x4e00;&#x4e9b;&#x989d;&#x5916;&#x7684;&#x5904;&#x7406;&#x653e;&#x7f6e;&#x5728;arch/$(ARCH)/boot&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x662f;&#x6bd4;&#x8f83;&#x901a;&#x7528;&#x7684;&#x65b9;&#x5f0f;
    </p>
  </body>
</html></richcontent>
<node CREATED="1468377928427" ID="ID_782242606" MODIFIED="1468378718284">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.kbuild&#x4e0d;&#x63d0;&#x4f9b;&#x4efb;&#x4f55;&#x667a;&#x80fd;&#x7684;&#x6765;&#x7f16;&#x8bd1;&#x4f4d;&#x4e8e;boot&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;
    </p>
    <p>
      &#x76ee;&#x6807;&#xff0c;&#x6240;&#x4ee5;&#x9700;&#x8981;&#x5728;arch/$(ARCH)/Makefile&#x4e2d;&#x4eba;&#x5de5;&#x8c03;&#x7528;
    </p>
    <p>
      &#x4f4d;&#x4e8e;boot&#x5f53;&#x4e2d;&#x7684;makefile
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468378724508" ID="ID_300306346" MODIFIED="1468378833008">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x5e76;&#x6ca1;&#x6709;&#x4e00;&#x4e9b;&#x5177;&#x4f53;&#x7684;&#x89c4;&#x5219;&#x6765;&#x7ed9;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76f8;&#x5173;&#x7684;&#x76ee;&#x6807;&#x8fdb;&#x884c;
    </p>
    <p>
      &#x547d;&#x540d;&#xff0c;&#x6240;&#x4ee5;&#x9700;&#x8981;&#x5b9a;&#x4e49;<b>$(archhelp</b>)&#x53d8;&#x91cf;&#xff0c;&#x7528;&#x4e8e;&#x5728;
    </p>
    <p>
      make help&#x7684;&#x65f6;&#x5019;&#x5217;&#x4e3e;&#x51fa;&#x8ddf;&#x5177;&#x4f53;&#x7684;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76f8;&#x5173;&#x7684;&#x76ee;&#x6807;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468379735037" ID="ID_1836453298" MODIFIED="1468380363890">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x9884;&#x5904;&#x7406;&#x94fe;&#x63a5;&#x811a;&#x672c;
    </p>
    <p>
      &#x5f53;vmlinux image&#x88ab;&#x6784;&#x5efa;&#x7684;&#x65f6;&#x5019;&#xff0c;arch/$(ARCH)/kernel/vmlinux.lds
    </p>
    <p>
      &#x811a;&#x672c;&#x4f1a;&#x88ab;&#x8c03;&#x7528;&#xff0c;&#x8be5;&#x811a;&#x672c;&#x662f;&#x5728;&#x4f4d;&#x4e8e;&#x8be5;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;vmlinux.lds.S&#x6587;&#x4ef6;&#x7684;&#x9884;&#x5904;&#x7406;
    </p>
    <p>
      &#x7684;&#x53d8;&#x91cf;&#x3002;
    </p>
    <p>
      &#xa0;kbuild knows .lds files and includes a rule *lds.S -&gt; *lds.
    </p>
    <p>
      
    </p>
    <p>
      1209&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      1210&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/x86/kernel/Makefile
    </p>
    <p>
      1211&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;always := vmlinux.lds
    </p>
    <p>
      1212
    </p>
    <p>
      1213&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#Makefile
    </p>
    <p>
      1214&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;export CPPFLAGS_vmlinux.lds += -P -C -U$(ARCH)
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1468380767766" FOLDED="true" ID="ID_58595401" MODIFIED="1526886180592">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7b2c;&#x4e03;&#x90e8;&#x5206;:
    </p>
    <p>
      Kbuild syntax for exported headers
    </p>
    <p>
      &#x5185;&#x6838;&#x5305;&#x542b;&#x4e00;&#x7cfb;&#x5217;&#x7684;&#x66b4;&#x9732;&#x7ed9;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x5934;&#x6587;&#x4ef6;&#xff0c;&#x6709;&#x4e9b;&#x5934;&#x6587;&#x4ef6;
    </p>
    <p>
      &#x5728;&#x66b4;&#x9732;&#x7ed9;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x65f6;&#x5019;&#x9700;&#x8981;&#x505a;&#x4e00;&#x4e9b;&#x9884;&#x5904;&#x7406;&#x3002;
    </p>
    <p>
      &#x9884;&#x5904;&#x7406;&#x505a;&#x7684;&#x4e8b;&#x60c5;:
    </p>
    <p>
      1.&#x4e22;&#x5f03;&#x5185;&#x6838;&#x7684;&#x4e00;&#x4e9b;&#x6ce8;&#x91ca;
    </p>
    <p>
      2.&#x4e22;&#x5f03;Include linux/compile.h
    </p>
    <p>
      3.&#x4e22;&#x5f03;&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x8ddf;&#x5185;&#x6838;&#x5185;&#x90e8;&#x76f8;&#x5173;&#x7684;section(&#x7531;&#x5b8f;&#x5b9a;&#x4e49;ifdef __KERNEL__&#x4fdd;&#x62a4;)
    </p>
    <p>
      &#x6bcf;&#x4e2a;&#x76f8;&#x5173;&#x7684;&#x76ee;&#x5f55;&#x5305;&#x542b;&#x4e86;&#x4e00;&#x4e2a;&#x540d;&#x5b57;&#x53eb;&#x505a;Kbuild&#x7684;&#x6587;&#x4ef6;&#xff0c;&#x7528;&#x6765;&#x6307;&#x5b9a;&#x9700;&#x8981;&#x66b4;&#x9732;&#x7684;&#x5934;&#x6587;&#x4ef6;
    </p>
    <p>
      <b>&#x4e0b;&#x9762;&#x8bf4;&#x660e;Kbuild&#x6587;&#x4ef6;&#x7684;&#x8bed;&#x6cd5;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1468386690371" ID="ID_1391839196" MODIFIED="1468386819099">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      header-y
    </p>
    <p>
      &#x6307;&#x5b9a;&#x9700;&#x8981;&#x66b4;&#x9732;&#x51fa;&#x6765;&#x7684;&#x5934;&#x6587;&#x4ef6;&#xff0c;&#x4e00;&#x822c;&#x5730;&#x662f;&#x4e00;&#x4e2a;&#x6587;&#x4ef6;&#x4e00;&#x884c;
    </p>
    <p>
      &#x4e5f;&#x53ef;&#x4ee5;&#x6307;&#x5b9a;&#x9700;&#x8981;&#x626b;&#x63cf;&#x7684;&#x5b50;&#x76ee;&#x5f55;&#x3002;
    </p>
    <p>
      1257&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      1258&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#include/linux/Kbuild
    </p>
    <p>
      1259&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;header-y += usb/
    </p>
    <p>
      1260&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;header-y += aio_abi.h
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468386959971" ID="ID_1606104328" MODIFIED="1468387094986">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      genhdr-y
    </p>
    <p>
      &#x6307;&#x5b9a;&#x9700;&#x8981;&#x88ab;&#x66b4;&#x9732;&#x7684;&#x751f;&#x6210;&#x7684;&#x5934;&#x6587;&#x4ef6;&#xff0c;&#x751f;&#x6210;&#x6587;&#x4ef6;&#x6bd4;&#x8f83;&#x7279;&#x6b8a;
    </p>
    <p>
      &#x56e0;&#x4e3a;&#x505a;'make O=...'&#x7f16;&#x8bd1;&#x7684;&#x65f6;&#x5019;&#x5b83;&#x4eec;&#x9700;&#x8981;&#x5728;&#x53e6;&#x4e00;&#x4e2a;&#x76ee;&#x5f55;&#x91cc;&#x9762;&#x88ab;&#x67e5;&#x627e;
    </p>
    <p>
      1277&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      1278&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#include/linux/Kbuild
    </p>
    <p>
      1279&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;genhdr-y += version.h
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468387155564" ID="ID_1612756831" MODIFIED="1468387325594">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      destination-y
    </p>
    <p>
      &#x5f53;&#x4e00;&#x4e2a;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x91cc;&#x9762;&#x6709;&#x4e00;&#x7cfb;&#x5217;&#x7684;&#x6587;&#x4ef6;&#x9700;&#x8981;&#x88ab;&#x66b4;&#x9732;&#x5230;
    </p>
    <p>
      &#x4e0d;&#x540c;&#x7684;&#x8def;&#x5f84;&#x4e0b;&#x9762;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x8fd9;&#x4e2a;&#x53d8;&#x91cf;&#x5c31;&#x8d77;&#x5230;&#x4e86;&#x4f5c;&#x7528;&#x4e86;&#x3002;
    </p>
    <p>
      1288&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      1289&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/xtensa/platforms/s6105/include/platform/Kbuild
    </p>
    <p>
      1290&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;destination-y := include/linux
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1468387558732" ID="ID_1386767689" MODIFIED="1468387983032">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      generic-y
    </p>
    <p>
      include/asm-generic&#x76ee;&#x5f55;&#x91cc;&#x9762;&#x5305;&#x542b;&#x5404;&#x4e2a;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x53ef;&#x80fd;
    </p>
    <p>
      &#x90fd;&#x4f1a;&#x7528;&#x5230;&#x7684;&#x5934;&#x6587;&#x4ef6;&#x5b9a;&#x4e49;&#xff0c;&#x5728;&#x5404;&#x4e2a;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76ee;&#x5f55;&#x7684;kbuild
    </p>
    <p>
      &#x6587;&#x4ef6;&#x91cc;&#x9762;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;&#x8be5;&#x53d8;&#x91cf;&#x6765;&#x5217;&#x4e3e;&#x51fa;&#x9700;&#x8981;&#x7684;&#x5934;&#x6587;&#x4ef6;&#x7684;&#x540d;&#x79f0;&#xff0c;
    </p>
    <p>
      1301&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;Example:
    </p>
    <p>
      1302&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;#arch/x86/include/asm/Kbuild
    </p>
    <p>
      1303&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;generic-y += termios.h
    </p>
    <p>
      1304&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;generic-y += rtc.h
    </p>
    <p>
      <b>&#x90a3;&#x4e48;&#x5217;&#x4e3e;&#x51fa;&#x6765;&#x7684;&#x6587;&#x4ef6;&#x4f1a;&#x88ab;&#x653e;&#x7f6e;&#x5728; arch/$(ARCH)/include/generated/asm&#x76ee;&#x5f55;&#x4e0b;&#x9762; </b>
    </p>
    <p>
      <b>&#x540c;&#x65f6;&#x9700;&#x8981;&#x66b4;&#x9732;&#x7ed9;&#x7528;&#x6237;&#x7684;&#x6587;&#x4ef6;&#x88ab;&#x653e;&#x7f6e;&#x5728;usr/include/asm&#x4e0b;&#x9762;</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1491269996613" FOLDED="true" ID="ID_1842522828" MODIFIED="1534946205800">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>&#x535a;&#x5ba2;: Linux&#x5185;&#x6838;&#x6784;&#x5efa;&#x7cfb;&#x7edf;&#x5b66;&#x4e60;</i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1491270089493" ID="ID_1218138841" MODIFIED="1526886205761">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#dd0d0d">&#x7b2c;&#x4e8c;&#x7bc7;&#xff1a; &#x6784;&#x6210;&#x6784;&#x5efa;&#x7cfb;&#x7edf;&#x7684;&#x6587;&#x4ef6;</font></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1491270114341" ID="ID_32705983" MODIFIED="1491270179415">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9876;&#x5c42;Makefile
    </p>
    <p>
      &#x63d0;&#x4f9b;&#x9488;&#x5bf9;&#x5404;&#x79cd;&#x76ee;&#x6807;&#x7684;&#x63a5;&#x53e3;&#xff0c;&#x4e00;&#x822c;&#x548c;&#x5b9e;&#x73b0;&#x65e0;&#x5173;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491270183300" ID="ID_723434256" MODIFIED="1491272519493">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5e73;&#x53f0;&#x76f8;&#x5173;&#x7684;makefile
    </p>
    <p>
      &#x901a;&#x5e38;&#x4f4d;&#x4e8e;arch/*/&#x4e0b;&#x9762;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491272546651" ID="ID_1140887424" MODIFIED="1526886337991">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5404;&#x7c7b;&#x89c4;&#x5219;&#x6587;&#x4ef6;&#xff0c;&#x4f4d;&#x4e8e;scripts&#x76ee;&#x5f55;&#x4e0b;&#x9762;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x89c6;&#x4e3a;&#x9876;&#x5c42;&#x7684;makefile&#x6587;&#x4ef6;&#x7684;&#x5404;&#x4e2a;&#x63a5;&#x53e3;&#x7684;&#x5b9e;&#x73b0;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491272816737" ID="ID_736280168" MODIFIED="1491272857211">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Kbuild.include
    </p>
    <p>
      &#x901a;&#x7528;&#x7684;&#x6587;&#x4ef6;&#xff0c;&#x8be5;&#x6587;&#x4ef6;&#x88ab;&#x9876;&#x5c42;&#x7684;makefile&#x548c;
    </p>
    <p>
      Makefile.build&#x6587;&#x4ef6;&#x5305;&#x542b;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491272867729" ID="ID_1159924594" MODIFIED="1491272933620">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.build
    </p>
    <p>
      &#x8be5;&#x6587;&#x4ef6;&#x5b9a;&#x4e49;&#x4e86;&#x8bb8;&#x591a;&#x7f16;&#x8bd1;&#x89c4;&#x5219;&#xff0c;&#x7528;&#x4e8e;&#x7f16;&#x8bd1;built-in.o,
    </p>
    <p>
      lib.a&#x7b49;&#x7ec4;&#x4ef6;&#xff0c;&#x8fd9;&#x4e9b;&#x7ec4;&#x4ef6;&#x6784;&#x6210;&#x4e86;linux&#x5185;&#x6838;&#x7684;&#x955c;&#x50cf;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491272948464" ID="ID_1336938693" MODIFIED="1491273087513">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.lib
    </p>
    <p>
      &#x8be5;&#x6587;&#x4ef6;&#x7ed9;&#x8bb8;&#x591a;&#x7684;&#x53d8;&#x91cf;&#x8fdb;&#x884c;&#x4e86;&#x8d4b;&#x503c;&#x64cd;&#x4f5c;&#xff0c;&#x6bd4;&#x5982;
    </p>
    <p>
      obj-y, obj-m, subdir-y, subdir-m&#x7b49;&#x7b49;&#x3002;&#x8fd9;&#x4e9b;&#x53d8;&#x91cf;&#x6240;&#x4ee3;&#x8868;
    </p>
    <p>
      &#x7684;&#x6587;&#x4ef6;&#x548c;&#x76ee;&#x5f55;&#x90fd;&#x662f;&#x9700;&#x8981;&#x8fdb;&#x884c;&#x7f16;&#x8bd1;&#x7684;&#xff0c;&#x53e6;&#x5916;&#x8fd8;&#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x7cfb;&#x5217;&#x7684;cmd,
    </p>
    <p>
      &#x7528;&#x4e8e;&#x642d;&#x914d;if_changed&#x7cfb;&#x5217;&#x4f7f;&#x7528;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491273134775" ID="ID_986635715" MODIFIED="1491273348065">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.host
    </p>
    <p>
      &#x5728;linux&#x5185;&#x6838;&#x7f16;&#x8bd1;&#x7684;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#xff0c;&#x4e0d;&#x4ec5;&#x9700;&#x8981;&#x4f7f;&#x7528;gcc, as, ld&#x7b49;&#x5de5;&#x5177;&#xff0c;
    </p>
    <p>
      &#x8fd8;&#x9700;&#x8981;&#x4f7f;&#x7528;&#x8bb8;&#x591a;&#x5176;&#x4ed6;&#x7684;&#x7a0b;&#x5e8f;&#x6765;&#x8fdb;&#x884c;&#x5904;&#x7406;&#x3002;&#x6bd4;&#x5982;&#x4f7f;&#x7528;fixdep&#x6765;&#x5904;&#x7406;
    </p>
    <p>
      &#x4f9d;&#x8d56;&#x5173;&#x7cfb;&#xff0c;&#x4f7f;&#x7528;conf/gconf/mconf&#x7b49;&#x4f17;&#x591a;&#x5de5;&#x5177;&#x6765;&#x89e3;&#x6790;Kconfig&#x914d;&#x7f6e;&#x6587;&#x4ef6;
    </p>
    <p>
      &#x5f53;&#x4e2d;&#x7684;&#x914d;&#x7f6e;&#x4ee5;&#x751f;&#x6210;.config&#x6587;&#x4ef6;&#x3002;&#x4f7f;&#x7528;genksyms&#x8ba1;&#x7b97;&#x5185;&#x6838;&#x5bfc;&#x51fa;&#x7b26;&#x53f7;&#x7684;
    </p>
    <p>
      &#x6821;&#x9a8c;&#x548c;&#x7b49;&#x7b49;&#x3002;&#x8fd9;&#x4e9b;&#x5de5;&#x5177;&#x7684;&#x6e90;&#x4ee3;&#x7801;&#x653e;&#x7f6e;&#x5728;scripts&#x7684;&#x4e0d;&#x540c;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#xff0c;
    </p>
    <p>
      Makefile.host&#x5b9a;&#x4e49;&#x4e86;&#x5982;&#x4f55;&#x5c06;&#x5b83;&#x4eec;&#x7f16;&#x8bd1;&#x51fa;&#x6765;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491273368277" ID="ID_490826990" MODIFIED="1491273399167">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.clean
    </p>
    <p>
      &#x8be6;&#x7ec6;&#x5b9a;&#x4e49;&#x4e86;&#x5185;&#x6838;&#x505a;clean&#x52a8;&#x4f5c;&#x7684;&#x4e00;&#x7cfb;&#x5217;&#x7684;&#x89c4;&#x5219;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491273419317" ID="ID_1483708926" MODIFIED="1491273451896">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.headerisnt
    </p>
    <p>
      &#x5b9a;&#x4e49;&#x4e86;&#x5982;&#x4f55;&#x5b89;&#x88c5;&#x5185;&#x6838;&#x5934;&#x6587;&#x4ef6;&#x7684;&#x4e00;&#x7cfb;&#x5217;&#x89c4;&#x5219;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491273620395" ID="ID_1817956798" MODIFIED="1491273755725">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.modinst
    </p>
    <p>
      &#x5b9a;&#x4e49;&#x4e86;&#x5982;&#x4f55;&#x5b89;&#x88c5;&#x5185;&#x90e8;&#x6a21;&#x5757;&#x5230;INSTALL_MOD_PATH&#x8def;&#x5f84;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x53bb;&#x7684;&#x4e00;&#x4e9b;&#x5217;&#x7684;&#x89c4;&#x5219;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491273784403" ID="ID_994533779" MODIFIED="1491273854814">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.modpost
    </p>
    <p>
      &#x5728;2.6&#x5185;&#x6838;&#x7684;&#x7f16;&#x8bd1;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#xff0c;&#x6a21;&#x5757;&#x7684;&#x7f16;&#x8bd1;&#x9700;&#x8981;&#x4e24;&#x4e2a;&#x9636;&#x6bb5;&#x3002;
    </p>
    <p>
      &#x7b2c;&#x4e00;&#x4e2a;&#x9636;&#x6bb5;&#x662f;&#x5c06;&#x76f8;&#x5e94;&#x7684;&#x6e90;&#x4ee3;&#x7801;&#x7f16;&#x8bd1;&#x6210;.o&#x6587;&#x4ef6;&#xff0c;&#x7b2c;&#x4e8c;&#x4e2a;&#x9636;&#x6bb5;
    </p>
    <p>
      &#x662f;&#x5c06;&#x5bf9;&#x5e94;&#x7684;.o&#x6587;&#x4ef6;&#x94fe;&#x63a5;&#x6210;&#x6a21;&#x5757;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491273872569" ID="ID_715202670" MODIFIED="1491274922225">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Makefile.fwinst
    </p>
    <p>
      &#x5728;2.6.27&#x7248;&#x672c;&#x4e4b;&#x524d;&#xff0c;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x548c;&#x76f8;&#x5e94;&#x7684;&#x56fa;&#x4ef6;&#x662f;&#x4e00;&#x540c;&#x8fdb;&#x884c;&#x7f16;&#x8bd1;&#x7684;&#xff0c;
    </p>
    <p>
      &#x5728;2.6.27&#x7248;&#x672c;&#x53ca;&#x5176;&#x4e4b;&#x540e;&#x7684;&#x7248;&#x672c;&#xff0c;drivers/firmware&#x88ab;&#x5355;&#x72ec;&#x53d6;&#x51fa;&#x653e;&#x7f6e;
    </p>
    <p>
      &#x5230;firmware&#x76ee;&#x5f55;&#x91cc;&#x9762;&#xff0c;&#x8be5;&#x6587;&#x4ef6;&#x5c31;&#x662f;&#x5c06;firmware&#x91cc;&#x9762;&#x7684;&#x6587;&#x4ef6;&#x5b89;&#x88c5;&#x5230;
    </p>
    <p>
      &#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x7279;&#x5b9a;&#x7684;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1491274945610" ID="ID_428886487" MODIFIED="1491275055740">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4ee3;&#x7801;&#x6811;&#x4e0b;&#x5404;&#x76ee;&#x5f55;&#x7684;makefile
    </p>
    <p>
      &#x5185;&#x6838;&#x7684;&#x6784;&#x5efa;&#x662f;&#x4e00;&#x4e2a;&#x4e0d;&#x65ad;&#x9012;&#x5f52;&#x8fdb;&#x884c;&#x7684;&#x8fc7;&#x7a0b;&#xff0c;&#x5404;&#x4e2a;
    </p>
    <p>
      &#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;makefile&#x6587;&#x4ef6;&#x6216;&#x8005;&#x662f;kbuild&#x6587;&#x4ef6;&#x8d1f;&#x8d23;
    </p>
    <p>
      &#x5bf9;&#x672c;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;&#x6587;&#x4ef6;&#x8fdb;&#x884c;&#x7f16;&#x8bd1;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491276191281" ID="ID_1632312480" MODIFIED="1491276212554">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4ee3;&#x7801;&#x6811;&#x5404;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;&#x914d;&#x7f6e;&#x6587;&#x4ef6;Kconfig
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1491276991843" ID="ID_1298505986" MODIFIED="1526886430086">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7b2c;&#x4e09;&#x7bc7;&#xff1a;&#x9876;&#x5c42;Makefile&#x7684;&#x603b;&#x4f53;&#x6846;&#x67b6;&#x7ed3;&#x6784;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491291292295" ID="ID_1401334981" MODIFIED="1526886433712">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5f71;&#x54cd;&#x5185;&#x6838;&#x6784;&#x5efa;&#x52a8;&#x4f5c;&#x7684;&#x6709;&#x6570;&#x4e2a;&#x53d8;&#x91cf;:
    </p>
    <p>
      &#x7b2c;&#x4e00;&#x7ec4; KBUILD_SRC KBUILD_OUTPUT skip-makefile
    </p>
    <p>
      &#x7b2c;&#x4e8c;&#x7ec4; mixed-targets config-targets dot-config
    </p>
  </body>
</html></richcontent>
<node CREATED="1491291483053" ID="ID_1630354893" MODIFIED="1491291528992">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7b2c;&#x4e00;&#x7ec4;&#x53d8;&#x91cf;&#x662f;&#x4e3a;&#x4e86;&#x652f;&#x6301;&#x5c06;&#x7f16;&#x8bd1;&#x8f93;&#x51fa;&#x6587;&#x4ef6;&#x653e;&#x7f6e;
    </p>
    <p>
      &#x5230;&#x53e6;&#x5916;&#x7684;&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x53bb;&#x7684;&#x76ee;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491292160480" ID="ID_1388983278" MODIFIED="1526886438411">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7b2c;&#x4e8c;&#x7ec4;&#x547d;&#x4ee4;&#xff0c;&#x662f;&#x4e3a;&#x4e86;&#x9002;&#x5e94;make&#x547d;&#x4ee4;&#x6240;&#x8ddf;&#x7684;Targets
    </p>
    <p>
      &#x6570;&#x76ee;&#x548c;&#x7c7b;&#x578b;&#x4e0a;&#x7684;&#x591a;&#x6837;&#x6027;&#x800c;&#x5df2;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491292948363" ID="ID_1252189189" MODIFIED="1491296813503">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      no-dot-config-targets := clean clobber mrproper distclean \
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;help %docs check% coccicheck \
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ubootversion backup
    </p>
    <p>
      config-targets := 0
    </p>
    <p>
      mixed-targets&#xa0;&#xa0;:= 0
    </p>
    <p>
      dot-config&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;:= 1
    </p>
    <p>
      ifneq ($(filter $(no-dot-config-targets), $(MAKECMDGOALS)),)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ifeq ($(filter-out $(no-dot-config-targets), $(MAKECMDGOALS)),)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;dot-config := 0
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;endif
    </p>
    <p>
      endif
    </p>
    <p>
      <i><font color="#181de3">ifeq ($(KBUILD_EXTMOD),) </font></i>
    </p>
    <p>
      <i><font color="#181de3">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ifneq ($(filter config %config,$(MAKECMDGOALS)),) </font></i>
    </p>
    <p>
      <i><font color="#181de3">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;config-targets := 1 </font></i>
    </p>
    <p>
      <i><font color="#181de3">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ifneq ($(words $(MAKECMDGOALS)),1) </font></i>
    </p>
    <p>
      <i><font color="#181de3">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mixed-targets := 1&#xa0;&#xa0;&#x6df7;&#x5408;&#x76ee;&#x6807; </font></i>
    </p>
    <p>
      <i><font color="#181de3">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;endif </font></i>
    </p>
    <p>
      <i><font color="#181de3">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;endif </font></i>
    </p>
    <p>
      <i><font color="#181de3">endif</font></i>
    </p>
    <p>
      <font color="#d71c1c">&#x9876;&#x5c42;&#x7684;makefile 430&#x884c;&#x5de6;&#x53f3;&#x5b9a;&#x4e49;&#x4e86;&#x5982;&#x4e0a;&#x7684;&#x64cd;&#x4f5c;&#xff0c;&#x901a;&#x8fc7;&#x4e00;&#x4e2a;no-dot-config-targets&#x53d8;&#x91cf; </font>
    </p>
    <p>
      <font color="#d71c1c">&#x5b9a;&#x4e49;&#x4e86;&#x6240;&#x6709;&#x8ddf;.config&#x65e0;&#x5173;&#x7684;&#x76ee;&#x6807;&#x96c6;&#x5408;&#x3002;makefile&#x4f1a;&#x5206;&#x6790;&#x4ece;make&#x547d;&#x4ee4;&#x4f20;&#x5165;&#x7684;&#x53c2;&#x6570;&#x76ee;&#x6807; </font>
    </p>
    <p>
      <font color="#d71c1c">&#x5f53;&#x4e2d;&#x662f;&#x5426;&#x5b9a;&#x4e49;&#x4e86;&#x8ddf;.config&#x6709;&#x5173;&#x7684;&#x76ee;&#x6807;&#xff0c;&#x5982;&#x679c;&#x6709;&#x4e14;&#x4ec5;&#x6709;&#x5728;no-dot-config-targets&#x5f53;&#x4e2d;&#x5b9a;&#x4e49;&#x7684; </font>
    </p>
    <p>
      <font color="#d71c1c">target,&#x90a3;&#x4e48;&#x5c31;&#x5c06;dot-config&#x5b9a;&#x4e49;&#x6210;0&#xff0c;&#x5426;&#x5219;&#x5c31;&#x8bbe;&#x7f6e;&#x6210;&#x9ed8;&#x8ba4;&#x7684;1.</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491296240812" ID="ID_79779942" MODIFIED="1491296608346">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#2b2a89">ifeq ($(mixed-targets),1) </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">PHONY += $(MAKECMDGOALS) __build_one_by_one </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">$(filter-out __build_one_by_one, $(MAKECMDGOALS)): __build_one_by_one </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">&#xa0;&#xa0;&#xa0;&#xa0;@: </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">__build_one_by_one: </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">&#xa0;&#xa0;&#xa0;&#xa0;$(Q)set -e; \ </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">&#xa0;&#xa0;&#xa0;&#xa0;for i in $(MAKECMDGOALS); do \ </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(MAKE) -f $(srctree)/Makefile $$i; \ </font></i>
    </p>
    <p>
      <i><font color="#2b2a89">&#xa0;&#xa0;&#xa0;&#xa0;done</font></i>
    </p>
    <p>
      &#x5728;&#x6e90;&#x4ee3;&#x7801;&#x7684;&#x9876;&#x5c42;&#x76ee;&#x5f55;&#x5f53;&#x4e2d;&#xff0c;&#x4f1a;&#x5224;&#x65ad;&#x5f53;&#x524d;&#x8f93;&#x5165;&#x7684;&#x76ee;&#x6807;&#x662f;&#x4e0d;&#x662f;&#x6df7;&#x5408;&#x76ee;&#x6807;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x662f;&#x6df7;&#x5408;&#x76ee;&#x6807;&#x7684;&#x8bdd;&#xff0c;&#x5c31;&#x4f1a;&#x6328;&#x4e2a;&#x6267;&#x884c;&#x8f93;&#x5165;&#x7684;&#x76ee;&#x6807;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491296521562" ID="ID_747450763" MODIFIED="1491296593960">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5982;&#x679c;&#x53ea;&#x662f;&#x5355;&#x4e00;&#x7684;&#x914d;&#x7f6e;&#x76ee;&#x6807;&#xff0c;&#x90a3;&#x4e48;&#x8fdb;&#x884c;&#x5982;&#x4e0b;&#x7684;&#x5904;&#x7406;
    </p>
    <p>
      <i><font color="#d90e0e">KBUILD_DEFCONFIG := sandbox_defconfig </font></i>
    </p>
    <p>
      <i><font color="#d90e0e">export KBUILD_DEFCONFIG KBUILD_KCONFIG </font></i>
    </p>
    <p>
      <i><font color="#d90e0e">config: scripts_basic outputmakefile FORCE </font></i>
    </p>
    <p>
      <i><font color="#d90e0e">&#xa0;&#xa0;&#xa0;&#xa0;$(Q)$(MAKE) $(build)=scripts/kconfig $@ </font></i>
    </p>
    <p>
      <i><font color="#d90e0e">#The only place to match make xxx_defconfig </font></i>
    </p>
    <p>
      <i><font color="#d90e0e">%config: scripts_basic outputmakefile FORCE </font></i>
    </p>
    <p>
      <i><font color="#d90e0e">&#xa0;&#xa0;&#xa0;&#xa0;$(Q)$(MAKE) $(build)=scripts/kconfig $@</font></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1474123973928" ID="ID_164809639" MODIFIED="1526886882269">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e81313"><i>483 %config: scripts_basic outputmakefile FORCE </i></font>
    </p>
    <p>
      <font color="#e81313"><i>484&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(Q)$(MAKE) $(build)=scripts/kconfig $@ </i></font>
    </p>
    <p>
      &#x5355;&#x72ec;&#x5206;&#x6790;
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1474879387533" ID="ID_526139270" MODIFIED="1526886900365">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      scripts_basic:
    </p>
    <p>
      $(Q)$(MAKE) $(build)=scripts/basic
    </p>
    <p>
      $(Q)$(MAKE) -f $(srctree)/scripts/Makefile.build obj=scripts/basic
    </p>
    <p>
      <font color="#b30b0b">&#x8be5;make&#x547d;&#x4ee4;&#x7684;&#x5b9e;&#x9645;&#x6548;&#x679c;&#x662f;&#x53bb;&#x7f16;&#x8bd1;&#x51fa; scripts/basic &#x76ee;&#x5f55;&#x4e0b;&#x7684;host program</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1474880641204" ID="ID_1953050304" MODIFIED="1474880689162">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#d70707"><i>scripts/Makefile.lib&#x811a;&#x672c; </i></font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491197108638" ID="ID_59313829" MODIFIED="1526886902084">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#e82727">1.&#x5bf9;&#x7f16;&#x8bd1;&#x6587;&#x4ef6;Makefile.build&#x8fdb;&#x884c;&#x5206;&#x6790;</font></i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1491197213268" ID="ID_350613596" MODIFIED="1491203253555">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>a.&#x5224;&#x65ad;&#x4f20;&#x5165;&#x7684;obj&#x53d8;&#x91cf;&#x662f;&#x5426;&#x662f;&#x4ee5;tpl&#x6216;&#x8005;spl</i></b>
    </p>
    <p>
      &#x4f5c;&#x4e3a;&#x8def;&#x5f84;&#x7684;&#x5f00;&#x5934;&#x7684;&#xff0c;&#x5982;&#x679c;&#x662f;&#x5219;&#x5c06;&#x53d8;&#x91cf;prefix
    </p>
    <p>
      &#x8d4b;&#x503c;&#x6210;&#x4e3a;tpl&#x6216;&#x8005;spl,&#x5982;&#x679c;&#x4e0d;&#x662f;&#x5219;&#x5c06;&#x53d8;&#x91cf;prefix
    </p>
    <p>
      &#x8d4b;&#x503c;&#x4e3a;'.'
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491197524595" ID="ID_1446129436" MODIFIED="1491199834283">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>b.&#x5c06;&#x5982;&#x4e0b;&#x7684;&#x53d8;&#x91cf;&#x8fdb;&#x884c;&#x521d;&#x59cb;&#x5316;</i></b>
    </p>
    <p>
      obj-y obj-m lib-y lib-m always targets
    </p>
    <p>
      subdir-y subdir-m EXTRA_AFLAGS&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      EXTRA_CFLAGS&#xa0;EXTRA_CPPFLAGS
    </p>
    <p>
      EXTRA_LDFLAGS&#xa0;
    </p>
    <p>
      asflags-y&#xa0;ccflags-y&#xa0;cppflags-y ldflags-y&#xa0;
    </p>
    <p>
      subdir-asflags-y subdir-ccflags-y
    </p>
    <p>
      save-cflags := $(CFLAGS)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491197678522" ID="ID_761512240" MODIFIED="1501036442875">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>c.&#x5c06;&#x914d;&#x7f6e;&#x6587;&#x4ef6;&#x5305;&#x542b;&#x8fdb;&#x6765;</b>
    </p>
    <p>
      -include include/config/auto.conf
    </p>
    <p>
      -include $(prefix)/include/autoconf.mk
    </p>
    <p>
      include scripts/Makefile.uncmd_spl
    </p>
    <p>
      include scripts/Kbuild.include----&gt;&#x5305;&#x542b;kbuild&#x4f7f;&#x7528;&#x7684;&#x901a;&#x7528;&#x7684;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491298668058" ID="ID_921154180" MODIFIED="1491298723731">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if_changed&#x547d;&#x4ee4;
    </p>
    <p>
      &#x5f53;&#x76ee;&#x6807;&#x7684;&#x5148;&#x51b3;&#x6761;&#x4ef6;&#x6bd4;&#x76ee;&#x6807;&#x66f4;&#x65b0;&#x6216;&#x8005;&#x547d;&#x4ee4;&#x884c;&#x5df2;&#x7ecf;&#x88ab;
    </p>
    <p>
      &#x66f4;&#x6539;&#xff0c;&#x5219;&#x6267;&#x884c;&#x547d;&#x4ee4;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1491200900600" ID="ID_34862812" MODIFIED="1526886896120">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>d. &#x7531;&#x4e8e;&#x4f20;&#x5165;&#x7684;src = obj = scripts/basic</i></b>
    </p>
    <p>
      <i><font color="#be2c2c" face="Serif">&#x6240;&#x4ee5;&#x5728;basic&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x5bfb;&#x627e;Makefile&#x6216;&#x8005;&#x662f;Kbuild&#x6587;&#x4ef6;&#xff0c; </font></i>
    </p>
    <p>
      <i><font color="#be2c2c" face="Serif">&#x5305;&#x542b;&#x76f8;&#x5e94;&#x7684;&#x4f20;&#x5165;&#x7684;obj&#x76ee;&#x6807;&#x4e0b;&#x9762;&#x7684;makefile&#x6216;&#x8005;&#x662f;kbuild&#x6587;&#x4ef6;</font></i>
    </p>
    <p>
      &#x7136;&#x540e;&#x5305;&#x542b;&#x8be5;&#x6587;&#x4ef6;
    </p>
    <p>
      include $(kbuild-file)
    </p>
    <p>
      scripts/basic&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;Makefile&#x6587;&#x4ef6;&#x7528;&#x6765;&#x7f16;&#x8bd1;&#x751f;&#x6210;fixdep&#x7a0b;&#x5e8f;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ed640c" DESTINATION="ID_34862812" ENDARROW="Default" ENDINCLINATION="847;0;" ID="Arrow_ID_1785801322" SOURCE="ID_711080305" STARTARROW="None" STARTINCLINATION="847;0;"/>
</node>
<node CREATED="1491201278053" ID="ID_616799324" MODIFIED="1491201316762">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>e.&#x6dfb;&#x52a0;&#x5bf9;uboot&#x652f;&#x6301;&#x7684;&#x53d8;&#x91cf;</i></b>
    </p>
    <p>
      asflags-y&#xa0;&#xa0;+= $(PLATFORM_CPPFLAGS)
    </p>
    <p>
      ccflags-y&#xa0;&#xa0;+= $(PLATFORM_CPPFLAGS)
    </p>
    <p>
      cppflags-y += $(PLATFORM_CPPFLAGS)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491201663755" ID="ID_353480679" MODIFIED="1491201770163">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>e.&#x5305;&#x542b;&#x6587;&#x4ef6;include scripts/Makefile.lib</i></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491202397453" ID="ID_675764528" MODIFIED="1491203265538">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#d80f0f">f.</font>&#x68c0;&#x67e5;&#x53d8;&#x91cf;hostprogs-y&#x548c;hostprogs-m&#x662f;&#x5426;&#x4e3a;&#x7a7a;&#xff0c;</i></b>
    </p>
    <p>
      &#x5982;&#x679c;&#x4e0d;&#x662f;&#x7a7a;&#xff0c;&#x5219;&#x5c06;&#x6587;&#x4ef6;
    </p>
    <p>
      include scripts/Makefile.host
    </p>
    <p>
      &#x5305;&#x542b;&#x8fdb;&#x6765;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491203125783" ID="ID_936270056" MODIFIED="1491203224603">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>g. &#x5224;&#x65ad;KBUILD_SRC&#x662f;&#x5426;&#x4e3a;&#x7a7a;</i></b>&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x4e0d;&#x662f;&#x7a7a;(&#x4e00;&#x822c;&#x5728;&#x771f;&#x6b63;&#x7f16;&#x8bd1;uboot&#x7684;&#x65f6;&#x5019;&#x8be5;&#x503c;&#x4e0d;&#x7a7a;)&#xff0c;
    </p>
    <p>
      &#x5219;&#x6839;&#x636e;&#x4f20;&#x5165;&#x7684;obj&#x7684;&#x503c;&#xff0c;&#x521b;&#x5efa;obj&#x548c;obj-dirs&#x5bf9;&#x5e94;&#x7684;&#x76ee;&#x5f55;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491203556190" ID="ID_45250146" MODIFIED="1526890154392">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>h.&#x5982;&#x679c;&#x5df2;&#x7ecf;&#x771f;&#x6b63;&#x8fdb;&#x5165;&#x4e86;&#x7f16;&#x8bd1;&#x4ee3;&#x7801;&#x7684;&#x9636;&#x6bb5;&#xff0c;</i></b>&#x90a3;&#x4e48;&#x5c31;&#x901a;&#x8fc7;&#x5982;&#x4e0b;&#x7684;&#x8d4b;&#x503c;
    </p>
    <p>
      &#x6307;&#x5b9a;&#x7f16;&#x8bd1;&#x7ed3;&#x675f;&#x540e;&#x7684;&#x76f8;&#x5173;&#x7ed3;&#x679c;&#x7684;&#x4f4d;&#x7f6e;
    </p>
    <p>
      lib-target := $(obj)/lib.a
    </p>
    <p>
      builtin-target := $(obj)/built-in.o
    </p>
    <p>
      modorder-target := $(obj)/modules.order
    </p>
  </body>
</html></richcontent>
<node CREATED="1491206026956" ID="ID_1284916225" MODIFIED="1526890162313">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      122 __build: $(if $(KBUILD_BUILTIN),$(builtin-target) $(lib-target) $(extra-y)) \
    </p>
    <p>
      123&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(if $(KBUILD_MODULES),$(obj-m) $(modorder-target)) \
    </p>
    <p>
      124&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(subdir-ym) $(always)
    </p>
    <p>
      125&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@:
    </p>
    <p>
      &#x9876;&#x5c42;&#x76ee;&#x5f55;&#x7684;Makefile&#x6587;&#x4ef6;&#x5df2;&#x7ecf;&#x5c06;KBUILD_BUILTIN&#x8bbe;&#x7f6e;&#x6210;1&#xff0c;
    </p>
    <p>
      &#x800c;&#x5c06;KBUILD_MODULES&#x6ca1;&#x6709;&#x8fdb;&#x884c;&#x8bbe;&#x7f6e;&#xff0c;
    </p>
    <p>
      &#x4e5f;&#x5c31;&#x662f;&#x8bf4;u-boot&#x9ed8;&#x8ba4;&#x662f;&#x91c7;&#x7528;builtin&#x7f16;&#x8bd1;&#x6a21;&#x5f0f;&#x7684;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491297907135" ID="ID_1480152721" MODIFIED="1491298110793">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      $(builtin-target): $(obj-y) FORCE
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(call if_changed,link_o_target)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491298166133" ID="ID_1854524770" MODIFIED="1491298187334">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      $(lib-target): $(lib-y) FORCE
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(call if_changed,link_l_target)
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1491298289077" ID="ID_1554641990" MODIFIED="1491298348197">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5bf9;&#x4e8e;&#x76ee;&#x6807;outputmakefile,&#x5176;&#x5b9e;&#x53ea;&#x662f;&#x5728;make&#x547d;&#x4ee4;&#x5e26;&#x6709;
    </p>
    <p>
      O&#x9009;&#x9879;&#x7684;&#x65f6;&#x5019;&#x624d;&#x6709;&#x4f5c;&#x7528;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491298855240" ID="ID_711080305" LINK="#ID_34862812" MODIFIED="1526886896120">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5206;&#x6790;<i><font color="#e81313">$(Q)$(MAKE) $(build)=scripts/kconfig $@ </font></i></b>
    </p>
    <p>
      <b>&#x5373;&#x5206;&#x6790; </b>
    </p>
    <p>
      <b>make -f scripts/Makefile.build obj=scripts/kconfig s3c2410_defconfig</b>
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ed640c" DESTINATION="ID_34862812" ENDARROW="Default" ENDINCLINATION="847;0;" ID="Arrow_ID_1785801322" STARTARROW="None" STARTINCLINATION="847;0;"/>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1491299282142" ID="ID_383307405" MODIFIED="1526886894438">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x9996;&#x5148;&#x4f1a;&#x5305;&#x542b;scripts/kconfig&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x7684;makefile
    </p>
    <p>
      &#x6587;&#x4ef6;&#xff0c;&#x5bf9;&#x8be5;&#x6587;&#x4ef6;&#x8fdb;&#x884c;&#x5206;&#x6790;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491299695530" ID="ID_839625115" MODIFIED="1526886896626">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9996;&#x5148;&#x6211;&#x4eec;&#x627e;&#x5230;&#x9ed8;&#x8ba4;&#x7684;&#x76ee;&#x6807;&#xff1a;
    </p>
    <p>
      <i><font color="#d90505">115 %_defconfig: $(obj)/conf </font></i>
    </p>
    <p>
      <i><font color="#d90505">116&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(Q)$&lt; $(silent) --defconfig=arch/$(SRCARCH)/configs/$@ $(Kconfig) </font></i>
    </p>
    <p>
      <i><font color="#d90505">117 </font></i>
    </p>
    <p>
      <i><font color="#d90505">118 # Added for U-Boot (backward compatibility) </font></i>
    </p>
    <p>
      <i><font color="#d90505">119 %_config: %_defconfig </font></i>
    </p>
    <p>
      <i><font color="#d90505">120&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@:</font></i>
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x770b;&#x5230;u-boot&#x4e3a;%_config&#x505a;&#x4e86;&#x517c;&#x5bb9;&#x6027;&#x7684;&#x5904;&#x7406;&#xff0c;&#x7528;&#x4e8e;&#x5904;&#x7406;&#x5c31;&#x7248;&#x672c;&#x7684;&#x7f16;&#x8bd1;&#x65b9;&#x5f0f;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491300207239" ID="ID_510646270" MODIFIED="1491300262495">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      $(obj)/conf&#x662f;host&#x7a0b;&#x5e8f;&#xff0c;&#x5373;&#x8fdb;&#x884c;Kconfig&#x8fc7;&#x7a0b;&#x7684;&#x4e3b;&#x7a0b;&#x5e8f;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1491300347510" FOLDED="true" ID="ID_744119757" MODIFIED="1501829857031">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#310909">$(Q)$&lt; $(silent) --defconfig=arch/$(SRCARCH)/configs/$@ $(Kconfig) </font></i>
    </p>
    <p>
      <i><font color="#310909">$&lt;&#x8868;&#x793a;&#x7b2c;&#x4e00;&#x4e2a;&#x4f9d;&#x8d56;&#xff0c;&#x5373;conf&#x7a0b;&#x5e8f; </font></i>
    </p>
    <p>
      &#x6240;&#x4ee5;&#x8be5;&#x547d;&#x4ee4;&#x5982;&#x4e0b;:
    </p>
    <p>
      conf --defconfig=arch/../configs/s3c2410_defconfig kconfig
    </p>
    <p>
      &#x5728;u-boot&#x6e90;&#x4ee3;&#x7801;&#x76ee;&#x5f55;&#x7684;configs&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#xff0c;&#x6211;&#x4eec;&#x4ee5;&#x4e09;&#x661f;&#x4ee3;&#x7801;&#x4e3a;&#x4f8b;&#x5b50;&#xff0c;&#x53ef;&#x4ee5;&#x770b;&#x5230;&#x5982;&#x4e0b;&#x7684;
    </p>
    <p>
      &#x914d;&#x7f6e;&#x6587;&#x4ef6;:
    </p>
    <p>
      smdk2410_defconfig&#xa0;&#xa0;smdk5250_defconfig&#xa0;&#xa0;smdk5420_defconfig&#xa0; smdkc100_defconfig&#xa0;&#xa0;smdkv310_defconfig
    </p>
    <p>
      &#x8be5;&#x547d;&#x4ee4;&#x7684;&#x5b9e;&#x9645;&#x4f5c;&#x7528;&#x5c31;&#x662f;&#x8bfb;&#x53d6;&#x9ed8;&#x8ba4;&#x7684;&#x914d;&#x7f6e;&#x548c;&#x6e90;&#x4ee3;&#x7801;&#x9876;&#x5c42;&#x76ee;&#x5f55;&#x5f53;&#x4e2d;&#x7684;kconfig&#x914d;&#x7f6e;
    </p>
  </body>
</html></richcontent>
<node CREATED="1491300885089" ID="ID_170643425" MODIFIED="1491301254222">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="SansSerif">&#x5206;&#x6790;&#x6700;&#x9876;&#x5c42;&#x7684;Kconfig&#x6587;&#x4ef6;&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x770b;&#x5230;&#x9664;&#x4e86;&#x8bbe;&#x7f6e; </font>
    </p>
    <p>
      <font size="4" face="SansSerif">&#x4e00;&#x4e9b;&#x914d;&#x7f6e;&#x53d8;&#x91cf;&#x4e4b;&#x5916;&#xff0c;&#x8fd8;source&#x4e86;&#x5982;&#x4e0b;&#x8def;&#x5f84;&#x5f53;&#x4e2d;&#x7684;kconfig </font>
    </p>
    <p>
      <font size="4" face="SansSerif">source "arch/Kconfig"</font>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "common/Kconfig" </font></i></b>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "cmd/Kconfig" </font></i></b>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "dts/Kconfig" </font></i></b>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "net/Kconfig" </font></i></b>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "drivers/Kconfig" </font></i></b>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "fs/Kconfig" </font></i></b>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "lib/Kconfig" </font></i></b>
    </p>
    <p>
      <b><i><font size="4" face="SansSerif">source "test/Kconfig"</font></i></b>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="12"/>
</node>
</node>
</node>
<node CREATED="1491300309574" ID="ID_806401935" MODIFIED="1491300342031">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6211;&#x4eec;&#x770b;makefile&#x6587;&#x4ef6;&#x7684;&#x5f00;&#x901a;&#x8fdb;&#x884c;&#x4e86;&#x5982;&#x4e0b;&#x7684;&#x5904;&#x7406;
    </p>
    <p>
      15 SRCARCH := ..
    </p>
    <p>
      &#xa0;16
    </p>
    <p>
      &#xa0;17 ifdef KBUILD_KCONFIG
    </p>
    <p>
      &#xa0;18 Kconfig := $(KBUILD_KCONFIG)
    </p>
    <p>
      &#xa0;19 else
    </p>
    <p>
      &#xa0;20 Kconfig := Kconfig
    </p>
    <p>
      &#xa0;21 endif
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1491146234120" ID="ID_342765257" MODIFIED="1491146397131">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x6211;&#x4eec;&#x5728;&#x9876;&#x5c42;&#x76ee;&#x5f55;&#x7684;Makefile&#x6587;&#x4ef6;&#x91cc;&#x9762;&#x5df2;&#x7ecf;&#x770b;&#x5230;&#x4e86;&#x8be5;&#x8bed;&#x53e5;
    </p>
    <p>
      &#xa0;&#xa0;include scripts/Kbuild.include
    </p>
    <p>
      &#x5728;&#x6587;&#x4ef6;Kbuild.include&#x5f53;&#x4e2d;&#xff0c;&#x5b9a;&#x4e49;&#x4e86;&#x53d8;&#x91cf;build
    </p>
    <p>
      build := -f $(srctree)/scripts/Makefile.build obj
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1492248380396" ID="ID_1978186560" MODIFIED="1526886545703">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x7b2c;&#x56db;&#x7bc7;: &#x76ee;&#x6807;&#x6784;&#x5efa;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1492248424821" ID="ID_489443662" MODIFIED="1492248571354">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x9876;&#x5c42;&#x7684;Makefile&#x4f1a;&#x5206;&#x522b;&#x9488;&#x5bf9;<font color="#cb1717"><i>mix-target, config-targets&#x548c;dot-config</i></font>
    </p>
    <p>
      &#x8fdb;&#x884c;&#x5206;&#x652f;&#x5224;&#x65ad;&#xff0c; &#x5f53;&#x76ee;&#x524d;&#x65e2;&#x4e0d;&#x662f;mix-targets&#x548c;config-targest&#x7684;&#x65f6;&#x5019;&#xff0c;&#x6211;&#x4eec;
    </p>
    <p>
      &#x5c31;&#x8fdb;&#x5165;&#x4e86;dot-config&#x7684;&#x5224;&#x65ad;&#xff0c;dot-config&#x9488;&#x5bf9;&#x7684;&#x5c31;&#x662f;&#x975e;&#x914d;&#x7f6e;&#x4e4b;&#x7c7b;&#x7684;&#x76ee;&#x6807;&#x5bf9;&#x8c61;&#x3002;
    </p>
    <p>
      &#x5f53;dot-config==1&#x7684;&#x65f6;&#x5019;&#xff0c;&#x53ef;&#x4ee5;&#x786e;&#x5b9a;&#x662f;&#x9488;&#x5bf9;&#x76ee;&#x6807;&#x8fdb;&#x884c;&#x6784;&#x5efa;&#x4e86;&#xff0c;&#x800c;&#x4e0d;&#x662f;&#x505a;
    </p>
    <p>
      &#x4f8b;&#x5982;clean, mrproper&#x7b49;&#x76ee;&#x6807;&#x7684;&#x5904;&#x7406;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1492248639050" ID="ID_1769353011" MODIFIED="1526886556071" TEXT="&#x6784;&#x5efa;&#x8fc7;&#x7a0b;&#x5206;&#x6790;">
<node CREATED="1492249263351" ID="ID_835594399" MODIFIED="1526886577278">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9996;&#x5148;&#x4ecb;&#x7ecd;&#x4e00;&#x4e0b;make&#x5bf9;include&#x547d;&#x4ee4;&#x7684;&#x5904;&#x7406;&#x65b9;&#x5f0f;:
    </p>
    <p>
      makefile&#x4f1a;&#x9996;&#x5148;&#x5bfb;&#x627e;include&#x5bf9;&#x5e94;&#x7684;&#x6587;&#x4ef6;&#x662f;&#x5426;&#x5b58;&#x5728;&#xff0c;&#x5982;&#x679c;&#x4e0d;&#x5b58;&#x5728;&#x7684;&#x8bdd;
    </p>
    <p>
      &#x5c31;&#x8df3;&#x8fc7;&#x8be5;include&#x547d;&#x4ee4;&#x3002;&#x7b49;&#x5230;make&#x5c06;&#x6240;&#x6709;&#x7684;makefile&#x6587;&#x4ef6;&#x90fd;&#x8bfb;&#x53d6;&#x5b8c;&#x6210;
    </p>
    <p>
      &#x4e4b;&#x540e;&#xff0c;&#x4f1a;&#x5728;&#x5168;&#x5c40;&#x5bfb;&#x627e;&#x53ef;&#x4ee5;&#x91cd;&#x65b0;&#x751f;&#x6210;&#x8fd9;&#x4e9b;makefile&#x7684;&#x89c4;&#x5219;&#xff0c;&#x5982;&#x679c;&#x6709;&#x76f8;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      &#x89c4;&#x5219;&#xff0c;&#x90a3;&#x4e48;make&#x5c31;&#x4f1a;&#x751f;&#x6210;&#x8be5;makefile, &#x7136;&#x540e;make&#x53c8;&#x4f1a;&#x91cd;&#x65b0;&#x8bfb;&#x5165;&#x4e3b;makefile
    </p>
    <p>
      &#x548c;&#x76f8;&#x5e94;&#x9700;&#x8981;include&#x7684;&#x6587;&#x4ef6;&#xff0c;&#x76f4;&#x5230;&#x627e;&#x4e0d;&#x5230;&#x89c4;&#x5219;&#x91cd;&#x65b0;&#x751f;&#x6210;makefile&#x4e86;&#xff0c;&#x6700;&#x540e;
    </p>
    <p>
      &#x624d;&#x4f1a;&#x8fdb;&#x5165;&#x5bf9;&#x4e8e;&#x89c4;&#x5219;&#x7684;&#x5904;&#x7406;&#x5f53;&#x4e2d;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1492269075892" ID="ID_539573432" MODIFIED="1526891614047">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#1d9662">1.&#x6211;&#x4eec;&#x770b;&#x5230;&#x5728;&#x9876;&#x5c42;&#x7684;Makefile&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#xff0c;&#x4f1a;&#x6709;&#x4e00;&#x4e2a;&#x5224;&#x65ad;</font></i></b>
    </p>
    <p>
      <i><font color="#e00e0e">ifeq ($(dot-config),1) </font></i>
    </p>
    <p>
      <i><font color="#e00e0e">-include include/config/auto.conf </font></i>
    </p>
    <p>
      <i><font color="#e00e0e">-include include/config/auto.conf.cmd </font></i>
    </p>
    <p>
      <i><font color="#e00e0e">$(KCONFIG_CONFIG) include/config/auto.conf.cmd: ;&#xa0;&#xa0;&#xa0;&#xa0; </font><font color="#340f0f"># To avoid any implicit rule to kick in, define an empty command</font></i>
    </p>
    <p>
      <i><font color="#e00e0e">include/config/%.conf: $(KCONFIG_CONFIG) include/config/auto.conf.cmd </font></i>
    </p>
    <p>
      <i><font color="#e00e0e">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(Q)$(MAKE) -f $(srctree)/Makefile silentoldconfig </font></i>
    </p>
    <p>
      <i><font color="#e00e0e">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(Q)$(MAKE) -f $(srctree)/scripts/Makefile.autoconf || \ </font></i>
    </p>
    <p>
      <i><font color="#e00e0e">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;{ rm -f include/config/auto.conf; false; } </font></i>
    </p>
    <p>
      <i><font color="#e00e0e">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(Q)touch include/config/auto.conf</font></i>
    </p>
    <p>
      &#x6211;&#x4eec;&#x770b;&#x5230;&#x5982;&#x679c;&#x5224;&#x65ad;dot-config&#x4e3a;1&#xff0c;&#x5373;&#x5f53;&#x524d;&#x7684;&#x547d;&#x4ee4;&#x662f;&#x8fdb;&#x884c;&#x7cfb;&#x7edf;&#x7684;&#x6784;&#x5efa;&#xff0c;&#x90a3;&#x4e48;
    </p>
    <p>
      &#x5b83;&#x4f1a;&#x5305;&#x542b;&#x4e24;&#x4e2a;&#x91cd;&#x8981;&#x7684;&#x6587;&#x4ef6;&#xff0c;&#x4e00;&#x4e2a;&#x662f;auto.conf&#xff0c;&#x53e6;&#x4e00;&#x4e2a;&#x662f;auto.conf.cmd
    </p>
    <p>
      &#x540e;&#x9762;&#x7684;&#x4e00;&#x4e2a;&#x89c4;&#x5219;&#x662f;&#x7528;&#x6765;&#x6784;&#x5efa;auto.conf&#x548c;auto.conf.cmd&#x6587;&#x4ef6;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1492269883394" ID="ID_1017357685" MODIFIED="1492269911218" TEXT="KCONFIG_CONFIG&#x6307;&#x4ee3;&#x7684;&#x5c31;&#x662f;.config&#x6587;&#x4ef6;"/>
<node CREATED="1492270355739" ID="ID_1045030740" MODIFIED="1526890725931">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x770b;&#x770b;&#x751f;&#x6210;auto.conf&#x7684;&#x547d;&#x4ee4;
    </p>
    <p>
      $(Q)$(MAKE) -f $(srctree)/Makefile silentoldconfig
    </p>
    <p>
      &#x8be5;&#x547d;&#x4ee4;&#x5b9e;&#x9645;&#x4e0a;&#x6267;&#x884c;&#x7684;&#x662f;%config&#x76ee;&#x6807;&#xff0c;&#x6700;&#x7ec8;&#x4f1a;&#x8fdb;&#x5165;&#x5230;
    </p>
    <p>
      scripts/kconfig/Makefile&#x5bfb;&#x627e;silentoldconfig&#x76ee;&#x6807;
    </p>
    <p>
      <font color="#122fe8"><i>45 silentoldconfig: $(obj)/conf </i></font>
    </p>
    <p>
      <font color="#122fe8"><i>46&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$(Q)mkdir -p include/config include/generated </i></font>
    </p>
    <p>
      <font color="#122fe8"><i>47&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;$&lt; $(silent) --$@ $(Kconfig)&#xa0;&#xa0;&#xa0; </i></font><i><font color="#e10a20"><b>&#x8fd9;&#x53e5;&#x547d;&#x4ee4;&#x5c55;&#x5f00;&#x5c31;&#x662f;: conf --silentoldconfig Kconfig</b></font></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1492338608077" ID="ID_955062568" MODIFIED="1492338873933">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5bf9;&#x4e8e;&#x6700;&#x65b0;&#x7684;u-boot&#x4ee3;&#x7801;&#x6765;&#x8bf4;&#xff0c;&#x8be5;silentoldconfig&#x76ee;&#x6807;&#x9664;&#x4e86;
    </p>
    <p>
      &#x4f1a;&#x66f4;&#x65b0;.config, include/generated/autoconf.h&#x4ee5;&#x53ca;
    </p>
    <p>
      include/configs/*&#x7b49;&#x4f20;&#x7edf;&#x7684;linux&#x4e0b;&#x9762;&#x7684;&#x6587;&#x4ef6;&#xff0c;&#x5b83;&#x540c;&#x65f6;&#x8fd8;&#x4f1a;&#xff1a;
    </p>
    <p>
      1.&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x7b26;&#x53f7;&#x94fe;&#x63a5;"arch/${ARCH}/include/asm/arch"&#x7528;&#x4e8e;&#x6307;&#x5411;
    </p>
    <p>
      SoC/CPU&#x7279;&#x5b9a;&#x7684;&#x5934;&#x6587;&#x4ef6;&#x76ee;&#x5f55;
    </p>
    <p>
      
    </p>
    <p>
      2.&#x521b;&#x5efa; include/config.h&#x6587;&#x4ef6;
    </p>
    <p>
      3.&#x521b;&#x5efa;include/autoconf.mk&#x6587;&#x4ef6;
    </p>
    <p>
      4.&#x521b;&#x5efa;spl/include/autoconf.mk (SPL and TPL only)
    </p>
    <p>
      5.&#x521b;&#x5efa;&#x6587;&#x4ef6;tpl/include/autoconf.mk (TPL only)
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1492269442831" ID="ID_428221924" MODIFIED="1492269745073">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#0f6339">2.&#x770b;&#x770b;.config&#x6587;&#x4ef6;&#x662f;&#x5982;&#x4f55;&#x88ab;&#x4f7f;&#x7528;&#x7684;</font></i></b>
    </p>
    <p>
      &#x4f7f;&#x7528;.config&#x6587;&#x4ef6;&#x7684;&#x4e3b;&#x8981;&#x662f;&#x4e24;&#x4e2a;&#x90e8;&#x5206;&#xff0c;&#x4e00;&#x4e2a;&#x90e8;&#x5206;&#x662f;&#x5185;&#x6838;&#x6784;&#x5efa;&#x7cfb;&#x7edf;&#x6839;&#x636e;&#x914d;&#x7f6e;
    </p>
    <p>
      &#x6587;&#x4ef6;&#x4ea7;&#x751f;&#x6307;&#x5b9a;&#x7684;&#x5185;&#x6838;&#x955c;&#x50cf;&#xff0c;&#x53e6;&#x4e00;&#x4e2a;&#x90e8;&#x5206;&#x662f;linux&#x7684;&#x4ee3;&#x7801;&#x672c;&#x8eab;&#x901a;&#x8fc7;&#x914d;&#x7f6e;&#x6587;&#x4ef6;&#x6765;
    </p>
    <p>
      &#x8fdb;&#x884c;c&#x8bed;&#x8a00;&#x4ee3;&#x7801;&#x7684;&#x9884;&#x5904;&#x7406;&#x3002;&#x4f46;&#x662f;&#x4e8c;&#x8005;&#x90fd;&#x4e0d;&#x53ef;&#x80fd;&#x76f4;&#x63a5;&#x5730;&#x4f7f;&#x7528;.config&#x6587;&#x4ef6;&#xff0c;&#x524d;&#x8005;
    </p>
    <p>
      &#x662f;&#x901a;&#x8fc7;auto.conf&#x548c;auto.conf.cmd&#x6587;&#x4ef6;&#x6765;&#x4f7f;&#x7528;.config&#x6587;&#x4ef6;&#xff0c;&#x540e;&#x8005;&#x662f;&#x901a;&#x8fc7;
    </p>
    <p>
      autoconf.h&#x6587;&#x4ef6;&#x6765;&#x95f4;&#x63a5;&#x4f7f;&#x7528;.config&#x6587;&#x4ef6;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1526892904265" FOLDED="true" ID="ID_1253744710" MODIFIED="1576373037231">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#0f28e8">&#x5185;&#x6838;&#x7f16;&#x8bd1;&#x51fa;&#x6765;&#x7684;&#x51e0;&#x79cd;&#x683c;&#x5f0f;&#x53ca;&#x5176;&#x751f;&#x6210;&#x8fc7;&#x7a0b;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526892959128" ID="ID_130930099" MODIFIED="1526893410966">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>vmlinux</b>&#xa0;&#x5185;&#x6838;&#x7f16;&#x8bd1;&#x51fa;&#x6765;&#x7684;&#x6700;&#x539f;&#x59cb;&#x7684;elf&#x6587;&#x4ef6;
    </p>
    <p>
      <b>zImage</b>&#xa0;&#x7ecf;&#x8fc7;objcopy&#x5904;&#x7406;&#xff0c;gzip&#x538b;&#x7f29;&#x8fc7;&#x7684;&#x5185;&#x6838;&#x4e8c;&#x8fdb;&#x5236;&#x6587;&#x4ef6;&#xff0c;&#x81ea;&#x5e26;&#x89e3;&#x538b;&#x7f29;&#x7684;&#x7a0b;&#x5e8f;
    </p>
    <p>
      <b>bzImage </b>&#x8868;&#x793a;"big zImage",&#x5176;&#x8ddf;zImage&#x7684;&#x533a;&#x522b;&#x5c31;&#x662f;zImage&#x662f;&#x89e3;&#x538b;&#x7f29;&#x5230;&#x4f4e;&#x7aef;&#x5185;&#x5b58;&#x7684;(&#x7b2c;&#x4e00;&#x4e2a;640k)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bzImage&#x662f;&#x89e3;&#x538b;&#x5230;&#x9ad8;&#x7aef;&#x5185;&#x5b58;&#x7684;(&#x7b2c;&#x4e00;&#x4e2a;1M),&#x5982;&#x679c;&#x5185;&#x6838;&#x8f83;&#x5927;&#xff0c;&#x5e94;&#x8be5;&#x4f7f;&#x7528;bzImage
    </p>
    <p>
      <b>uImage</b>&#xa0;&#x662f;uboot&#x4e13;&#x7528;&#x7684;image,&#x5b83;&#x662f;&#x5728;zImage&#x7684;&#x524d;&#x9762;&#x6dfb;&#x52a0;&#x4e86;64byte&#x7684;&#x5934;&#x90e8;&#x4fe1;&#x606f;&#x5f62;&#x6210;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1571017459253" ID="ID_1798204731" MODIFIED="1594973656744" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#ff0000">USB&#x7cfb;&#x7edf;&#x5b66;&#x4e60;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1471313923568" ID="ID_984050240" MODIFIED="1594973656747" TEXT="USB&#x8bbe;&#x5907;&#x9a71;&#x52a8;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1586741500654" ID="ID_4126578" MODIFIED="1597301984701">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#3300ff">Linux&#35774;&#22791;&#39537;&#21160;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1471313935648" FOLDED="true" ID="ID_52548290" MODIFIED="1597302012148">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.<b><i>USB&#x8bbe;&#x5907;&#x7684;&#x903b;&#x8f91;&#x7ec4;&#x7ec7;&#x5f53;&#x4e2d;&#x5305;&#x542b;&#x8bbe;&#x5907;&#xff0c;&#x914d;&#x7f6e;&#xff0c;&#x63a5;&#x53e3;&#x548c;&#x7aef;&#x70b9;&#x56db;&#x4e2a;</i></b>
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x5f53;&#x4e2d;&#x53ef;&#x4ee5;&#x6709;&#x591a;&#x4e2a;&#x63a5;&#x53e3;
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x914d;&#x7f6e;&#x5f53;&#x4e2d;&#x53ef;&#x4ee5;&#x6709;&#x591a;&#x4e2a;&#x63a5;&#x53e3;---&gt;&#x914d;&#x7f6e;&#x5f53;&#x4e2d;&#x7684;&#x63a5;&#x53e3;&#x53ef;&#x4ee5;&#x88ab;&#x4e0d;&#x540c;&#x7684;&#x9a71;&#x52a8;&#x94fe;&#x63a5;
    </p>
    <p>
      
    </p>
    <p>
      a. ubs&#x8bbe;&#x5907;&#x53ef;&#x4ee5;&#x7528;&#x7ed3;&#x6784;&#x4f53;usb_device&#x6765;&#x8fdb;&#x884c;&#x8868;&#x793a;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;usb&#x8bbe;&#x7f6e;&#x63cf;&#x8ff0;&#x7b26;&#x5b9a;&#x4e49;&#x4e3a;usb_device_description
    </p>
    <p>
      b. usb&#x914d;&#x7f6e;&#x63cf;&#x8ff0;&#x7b26;:
    </p>
    <p>
      usb&#x914d;&#x7f6e;---&gt;usb_host_config
    </p>
    <p>
      usb&#x914d;&#x7f6e;&#x63cf;&#x8ff0;&#x7b26;----&gt;usb_config_descriptor
    </p>
    <p>
      
    </p>
    <p>
      c. &#x63a5;&#x53e3;&#x63cf;&#x8ff0;&#x7b26;
    </p>
    <p>
      usb&#x63a5;&#x53e3;&#x5728;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;&#x8868;&#x793a;-----&gt;usb_interface
    </p>
    <p>
      usb&#x63a5;&#x53e3;&#x63cf;&#x8ff0;&#x7b26;------&gt;usb_interface_descriptor
    </p>
    <p>
      
    </p>
    <p>
      d.&#x7aef;&#x70b9;&#x63cf;&#x8ff0;&#x7b26;
    </p>
    <p>
      usb&#x7aef;&#x70b9;&#x5728;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;&#x8868;&#x793a;-----&gt;usb_host_endpoint
    </p>
    <p>
      usb&#x7aef;&#x70b9;&#x63cf;&#x8ff0;&#x7b26;------&gt;usb_endpoint_descriptor
    </p>
    <p>
      <b>&#x7aef;&#x70b9;0&#x662f;&#x7528;&#x4f5c;&#x63a7;&#x5236;&#x7684;&#xff0c;&#x53ea;&#x8981;&#x8bbe;&#x5907;&#x8fde;&#x63a5;&#x540e;&#x4e0a;&#x7535;&#xff0c;&#x90a3;&#x4e48;&#x7aef;&#x70b9;0&#x5c31;&#x53ef;&#x4ee5; </b>
    </p>
    <p>
      <b>&#x4e0e;host&#x8fdb;&#x884c;&#x901a;&#x4fe1;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1471348973014" ID="ID_43470924" MODIFIED="1471349276814">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>struct usb_hub</b>&#xa0;{
    </p>
    <p>
      struct device&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*intfdev
    </p>
    <p>
      struct usb_device&#xa0;&#xa0;&#xa0;*hdev
    </p>
    <p>
      struct kref&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;kref
    </p>
    <p>
      struct urb&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*urb
    </p>
    <p>
      u8&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*buffer)[8]
    </p>
    <p>
      unsigned long&#xa0;&#xa0;&#xa0;&#xa0;event_bits[1]
    </p>
    <p>
      unsigned long&#xa0;&#xa0;&#xa0;&#xa0;change_bits[1]
    </p>
    <p>
      unsigned long&#xa0;&#xa0;&#xa0;&#xa0;removed_bits[1]
    </p>
    <p>
      unsigned long&#xa0;&#xa0;&#xa0;&#xa0;wakeup_bits[1]
    </p>
    <p>
      struct usb_hub_descriptor *descriptor
    </p>
    <p>
      struct usb_tt&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;tt
    </p>
    <p>
      struct delayed_work leds
    </p>
    <p>
      struct delayed_work init_work
    </p>
    <p>
      struct usb_port&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;**ports
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1471601216979" ID="ID_175921220" MODIFIED="1471601281725">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#x8bbe;&#x5907;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x914d;&#x7f6e;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x63a5;&#x53e3;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x8bbe;&#x7f6e;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x7aef;&#x70b9;
    </p>
    <p>
      usb_device&#xa0;&#xa0;usb_configuration&#xa0;&#xa0;usb_interface&#xa0;&#xa0;usb_host_interface&#xa0; usb_host_endpoint
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1471324351066" ID="ID_1540543093" MODIFIED="1471324554772">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2. usb&#x4e3b;&#x673a;&#x63a7;&#x5236;&#x5668;&#x9a71;&#x52a8;
    </p>
    <p>
      usb_hcd&#x7ed3;&#x6784;&#x4f53;&#x63cf;&#x8ff0;&#x4e3b;&#x673a;&#x63a7;&#x5236;&#x5668;&#x9a71;&#x52a8;&#xff0c;&#x5305;&#x542b;&#x4e3b;&#x673a;&#x63a7;&#x5236;&#x5668;&#x7684;
    </p>
    <p>
      &#x786c;&#x4ef6;&#x8d44;&#x6e90;&#x548c;&#x4e3b;&#x673a;&#x63a7;&#x5236;&#x5668;&#x9a71;&#x52a8;hc_driver
    </p>
  </body>
</html></richcontent>
<node CREATED="1597302027503" ID="ID_943910022" MODIFIED="1597302040103" TEXT="DWC3 &#x63a7;&#x5236;&#x5668;"/>
<node CREATED="1597304368917" ID="ID_316380794" MODIFIED="1597304384950" TEXT="host controller interface(HCI)">
<node CREATED="1597304501991" ID="ID_284270740" MODIFIED="1600762704008">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      HCI&#26159;&#19968;&#31181;&#23492;&#23384;&#22120;&#23618;&#38754;&#30340;&#25509;&#21475;&#65292;&#35813;&#25509;&#21475;&#20351;&#33021;&#20027;&#26426;&#25511;&#21046;&#22120;&#30828;&#20214;&#36319;&#20027;&#26426;&#25511;&#21046;&#22120;&#39537;&#21160;&#30340;&#36890;&#35759;
    </p>
    <p>
      A <b>host controller interface</b>&#160;(<b>HCI</b>) is a register-level <a class="mw-redirect" title="Interface (computer science)" href="https://en.wikipedia.org/wiki/Interface_(computer_science)">interface</a>&#160; that enables a <a class="mw-redirect" title="Host controller" href="https://en.wikipedia.org/wiki/Host_controller">host controller</a>&#160;for <a title="USB" href="https://en.wikipedia.org/wiki/USB">USB</a>&#160;or <a title="IEEE 1394" href="https://en.wikipedia.org/wiki/IEEE_1394">IEEE 1394</a>&#160; hardware to communicate with a host controller driver in software.
    </p>
    <p>
      <b>eXtensible Host Controller Interface</b>&#160;(<b>xHCI</b>) is a computer interface specification that defines a register-level description of a host controller for <a class="mw-redirect" title="Universal Serial Bus" href="https://en.wikipedia.org/wiki/Universal_Serial_Bus">Universal Serial Bus</a>&#160;(USB), which is capable of interfacing with USB 1.x, 2.0, and 3.x compatible devices.The specification is also referred to as the <a title="USB 3.0" href="https://en.wikipedia.org/wiki/USB_3.0">USB 3.0</a>&#160;host controller specification.
    </p>
  </body>
</html></richcontent>
<node CREATED="1598347174606" ID="ID_253761748" MODIFIED="1598347197788">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/xhci&#x901a;&#x7528;&#x67b6;&#x6784;&#x6846;&#x56fe;.PNG" />
  </body>
</html></richcontent>
<node CREATED="1598347351434" ID="ID_1198655944" MODIFIED="1598347824353">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff3300"><b>Doorbell Array</b></font>
    </p>
    <p>
      
    </p>
    <p>
      &#35813;array&#26159;&#19968;&#20010;&#26368;&#22810;&#21487;&#20197;&#36798;&#21040;256&#20010;&#23492;&#23384;&#22120;&#30340;array, &#25903;&#25345;&#22810;&#36798;255&#20010;usb&#35774;&#22791;&#25110;&#32773;&#26159;usb hub&#12290;
    </p>
    <p>
      &#27599;&#20010;doorbell&#23492;&#23384;&#22120;&#32473;&#31995;&#32479;&#25552;&#20379;&#20102;&#19968;&#20010;&#36890;&#30693;xhci&#26159;&#21542;&#26377;slot&#25110;&#32773;endpoint&#30456;&#20851;&#30340;&#24037;&#20316;&#38656;&#35201;&#23637;&#24320;&#30340;&#26426;&#21046;&#12290;
    </p>
    <p>
      &#20301;&#20110;doorbell&#23492;&#23384;&#22120;&#24403;&#20013;&#30340;DB&#30446;&#26631;&#22495;&#21487;&#20197;&#34987;&#35774;&#32622;&#25104;ringing&#30340;&#21407;&#22240;&#12290;
    </p>
    <p>
      register 0&#34987;&#20998;&#37197;&#32473;host controller&#29992;&#20110;&#21629;&#20196;ring&#30340;&#31649;&#29702;
    </p>
    <p>
      
    </p>
    <p>
      <font face="Times New Roman"><b>Device Slot</b></font>&#26159;&#19968;&#20010;&#26415;&#35821;&#65292;&#29992;&#20110;&#25351;&#20195;&#36319;&#19968;&#20010;&#29420;&#31435;&#30340;usb&#35774;&#22791;&#30456;&#20851;&#30340;&#19968;&#31995;&#21015;&#30340;xHCI&#25968;&#25454;&#32467;&#26500;&#65292;
    </p>
    <p>
      slot id&#34987;&#29992;&#20110;&#32034;&#24341;&#19968;&#20010;&#20855;&#20307;&#30340;device slot
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1597712695029" ID="ID_58887035" MODIFIED="1597712721249">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0033">xHCI ring&#30340;&#20998;&#26512;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1597712775938" ID="ID_160673966" MODIFIED="1597712802000">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/xhci-ring-01.jpg" />
  </body>
</html></richcontent>
</node>
<node CREATED="1597712860231" FOLDED="true" ID="ID_1242572414" MODIFIED="1600762346101">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" face="Times New Roman" color="#0000ff">ring&#30340;&#20998;&#31867;</font></b>
    </p>
    <p>
      &#19968;&#20010;RING&#21487;&#33021;&#30001;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;SEGMENT&#26500;&#25104;
    </p>
    <p>
      &#27599;&#20010;SEGMENT&#21017;&#26377;&#22810;&#20010;TRB&#26500;&#25104;
    </p>
    <p>
      &#22810;&#20010;SEGMENT&#30340;&#38142;&#25509;&#26159;&#30001;LINK TRB&#26469;&#23454;&#29616;&#30340;&#65292;LINK&#23601;&#22914;&#21516;&#21333;&#38142;&#34920;&#65292;
    </p>
    <p>
      &#26368;&#21518;&#19968;&#20010;LINK TRB&#25351;&#21521;&#31532;&#19968;&#20010;SEGMENT&#65292;&#24418;&#25104;&#19968;&#20010;&#29615;&#65292;RING
    </p>
  </body>
</html></richcontent>
<node CREATED="1597712871155" ID="ID_1378403688" MODIFIED="1597712875911" TEXT="COMMAND"/>
<node CREATED="1597712880433" ID="ID_1725925496" MODIFIED="1597712882823" TEXT="EVENT"/>
<node CREATED="1597712886396" ID="ID_1617411837" MODIFIED="1597712889456" TEXT="TRANSFER">
<node CREATED="1597713207112" ID="ID_744984554" MODIFIED="1597713251949">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#38024;&#23545;USB CONTROL TRANSFER&#30340;
    </p>
    <p>
      SETUP DATA STATUS&#160;&#160;&#160;TRBs
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597713256893" ID="ID_1280567077" MODIFIED="1597713297026">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#38024;&#23545;BULK, INTERRUPT&#65292;ISO TRANSFER&#30340;NORMAL TRB
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597713300577" ID="ID_416024450" MODIFIED="1597713396563">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#38024;&#23545;ISO TRANSFER&#30340;ISOCH TRB
    </p>
    <p>
      (ISO TD&#30001;&#19968;&#20010;ISOCH TRB&#21644;0&#20010;&#25110;&#32773;&#22810;&#20010;NORMAL TRB&#25152;&#26500;&#25104;)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598404023680" ID="ID_226874291" MODIFIED="1598404057986">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff"><b>Transfer Ring&#30340;&#31649;&#29702;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598404133094" ID="ID_1451932802" MODIFIED="1598404186626">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#ff0033" face="Times New Roman"><i>&#20027;&#35201;&#26159;&#20171;&#32461; Enqueue &#21644; Dequeue Pointers&#30340;&#31649;&#29702;</i></font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598404384874" ID="ID_1202400293" MODIFIED="1598404394004">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/xhci-TransferRing-management.PNG" />
  </body>
</html></richcontent>
</node>
<node CREATED="1598404525701" ID="ID_404629051" MODIFIED="1598420529100">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20301;&#20110;TRB&#24403;&#20013;&#30340;<font color="#ff0000"><b>Cycle bit</b></font>&#29992;&#26469;&#34920;&#31034;&#20301;&#20110;transfer ring&#37324;&#38754;&#30340;Enqueue Pointer
    </p>
    <p>
      &#30340;&#20301;&#32622;&#65292;&#36719;&#20214;&#21487;&#20197;&#20351;&#29992;&#21644;&#32500;&#25252;&#27599;&#20010;transfer ring&#30340;Enqueue&#21644;Dequeue&#25351;&#38024;&#30340;
    </p>
    <p>
      &#31169;&#26377;&#25335;&#36125;
    </p>
    <p>
      &#24403;Transfer Ring&#21021;&#22987;&#21270;&#30340;&#26102;&#20505;&#65292;Enqueue&#21644;Dequeue&#25351;&#38024;&#20250;&#34987;&#35774;&#32622;&#25104;&#25351;&#21521;&#31532;&#19968;&#20010;TRB&#30340;&#20301;&#32622;&#65292;
    </p>
    <p>
      &#24182;&#19988;&#35813;&#20301;&#32622;&#20250;&#34987;&#20889;&#20837;&#21040; <font color="#ff0000"><b>Endpoint/Stream Context TR Dequeue Pointer</b></font>&#22495;
    </p>
  </body>
</html></richcontent>
<node CREATED="1598419067348" ID="ID_992646552" MODIFIED="1598419522842">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36719;&#20214;&#20351;&#29992;Enqueue&#25351;&#38024;&#26469;&#20915;&#23450;&#22312;transfer ring&#19978;&#38754;&#25918;&#32622;&#19979;&#19968;&#20010;&#24037;&#20316;&#39033;&#30340;&#20301;&#32622;&#65292;
    </p>
    <p>
      &#36719;&#20214;&#36890;&#36807;&#23558;Enqueue&#25351;&#38024;&#36882;&#22686;TRB&#30340;&#22823;&#23567;&#26469;&#25512;&#36827;&#25351;&#38024;&#65292;&#25110;&#32773;&#22312;&#36935;&#21040;Link TRB&#30340;&#26102;&#20505;&#20351;&#29992;
    </p>
    <p>
      <font color="#3300ff"><b>Ring Segment Pointer</b></font>&#22495;&#20540;&#26469;&#26356;&#26032;Enqueue&#25351;&#38024;&#12290;Enqueue&#25351;&#38024;&#20063;&#20250;&#22312;Transfer Ring&#24403;&#20013;
    </p>
    <p>
      &#36890;&#36807;Cycle bit&#36827;&#34892;&#26631;&#35760;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598419803687" ID="ID_263984725" MODIFIED="1598420525731">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36890;&#36807;&#21033;&#29992;Enqueue&#25351;&#38024;&#65292;&#21487;&#20197;&#20915;&#23450;Transfer Ring&#26159;&#21542;&#26159;&#31354;&#12290;
    </p>
    <p>
      &#24403;&#20174;Transfer Ring&#37324;&#38754;&#33719;&#21462;TRBs&#30340;&#26102;&#20505;&#65292;&#21487;&#20197;&#26816;&#26597;Cycle bit&#30340;&#32763;&#36716;&#65292;
    </p>
    <p>
      &#22914;&#26524;&#20986;&#29616;&#20102;Cycle bit&#30340;&#32763;&#36716;&#65292;&#35828;&#26126;ring&#24050;&#32463;&#31354;&#20102;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#36719;&#20214;&#20351;&#29992;Dequeue&#25351;&#38024;&#26469;&#20915;&#23450;&#20160;&#20040;&#26102;&#20505;Transfer Ring&#26159;&#28385;&#30340;&#65292;
    </p>
    <p>
      &#22914;&#26524;Dequeue&#25351;&#38024;&#21644;Enqueue&#25351;&#38024;&#30456;&#31561;&#65292;&#37027;&#20040;&#21487;&#20197;&#21028;&#26029;ring&#26159;&#28385;&#30340;&#12290;
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598420531998" ID="ID_160984697" MODIFIED="1598420818428">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Enqueue Pointer&#26159;&#30001;producer&#26469;&#31649;&#29702;&#30340;&#65292;
    </p>
    <p>
      Dequeue Pointer&#26159;&#30001;consumer&#26469;&#31649;&#29702;&#30340;&#65292;
    </p>
    <p>
      producer&#32500;&#25252;&#30528;<font color="#ff0000"><b>PCS</b></font>&#26631;&#24535;&#65292;&#35813;&#26631;&#24535;&#26631;&#26126;producer&#24212;&#35813;&#20889;&#20837;&#21040;TRB Cycle bit&#37324;&#38754;&#30340;&#20540;&#65292;
    </p>
    <p>
      consumer&#32500;&#25252;&#30528;<font color="#ff0000">CCS</font>&#26631;&#24535;&#65292;&#35813;&#26631;&#24535;&#20250;&#36319;&#33719;&#21462;&#30340;TRB&#37324;&#38754;&#30340;cycle bit&#36827;&#34892;&#27604;&#23545;&#65292;&#22914;&#26524;CCS
    </p>
    <p>
      &#26631;&#24535;&#36319;TRB Cycle bit&#26159;&#30456;&#31561;&#30340;&#65292;&#37027;&#20040;consumer&#23601;&#33719;&#21462;&#35813;TRB&#30340;&#25152;&#26377;&#26435;&#65292;&#21542;&#21017;consumer
    </p>
    <p>
      &#24212;&#35813;&#20572;&#27490;&#22788;&#29702;TRB&#24182;&#19988;&#31561;&#24453;work&#36890;&#30693;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598421566012" ID="ID_821545223" MODIFIED="1598421587450">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#24403;&#29983;&#20135;&#32773;&#25110;&#32773;&#28040;&#36153;&#32773;&#21040;&#36798;&#25968;&#32452;&#30340;&#26411;&#23614;&#26102; (xhci&#36890;&#36807;link&#26041;&#24335;&#23454;&#29616;, &#20855;&#20307;&#21442;&#32771;&#25163;&#20876;), </b>
    </p>
    <p>
      <b>&#38656;&#35201;&#23558;&#33258;&#24049;&#30340;PCS/CCS&#36827;&#34892;&#32763;&#36716;.</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1597713662692" ID="ID_1205636359" MODIFIED="1597714042860">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      TD&#34920;&#31034;&#19968;&#20010;USB TRANSFER
    </p>
    <p>
      &#22312;TRB&#24403;&#20013;&#65292;&#26377;&#19968;&#20010;CH BIT&#65292;&#22914;&#26524;&#19968;&#22788;TD&#30001;&#22810;&#20010;TRB&#26500;&#25104;&#65292;&#21017;&#38656;&#35201;&#23558;&#38500;&#26368;&#21518;&#19968;&#20010;TRB&#20043;&#22806;&#30340;
    </p>
    <p>
      &#25152;&#26377;&#30340;CH BIT&#32622;&#20301;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597714534189" FOLDED="true" ID="ID_300456583" MODIFIED="1600762339464">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#cc00cc" size="4">&#39537;&#21160;&#20195;&#30721;&#25968;&#25454;&#32467;&#26500;&#20998;&#26512;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1597714685690" ID="ID_776999732" MODIFIED="1597714737309">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct xhci_segment {
    </p>
    <p>
      &#160;&#160;&#160; <b>union xhci_trb&#160;&#160;&#160;&#160;&#160;&#160;*trbs;</b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* private to HCD */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct xhci_segment *next;
    </p>
    <p>
      &#160;&#160;&#160;&#160;dma_addr_t&#160;&#160;&#160;&#160;&#160;&#160;dma;
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* Max packet sized bounce buffer for td-fragmant alignment */
    </p>
    <p>
      &#160;&#160;&#160;&#160;dma_addr_t&#160;&#160;&#160;&#160;&#160;&#160;bounce_dma;
    </p>
    <p>
      &#160;&#160;&#160;&#160;void&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*bounce_buf;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bounce_offs;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bounce_len;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<node CREATED="1597714768039" ID="ID_736676769" MODIFIED="1597714859034">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font size="4" face="Times New Roman">union xhci_trb { </font></i>
    </p>
    <p>
      <i><font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_link_trb&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;link; </font></i>
    </p>
    <p>
      <i><font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_transfer_event&#160;&#160;trans_event; </font></i>
    </p>
    <p>
      <i><font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_event_cmd&#160;&#160;&#160;&#160;&#160;&#160;&#160;event_cmd; </font></i>
    </p>
    <p>
      <i><font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_generic_trb&#160;&#160;&#160;&#160;&#160;generic; </font></i>
    </p>
    <p>
      <i><font size="4" face="Times New Roman">}; </font></i>
    </p>
    <p>
      &#19968;&#20010;segment&#26159;&#30001;&#22810;&#20010;trbs&#26500;&#25104;&#30340;&#65292;&#25152;&#20197;&#20351;&#29992;union&#26469;&#34920;&#31034;trb
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597714912636" ID="ID_1043106788" MODIFIED="1597714964215">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">dma</font></b>
    </p>
    <p>
      &#35813;&#27573;trbs&#30340;&#39318;&#24635;&#32447;&#22320;&#22336;&#65292;&#30828;&#20214;&#36890;&#36807;&#35813;&#22320;&#22336;&#26469;&#21462;trbs
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597715021762" ID="ID_1815441140" MODIFIED="1597715067160">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      bound_buf
    </p>
    <p>
      linux&#39537;&#21160;&#38024;&#23545;XHCI SPEC 4.11.7.1 TD Fragments&#21152;&#20837;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1597715390734" ID="ID_1485792855" MODIFIED="1597715924492">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman">struct xhci_td { </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct list_head&#160;&#160;&#160;&#160;td_list; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct list_head&#160;&#160;&#160;&#160;cancelled_td_list; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct urb&#160;&#160;&#160;&#160;&#160;&#160;*urb;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font><font size="4" face="Times New Roman" color="#ff3333">&#19978;&#23618;&#30340;&#32467;&#26500;&#65292;&#26368;&#32456;&#34987;&#39537;&#21160;&#20998;&#35299;&#20026;TRB</font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_segment *start_seg; </font><b><font size="4" face="Times New Roman" color="#0000ff">&#19968;&#20010;TD&#24403;&#20013;&#30340;&#31532;&#19968;&#20010;SEGMENT</font></b>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;union xhci_trb&#160;&#160;&#160;&#160;&#160;&#160;*first_trb; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;union xhci_trb&#160;&#160;&#160;&#160;&#160;&#160;*last_trb; </font><font size="4" face="Times New Roman" color="#ff3333">&#36215;&#22987;&#21644;&#32467;&#26463;&#30340;TRB&#65292;&#26500;&#25104;&#20102;&#19968;&#20010;TD</font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_segment *bounce_seg; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;/* actual_length of the URB has already been set */ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;bool&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;urb_length_set; </font><font size="4" face="Times New Roman" color="#ff0033">&#29992;&#20110;&#21028;&#26029;actual transfer length&#26159;&#21542;&#24050;&#32463;&#34987;&#35774;&#32622;&#36807;</font>
    </p>
    <p>
      <font size="4" face="Times New Roman">};</font>
    </p>
    <p>
      &#30828;&#20214;&#19978;&#65292;&#19968;&#20010;TD(transfer descriptor)&#26159;&#30001;CH bit&#26469;&#23454;&#29616;&#30340;&#65292;&#21363;&#19968;&#20010;TD&#24403;&#20013;&#30340;&#25152;&#26377;TRB&#65292;&#38500;&#20102;
    </p>
    <p>
      &#26368;&#21518;&#19968;&#20010;&#30340;CH BIT&#32622;1&#65292; &#36825;&#26679;RING&#24403;&#20013;&#30340;TD&#19982;TD&#20043;&#38388;&#23601;&#20998;&#24320;&#20102;&#65292;
    </p>
    <p>
      &#36719;&#20214;&#19978;&#21017;&#26159;&#36890;&#36807;list_head&#30340;&#24418;&#24335;&#26469;&#31649;&#29702;TD
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597715990965" ID="ID_526859346" MODIFIED="1597716555062">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman">struct xhci_ring { </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_segment *first_seg; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_segment *last_seg; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160; </font><font color="#ff0033" face="Times New Roman">union&#160;&#160;xhci_trb&#160;&#160;&#160;&#160;&#160;*enqueue; </font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_segment *enq_seg; </font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman">&#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;enq_updates; </font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman">&#160;&#160;&#160;&#160;union&#160;&#160;xhci_trb&#160;&#160;&#160;&#160;&#160;*dequeue; </font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman">&#160;&#160;&#160;&#160;struct xhci_segment *deq_seg; </font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman">&#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;deq_updates; &#29983;&#20135;&#32773;&#65288;SW&#65289;&#36890;&#36807;enqueue ptr&#26469;&#25351;&#23450;&#25918;&#20837;TRB&#30340;&#20301;&#32622; </font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#28040;&#36153;&#32773;&#65288;HW&#65289;&#36890;&#36807;dequeue ptr&#26469;&#25351;&#23450;&#21462;&#24471;TRB&#30340;&#20301;&#32622;</font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;struct list_head&#160;&#160;&#160;&#160;td_list; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;/* </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;&#160;* Write the cycle state into the TRB cycle field to give ownership of </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;&#160;* the TRB to the host controller (if we are the producer), or to check </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;&#160;* if we own the TRB (if we are the consumer).&#160;&#160;See section 4.9.1. </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;&#160;*/ </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;u32&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cycle_state;&#160; </font><font size="4" face="Times New Roman">&#21028;&#26029;&#24403;&#21069;dequeue ptr&#25351;&#21521;&#30340;TRB&#26159;&#26377;&#25928;&#38656;&#35201;&#25191;&#34892;&#30340;&#65292;&#36824;&#26159;&#19981;&#38656;&#35201;&#25191;&#34892;&#30340;&#26080;&#25928;TRB</font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;stream_id; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;num_segs; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;num_trbs_free; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;num_trbs_free_temp; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;unsigned int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;bounce_buf_len; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;enum xhci_ring_type type;&#160; <b>&#35813;RING&#30340;&#31867;&#22411;</b> </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;bool&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;last_td_was_short;&#160; <b>&#34920;&#31034;&#19968;&#20010;TD&#26159;&#21542;&#20026;&#30701;&#21253;&#32467;&#26463;</b> </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;struct radix_tree_root&#160;&#160;*trb_address_map;&#160; <b>RADIX TREE&#65292;&#29992;&#26469;&#26597;&#25214;TRB</b> </font>
    </p>
    <p>
      <font face="Times New Roman">}; </font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1597802462159" FOLDED="true" ID="ID_698243343" MODIFIED="1600849715140">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: Type-C Sink (powered) connected
    </p>
    <p>
      msm-dwc3 a600000.ssusb: host:1 (id:0) event received&#160;&#160;type-c&#25509;&#21475;&#25554;&#20837;&#30340;&#26102;&#20505;&#25253;&#20107;&#20214;&#65311;
    </p>
    <p>
      
    </p>
    <p>
      msm-dwc3 a600000.ssusb: dwc3_resume_work: dwc3 resume work&#160;&#160;DWC3&#36827;&#20837;resume&#29366;&#24577;
    </p>
    <p>
      
    </p>
    <p>
      msm-dwc3 a600000.ssusb: dwc3_otg_start_host: turn on host&#160;&#160;DWC3&#20999;&#25442;&#25104;host&#27169;&#24335;&#65311;
    </p>
    <p>
      
    </p>
    <p>
      msm-usb-ssphy-qmp 88e8000.ssphy: QMP phy connect notification&#160;&#160;3.0&#30340;phy&#23618;&#21551;&#21160;&#65311;
    </p>
    <p>
      msm-qusb-phy-v2 88e2000.qusb: QUSB PHY: connect notification cable_connected=1&#160;&#160;2.0&#30340;phy&#23618;&#21551;&#21160;&#65311;
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      msm-qusb-phy-v2 88e2000.qusb: qusb_phy_init&#160;&#160;usb2.0 phy&#36827;&#20837;&#21021;&#22987;&#21270;&#36807;&#31243;
    </p>
    <p>
      sm-usb-ssphy-qmp 88e8000.ssphy: Initializing QMP phy&#160;&#160;usb3.0 phy&#36827;&#20837;&#21021;&#22987;&#21270;&#36807;&#31243;
    </p>
    <p>
      msm-dwc3 a600000.ssusb: DWC3_CONTROLLER_RESET_EVENT received&#160;&#160;DWC3&#34987;reset
    </p>
    <p>
      msm-dwc3 a600000.ssusb: DWC3_CONTROLLER_POST_RESET_EVENT received
    </p>
    <p>
      
    </p>
    <p>
      dwc3 a600000.dwc3: Disabling controller clock gating.&#160;&#160;&#32469;&#36807;&#31995;&#32479;&#30340;&#26576;&#20123;bug
    </p>
    <p>
      msm-dwc3 a600000.ssusb: dwc3_pwr_event_handler link state = 0x0005 &#36827;&#20837;&#21040;&#20102;
    </p>
    <p>
      DWC3_LINK_STATE_RX_DET&#160;&#160;&#160;&#160;&#160;&#160;= 0x05, /* in HS, means Early Suspend */ &#29366;&#24577;
    </p>
    <p>
      
    </p>
    <p>
      msm-qusb-phy-v2 88e2000.qusb: qusb_phy_init usb2.0 phy&#21448;&#19968;&#27425;&#36827;&#20837;&#20102;&#21021;&#22987;&#21270;&#36807;&#31243;
    </p>
    <p>
      
    </p>
    <p>
      xhci-hcd xhci-hcd.0.auto: xHCI Host Controller&#160;&#160;&#160;xhci&#24320;&#22987;&#21021;&#22987;&#21270;&#65292;&#26377;&#21487;&#33021;&#26159;&#22312;PCI&#39537;&#21160;&#37324;&#38754;&#35843;&#29992;xhci_init_driver&#65292;
    </p>
    <p>
      &#33719;&#21462;&#21040;xhci&#30340;&#25805;&#20316;&#38598; <b><font color="#ff0000">static const struct hc_driver xhci_hc_driver</font></b>
    </p>
    <p>
      Calling HCD init
    </p>
    <p>
      int xhci_gen_setup(struct usb_hcd *hcd, xhci_get_quirks_t get_quirks)
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1597814680241" ID="ID_1853295193" MODIFIED="1598265850916">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dwc3-msm.c &#25991;&#20214;&#37324;&#38754;&#26377;&#20010;&#20989;&#25968;
    </p>
    <p>
      static int dwc3_otg_start_host(struct dwc3_msm *mdwc, int on)
    </p>
    <p>
      &#35813;&#20989;&#25968;&#20250;&#26681;&#25454;usb&#35774;&#22791;&#30340;&#25554;&#25300;&#34987;&#21160;&#24577;&#35843;&#29992;&#65292; &#27880;&#24847;&#35813;&#20989;&#25968;&#30340;&#22914;&#19979;&#30340;&#37325;&#35201;&#21160;&#20316;
    </p>
    <p>
      a. struct dwc3 *dwc = platform_get_drvdata(mdwc-&gt;dwc3);
    </p>
    <p>
      b. ret = dwc3_host_init(dwc);
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci = platform_device_alloc(&quot;xhci-hcd&quot;, PLATFORM_DEVID_AUTO);&#160; &#21019;&#24314;&#24182;&#27880;&#20876;&#19968;&#20010;&#21517;&#21483;xhci-hcd&#30340;&#24179;&#21488;&#35774;&#22791;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;<font size="4" color="#0000ff" face="Times New Roman"><i>phy_create_lookup(dwc-&gt;usb2_generic_phy, &quot;usb2-phy&quot;,dev_name(dwc-&gt;dev)); </i></font>
    </p>
    <p>
      <font size="4" color="#0000ff" face="Times New Roman"><i>&#160;&#160;&#160;&#160;&#160;phy_create_lookup(dwc-&gt;usb3_generic_phy, &quot;usb3-phy&quot;,dev_name(dwc-&gt;dev));</i></font>
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;dev.parent&#160;&#160;&#160;&#160;= dwc-&gt;dev;
    </p>
    <p>
      
    </p>
    <p>
      c. &#36339;&#36716;&#21040;&#25991;&#20214;xhci-plat.c
    </p>
    <p>
      &#31995;&#32479;&#19968;&#26086;&#20390;&#27979;&#21040;&#26377;xhci-hcd&#30340;&#24179;&#21488;&#35774;&#22791;&#34987;&#27880;&#20876;&#21040;&#31995;&#32479;&#24403;&#20013;&#65292;&#23601;&#20250;&#35843;&#29992;usb_xhci_driver&#20989;&#25968;&#24403;&#20013;&#30340;probe&#20989;&#25968;
    </p>
    <p>
      <font color="#006666"><b>static int xhci_plat_probe(struct platform_device *pdev)</b></font>
    </p>
    <p>
      &#27880;&#24847;linux&#31995;&#32479;&#22312;&#21551;&#21160;&#30340;&#26102;&#20505;&#20250;&#27880;&#20876;usb_xhci_driver&#39537;&#21160;&#65292;&#22914;&#19979;&#25152;&#31034;
    </p>
    <p>
      static int __init xhci_plat_init(void)
    </p>
    <p>
      {
    </p>
    <p>
      &#160;&#160;&#160; <font color="#ff0000">xhci_init_driver(&amp;xhci_plat_hc_driver, &amp;xhci_plat_overrides); </font>
    </p>
    <p>
      <font color="#3300cc">&#20989;&#25968;&#21407;&#22411;&#65306; void xhci_init_driver(struct hc_driver *drv, const struct xhci_driver_overrides *over)</font>
    </p>
    <p>
      &#160;&#160;&#160;&#160;return platform_driver_register(&amp;usb_xhci_driver);
    </p>
    <p>
      } &#27880;&#24847;xhci_init_driver&#65292;&#23454;&#38469;&#19978;&#26159;&#23558;xhci&#30340;&#25805;&#20316;&#38598; struct hc_driver xhci_hc_driver&#36171;&#20540;&#32473;&#20102;<font color="#0000ff"><b><i>xhci_plat_hc_driver</i></b></font>&#65292;
    </p>
    <p>
      &#21516;&#26102;&#36824;&#23558;xhci_plat_overrides&#37324;&#38754;&#21253;&#21547;&#30340;&#19968;&#20010;reset&#21644;&#19968;&#20010;start&#20989;&#25968;&#65306; xhci_plat_setup&#65292; xhci_plat_start
    </p>
    <p>
      &#36171;&#20540;&#32473;&#20102;xhci&#30340;&#25805;&#20316;&#38598;&#37324;&#38754;&#30340;reset&#21644;start&#25104;&#21592;; &#21516;&#26102;xhci_init_driver&#20989;&#25968;&#36824;&#20250;&#23558;&#25805;&#20316;&#38598;&#37324;&#38754;&#30340;&#21464;&#37327;
    </p>
    <p>
      hcd_priv_size&#36827;&#34892;&#20462;&#25913;&#65292;hcd_priv_size&#21021;&#22987;&#35805;&#30340;&#26102;&#20505;&#35774;&#32622;&#25104;&#20102;.hcd_priv_size =&#160;&#160;&#160;&#160;sizeof(struct xhci_hcd),
    </p>
    <p>
      &#22312;xhci_init_driver&#20989;&#25968;&#37324;&#38754;&#20570;&#20102;&#22914;&#19979;&#20462;&#25913; drv-&gt;hcd_priv_size += over-&gt;extra_priv_size;
    </p>
  </body>
</html></richcontent>
<node CREATED="1597816255218" ID="ID_1236401448" MODIFIED="1597816287195">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman">static int xhci_plat_probe(struct platform_device *pdev) </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#37325;&#28857;&#20998;&#26512;</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1597816310247" FOLDED="true" ID="ID_192953487" MODIFIED="1600848943820">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      const struct hc_driver&#160;&#160;*driver;
    </p>
    <p>
      struct xhci_hcd&#160;&#160;&#160;&#160;&#160;*xhci;
    </p>
    <p>
      struct usb_hcd&#160;&#160;&#160;&#160;&#160;&#160;*hcd;&#160;&#160;&#21464;&#37327;&#22768;&#26126;
    </p>
  </body>
</html></richcontent>
<node CREATED="1598770995914" ID="ID_25666316" MODIFIED="1598771125432">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#e71414">struct usb_hcd {</font></b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_bus&#160;&#160;&#160;&#160;&#160;&#160;self;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* hcd is-a bus */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct kref&#160;&#160;&#160;&#160;&#160;kref;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* reference counter */
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;const char&#160;&#160;&#160;&#160;&#160;&#160;*product_desc;&#160;&#160;/* product/vendor string */
    </p>
    <p>
      &#160;&#160;&#160;&#160;int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;speed;&#160;&#160;&#160;&#160;&#160;&#160;/* Speed for this roothub.
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* May be different from
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* hcd-&gt;driver-&gt;flags &amp; HCD_MASK
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;char&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;irq_descr[24];&#160;&#160;/* driver + bus # */
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct timer_list&#160;&#160;&#160;rh_timer;&#160;&#160;&#160;/* drives root-hub polling */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct urb&#160;&#160;&#160;&#160;&#160;&#160;*status_urb;&#160;&#160;&#160;&#160;/* the current status urb */
    </p>
    <p>
      const struct hc_driver&#160;&#160;*driver;&#160;&#160;&#160;&#160;/* hw-specific hooks */
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;/*&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* OTG and some Host controllers need software interaction with phys;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* other external phys should be software-transparent
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_phy&#160;&#160;&#160;&#160;&#160;&#160;*usb_phy;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct phy&#160;&#160;&#160;&#160;&#160;&#160;*phy;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* Flags that need to be manipulated atomically because they can
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* change while the host controller is running.&#160;&#160;Always use
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* set_bit() or clear_bit() to change their values.
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned long&#160;&#160;&#160;&#160;&#160;&#160;&#160;flags;
    </p>
    <p>
      .......
    </p>
    <p>
      <b><font color="#e01313">}</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1597816424354" ID="ID_956067049" MODIFIED="1597816427815" TEXT="driver = &amp;xhci_plat_hc_driver;"/>
<node CREATED="1597816465245" ID="ID_1334883500" MODIFIED="1597816496603">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font size="4" face="Times New Roman">sysdev = &amp;pdev-&gt;dev; </font></i>
    </p>
    <p>
      <i><font size="4" face="Times New Roman">phydev = &amp;pdev-&gt;dev;</font></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597816517161" FOLDED="true" ID="ID_1124171331" MODIFIED="1600848941067">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hcd = __usb_create_hcd(driver, sysdev, &amp;pdev-&gt;dev,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dev_name(&amp;pdev-&gt;dev), <b><font color="#ff0000">NULL</font></b>);
    </p>
    <p>
      
    </p>
    <p>
      &#20989;&#25968;&#21407;&#22411;&#65306;
    </p>
    <p>
      struct usb_hcd *__usb_create_hcd(const struct hc_driver *driver,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct device *sysdev, struct device *dev, const char *bus_name,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <b><font color="#ff0000">struct usb_hcd *primary_hcd</font></b>)
    </p>
  </body>
</html></richcontent>
<node CREATED="1597816670144" ID="ID_1825642399" MODIFIED="1597818130502">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#39318;&#20808;&#21160;&#24577;&#20998;&#37197;&#19968;&#20010;usb_hcd&#32467;&#26500;&#20307;
    </p>
    <p>
      hcd = kzalloc(sizeof(*hcd) + <b><font color="#ff0000">driver-&gt;hcd_priv_size</font></b>, GFP_KERNEL);
    </p>
    <p>
      &#22810;&#20998;&#37197;&#30340;hcd_priv_size&#31354;&#38388;&#21487;&#20197;&#29992;&#26469;&#36716;&#25442;&#25104;&#21035;&#30340;&#32467;&#26500;&#20307;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597816862401" ID="ID_1807077421" MODIFIED="1597817076999">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#19979;&#38754;&#30340;&#20195;&#30721;&#23601;&#24456;&#26377;&#24847;&#24605;&#20102;
    </p>
    <p>
      usb_hcd&#37324;&#38754;&#26377;address0_mutex&#21644;bandwidth_mutex&#38145;&#65292;
    </p>
    <p>
      &#24403;&#20195;&#30721;&#21028;&#26029;primary_hcd&#26159;&#31354;&#25351;&#38024;&#30340;&#26102;&#20505;&#65292;&#20250;&#32473;&#24403;&#21069;&#29983;&#25104;&#30340;hcd
    </p>
    <p>
      &#21160;&#24577;&#20998;&#37197;&#36825;2&#20010;&#38145;&#24182;&#20570;&#21021;&#22987;&#21270;&#65292;&#28982;&#32780;&#24403;primary_hcd&#19981;&#20026;&#31354;&#30340;&#26102;&#20505;&#65292;
    </p>
    <p>
      &#26032;&#20998;&#37197;&#20986;&#26469;&#30340;hcd&#26159;&#20511;&#29992;&#20102;primary_hcd&#37324;&#38754;&#30340;&#38145;&#30340;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597817194141" ID="ID_1232040689" MODIFIED="1598790763874">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_bus_init(&amp;hcd-&gt;self);&#160;&#160;&#21021;&#22987;&#21270;usb_bus&#37324;&#38754;&#30340;&#21464;&#37327;&#25351;&#38024;&#20043;&#31867;&#30340;
    </p>
    <p>
      <b><font color="#0f1bf1">hcd-&gt;self.controller = dev; &#36825;&#37324;&#30340;dev&#26159;platform device&#37324;&#38754;&#30340;dev</font></b>
    </p>
    <p>
      hcd-&gt;self.sysdev = sysdev;
    </p>
    <p>
      hcd-&gt;self.bus_name = bus_name;
    </p>
    <p>
      hcd-&gt;self.uses_dma = (sysdev-&gt;dma_mask != NULL);
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#f00f0f" DESTINATION="ID_1232040689" ENDARROW="Default" ENDINCLINATION="1748;0;" ID="Arrow_ID_920616968" SOURCE="ID_636902222" STARTARROW="None" STARTINCLINATION="203;-23;"/>
</node>
<node CREATED="1597817211301" ID="ID_1551598436" MODIFIED="1598432060846">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>hcd-&gt;rh_timer.function = rh_timer_func; </b>
    </p>
    <p>
      <b>&#36825;&#37324;&#21482;&#26159;&#21021;&#22987;&#21270;&#20102;&#23450;&#26102;&#22120;&#30340;&#20989;&#25968;&#65292;&#24182;&#27809;&#26377;&#21551;&#21160;&#35813;&#23450;&#26102;&#22120;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597817371533" ID="ID_1372158765" MODIFIED="1597817373614" TEXT="hcd-&gt;driver = driver;"/>
<node CREATED="1597820243974" ID="ID_909043927" MODIFIED="1597820361397">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hcd-&gt;product_desc = (driver-&gt;product_desc) ? driver-&gt;product_desc :&quot;USB Host Controller&quot;;
    </p>
    <p>
      &#35774;&#32622;hcd&#30340;product_desc&#65292;&#23454;&#38469;&#19978;&#26159;&#34987;&#36171;&#20540;&#25104;&#20102;xhci_plat_hc_driver&#37324;&#38754;&#30340;product_desc:
    </p>
    <p>
      <b><font color="#0000ff">xHCI Host Controller</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1597818153694" ID="ID_391072548" MODIFIED="1600849172769">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      xhci = hcd_to_xhci(hcd);
    </p>
    <p>
      &#23558;&#22810;&#20998;&#37197;&#30340;&#31354;&#38388;&#36716;&#25442;&#25104;xhci_hcd&#32467;&#26500;&#20307;&#20102;
    </p>
    <p>
      
    </p>
    <p>
      hcd_to_xhci &#20250;&#20248;&#20808;&#23547;&#25214;hcd&#37324;&#38754;&#26159;&#21542;&#26377;&#25351;&#21521;primary_hcd&#65292;&#22914;&#26524;&#26377;&#21017;
    </p>
    <p>
      &#20351;&#29992;primary_hcd&#37324;&#38754;&#30340;xhci_hcd&#65292;&#27425;&#20043;&#25165;&#20351;&#29992;&#20256;&#36882;&#36827;&#21435;&#30340;hcd&#30340;xhci_hcd&#25104;&#21592;
    </p>
  </body>
</html></richcontent>
<node CREATED="1598317847857" ID="ID_1850215112" MODIFIED="1598318017924">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>struct xhci_hcd {</b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_hcd *main_hcd;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_hcd *shared_hcd;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct xhci_cap_regs __iomem *cap_regs;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct xhci_op_regs __iomem *op_regs;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct xhci_run_regs __iomem *run_regs;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct xhci_doorbell_array __iomem *dba;
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* Our HCD's current interrupter register set */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct&#160;&#160;xhci_intr_reg __iomem *ir_set;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* secondary interrupter */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct&#160;&#160;xhci_intr_reg __iomem **sec_ir_set;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;int&#160;&#160;&#160;&#160;&#160;core_id;
    </p>
    <p>
      &#160;&#160;&#160;&#160;........
    </p>
    <p>
      <b>}</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1597818554223" ID="ID_661016377" MODIFIED="1597818577108">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      xhci-&gt;clk = clk;
    </p>
    <p>
      xhci-&gt;main_hcd = hcd;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597818580549" ID="ID_48874691" MODIFIED="1597818638492">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>xhci-&gt;shared_hcd</b>&#160;= __usb_create_hcd(driver, sysdev, &amp;pdev-&gt;dev,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; dev_name(&amp;pdev-&gt;dev), hcd);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597826115909" ID="ID_1334797884" MODIFIED="1597826179363">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hcd-&gt;usb_phy = devm_usb_get_phy_by_phandle(phydev, &quot;usb-phy&quot;, 0);
    </p>
    <p>
      &#30001;&#20110;phydev&#19981;&#26159;&#36890;&#36807;dts&#29983;&#25104;&#30340;&#65292;&#26159;dwc3&#21160;&#24577;&#29983;&#25104;&#30340;&#65292;&#25152;&#20197;&#36825;&#37324;&#24212;&#35813;&#26159;&#33719;&#21462;&#19981;&#21040;usb_phy&#30340;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597820458296" ID="ID_1225151255" MODIFIED="1600849079341" TEXT="ret = usb_add_hcd(hcd, irq, IRQF_SHARED);">
<node CREATED="1597826194925" ID="ID_333645239" MODIFIED="1597826243961">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#35813;&#20989;&#25968;&#20250;&#36890;&#36807;2&#31181;&#26041;&#24335;&#23547;&#25214;phy
    </p>
    <p>
      struct usb_phy *phy = usb_get_phy_dev(hcd-&gt;self.sysdev, 0);
    </p>
    <p>
      struct phy *phy = phy_get(hcd-&gt;self.sysdev, &quot;usb&quot;);
    </p>
    <p>
      &#36825;2&#31181;&#26041;&#24335;&#24212;&#35813;&#37117;&#26159;&#22833;&#36133;&#30340;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597826343976" ID="ID_864294204" MODIFIED="1597826346733" TEXT="dev_info(hcd-&gt;self.controller, &quot;%s\n&quot;, hcd-&gt;product_desc);"/>
<node CREATED="1597826356652" ID="ID_1657611350" MODIFIED="1597826359307" TEXT="retval = hcd_buffer_create(hcd);"/>
<node CREATED="1597826392670" ID="ID_1331217971" MODIFIED="1597826421292">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      retval = usb_register_bus(&amp;hcd-&gt;self);
    </p>
    <p>
      &#35843;&#29992;&#35813;&#20989;&#25968;&#20197;&#21518;&#65292;&#20869;&#26680;&#20250;&#25171;&#21360;
    </p>
    <p>
      new USB bus registered, assigned bus
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597826468192" FOLDED="true" ID="ID_1123406726" MODIFIED="1600849100524">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0033ff">rhdev = usb_alloc_dev(NULL, &amp;hcd-&gt;self, 0); </font></b>
    </p>
    <p>
      <b><font color="#0033ff">hcd-&gt;self.root_hub = rhdev;&#160;</font></b>&#160;&#21019;&#24314;&#19968;&#20010;usb_device&#65292;&#24182;&#36171;&#20540;&#32473;usb_bus&#37324;&#38754;&#30340;root_hub&#21464;&#37327;
    </p>
    <p>
      
    </p>
    <p>
      struct usb_bus {
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct device *controller;&#160;&#160;/* host/master side hardware */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct device *sysdev;&#160;&#160;&#160;&#160;&#160;&#160;/* as seen from firmware or bus */
    </p>
    <p>
      &#160;&#160;&#160;&#160;int busnum;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Bus number (in order of reg) */
    </p>
    <p>
      &#160;&#160;&#160;&#160;const char *bus_name;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* stable id (PCI slot_name etc) */
    </p>
    <p>
      &#160;&#160;&#160;&#160;................
    </p>
    <p>
      &#160;&#160;&#160; <b>truct usb_device *root_hub; </b>
    </p>
    <p>
      <b>}</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598775104758" ID="ID_1295471699" MODIFIED="1598775191497">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#d62121">struct usb_device *usb_alloc_dev(</font></b>struct usb_device *parent,&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_bus *bus, unsigned port1<b><font color="#f21919">)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598775269444" ID="ID_1796296437" MODIFIED="1598775281819">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_device *dev;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598775300749" ID="ID_1594282604" MODIFIED="1598775336163">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_hcd *usb_hcd = bus_to_hcd(bus);
    </p>
    <p>
      bus&#26144;&#23556;&#22238;usb_hcd
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598775916585" ID="ID_1371105474" MODIFIED="1598775939184">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21160;&#24577;&#20998;&#37197;&#19968;&#20010;usb_device
    </p>
    <p>
      dev = kzalloc(sizeof(*dev), GFP_KERNEL);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598776125712" ID="ID_1780517847" MODIFIED="1598776264532">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (usb_hcd-&gt;driver-&gt;alloc_dev &amp;&amp; parent &amp;&amp;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;!usb_hcd-&gt;driver-&gt;alloc_dev(usb_hcd, dev)) {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_put_hcd(bus_to_hcd(bus));&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kfree(dev);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return NULL;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;}&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#27880;&#24847;&#25105;&#20204;&#35843;&#29992;&#30340;&#26102;&#20505;parents&#26159;&#31354;&#65292;&#25152;&#20197;&#19981;&#36208;&#36825;&#37324;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598776496187" ID="ID_247167027" MODIFIED="1598776552806">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void device_initialize(struct device *dev)&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      {&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;dev-&gt;kobj.kset = devices_kset;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;kobject_init(&amp;dev-&gt;kobj, &amp;device_ktype);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;INIT_LIST_HEAD(&amp;dev-&gt;dma_pools);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;mutex_init(&amp;dev-&gt;mutex);
    </p>
    <p>
      &#160;&#160;&#160;&#160;lockdep_set_novalidate_class(&amp;dev-&gt;mutex);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;spin_lock_init(&amp;dev-&gt;devres_lock);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;INIT_LIST_HEAD(&amp;dev-&gt;devres_head);
    </p>
    <p>
      &#160;&#160;&#160;&#160;device_pm_init(dev);&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;set_dev_node(dev, -1);
    </p>
    <p>
      #ifdef CONFIG_GENERIC_MSI_IRQ
    </p>
    <p>
      &#160;&#160;&#160;&#160;INIT_LIST_HEAD(&amp;dev-&gt;msi_list);
    </p>
    <p>
      #endif
    </p>
    <p>
      }
    </p>
    <p>
      <b><font color="#ea1111">device_initialize(&amp;dev-&gt;dev);</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598776778823" ID="ID_1521785377" MODIFIED="1598836808970">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#1f08f5">dev-&gt;dev.bus = &amp;usb_bus_type;</font></b>
    </p>
    <p>
      dev-&gt;dev.type = &amp;usb_device_type;
    </p>
    <p>
      dev-&gt;dev.groups = usb_device_groups;
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ff3333" DESTINATION="ID_1155032627" ENDARROW="Default" ENDINCLINATION="323;0;" ID="Arrow_ID_126223576" STARTARROW="None" STARTINCLINATION="1184;0;"/>
</node>
<node CREATED="1598777678280" ID="ID_1379841377" MODIFIED="1598777727363">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev-&gt;dev.dma_mask = bus-&gt;sysdev-&gt;dma_mask;
    </p>
    <p>
      dev-&gt;dev.dma_pfn_offset = bus-&gt;sysdev-&gt;dma_pfn_offset;
    </p>
    <p>
      &#37197;&#32622;dma mask&#21644;offset
    </p>
    <p>
      &#36825;&#37324;&#27809;&#21861;&#29992;&#65292;&#26159;&#20026;&#20102;&#35268;&#36991;&#19968;&#20123;&#31995;&#32479;bug
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598778235614" ID="ID_391780491" MODIFIED="1598778254893">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      set_dev_node(&amp;dev-&gt;dev, dev_to_node(bus-&gt;sysdev));
    </p>
    <p>
      &#19981;&#30693;&#36947;&#20570;&#21861;&#30340;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598778269494" ID="ID_1678439005" MODIFIED="1598778301525">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev-&gt;state = <b><font color="#e91a1a">USB_STATE_ATTACHED</font></b>;
    </p>
    <p>
      dev-&gt;lpm_disable_count = 1;
    </p>
    <p>
      atomic_set(&amp;dev-&gt;urbnum, 0);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598778406433" ID="ID_1191694838" MODIFIED="1598778432774">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      INIT_LIST_HEAD(&amp;dev-&gt;ep0.urb_list);
    </p>
    <p>
      &#160;&#160;&#160;&#160;dev-&gt;ep0.desc.bLength = USB_DT_ENDPOINT_SIZE;
    </p>
    <p>
      &#160;&#160;&#160;&#160;dev-&gt;ep0.desc.bDescriptorType = USB_DT_ENDPOINT;
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* ep0 maxpacket comes later, from device descriptor */
    </p>
    <p>
      &#160;&#160;&#160;&#160;usb_enable_endpoint(dev, &amp;dev-&gt;ep0, false);
    </p>
    <p>
      &#160;&#160;&#160;&#160;dev-&gt;can_submit = 1;
    </p>
    <p>
      &#21021;&#22987;&#21270;&#25511;&#21046;&#31471;&#28857;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598789434124" ID="ID_1469226714" MODIFIED="1598789474878">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#26681;&#25454;&#20256;&#20837;&#30340;&#21442;&#25968;parent&#26159;&#21542;&#20026;&#31354;&#65292;
    </p>
    <p>
      &#20570;&#22914;&#19979;&#30340;&#19981;&#21516;&#22788;&#29702;
    </p>
  </body>
</html></richcontent>
<node CREATED="1598789479562" ID="ID_1146909754" MODIFIED="1598789486816" TEXT="parent&#x662f;&#x7a7a;">
<node CREATED="1598790685334" ID="ID_149632752" MODIFIED="1598790690410" TEXT="dev-&gt;route = 0;"/>
<node CREATED="1598790703642" ID="ID_636902222" MODIFIED="1598790770509" TEXT="dev-&gt;dev.parent = bus-&gt;controller;">
<arrowlink COLOR="#f00f0f" DESTINATION="ID_1232040689" ENDARROW="Default" ENDINCLINATION="1748;0;" ID="Arrow_ID_920616968" STARTARROW="None" STARTINCLINATION="203;-23;"/>
</node>
<node CREATED="1598790719971" ID="ID_294524603" MODIFIED="1598791081011">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>root_hub = 1;</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1598789490759" ID="ID_114877221" MODIFIED="1598789497918" TEXT="parent&#x4e0d;&#x662f;&#x7a7a;"/>
</node>
<node CREATED="1598790970693" ID="ID_671022658" MODIFIED="1598791041931">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev-&gt;portnum = port1; &#23545;&#20110;root device&#65292;&#36825;&#26159;&#26159;0
    </p>
    <p>
      dev-&gt;bus = bus;
    </p>
    <p>
      dev-&gt;parent = parent; &#23545;&#20110;root device, parent&#26159;&#31354;
    </p>
    <p>
      INIT_LIST_HEAD(&amp;dev-&gt;filelist);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598791117296" ID="ID_159480634" MODIFIED="1598791146911">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev-&gt;authorized = 1;&#160;&#160;&#23545;&#20110;root hub,&#30452;&#25509;&#36171;&#20540;1
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1597826614845" ID="ID_21287783" MODIFIED="1597826679252">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#30001;&#20110;xhci_hc_driver&#30340;flags=HCD_MEMORY | HCD_USB3 | HCD_SHARED,
    </p>
    <p>
      &#25925;hcd-&gt;speed&#26159;HCD_USB3
    </p>
    <p>
      &#25152;&#20197;&#35774;&#32622;
    </p>
    <p>
      rhdev-&gt;speed = USB_SPEED_SUPER;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597826738673" FOLDED="true" ID="ID_453648724" MODIFIED="1600849095124">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#35843;&#29992;retval = hcd-&gt;driver-&gt;reset(hcd);
    </p>
    <p>
      &#21363;&#35843;&#29992;xhci_plat_setup&#20989;&#25968;
    </p>
  </body>
</html></richcontent>
<node CREATED="1597826902398" ID="ID_409411419" MODIFIED="1597826904762" TEXT="static int xhci_plat_setup(struct usb_hcd *hcd)">
<node CREATED="1597826914522" ID="ID_1903496406" MODIFIED="1600764365214">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      xhci_priv_init_quirk(hcd)
    </p>
    <p>
      
    </p>
    <p>
      34 static const struct xhci_driver_overrides xhci_plat_overrides __initconst = {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;|&#160;&#160; -xhci_plat_start(struct usb_hcd *hcd)
    </p>
    <p>
      &#160;35&#160;&#160;&#160;&#160;&#160;.extra_priv_size = sizeof(struct xhci_plat_priv),&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;|&#160;&#160; -xhci_priv_init_quirk(struct usb_hcd
    </p>
    <p>
      &#160;36&#160;&#160;&#160;&#160;&#160;.reset = xhci_plat_setup,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;|&#160;&#160; -xhci_priv_plat_start(struct usb_hcd
    </p>
    <p>
      &#160;37&#160;&#160;&#160;&#160;&#160;.start = xhci_plat_start,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;|~
    </p>
    <p>
      &#160;38 };&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597826925973" ID="ID_846850032" MODIFIED="1597827057274">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" face="Times New Roman" color="#009933">xhci_gen_setup(hcd, xhci_plat_quirks) </font></b>
    </p>
    <p>
      <b><font size="4" face="Times New Roman" color="#009933">&#20989;&#25968;&#21407;&#22411;&#65306; </font></b>
    </p>
    <p>
      <b><font size="4" face="Times New Roman" color="#009933">int xhci_gen_setup(struct usb_hcd *hcd, xhci_get_quirks_t get_quirks)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598265457883" ID="ID_1281324217" MODIFIED="1598265494586">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      static void xhci_plat_quirks(struct device *dev, struct xhci_hcd *xhci)
    </p>
    <p>
      {
    </p>
    <p>
      &#160;&#160;&#160;&#160;/*
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* As of now platform drivers don't provide MSI support so we ensure
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* here that the generic code does not try to make a pci_dev from our
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* dev struct in order to setup MSI
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;quirks |= XHCI_PLAT;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598318161707" ID="ID_1297507884" MODIFIED="1598318477675">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21464;&#37327;&#30340;&#19968;&#20123;&#22768;&#26126;
    </p>
    <p>
      struct xhci_hcd&#160;&#160;&#160;&#160;&#160;*xhci;
    </p>
    <p>
      struct device&#160;&#160;&#160;&#160;&#160;&#160;&#160;*dev = hcd-&gt;self.sysdev;
    </p>
    <p>
      
    </p>
    <p>
      hcd-&gt;self.sg_tablesize = ~0;
    </p>
    <p>
      hcd-&gt;self.no_sg_constraint = 1;
    </p>
    <p>
      hcd-&gt;self.no_stop_on_short = 1;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598318546715" ID="ID_962250187" MODIFIED="1598318580833">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      xhci = hcd_to_xhci(hcd);
    </p>
    <p>
      &#25214;&#21040;xhci_hcd
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598318588226" ID="ID_1078801714" MODIFIED="1598318846313">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#21028;&#26029;&#24403;&#21069;&#30340;hcd&#26159;primary hcd&#65292;&#21017;&#20570;&#22914;&#19979;&#30340;&#19968;&#20123;&#24037;&#20316;&#65292;<b>&#21542;&#21017;&#35813;&#20989;&#25968;&#30452;&#25509;&#36820;&#22238;&#20102;</b>
    </p>
    <p>
      xhci-&gt;main_hcd = hcd;
    </p>
    <p>
      hcd-&gt;speed = HCD_USB2;
    </p>
    <p>
      hcd-&gt;self.root_hub-&gt;speed = USB_SPEED_HIGH;
    </p>
    <p>
      &#21487;&#20197;&#30475;&#21040;roothub&#26159;&#20197;2.0&#30340;&#24418;&#24335;&#23384;&#22312;&#30340;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598319609835" ID="ID_1656099715" MODIFIED="1598319658530">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300cc"><b>xhci&#24403;&#20013;&#30340;&#19968;&#20123;&#23492;&#23384;&#22120;&#30340;&#37197;&#32622;</b></font>
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;cap_regs = hcd-&gt;regs;
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;op_regs = hcd-&gt;regs +
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HC_LENGTH(readl(&amp;xhci-&gt;cap_regs-&gt;hc_capbase));
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;run_regs = hcd-&gt;regs +
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(readl(&amp;xhci-&gt;cap_regs-&gt;run_regs_off) &amp; RTSOFF_MASK);
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* Cache read-only capability registers */
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;hcs_params1 = readl(&amp;xhci-&gt;cap_regs-&gt;hcs_params1);
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;hcs_params2 = readl(&amp;xhci-&gt;cap_regs-&gt;hcs_params2);
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;hcs_params3 = readl(&amp;xhci-&gt;cap_regs-&gt;hcs_params3);
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;hcc_params = readl(&amp;xhci-&gt;cap_regs-&gt;hc_capbase);
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;hci_version = HC_VERSION(xhci-&gt;hcc_params);
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci-&gt;hcc_params = readl(&amp;xhci-&gt;cap_regs-&gt;hcc_params);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598319718802" ID="ID_1248932578" MODIFIED="1598319722190" TEXT="get_quirks(dev, xhci)"/>
<node CREATED="1598319827675" ID="ID_1356759234" MODIFIED="1598319853262">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      retval = xhci_halt(xhci);
    </p>
    <p>
      
    </p>
    <p>
      halt&#25481;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598319866194" ID="ID_762524" MODIFIED="1598319907712">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      xhci_dbg(xhci, &quot;Resetting HCD\n&quot;);&#160;&#160;&#36755;&#20986;&#26085;&#24535;&#65292;&#23545;xhci&#36827;&#34892;reset&#25805;&#20316;
    </p>
    <p>
      retval = xhci_reset(xhci);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598320174200" ID="ID_1077168337" MODIFIED="1598320233282">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300cc"><b>&#21021;&#22987;&#21270;xhci</b></font>
    </p>
    <p>
      
    </p>
    <p>
      xhci_dbg(xhci, &quot;Calling HCD init\n&quot;);
    </p>
    <p>
      retval = xhci_init(hcd);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1598432428277" ID="ID_256126910" MODIFIED="1598432439742">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hcd-&gt;rh_pollable = 1;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598791766198" ID="ID_1937899059" MODIFIED="1598791779909">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      /* initialize tasklets */
    </p>
    <p>
      &#160;&#160;&#160;&#160;init_giveback_urb_bh(&amp;hcd-&gt;high_prio_bh);
    </p>
    <p>
      &#160;&#160;&#160;&#160;init_giveback_urb_bh(&amp;hcd-&gt;low_prio_bh);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597827600352" FOLDED="true" ID="ID_1302343178" MODIFIED="1600849092507">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#26159;primary hcd&#21017;
    </p>
    <p>
      usb_hcd_request_irqs(hcd, irqnum, irqflags);
    </p>
  </body>
</html></richcontent>
<node CREATED="1598432705470" FOLDED="true" ID="ID_120826140" MODIFIED="1600849091243">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#22914;&#26524;cd-&gt;driver-&gt;irq&#23384;&#22312;&#65292;&#35843;&#29992;&#22914;&#19979;&#30340;&#20989;&#25968;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598432786921" ID="ID_728512942" MODIFIED="1598432811514">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      retval = request_irq(irqnum, &amp;usb_hcd_irq, irqflags,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hcd-&gt;irq_descr, hcd)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598432842526" ID="ID_1614209564" MODIFIED="1598432846632" TEXT="hcd-&gt;irq = irqnum;"/>
</node>
</node>
<node CREATED="1597827627302" ID="ID_1142371003" MODIFIED="1600849653478">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hcd-&gt;state = HC_STATE_RUNNING;
    </p>
    <p>
      <font color="#ff3300"><b><i>retval = hcd-&gt;driver-&gt;start(hcd);</i></b></font>
    </p>
    <p>
      &#21363;&#35843;&#29992;&#20989;&#25968;
    </p>
    <p>
      <font color="#3300cc"><b>int xhci_run(struct usb_hcd *hcd)</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598320521362" ID="ID_1066186171" MODIFIED="1598320542933">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct xhci_hcd *xhci = hcd_to_xhci(hcd);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598320635409" ID="ID_1410955948" MODIFIED="1598320650573">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hcd-&gt;uses_new_polling = 1;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598320660554" ID="ID_1339545157" MODIFIED="1598320721688">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (!usb_hcd_is_primary_hcd(hcd))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return xhci_run_finished(xhci);
    </p>
    <p>
      
    </p>
    <p>
      &#22914;&#26524;&#24403;&#21069;&#20256;&#20837;&#30340;hcd&#19981;&#26159;primary hcd&#65292;&#23601;&#35843;&#29992;xhci_run_finished&#24182;&#30452;&#25509;&#36820;&#22238;&#65292;
    </p>
    <p>
      &#21542;&#21017;&#36824;&#38656;&#36827;&#34892;&#19979;&#38754;&#30340;&#22788;&#29702;&#21160;&#20316;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598429772185" ID="ID_1748017758" MODIFIED="1598429798795">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff"><b>xhci_try_enable_msi(hcd)</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598430497991" ID="ID_1219914324" MODIFIED="1598430518763">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct xhci_hcd *xhci = hcd_to_xhci(hcd)
    </p>
    <p>
      &#20174;hcd&#33719;&#21462;xhci
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598430646366" ID="ID_356409049" MODIFIED="1598430656639">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct pci_dev&#160;&#160;*pdev;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598430747299" ID="ID_926606305" MODIFIED="1598430779655">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#21457;&#29616;
    </p>
    <p>
      xhci-&gt;quirks &amp; XHCI_PLAT&#65292;
    </p>
    <p>
      &#37027;&#20040;&#20989;&#25968;&#30452;&#25509;&#36820;&#22238;&#65292;&#21542;&#21017;&#32487;&#32493;&#25191;&#34892;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598430818163" ID="ID_32747411" MODIFIED="1598430877553">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pdev = to_pci_dev(xhci_to_hcd(xhci)-&gt;self.controller);
    </p>
    <p>
      &#20174;&#30446;&#21069;&#30340;&#20998;&#26512;&#26469;&#30475;&#36825;&#20010;&#26159;&#23545;&#24212;intel&#30340;&#25511;&#21046;&#22120;&#20102;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598432976449" ID="ID_1812594901" MODIFIED="1598433028946">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;hcd-&gt;irq&#19981;&#26159;0&#65292;&#26159;&#23384;&#22312;&#30340;&#65292;&#37027;&#20040;&#35843;&#29992;
    </p>
    <p>
      free_irq(hcd-&gt;irq, hcd) &#23558;Irq&#36827;&#34892;&#37322;&#25918;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598433079042" ID="ID_1824846192" MODIFIED="1598491549994" TEXT="xhci_setup_msix(xhci);">
<node CREATED="1598433176360" ID="ID_693116397" MODIFIED="1598434207286">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_hcd *hcd = xhci_to_hcd(xhci);
    </p>
    <p>
      struct pci_dev *pdev = to_pci_dev(hcd-&gt;self.controller);
    </p>
    <p>
      
    </p>
    <p>
      &#33719;&#21462;usb_hcd&#35774;&#22791;&#21644;pci&#35774;&#22791;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598434211138" ID="ID_1865233520" MODIFIED="1598434312597">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      xhci-&gt;msix_count = min(num_online_cpus() + 1,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HCS_MAX_INTRS(xhci-&gt;hcs_params1));
    </p>
    <p>
      xhci-&gt;msix_entries =
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kmalloc((sizeof(struct msix_entry))*xhci-&gt;msix_count,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;GFP_KERNEL);
    </p>
    <p>
      for (i = 0; i &lt; xhci-&gt;msix_count; i++) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;xhci-&gt;msix_entries[i].entry = i;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;xhci-&gt;msix_entries[i].vector = 0;
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#37197;&#32622;msi&#20013;&#26029;&#21521;&#37327;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598434316833" ID="ID_1832906337" MODIFIED="1598434331076" TEXT="ret = pci_enable_msix_exact(pdev, xhci-&gt;msix_entries, xhci-&gt;msix_count);"/>
<node CREATED="1598434353324" ID="ID_899471090" MODIFIED="1598434429160">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; xhci-&gt;msix_count; i++) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ret = request_irq(xhci-&gt;msix_entries[i].vector,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <b>xhci_msi_irq</b>,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0, &quot;xhci_hcd&quot;, xhci_to_hcd(xhci));
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (ret)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto disable_msix;
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598434444169" ID="ID_239906273" MODIFIED="1598434447479" TEXT="hcd-&gt;msix_enabled = 1;"/>
</node>
<node CREATED="1598491628746" ID="ID_869408782" MODIFIED="1598491676525">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21028;&#26029;xhci_setup_msix&#35843;&#29992;&#26159;&#21542;&#25104;&#21151;&#65292;
    </p>
    <p>
      &#22914;&#26524;&#19981;&#25104;&#21151;&#65292;&#37027;&#20040;&#23601;&#36716;&#32780;&#35843;&#29992;
    </p>
    <p>
      xhci_setup_msi(xhci) &#20989;&#25968;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1598320760706" ID="ID_30002668" MODIFIED="1598339778405">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#25171;&#21360;&#20986;cmd ring memory map
    </p>
    <p>
      xhci_dbg(xhci, &quot;Command ring memory map follows:\n&quot;);
    </p>
    <p>
      xhci_debug_ring(xhci, xhci-&gt;cmd_ring);&#160;&#160;&#20174;&#20869;&#26680;&#26085;&#24535;&#30475;&#35813;&#27573;&#30340;memory&#30340;&#31354;&#38388;&#26159;4K
    </p>
    <p>
      
    </p>
    <p>
      &#25171;&#21360;ERST memory map
    </p>
    <p>
      &#35813;map&#31354;&#38388;&#30340;&#22823;&#23567;&#26159;16&#20010;&#23383;&#33410;
    </p>
    <p>
      
    </p>
    <p>
      &#25171;&#21360;Event ring&#20869;&#23384;&#31354;&#38388;&#65306; 4K
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598339782946" ID="ID_1633623900" MODIFIED="1598340320178">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      temp = readl(&amp;xhci-&gt;ir_set-&gt;irq_control);
    </p>
    <p>
      temp &amp;= ~ER_IRQ_INTERVAL_MASK;
    </p>
    <p>
      writel(temp, &amp;xhci-&gt;ir_set-&gt;irq_control);&#160;&#160;&#35813;&#25513;&#30721;&#26159;&#29992;&#26469;&#35774;&#32622;&#20013;&#26029;&#20043;&#38388;&#30340;&#26368;&#23567;&#26102;&#38388;&#38388;&#38548;&#30340;&#65288;(in 250ns intervals)&#65289;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598421799386" ID="ID_1214743327" MODIFIED="1598422026825">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0000cc"><b>&#20107;&#20214;&#20013;&#26029;&#20351;&#33021;</b></font>
    </p>
    <p>
      
    </p>
    <p>
      temp = readl(&amp;xhci-&gt;op_regs-&gt;command);
    </p>
    <p>
      temp |= (CMD_EIE);
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci_dbg_trace(xhci, trace_xhci_dbg_init,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;// Enable interrupts, cmd = 0x%x.&quot;, temp);
    </p>
    <p>
      writel(temp, &amp;xhci-&gt;op_regs-&gt;command);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598422141170" ID="ID_961940937" MODIFIED="1598422183642">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff"><b>&#20351;&#33021;&#20107;&#20214;ring&#20013;&#26029;</b></font>
    </p>
    <p>
      
    </p>
    <p>
      temp = readl(&amp;xhci-&gt;ir_set-&gt;irq_pending);
    </p>
    <p>
      xhci_dbg_trace(xhci, trace_xhci_dbg_init,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;// Enabling event ring interrupter %pK by writing 0x%x to irq_pending&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;xhci-&gt;ir_set, (unsigned int) ER_IRQ_ENABLE(temp));
    </p>
    <p>
      writel(ER_IRQ_ENABLE(temp), &amp;xhci-&gt;ir_set-&gt;irq_pending);
    </p>
    <p>
      xhci_print_ir_set(xhci, 0);
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1598791808224" ID="ID_1543387112" MODIFIED="1598791882561">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#e90e0e">retval = register_root_hub(hcd);</font></b>
    </p>
    <p>
      
    </p>
    <p>
      static int register_root_hub(struct usb_hcd *hcd)
    </p>
    <p>
      &#24320;&#22987;&#21521;&#31995;&#32479;&#27880;&#20876;root hub&#20102;
    </p>
  </body>
</html></richcontent>
<node CREATED="1598792170665" ID="ID_1465990735" MODIFIED="1598792209993">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct device *parent_dev = hcd-&gt;self.controller;
    </p>
    <p>
      struct device *sysdev = hcd-&gt;self.sysdev;
    </p>
    <p>
      struct usb_device *usb_dev = hcd-&gt;self.root_hub;
    </p>
    <p>
      
    </p>
    <p>
      &#33719;&#21462;&#19977;&#22823;&#35774;&#22791;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598792331190" ID="ID_139679506" MODIFIED="1598792472310">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_dev-&gt;ep0.desc.wMaxPacketSize = cpu_to_le16(64);
    </p>
    <p>
      retval = usb_get_device_descriptor(usb_dev, USB_DT_DEVICE_SIZE);
    </p>
    <p>
      
    </p>
    <p>
      &#33719;&#21462;&#35774;&#22791;&#25551;&#36848;&#31526;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598792738689" ID="ID_1374452084" MODIFIED="1598792866547">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      le16_to_cpu(usb_dev-&gt;descriptor.bcdUSB) &gt;= 0x0201
    </p>
    <p>
      &#22914;&#26524;&#33719;&#21462;&#30340;bcdUSB&#22823;&#20110;0x0200,&#37027;&#20040;&#38656;&#35201;&#22788;&#29702;bos
    </p>
    The USB 3.0 and USB 2.0 LPM specifications define a new USB descriptor called the Binary Device Object Store (BOS). The BOS descriptor returns a set of device-level capability descriptors for the USB device. For a USB device, which reports a&#160;

    <p>
      <b>bcdUSB</b>&#160;value greater than 0x0200 in their device descriptor
    </p>
    <p>
      &#20302;&#21151;&#32791;&#27169;&#24335;&#24341;&#20837;&#30340;
    </p>
  </body>
</html></richcontent>
<node CREATED="1598792915263" ID="ID_1984888917" MODIFIED="1598792927133">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      retval = usb_get_bos_descriptor(usb_dev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598792939905" ID="ID_233377655" MODIFIED="1598792960907">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_dev-&gt;lpm_capable = usb_device_supports_lpm(usb_dev);
    </p>
    <p>
      &#21028;&#35835;&#26159;&#21542;&#25903;&#25345;lpm
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1598793038733" ID="ID_1387301750" MODIFIED="1600395118826">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>retval = usb_new_device (usb_dev);</b>
    </p>
    <p>
      &#20989;&#25968;&#21407;&#22411;&#65306; int usb_new_device(struct usb_device *udev)
    </p>
    <p>
      &#24320;&#22987;&#23545;usb&#35774;&#22791;&#36827;&#34892;&#21021;&#22987;&#21270;
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#cc00ff" DESTINATION="ID_186688806" ENDARROW="None" ENDINCLINATION="-2081;201;" ID="Arrow_ID_1294228912" STARTARROW="None" STARTINCLINATION="7679;0;"/>
<node CREATED="1598793309428" ID="ID_1037316838" MODIFIED="1598793406165">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#39318;&#20808;&#21028;&#26029;udev&#26159;&#21542;&#26377;&#29238;&#35774;&#22791;&#65292;&#26377;&#30340;&#35805;&#21017;&#38656;&#35201;&#21796;&#37266;
    </p>
    <p>
      &#29238;&#35774;&#22791;
    </p>
    <p>
      device_init_wakeup(&amp;udev-&gt;dev, 0)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598793452512" ID="ID_1131609371" MODIFIED="1598793469359">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pm_runtime_set_active(&amp;udev-&gt;dev);
    </p>
    <p>
      &#160;&#160;&#160;&#160;pm_runtime_get_noresume(&amp;udev-&gt;dev);
    </p>
    <p>
      &#160;&#160;&#160;&#160;pm_runtime_use_autosuspend(&amp;udev-&gt;dev);
    </p>
    <p>
      &#160;&#160;&#160;&#160;pm_runtime_enable(&amp;udev-&gt;dev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598793483554" ID="ID_1055043055" MODIFIED="1598793487667" TEXT="usb_disable_autosuspend(udev);"/>
<node CREATED="1598793499346" ID="ID_824422241" MODIFIED="1599813338805">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#35774;&#22791;&#36827;&#34892;&#26522;&#20030;
    </p>
    <p>
      err = usb_enumerate_device(udev);
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#0033ff" DESTINATION="ID_1067343018" ENDARROW="None" ENDINCLINATION="-566;-78;" ID="Arrow_ID_150817927" STARTARROW="None" STARTINCLINATION="2289;0;"/>
</node>
<node CREATED="1598793570172" ID="ID_1321349043" MODIFIED="1598793621421">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev_dbg(&amp;udev-&gt;dev, &quot;udev %d, busnum %d, minor = %d\n&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;devnum, udev-&gt;bus-&gt;busnum,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(((udev-&gt;bus-&gt;busnum-1) * 128) + (udev-&gt;devnum-1)));
    </p>
    <p>
      &#25171;&#21360;&#26522;&#20030;&#20449;&#24687;
    </p>
    <p>
      &#20363;&#22914;&#65306; usb usb1: udev 1, busnum 1, minor = 0
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598793654534" ID="ID_1192968309" MODIFIED="1598793672401">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#26292;&#38706;&#35774;&#22791;&#33410;&#28857;&#32473;libusb
    </p>
    <p>
      udev-&gt;dev.devt = MKDEV(USB_DEVICE_MAJOR,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(((udev-&gt;bus-&gt;busnum-1) * 128) + (udev-&gt;devnum-1)));
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598793923025" ID="ID_79466081" MODIFIED="1598793986983">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#35843;&#29992;announce_device(udev)&#65292;
    </p>
    <p>
      &#25171;&#21360;&#19968;&#20123;&#35774;&#22791;&#30340;&#20449;&#24687;
    </p>
    <p>
      ev_info(&amp;udev-&gt;dev, &quot;New USB device found, idVendor=%04x, idProduct=%04x\n&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;le16_to_cpu(udev-&gt;descriptor.idVendor),
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;le16_to_cpu(udev-&gt;descriptor.idProduct));
    </p>
    <p>
      &#160;&#160;&#160;&#160;dev_info(&amp;udev-&gt;dev,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;New USB device strings: Mfr=%d, Product=%d, SerialNumber=%d\n&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;descriptor.iManufacturer,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;descriptor.iProduct,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;descriptor.iSerialNumber);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598794453927" ID="ID_386902129" MODIFIED="1598794458085" TEXT="device_enable_async_suspend(&amp;udev-&gt;dev);"/>
<node CREATED="1598836719068" ID="ID_1155032627" MODIFIED="1598838093009">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      err = device_add(&amp;udev-&gt;dev);
    </p>
    <p>
      &#27880;&#20876;&#35774;&#22791;
    </p>
    <p>
      &#36890;&#36807;usb_bus_type&#37324;&#38754;&#23450;&#20041;&#30340;match&#20989;&#25968;&#26469;&#21305;&#37197;struct usb_device_driver&#39537;&#21160;&#65292;&#26368;&#32456;&#21305;&#37197;
    </p>
    <p>
      &#21040;&#25991;&#20214; drivers/usb/core/generic.c &#37324;&#38754;&#30340;
    </p>
    <p>
      <b><font color="#ff0033">struct usb_device_driver usb_generic_driver </font></b>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#3300ff">&#25105;&#20204;&#35201;&#27880;&#24847;usb_device_driver&#21644;usb_driver&#30340;&#21306;&#21035;&#65292;&#21069;&#32773;&#26159;&#25972;&#20010;&#30340;usb&#35774;&#22791;&#30340;&#39537;&#21160;&#65292; </font>
    </p>
    <p>
      <font color="#3300ff">&#21518;&#32773;&#26159;&#26576;&#19968;&#20010;interface&#30340;&#39537;&#21160;</font>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ff3333" DESTINATION="ID_1155032627" ENDARROW="Default" ENDINCLINATION="323;0;" ID="Arrow_ID_126223576" SOURCE="ID_1521785377" STARTARROW="None" STARTINCLINATION="1184;0;"/>
<node CREATED="1598838347035" ID="ID_216338570" MODIFIED="1598838392116">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20998;&#26512;&#19968;&#19979;probe&#20989;&#25968;
    </p>
    <p>
      
    </p>
    <p>
      <b><font face="Times New Roman" color="#3300ff">static int generic_probe(struct usb_device *udev)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1598838417661" ID="ID_1646361811" MODIFIED="1599808338510">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;c = usb_choose_configuration(udev);
    </p>
    <p>
      &#20989;&#25968;&#21407;&#22411;
    </p>
    <p>
      <b>int usb_choose_configuration(struct usb_device *udev)</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1599808423749" ID="ID_903721286" MODIFIED="1599808491545">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;int i; </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;int num_configs; </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;int insufficient_power = 0; </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;struct usb_host_config *c, *best;</font>
    </p>
    <p>
      <b>&#19968;&#20123;&#21464;&#37327;&#30340;&#22768;&#26126;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599808518486" ID="ID_1188386649" MODIFIED="1599808559120">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      c = udev-&gt;config;
    </p>
    <p>
      num_configs = udev-&gt;descriptor.bNumConfigurations;
    </p>
    <p>
      &#33719;&#21462;usb&#35774;&#22791;&#37197;&#32622;&#30340;&#20010;&#25968;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599808623822" ID="ID_868158271" MODIFIED="1599809228876">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; num_configs; (i++, <b><font color="#ff3333">c++</font></b>))
    </p>
    <p>
      &#24490;&#29615;&#22788;&#29702;&#25152;&#26377;&#30340;&#37197;&#32622;&#65292;&#27880;&#24847;&#36825;&#37324;&#30340;c++&#25805;&#20316;
    </p>
  </body>
</html></richcontent>
<node CREATED="1599809395475" ID="ID_1193044611" MODIFIED="1599809428128">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_interface_descriptor *desc = NULL;
    </p>
    <p>
      &#21464;&#37327;&#22768;&#26126;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599809479323" ID="ID_967576938" MODIFIED="1599809511426">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (c-&gt;desc.bNumInterfaces &gt; 0)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;desc = &amp;c-&gt;intf_cache[0]-&gt;altsetting-&gt;desc;
    </p>
    <p>
      &#33719;&#21462;&#25509;&#21475;&#25551;&#36848;&#31526;desc
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599809919986" ID="ID_510520005" MODIFIED="1599809976894">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (usb_get_max_power(udev, c) &gt; udev-&gt;bus_mA) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;insufficient_power++;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;continue;
    </p>
    <p>
      }
    </p>
    <p>
      &#22914;&#26524;&#24403;&#21069;&#30340;&#37197;&#32622;&#38656;&#35201;&#30340;&#20379;&#30005;&#22823;&#20110;&#35774;&#22791;&#33021;&#22815;&#25552;&#20379;&#30340;&#20379;&#30005;&#37327;&#65292;&#21017;&#25918;&#24323;&#20351;&#29992;&#24403;&#21069;&#30340;&#37197;&#32622;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599810218384" ID="ID_750168757" MODIFIED="1599810256419">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0000ff">&#21097;&#19979;&#30340;&#20195;&#30721;&#20197;&#21518;&#20877;&#30475;&#65292;&#36825;&#37324;&#20808;&#30053;&#36807;&#20102;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1598838440518" ID="ID_105739457" MODIFIED="1598839033632">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      err = usb_set_configuration(udev, c);
    </p>
    <p>
      &#20989;&#25968;&#21407;&#22411;&#22914;&#19979;&#65306;
    </p>
    <p>
      int usb_set_configuration(struct usb_device *dev, int configuration)
    </p>
    <p>
      
    </p>
    <p>
      &#19979;&#38754;&#20998;&#26512;&#35813;&#20989;&#25968;
    </p>
  </body>
</html></richcontent>
<node CREATED="1599810339357" ID="ID_1456774419" MODIFIED="1599810379615">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;int i, ret; </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;struct usb_host_config *cp = NULL; </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;struct usb_interface **new_interfaces = NULL; </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;struct usb_hcd *hcd = bus_to_hcd(dev-&gt;bus); </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;int n, nintf;</font>
    </p>
    <p>
      <b>&#21464;&#37327;&#30340;&#22768;&#26126;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599810400513" ID="ID_1091430437" MODIFIED="1599810450698">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; dev-&gt;descriptor.bNumConfigurations; i++) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (dev-&gt;config[i].desc.bConfigurationValue ==
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;configuration) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cp = &amp;dev-&gt;config[i];
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#160;}
    </p>
    <p>
      &#33719;&#21462;&#30001;configuration&#25351;&#23450;&#30340;&#37197;&#32622;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599810576265" ID="ID_1312296248" MODIFIED="1599810686266">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      nintf = cp-&gt;desc.bNumInterfaces;
    </p>
    <p>
      new_interfaces = kmalloc(nintf * sizeof(*new_interfaces), GFP_NOIO);
    </p>
    <p>
      
    </p>
    <p>
      for (; n &lt; nintf; ++n) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;new_interfaces[n] = kzalloc(sizeof(struct usb_interface),GFP_NOIO);
    </p>
    <p>
      }
    </p>
    <p>
      
    </p>
    <p>
      &#33719;&#21462;&#25509;&#21475;&#25968;&#65292;&#24182;&#20998;&#37197;&#23545;&#24212;&#30340;usb_interface&#32467;&#26500;&#20307;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599810767009" ID="ID_369355996" MODIFIED="1599810803647">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = usb_autoresume_device(dev);
    </p>
    <p>
      &#21796;&#37266;&#24403;&#21069;&#30340;usb&#35774;&#22791;&#65292;&#36825;&#37324;&#30340;usb&#35774;&#22791;&#26159;root hub&#35774;&#22791;&#20102;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599810866601" ID="ID_1653632074" MODIFIED="1599810914017">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;if (dev-&gt;state != USB_STATE_ADDRESS)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_disable_device(dev, 1); /* Skip ep0 */
    </p>
    <p>
      &#22914;&#26524;&#21457;&#29616;&#35813;&#35774;&#22791;&#24050;&#32463;&#34987;&#37197;&#32622;&#36807;&#20102;&#65292;&#37027;&#20040;&#23601;&#20002;&#24323;&#25481;&#21407;&#20808;&#30340;&#37197;&#32622;&#65292;&#20934;&#22791;&#37325;&#26032;&#36827;&#34892;&#37197;&#32622;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599810961505" ID="ID_1063300292" MODIFIED="1599811007989">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      /* Get rid of pending async Set-Config requests for this device */
    </p>
    <p>
      &#160;&#160;&#160;&#160;cancel_async_set_config(dev);
    </p>
    <p>
      &#26087;&#26377;&#30340;&#34987;&#25346;&#36215;&#30340;config&#35831;&#27714;&#20063;&#20250;&#34987;&#20002;&#24323;&#25481;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599811764592" ID="ID_1792768188" MODIFIED="1599811814498">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = usb_hcd_alloc_bandwidth(dev, cp, NULL, NULL);
    </p>
    <p>
      &#26816;&#26597;&#26032;&#37197;&#32622;&#30340;&#24102;&#23485;&#26159;&#21542;&#36229;&#36807;&#20102;bus&#30340;&#24635;&#24102;&#23485;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599812306945" ID="ID_52079658" MODIFIED="1599812349856">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff3333">for (i = 0; i &lt; nintf; ++i) </font></b>
    </p>
    <p>
      &#36827;&#20837;for&#24490;&#29615;&#65292;&#22788;&#29702;&#24403;&#21069;&#37197;&#32622;&#19979;&#38754;&#30340;&#25152;&#26377;&#30340;interface
    </p>
  </body>
</html></richcontent>
<node CREATED="1599812367154" ID="ID_147737339" MODIFIED="1599812398411">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_interface_cache *intfc;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_interface *intf;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_host_interface *alt;
    </p>
    <p>
      &#20869;&#37096;&#21464;&#37327;&#22768;&#26126;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599812413283" ID="ID_492391983" MODIFIED="1599812494077">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      cp-&gt;interface[i] = intf = new_interfaces[i];
    </p>
    <p>
      &#20174;&#20998;&#37197;&#30340;interface&#25968;&#32452;&#37324;&#38754;&#36171;&#20540;&#19968;&#20010;&#25509;&#21475;&#25351;&#38024;&#32473;cp-&gt;interface[i]
    </p>
    <p>
      &#27880;&#24847;cp-&gt;interface[]&#25968;&#32452;&#37324;&#38754;&#30340;&#25351;&#38024;&#19981;&#26159;&#38271;&#26399;&#20445;&#30041;&#30340;&#65292;&#26681;&#25454;&#19981;&#21516;&#30340;&#37197;&#32622;&#20250;&#34987;
    </p>
    <p>
      &#26356;&#26032;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599812787502" ID="ID_1067343018" MODIFIED="1599813333963">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      intfc = cp-&gt;intf_cache[i];&#160;&#160;----&#12299; <font color="#ff3333">usb&#35774;&#22791;&#26522;&#20030;&#38454;&#27573;parse&#29983;&#25104;&#30340;</font>
    </p>
    <p>
      &#33719;&#21462;interface cache&#32467;&#26500;&#20307;&#65292;&#27880;&#24847;interface cache&#25968;&#32452;&#26159;&#38271;&#26399;&#23384;&#22312;&#30340;&#65292;
    </p>
    <p>
      &#20026;&#30340;&#26159;&#26041;&#20415;&#29992;&#25143;&#23618;&#22312;sys&#30446;&#24405;&#19979;&#38754;&#26597;&#30475;&#35774;&#22791;&#30340;&#25509;&#21475;&#20449;&#24687;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#0033ff" DESTINATION="ID_1067343018" ENDARROW="None" ENDINCLINATION="-566;-78;" ID="Arrow_ID_150817927" SOURCE="ID_824422241" STARTARROW="None" STARTINCLINATION="2289;0;"/>
</node>
<node CREATED="1599813894167" ID="ID_533455026" MODIFIED="1599813934735">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;num_altsetting = intfc-&gt;num_altsetting;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;authorized = !!HCD_INTF_AUTHORIZED(hcd);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;kref_get(&amp;intfc-&gt;ref);
    </p>
    <p>
      &#23558;interface cache&#37324;&#38754;&#30340;setting&#25968;&#32452;&#36171;&#20540;&#32473;&#24403;&#21069;&#30340;&#25509;&#21475;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599814002700" ID="ID_859669694" MODIFIED="1599814034717">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alt = usb_altnum_to_altsetting(intf, 0);
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* No altsetting 0?&#160;&#160;We'll assume the first altsetting.
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* We could use a GetInterface call, but if a device is
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* so non-compliant that it doesn't have altsetting 0
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* then I wouldn't trust its reply anyway.
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (!alt)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alt = &amp;intf-&gt;altsetting[0];
    </p>
    <p>
      <b>&#33719;&#21462;setting 0</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599816266602" ID="ID_1464766333" MODIFIED="1599816290851">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      intf-&gt;intf_assoc =
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;find_iad(dev, cp, alt-&gt;desc.bInterfaceNumber);
    </p>
    <p>
      &#33719;&#21462;&#25509;&#21475;&#25551;&#36848;&#31526;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599816314143" ID="ID_367107506" MODIFIED="1599816317608" TEXT="intf-&gt;cur_altsetting = alt;"/>
<node CREATED="1599816356345" ID="ID_1339927757" MODIFIED="1599816384811">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0033">usb_enable_interface(dev, intf, true);</font></b>
    </p>
    <p>
      &#20351;&#33021;&#25509;&#21475;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599816437560" ID="ID_471650229" MODIFIED="1599816484852">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;dev.parent = &amp;dev-&gt;dev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;dev.driver = NULL;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;dev.bus = &amp;usb_bus_type;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;dev.type = &amp;usb_if_device_type;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;dev.groups = usb_interface_groups;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/*
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Please refer to usb_alloc_dev() to see why we set
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* dma_mask and dma_pfn_offset.
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;dev.dma_mask = dev-&gt;dev.dma_mask;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;dev.dma_pfn_offset = dev-&gt;dev.dma_pfn_offset;
    </p>
    <p>
      &#21021;&#22987;&#21270;usb interface&#35774;&#22791;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600046696934" ID="ID_202233357" MODIFIED="1600046722639">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      INIT_WORK(&amp;intf-&gt;reset_ws, <b><font color="#3300ff">__usb_queue_reset_device</font></b>);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600046773783" ID="ID_1453966748" MODIFIED="1600046790114">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      device_initialize(&amp;intf-&gt;dev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600046807364" ID="ID_830657750" MODIFIED="1600046838514">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman" size="4" color="#ff0033">usb_get_dev(dev)</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600046875422" ID="ID_69416332" MODIFIED="1600046937936">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = usb_control_msg(dev, usb_sndctrlpipe(dev, 0),
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USB_REQ_SET_CONFIGURATION, 0, configuration, 0,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NULL, 0, USB_CTRL_SET_TIMEOUT)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600047072964" ID="ID_1699404820" MODIFIED="1600047106378">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev-&gt;actconfig = cp
    </p>
    <p>
      &#35760;&#24405;&#19979;&#24403;&#21069;&#27963;&#36291;&#30340;&#37197;&#32622;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600047126111" ID="ID_1607523738" MODIFIED="1600047158777">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_set_device_state(dev, USB_STATE_CONFIGURED)
    </p>
    <p>
      &#20462;&#25913;&#24403;&#21069;&#35774;&#22791;&#30340;&#29366;&#24577;&#20026;&#24050;&#37197;&#32622;&#29366;&#24577;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600047528783" ID="ID_531658368" MODIFIED="1600047566689">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; nintf; ++i)
    </p>
    <p>
      &#36827;&#20837;&#21040;for&#24490;&#29615;&#65292;&#27880;&#20876;&#25509;&#21475;&#35774;&#22791;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600047632277" ID="ID_176396847" MODIFIED="1600047676029">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_interface *intf = cp-&gt;interface[i]
    </p>
    <p>
      &#33719;&#21462;&#21040;&#25509;&#21475;&#25551;&#36848;&#31526;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600047689287" ID="ID_1645339013" MODIFIED="1600047807519">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0000ff">dev_dbg(</font></b>&amp;dev-&gt;dev,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;adding %s (config #%d, interface %d)\n&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dev_name(&amp;intf-&gt;dev), configuration,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;intf-&gt;cur_altsetting-&gt;desc.bInterfaceNumber<b><font color="#0000cc">)</font></b>
    </p>
    <p>
      <i><font size="4" face="Times New Roman">&#36825;&#26159;&#25171;&#21360;&#20986;&#26469;&#30340;&#26085;&#24535;</font></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600047821245" ID="ID_1845239625" MODIFIED="1600047834425">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      device_enable_async_suspend(&amp;intf-&gt;dev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600047851349" ID="ID_748496781" MODIFIED="1600047869382">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      device_add(&amp;intf-&gt;dev)
    </p>
    <p>
      &#27880;&#20876;&#25509;&#21475;&#35774;&#22791;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600048393354" ID="ID_652962456" MODIFIED="1600332038451">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman" size="4" color="#009933">&#23545;&#20110;hub&#30340;&#25509;&#21475;&#26469;&#35828;&#65292;&#21305;&#37197;&#21040;&#22914;&#19979;&#30340;&#20989;&#25968; </font></b>
    </p>
    <p>
      <b><font face="Times New Roman" size="4" color="#009933">int hub_probe(struct usb_interface *intf, const struct usb_device_id *id)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600053629501" ID="ID_974483330" MODIFIED="1600054136907">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21464;&#37327;&#22768;&#26126;
    </p>
    <p>
      struct usb_host_interface *desc;&#160;&#160;&#23545;&#20110;&#24403;&#21069;&#25509;&#21475;&#30340;&#25551;&#36848;&#32467;&#26500;&#20307;
    </p>
    <p>
      struct usb_endpoint_descriptor *endpoint;
    </p>
    <p>
      struct usb_device *hdev;
    </p>
    <p>
      struct usb_hub *hub;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600061928095" ID="ID_682492379" MODIFIED="1600063978043">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>struct usb_hub {</b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct device&#160;&#160;&#160;&#160;&#160;&#160;&#160;*intfdev;&#160;&#160;&#160;/* the &quot;interface&quot; device */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device&#160;&#160;&#160;*hdev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct kref&#160;&#160;&#160;&#160;&#160;kref;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct urb&#160;&#160;&#160;&#160;&#160;&#160;*urb;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* for interrupt polling pipe */
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* buffer for urb ... with extra space in case of babble */
    </p>
    <p>
      &#160;&#160;&#160;&#160;u8&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(*buffer)[8];
    </p>
    <p>
      &#160;&#160;&#160; <i><font face="Times New Roman" size="4" color="#0000ff">union { </font></i>
    </p>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_hub_status&#160;&#160;&#160;hub; </font></i>
    </p>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_port_status&#160;&#160;port; </font></i>
    </p>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">&#160;&#160;&#160;&#160;} *status;&#160;&#160;&#160;&#160;/* buffer for status reports */</font></i>
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct mutex&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;status_mutex;&#160;&#160;&#160;/* for the status buffer */
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;has_indicators:1;
    </p>
    <p>
      &#160;&#160;&#160;&#160;u8&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;indicator[USB_MAXCHILDREN];
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct delayed_work leds;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct delayed_work init_work;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct work_struct&#160;&#160;&#160;&#160;&#160;&#160;events;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_port&#160;&#160;&#160;&#160;&#160;**ports;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160; <font face="Times New Roman" size="4" color="#ff0033">struct usb_hub_descriptor *descriptor;&#160;&#160;/* class descriptor */ </font>
    </p>
    <p>
      <font face="Times New Roman" size="4" color="#ff0033">&#160;&#160;&#160;&#160;struct usb_tt&#160;&#160;&#160;&#160;&#160;&#160;&#160;tt;&#160;&#160;&#160;&#160;&#160;/* Transaction Translator */</font>
    </p>
    <p>
      <b>}</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600134656167" ID="ID_1231751798" MODIFIED="1600135025610">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      TT &#21363; Transaction Translator
    </p>
    <p>
      &#35813;&#21151;&#33021;&#26159;hub&#30340;&#21151;&#33021;&#65292;&#24403;hub&#19968;&#36793;&#25509;&#20837;&#30340;&#26159;full/low speed&#35774;&#22791;&#65292;
    </p>
    <p>
      &#21478;&#19968;&#36793;&#25509;&#20837;&#30340;&#26159;high speed&#35774;&#22791;&#30340;&#26102;&#20505;&#65292;hub&#21033;&#29992;TT&#30340;&#21151;&#33021;&#26469;&#27807;&#36890;&#20004;&#36793;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600135129248" ID="ID_1242396040" MODIFIED="1600135215466">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0033">struct usb_tt {</font></b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device&#160;&#160;&#160;*hub;&#160;&#160;&#160;/* upstream highspeed hub */
    </p>
    <p>
      &#160;&#160;&#160;&#160;int&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;multi;&#160;&#160;/* true means one TT per port */
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;think_time; /* think time in ns */
    </p>
    <p>
      &#160;&#160;&#160;&#160;void&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;*hcpriv;&#160;&#160;&#160;&#160;/* HCD private data */
    </p>
    <p>
      &#160;&#160;&#160;&#160;/* for control/bulk error recovery (CLEAR_TT_BUFFER) */
    </p>
    <p>
      &#160;&#160;&#160;&#160;spinlock_t&#160;&#160;&#160;&#160;&#160;&#160;lock;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct list_head&#160;&#160;&#160;&#160;clear_list; /* of usb_tt_clear */
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct work_struct&#160;&#160;clear_work;
    </p>
    <p>
      <b><font color="#ff0000">};</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1600054277353" ID="ID_193374215" MODIFIED="1600054332966">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      desc = intf-&gt;cur_altsetting; &#33719;&#21462;&#21040;&#25509;&#21475;&#25551;&#36848;&#31526;
    </p>
    <p>
      
    </p>
    <p>
      hdev = interface_to_usbdev(intf); &#26681;&#25454;&#25509;&#21475;&#33719;&#21462;usb&#35774;&#22791;&#32467;&#26500;&#20307;&#25351;&#38024;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600054972584" ID="ID_1400807537" MODIFIED="1600060173497">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (hdev-&gt;parent) {&#160;&#160;&#160;&#160;&#160;/* normal device */
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_enable_autosuspend(hdev);
    </p>
    <p>
      &#160;&#160;&#160;&#160;} else {&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* root hub */
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;const struct hc_driver *drv = bus_to_hcd(hdev-&gt;bus)-&gt;driver;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (drv-&gt;bus_suspend &amp;&amp; drv-&gt;bus_resume)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_enable_autosuspend(hdev);
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#23545;&#20110;&#26222;&#36890;&#30340;hub&#21644;root hub&#65292; &#20351;&#33021;autosuspend&#30340;&#26041;&#27861;&#26159;&#19981;&#19968;&#26679;&#30340;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600060490291" ID="ID_1865817395" MODIFIED="1600060544409">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (desc-&gt;desc.bNumEndpoints != 1)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto descriptor_error;
    </p>
    <p>
      endpoint = &amp;desc-&gt;endpoint[0].desc;
    </p>
    <p>
      
    </p>
    <p>
      &#33719;&#21462;&#31471;&#28857;&#25551;&#36848;&#31526;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600060593039" ID="ID_1261596172" MODIFIED="1600060627060">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36825;&#37324;&#38656;&#35201;&#21028;&#26029;&#26159;&#21542;&#26159;&#20013;&#26029;IN&#31471;&#28857;
    </p>
    <p>
      /* If it's not an interrupt in endpoint, we'd better punt! */
    </p>
    <p>
      &#160;&#160;&#160;&#160;if (!usb_endpoint_is_int_in(endpoint))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto descriptor_error;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600060649864" ID="ID_1725403281" MODIFIED="1600060672686">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev_info(&amp;intf-&gt;dev, &quot;USB hub found\n&quot;);
    </p>
    <p>
      &#25171;&#21360;&#20449;&#24687;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600061237846" ID="ID_670039648" MODIFIED="1600061260888">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20869;&#26680;&#20998;&#37197;hub&#32467;&#26500;&#20307;
    </p>
    <p>
      
    </p>
    <p>
      hub = kzalloc(sizeof(*hub), GFP_KERNEL);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600062260394" ID="ID_1413974688" MODIFIED="1600324001098">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21021;&#22987;&#21270;&#21160;&#24577;&#20998;&#37197;&#20986;&#26469;&#30340;hub&#32467;&#26500;&#20307;
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;kref_init(&amp;hub-&gt;kref); </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;hub-&gt;intfdev = &amp;intf-&gt;dev; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;hub-&gt;hdev = hdev; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;INIT_DELAYED_WORK(&amp;hub-&gt;leds, led_work); </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;INIT_DELAYED_WORK(&amp;hub-&gt;init_work, NULL); </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;INIT_WORK(&amp;hub-&gt;events, </font><b><font face="Times New Roman" size="4" color="#ff0066">hub_event</font></b><font face="Times New Roman" size="4">); </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;usb_get_intf(intf); </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;usb_get_dev(hdev);</font>
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ff0033" DESTINATION="ID_1232211851" ENDARROW="None" ENDINCLINATION="-766;90;" ID="Arrow_ID_416143009" STARTARROW="None" STARTINCLINATION="1167;0;"/>
</node>
<node CREATED="1600062526164" ID="ID_871270725" MODIFIED="1600062560656">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_set_intfdata(intf, hub) &#23558;hub&#35774;&#32622;&#20026;intf&#35774;&#22791;&#30340;drv data
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600062578225" ID="ID_685996065" MODIFIED="1600062592849">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;intf-&gt;needs_remote_wakeup = 1;
    </p>
    <p>
      &#160;&#160;&#160;&#160;pm_suspend_ignore_children(&amp;intf-&gt;dev, true);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600062843988" ID="ID_1775747160" MODIFIED="1600062918627">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (hdev-&gt;speed == USB_SPEED_HIGH)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;highspeed_hubs++;&#160;&#160;&#35760;&#24405;&#39640;&#36895;hub&#30340;&#25968;&#37327;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600063025389" ID="ID_964322007" MODIFIED="1600063199877">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (id-&gt;driver_info &amp; HUB_QUIRK_CHECK_PORT_AUTOSUSPEND)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hub-&gt;quirk_check_port_auto_suspend = 1;&#160;&#160;&#20351;&#33021;&#31471;&#28857;&#30340;&#33258;&#21160;&#25346;&#36215;&#21151;&#33021;&#65311;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600063489206" ID="ID_224713237" MODIFIED="1600063565309">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hub_configure(hub, endpoint)
    </p>
    <p>
      
    </p>
    <p>
      &#21407;&#22411;&#20989;&#25968;
    </p>
    <p>
      static int hub_configure(struct usb_hub *hub,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_endpoint_descriptor *endpoint)
    </p>
  </body>
</html></richcontent>
<node CREATED="1600063619931" ID="ID_629160385" MODIFIED="1600063799826">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_hcd *hcd;
    </p>
    <p>
      struct usb_device *hdev = hub-&gt;hdev;
    </p>
    <p>
      struct device *hub_dev = hub-&gt;intfdev;
    </p>
    <p>
      &#36319;usb&#35774;&#22791;&#30456;&#20851;&#30340;&#21464;&#37327;&#22768;&#26126;&#21644;&#36171;&#20540;
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600063830524" ID="ID_81579464" MODIFIED="1600063882845">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      u16 hubstatus, hubchange;
    </p>
    <p>
      u16 wHubCharacteristics;
    </p>
    <p>
      unsigned int pipe;
    </p>
    <p>
      int maxp, ret, i;
    </p>
    <p>
      char *message = &quot;out of memory&quot;;
    </p>
    <p>
      unsigned unit_load;
    </p>
    <p>
      unsigned full_load;
    </p>
    <p>
      unsigned maxchild;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600064096556" ID="ID_1797206340" MODIFIED="1600064176500">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman" size="4" color="#3300ff">hub&#35774;&#22791;&#20869;&#37096;&#21464;&#37327;&#30340;&#21160;&#24577;&#20998;&#37197;</font></b>
    </p>
    <p>
      hub-&gt;buffer = kmalloc(sizeof(*hub-&gt;buffer), GFP_KERNEL)
    </p>
    <p>
      hub-&gt;status = kmalloc(sizeof(*hub-&gt;status), GFP_KERNEL)
    </p>
    <p>
      mutex_init(&amp;hub-&gt;status_mutex)
    </p>
    <p>
      hub-&gt;descriptor = kzalloc(sizeof(*hub-&gt;descriptor), GFP_KERNEL)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600064481070" ID="ID_329703061" MODIFIED="1600064524965">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = get_hub_descriptor(hdev, hub-&gt;descriptor)
    </p>
    <p>
      &#33719;&#21462;hub&#25551;&#36848;&#31526;&#65311;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600064641455" ID="ID_1696118412" MODIFIED="1600064818708">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      maxchild = USB_MAXCHILDREN;
    </p>
    <p>
      if (hub_is_superspeed(hdev))
    </p>
    <p>
      &#160;&#160;&#160;&#160;maxchild = min_t(unsigned, maxchild, USB_SS_MAXPORTS);
    </p>
    <p>
      &#36825;&#37324;&#26159;&#35774;&#32622;hub&#21487;&#20197;&#25903;&#25345;&#30340;&#26368;&#22823;&#30340;port&#25968;&#37327;
    </p>
    <p>
      
    </p>
    <p>
      maxchild = hub-&gt;descriptor-&gt;bNbrPorts;
    </p>
    <p>
      &#20174;&#25551;&#36848;&#31526;&#37324;&#38754;&#33719;&#21462;port&#30340;&#25968;&#37327;&#65292;&#24182;&#25171;&#21360;&#20986;&#30456;&#20851;&#30340;&#26085;&#24535;
    </p>
    <p>
      dev_info(hub_dev, &quot;%d port%s detected\n&quot;, maxchild, (maxchild == 1) ? &quot;&quot; : &quot;s&quot;);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600064916110" ID="ID_553098478" MODIFIED="1600064938794">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20998;&#37197;&#20986;&#23545;&#24212;&#25968;&#37327;&#30340;port&#31471;&#21475;
    </p>
    <p>
      hub-&gt;ports = kzalloc(maxchild * sizeof(struct usb_port *), GFP_KERNEL);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600065183414" ID="ID_1375408694" MODIFIED="1600065220823">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      wHubCharacteristics = le16_to_cpu(hub-&gt;descriptor-&gt;wHubCharacteristics)
    </p>
    <p>
      &#33719;&#21462;&#29305;&#24615;&#65311;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600065232368" ID="ID_381238031" MODIFIED="1600065342464">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (hub_is_superspeed(hdev)) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;unit_load = 150;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;full_load = 900;
    </p>
    <p>
      &#160;&#160;&#160;&#160;} else {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;unit_load = 100;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;full_load = 500;
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#36825;&#37324;&#30340;unit_load&#36319;full_load&#20195;&#34920;&#30340;&#24847;&#24605;&#26159;&#20160;&#20040;&#65311;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600135256020" ID="ID_1117416619" MODIFIED="1600135294419">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;spin_lock_init(&amp;hub-&gt;tt.lock);
    </p>
    <p>
      &#160;&#160;&#160;&#160;INIT_LIST_HEAD(&amp;hub-&gt;tt.clear_list);
    </p>
    <p>
      &#160;&#160;&#160;&#160;INIT_WORK(&amp;hub-&gt;tt.clear_work, hub_tt_work);
    </p>
    <p>
      <b><i><font color="#0000ff">&#21021;&#22987;&#21270;hub&#20869;&#37096;&#30340;tt&#32467;&#26500;&#20307;</font></i></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600135853938" ID="ID_950176543" MODIFIED="1600135951759">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">A hub operating at high-speed can have one of two TT organizations: single TT or multiple TT. All hubs </font></i>
    </p>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">must support the single TT organization. A multiple TT hub has an additional interface descriptor (with a </font></i>
    </p>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">corresponding endpoint descriptor). The first set of descriptors shown below must be provided by all hubs. </font></i>
    </p>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">A hub that has a single TT must set the bDeviceProtocol field of the device descriptor to one(1) and the </font></i>
    </p>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">interface descriptor bInterfaceProtocol field set to 0. </font></i>
    </p>
    <p>
      
    </p>
    <p>
      switch (hdev-&gt;descriptor.bDeviceProtocol) &#21028;&#26029;TT&#30340;&#32452;&#32455;&#26041;&#24335;&#65292;&#30446;&#21069;845&#24179;&#21488;&#20351;&#29992;&#30340;&#26159;single tt
    </p>
    <p>
      case USB_HUB_PR_HS_SINGLE_TT:
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dev_dbg(hub_dev, &quot;Single TT\n&quot;);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hub-&gt;tt.hub = hdev;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600160663733" ID="ID_210071501" MODIFIED="1600160689557">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = usb_get_status(hdev, USB_RECIP_DEVICE, 0, &amp;hubstatus);
    </p>
    <p>
      &#33719;&#21462;hub&#30340;&#29366;&#24577;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600160918217" ID="ID_1396435974" MODIFIED="1600161034123">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;root_hub&#23601;&#31561;&#20110;&#24403;&#21069;&#30340;usb&#35774;&#22791;&#65292;&#20570;&#22914;&#19979;&#30340;&#22788;&#29702;
    </p>
    <p>
      if (hdev == hdev-&gt;bus-&gt;root_hub)
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1600161974779" ID="ID_241769970" MODIFIED="1600162016214">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#35774;&#32622;&#30005;&#21147;&#39044;&#31639;
    </p>
    <p>
      
    </p>
    <p>
      if (hcd-&gt;power_budget &gt; 0)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hdev-&gt;bus_mA = hcd-&gt;power_budget;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hdev-&gt;bus_mA = full_load * maxchild;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (hdev-&gt;bus_mA &gt;= full_load)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hub-&gt;mA_per_port = full_load;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hub-&gt;mA_per_port = hdev-&gt;bus_mA;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hub-&gt;limited_power = 1;
    </p>
    <p>
      &#160;}
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600236680343" ID="ID_1112263069" MODIFIED="1600236718503">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = hub_hub_status(hub, &amp;hubstatus, &amp;hubchange)&#160;&#160;&#21448;&#26159;&#33719;&#21462;hub&#30340;&#29366;&#24577;&#65311;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600237380522" ID="ID_1690712775" MODIFIED="1600239389347">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#35774;&#32622;&#20013;&#26029;&#31471;&#28857;&#65292;&#37197;&#32622;&#20013;&#26029;&#31471;&#28857;&#23545;&#24212;&#30340;urb&#32467;&#26500;&#20307;
    </p>
    <p>
      pipe = usb_rcvintpipe(hdev, endpoint-&gt;bEndpointAddress);
    </p>
    <p>
      maxp = usb_maxpacket(hdev, pipe, usb_pipeout(pipe));
    </p>
    <p>
      hub-&gt;urb = usb_alloc_urb(0, GFP_KERNEL);
    </p>
    <p>
      usb_fill_int_urb(hub-&gt;urb, hdev, pipe, *hub-&gt;buffer, maxp, hub_irq,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hub, endpoint-&gt;bInterval);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600239609756" ID="ID_596290369" MODIFIED="1600240356019">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#cc0033">&#20998;&#37197;&#24182;&#27880;&#20876;port&#35774;&#22791;&#65292;&#36825;&#37096;&#20998;&#20195;&#30721;&#21518;&#38754;&#20171;&#32461;</font></b>
    </p>
    <p>
      for (i = 0; i &lt; maxchild; i++) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;ret = usb_hub_create_port_device(hub, i + 1);
    </p>
    <p>
      }
    </p>
    <p>
      hdev-&gt;maxchild = i;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600313389072" ID="ID_1331279742" MODIFIED="1600313440259">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="5" color="#000099">int usb_hub_create_port_device(struct usb_hub *hub, int port1) </font>
    </p>
    <p>
      <font face="Times New Roman" size="5" color="#000099">&#20989;&#25968;&#21407;&#22411;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600240371103" ID="ID_875608682" MODIFIED="1600240834411">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = hcd-&gt;driver-&gt;update_hub_device(hcd, hdev,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&amp;hub-&gt;tt, GFP_KERNEL);
    </p>
    <p>
      &#35843;&#29992;update_hub_device&#20989;&#25968;&#65292;&#35843;&#29992;&#21040;xhci_update_hub_device
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600247033071" ID="ID_337021924" MODIFIED="1600247068371">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_hub_adjust_deviceremovable(hdev, hub-&gt;descriptor);
    </p>
    <p>
      <b>&#36825;&#26159;&#36215;&#21040;&#20160;&#20040;&#20316;&#29992;&#30340;&#65311;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600247079860" ID="ID_1271823248" MODIFIED="1600304975162">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman" size="4" color="#3300ff">hub_activate(hub, HUB_INIT); </font></b>
    </p>
    <p>
      <b><font color="#ff3300">&#20989;&#25968;&#21407;&#22411;&#65306; </font></b>
    </p>
    <p>
      <b><font color="#ff3300">static void hub_activate(struct usb_hub *hub, enum hub_activation_type type)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600305098660" ID="ID_1551683556" MODIFIED="1600305148927">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#21464;&#37327;&#22768;&#26126;</b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device *hdev = hub-&gt;hdev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_hcd *hcd;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int ret;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int port1;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int status;
    </p>
    <p>
      &#160;&#160;&#160;&#160;bool need_debounce_delay = false;
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned delay;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600309253276" ID="ID_859718456" MODIFIED="1600309305592">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#24403;&#20256;&#20837;&#30340;type&#26159;HUB_INIT2&#25110;&#32773;HUB_INIT3&#30340;&#26102;&#20505;&#65292;&#20570;&#22914;&#19979;
    </p>
    <p>
      &#30340;&#20195;&#30721;&#22788;&#29702;&#24037;&#20316;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600309312196" ID="ID_227784814" MODIFIED="1600309357835">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (hub-&gt;disconnected)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto disconnected;
    </p>
    <p>
      &#22914;&#26524;hub&#24050;&#32463;&#26029;&#24320;&#36830;&#25509;&#65292;&#21017;&#36339;&#36716;&#21040;disconnected&#26631;&#31614;&#22788;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600309368488" ID="ID_1958584060" MODIFIED="1600309444022">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (type == HUB_INIT2)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;goto init2;&#160;&#160;&#36339;&#36716;&#21040;init2&#20195;&#30721;&#26631;&#31614;&#22788;&#25191;&#34892;&#65292;
    </p>
    <p>
      &#19979;&#38754;&#30475;&#19968;&#19979;&#36825;&#37096;&#20998;&#30340;&#20195;&#30721;&#27969;&#31243;&#65281;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ff0000" DESTINATION="ID_1958584060" ENDARROW="Default" ENDINCLINATION="682;0;" ID="Arrow_ID_357783304" SOURCE="ID_677574427" STARTARROW="None" STARTINCLINATION="-101;-36;"/>
<node CREATED="1600310254825" ID="ID_1146357981" MODIFIED="1600310388647">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36827;&#20837;for&#24490;&#29615;&#65292;&#22788;&#29702;hub&#19979;&#38754;&#30340;&#25152;&#26377;&#30340;port
    </p>
    <p>
      <b>for (port1 = 1; port1 &lt;= hdev-&gt;maxchild; ++port1)</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600310395637" ID="ID_1856547204" MODIFIED="1600319552359">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_port *port_dev = hub-&gt;ports[port1 - 1];&#160;&#160;&#33719;&#21462;usb_port&#32467;&#26500;&#20307;
    </p>
    <p>
      <b><font color="#ff0000">struct usb_device *udev = port_dev-&gt;child;</font></b>&#160; &#33719;&#21462;&#36830;&#25509;&#22312;&#35813;port&#19978;&#38754;&#30340;usb_device&#32467;&#26500;&#20307;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600310476171" ID="ID_1323465553" MODIFIED="1600310498058">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      status = hub_port_status(hub, port1, &amp;portstatus, &amp;portchange);
    </p>
    <p>
      &#33719;&#21462;&#24403;&#21069;&#30340;port&#29366;&#24577;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600310533390" ID="ID_477564680" MODIFIED="1600314240787">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (udev || (portstatus &amp; USB_PORT_STAT_CONNECTION))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;dev_dbg(&amp;port_dev-&gt;dev, &quot;status %04x change %04x\n&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;portstatus, portchange);
    </p>
    <p>
      
    </p>
    <p>
      &#22914;&#26524;&#24403;&#21069;&#30340;port&#26377;&#35774;&#22791;&#36830;&#25509;&#65292;&#21017;&#25171;&#21360;&#26085;&#24535;&#65292;
    </p>
    <p>
      <b><font color="#cc00cc">&#23545;&#20110;usb2.0&#30340;port, &#25171;&#21360;&#30340;&#26085;&#24535;&#26159;&#65306; usb usb1-port1: status 0101 change 0001 </font></b>
    </p>
    <p>
      <b><font color="#cc00cc">&#23545;&#20110;usb3.0&#30340;port, &#25171;&#21360;&#30340;&#26085;&#24535;&#26159;&#65306; usb usb2-port1: status 0203 change 0001</font></b>
    </p>
    <p>
      
    </p>
    <p>
      &#23545;&#20110;status, &#23545;&#24212;&#30340;&#29366;&#24577;&#23450;&#20041;&#22914;&#19979;&#65306;
    </p>
    <p>
      #define USB_PORT_STAT_CONNECTION&#160;&#160;&#160;&#160;0x0001
    </p>
    <p>
      #define USB_PORT_STAT_ENABLE&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0002
    </p>
    <p>
      #define USB_PORT_STAT_SUSPEND&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0004
    </p>
    <p>
      #define USB_PORT_STAT_OVERCURRENT&#160;&#160;&#160;0x0008
    </p>
    <p>
      #define USB_PORT_STAT_RESET&#160;&#160;&#160;&#160;&#160;0x0010
    </p>
    <p>
      #define USB_PORT_STAT_L1&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0020
    </p>
    <p>
      /* bits 6 to 7 are reserved */
    </p>
    <p>
      #define USB_PORT_STAT_POWER&#160;&#160;&#160;&#160;&#160;0x0100
    </p>
    <p>
      #define USB_PORT_STAT_LOW_SPEED&#160;&#160;&#160;&#160;&#160;0x0200
    </p>
    <p>
      #define USB_PORT_STAT_HIGH_SPEED&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0400
    </p>
    <p>
      #define USB_PORT_STAT_TEST&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0800
    </p>
    <p>
      #define USB_PORT_STAT_INDICATOR&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x1000
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1600321460693" ID="ID_1761609124" MODIFIED="1600321615906">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman">/* </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;* Additions to wPortStatus bit field from USB 3.0 </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;* See USB 3.0 spec Table 10-10 </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;*/ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#define USB_PORT_STAT_LINK_STATE&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x01e0 </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#define USB_SS_PORT_STAT_POWER&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0200 </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#define USB_SS_PORT_STAT_SPEED&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x1c00 </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">#define USB_PORT_STAT_SPEED_5GBPS&#160;&#160;&#160;0x0000 </font>
    </p>
    <p>
      
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">/* </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">&#160;* Definitions for PORT_LINK_STATE values </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">&#160;* (bits 5-8) in wPortStatus </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">&#160;*/ </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_U0&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0000 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_U1&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0020 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_U2&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0040 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_U3&#160;&#160;&#160;&#160;&#160;&#160;&#160;0x0060 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_SS_DISABLED&#160;&#160;0x0080 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_RX_DETECT&#160;&#160;&#160;&#160;0x00a0 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_SS_INACTIVE&#160;&#160;0x00c0 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_POLLING&#160;&#160;&#160;&#160;&#160;&#160;0x00e0 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_RECOVERY&#160;&#160;&#160;&#160;&#160;0x0100 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_HOT_RESET&#160;&#160;&#160;&#160;0x0120 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_COMP_MOD&#160;&#160;&#160;&#160;&#160;0x0140 </font>
    </p>
    <p>
      <font size="4" face="Microsoft New Tai Lue">#define USB_SS_PORT_LS_LOOPBACK&#160;&#160;&#160;&#160;&#160;0x0160</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600312751622" ID="ID_1199652966" MODIFIED="1600313630025">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if ((portstatus &amp; USB_PORT_STAT_ENABLE) &amp;&amp; (
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;type != HUB_RESUME ||
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;!(portstatus &amp; USB_PORT_STAT_CONNECTION) ||
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;!udev ||
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;state == USB_STATE_NOTATTACHED))
    </p>
    <p>
      &#22914;&#26524;&#24403;&#21069;port&#30340;&#29366;&#24577;&#26159;&#20351;&#33021;&#30340;&#29366;&#24577;&#65292;&#24182;&#19988;&#20256;&#36882;&#36827;&#26469;&#30340;type&#19981;&#26159;RESUME&#25110;&#32773;&#36824;&#27809;&#26377;usb&#35774;&#22791;&#36830;&#25509;&#21040;&#24403;&#21069;&#30340;port&#65292;&#37027;&#20040;
    </p>
    <ol>
      <li>
        portstatus &amp;= ~USB_PORT_STAT_ENABLE; &#23558;&#20351;&#33021;&#29366;&#24577;&#28165;&#38646;
      </li>
      <li>
        &#22914;&#26524;&#24403;&#21069;&#30340;hub&#19981;&#26159;superspeed&#31867;&#22411;&#30340;hub&#65292;&#21017;&#25191;&#34892;usb_clear_port_feature(hdev, port1,USB_PORT_FEAT_ENABLE);
      </li>
      <li>
        &#20174;&#26085;&#24535;&#30475;&#65292;usb2.0&#27809;&#26377;&#36827;&#20837;&#26412;if&#21028;&#26029;&#25191;&#34892;&#20195;&#30721;&#24403;&#20013;&#65292;usb3.0&#20250;&#36827;&#20837;if&#21028;&#26029;&#20013;&#65292;&#20294;&#19981;&#20250;&#25191;&#34892;&#31532;&#20108;&#27493;
      </li>
    </ol>
  </body>
</html></richcontent>
</node>
<node CREATED="1600313647621" ID="ID_1550385998" MODIFIED="1600313720849">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (hub_is_superspeed(hdev) &amp;&amp;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;((portstatus &amp; USB_PORT_STAT_LINK_STATE) ==
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USB_SS_PORT_LS_POLLING))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;need_debounce_delay = true;
    </p>
    <p>
      &#22914;&#26524;&#26159;usb3.0&#30340;hub&#65292;&#21017;&#21028;&#26029;&#24403;&#21069;&#26159;&#21542;&#22312;polling/link training&#29366;&#24577;&#65292;&#22914;&#26524;&#26159;&#30340;&#35805;&#65292;
    </p>
    <p>
      &#21017;&#23558;debounce&#35774;&#32622;&#25104;true
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600314018561" ID="ID_1343073305" MODIFIED="1600314141516">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (portchange &amp; USB_PORT_STAT_C_CONNECTION) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;need_debounce_delay = true;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_clear_port_feature(hub-&gt;hdev, port1,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USB_PORT_FEAT_C_CONNECTION);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#21442;&#32771;usb2.0 spec Table 11-22 wPortChange&#21487;&#30693;&#65292;&#35813;bit&#32622;&#20301;&#34920;&#31034;port&#19978;&#38754;&#26377;&#29366;&#24577;&#21464;&#21270;&#65292;
    </p>
    <p>
      &#20174;&#26085;&#24535;&#26469;&#30475;usb2.0&#21644;usb3.0&#35813;bit&#37117;&#34987;&#32622;&#20301;&#20102;&#65292;&#25152;&#20197;&#21487;&#20197;&#35774;&#32622;debounce&#20026;true
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600314266211" ID="ID_1059611652" MODIFIED="1600314308615">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;if (portchange &amp; USB_PORT_STAT_C_ENABLE) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;need_debounce_delay = true;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_clear_port_feature(hub-&gt;hdev, port1,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USB_PORT_FEAT_C_ENABLE);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (portchange &amp; USB_PORT_STAT_C_RESET) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;need_debounce_delay = true;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_clear_port_feature(hub-&gt;hdev, port1,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USB_PORT_FEAT_C_RESET);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if ((portchange &amp; USB_PORT_STAT_C_BH_RESET) &amp;&amp;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hub_is_superspeed(hub-&gt;hdev)) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;need_debounce_delay = true;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_clear_port_feature(hub-&gt;hdev, port1,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USB_PORT_FEAT_C_BH_PORT_RESET);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;}
    </p>
    <p>
      &#20854;&#20182;&#30340;&#19968;&#20123;&#21028;&#26029;&#65292;&#36825;&#37324;&#21487;&#20197;&#30053;&#36807;&#19981;&#20570;&#20998;&#26512;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600321061655" ID="ID_127588619" MODIFIED="1600328369919">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#24403;&#21069;udev&#20026;&#31354;&#65292;&#25110;&#32773;&#21028;&#26029; udev-&gt;state == USB_STATE_NOTATTACHED &#35774;&#22791;&#27809;&#26377;&#36830;&#25509;&#21040;&#31471;&#21475;&#19978;&#65292;
    </p>
    <p>
      &#37027;&#20040;
    </p>
    <p>
      if (udev || (portstatus &amp; USB_PORT_STAT_CONNECTION) ||
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(portstatus &amp; USB_PORT_STAT_OVERCURRENT) ||
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(portchange &amp; USB_PORT_STAT_C_OVERCURRENT))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<b><i><font size="4" color="#ff0000">set_bit(port1, hub-&gt;change_bits);</font></i></b>
    </p>
    <p>
      
    </p>
    <p>
      &#22914;&#26524;&#19978;&#38754;&#30340;&#21028;&#26029;&#19981;&#25104;&#31435;&#65292;&#37027;&#20040;&#21028;&#26029; portstatus &amp; USB_PORT_STAT_ENABLE &#22914;&#26524;&#25104;&#31435;&#30340;&#35805;
    </p>
    <p>
      bool port_resumed = (portstatus &amp; USB_PORT_STAT_LINK_STATE) == USB_SS_PORT_LS_U0;
    </p>
    <p>
      &#36825;&#26159;&#33719;&#21462;usb3.0 port&#31471;&#21475;&#30340;&#29366;&#24577;&#26159;&#21542;&#26159;&#21018;&#36827;&#21435;&#21040;resume&#30340;&#29366;&#24577;&#20102;&#65292;&#28982;&#21518;&#20570;&#22914;&#19979;&#30340;&#25805;&#20316;
    </p>
    <p>
      &#160;&#160;if (portchange || (hub_is_superspeed(hub-&gt;hdev) &amp;&amp;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;port_resumed))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;set_bit(port1, hub-&gt;change_bits);&#160; &#21363;&#22914;&#26524;&#21457;&#29616;&#26377;portchange&#25110;&#32773;&#22312;usb3.0&#30340;&#24773;&#20917;&#19979;&#21457;&#29616;&#36827;&#20837;&#21040;resume
    </p>
    <p>
      &#160;&#160;&#29366;&#24577;&#65292;&#23601;&#35774;&#32622;change_bits
    </p>
    <p>
      
    </p>
    <p>
      &#22914;&#26524;&#19978;&#38754;&#30340;2&#20010;&#21028;&#26029;&#37117;&#19981;&#25104;&#31435;&#65292;&#37027;&#20040;&#22914;&#26524;udev-&gt;persist_enabled&#26159;&#25104;&#31435;&#30340;&#65292;&#23601;&#20570;&#19979;&#38754;&#30340;&#25805;&#20316;
    </p>
    <p>
      &#160;&#160;&#160;udev-&gt;reset_resume = 1;
    </p>
    <p>
      &#160;&#160;&#160;if (test_bit(port1, hub-&gt;power_bits))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;set_bit(port1, hub-&gt;change_bits); &#22914;&#26524;&#24403;&#21069;port&#36830;&#25509;&#30340;&#35774;&#22791;&#24050;&#32463;&#22788;&#20110;power on&#30340;&#29366;&#24577;&#65292;&#37027;&#20040;&#23558;change bit&#36827;&#34892;&#32622;&#20301;
    </p>
    <p>
      
    </p>
    <p>
      &#22914;&#26524;&#19978;&#38754;&#30340;3&#20010;&#21028;&#26029;&#37117;&#19981;&#25104;&#31435;&#65292;&#37027;&#20040;
    </p>
    <p>
      &#160;&#160;&#160;&#160;usb_set_device_state(udev, USB_STATE_NOTATTACHED);
    </p>
    <p>
      &#160;&#160;&#160;&#160;set_bit(port1, hub-&gt;change_bits);
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#3300cc" DESTINATION="ID_127588619" ENDARROW="Default" ENDINCLINATION="392;39;" ID="Arrow_ID_1644446309" SOURCE="ID_1335643394" STARTARROW="None" STARTINCLINATION="-33;34;"/>
</node>
</node>
<node CREATED="1600323071136" ID="ID_1607460697" MODIFIED="1600323109650">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;need_debounce_delay&#26159;true&#65292;&#37027;&#20040;&#20570;&#22914;&#19979;&#30340;&#25805;&#20316;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600323255667" ID="ID_671208482" MODIFIED="1600323271218">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      delay = HUB_DEBOUNCE_STABLE;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600323274988" ID="ID_977729406" MODIFIED="1600323381694">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#24403;&#21069;&#20256;&#20837;&#30340;type&#26159;HUB_INIT2&#65292;&#37027;&#20040;&#23601;&#21021;&#22987;&#21270;&#19968;&#20010;delay work
    </p>
    <p>
      INIT_DELAYED_WORK(&amp;hub-&gt;init_work, hub_init_func3);----&gt;&#23454;&#38469;&#19978;&#35843;&#29992;&#30340;&#26159;&#20989;&#25968;<b><font color="#ff0033">hub_activate(hub, HUB_INIT2)</font></b>
    </p>
    <p>
      queue_delayed_work(system_power_efficient_wq,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&amp;hub-&gt;init_work,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;msecs_to_jiffies(delay));
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1600323426173" ID="ID_337375046" MODIFIED="1600323464222">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0000ff">&#36825;&#37096;&#20998;&#20195;&#30721;&#26159;&#23545;&#20110;HUB_INIT3&#30340;&#22788;&#29702;&#65292; </font></b>
    </p>
    <p>
      <b><font color="#0000ff">&#25105;&#20204;&#20998;&#26512;&#19968;&#19979;&#30475;&#30475;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600323477773" ID="ID_742815768" MODIFIED="1600323482580" TEXT="hub-&gt;quiescing = 0;"/>
<node CREATED="1600323529803" ID="ID_124686020" MODIFIED="1600323558957">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      status = usb_submit_urb(hub-&gt;urb, GFP_NOIO);
    </p>
    <p>
      &#36825;&#37324;&#26159;&#28608;&#27963;&#20102;hub&#30340;urb &#65311;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600323681512" ID="ID_1232211851" MODIFIED="1600323990315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" face="Times New Roman">kick_hub_wq(hub) </font></b>
    </p>
    <p>
      <b><font size="4" face="Times New Roman">&#25195;&#25551;hub&#19978;&#38754;&#30340;&#25152;&#26377;&#30340;port</font></b>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ff0033" DESTINATION="ID_1232211851" ENDARROW="None" ENDINCLINATION="-766;90;" ID="Arrow_ID_416143009" SOURCE="ID_1413974688" STARTARROW="None" STARTINCLINATION="1167;0;"/>
<node CREATED="1600324049908" ID="ID_1065403420" MODIFIED="1600324063989">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_interface *intf;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600324253324" ID="ID_601602825" MODIFIED="1600324258674" TEXT="intf = to_usb_interface(hub-&gt;intfdev);"/>
<node CREATED="1600324305322" ID="ID_536503199" MODIFIED="1600324309672" TEXT="usb_autopm_get_interface_no_resume(intf);"/>
<node CREATED="1600324391236" ID="ID_181061609" MODIFIED="1600324447217">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      queue_work(hub_wq, &amp;hub-&gt;events)
    </p>
    <p>
      
    </p>
    <p>
      &#35843;&#29992;&#21040;&#20989;&#25968;
    </p>
    <p>
      static void hub_event(struct work_struct *work)
    </p>
  </body>
</html></richcontent>
<node CREATED="1600325875685" ID="ID_1331301005" MODIFIED="1600325916728">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21464;&#37327;&#22768;&#26126;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device *hdev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_interface *intf;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_hub *hub;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct device *hub_dev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;u16 hubstatus;
    </p>
    <p>
      &#160;&#160;&#160;&#160;u16 hubchange;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int i, ret;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600326599354" ID="ID_477899471" MODIFIED="1600326648935">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;hub = container_of(work, struct usb_hub, events);
    </p>
    <p>
      &#160;&#160;&#160;&#160;hdev = hub-&gt;hdev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;hub_dev = hub-&gt;intfdev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;intf = to_usb_interface(hub_dev);
    </p>
    <p>
      &#33719;&#21462;&#21464;&#37327;&#25351;&#38024;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600326684013" ID="ID_1934899673" MODIFIED="1600327246062">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev_dbg(hub_dev, &quot;state %d ports %d chg %04x evt %04x\n&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hdev-&gt;state, hdev-&gt;maxchild,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* NOTE: expects max 15 ports... */
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(u16) hub-&gt;change_bits[0],
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(u16) hub-&gt;event_bits[0]);
    </p>
    <p>
      &#25171;&#21360;&#26085;&#24535;&#65306; <b>hub 1-0:1.0: state 7 ports 1 chg 0002 evt 0000</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600327420286" ID="ID_1431454863" MODIFIED="1600327720413">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hdev-&gt;state == USB_STATE_NOTATTACHED &#22914;&#26524;&#24403;&#21069;hub&#23545;&#24212;&#30340;usb_device
    </p>
    <p>
      &#30340;&#29366;&#24577;&#26159;dettach&#30340;&#29366;&#24577;&#65292;&#37027;&#20040;&#36820;&#22238;&#38169;&#35823;
    </p>
    <p>
      hub-&gt;error = -ENODEV;
    </p>
    <p>
      hub_quiesce(hub, HUB_DISCONNECT);
    </p>
    <p>
      return &#36820;&#22238;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600327757688" ID="ID_892736387" MODIFIED="1600327833506">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = usb_autopm_get_interface(intf);
    </p>
    <p>
      &#30005;&#28304;&#30456;&#20851;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600327843856" ID="ID_1770853493" MODIFIED="1600327882288">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#21028;&#26029;hub-&gt;quiescing&#26159;&#38750;&#38646;&#30340;&#29366;&#24577;&#65292;
    </p>
    <p>
      &#37027;&#20040;&#35828;&#26126;&#24403;&#21069;&#30340;hub&#30340;&#38750;&#28608;&#27963;&#24577;&#65292;&#37027;&#20040;&#31435;&#21363;&#36820;&#22238;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600327919551" ID="ID_445202344" MODIFIED="1600328002308">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#21457;&#29616;&#24403;&#21069;hub&#20869;&#37096;&#26377;&#32047;&#31215;&#30340;&#38169;&#35823;if (hub-&gt;error)&#65292;
    </p>
    <p>
      &#37027;&#20040;&#38656;&#35201;&#23545;&#35774;&#22791;&#36827;&#34892;reset&#25805;&#20316;&#65292;&#24182;&#23558;error&#25968;&#37325;&#32622;&#20026;0
    </p>
    <p>
      ret = usb_reset_device(hdev);
    </p>
    <p>
      hub-&gt;nerrors = 0;
    </p>
    <p>
      hub-&gt;error = 0;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600328114135" ID="ID_392169422" MODIFIED="1600328149716">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 1; i &lt;= hdev-&gt;maxchild; i++)
    </p>
    <p>
      &#36827;&#20837;for&#24490;&#29615;&#65292;&#36880;&#20010;&#35299;&#20915;port&#30340;&#29366;&#24577;&#21464;&#36801;&#38382;&#39064;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600328158587" ID="ID_946146859" MODIFIED="1600328179740" TEXT="struct usb_port *port_dev = hub-&gt;ports[i - 1];"/>
<node CREATED="1600328208109" ID="ID_1335643394" MODIFIED="1600328375919">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (test_bit(i, hub-&gt;event_bits)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;|| test_bit(i, hub-&gt;change_bits)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;|| test_bit(i, hub-&gt;wakeup_bits))
    </p>
    <p>
      &#21028;&#26029;event_bits&#65292; change_bits&#65292; wakeup_bits
    </p>
    <p>
      &#26159;&#21542;&#26377;&#34987;&#32622;&#20301;&#65292;&#22914;&#26524;&#26377;&#65292;&#37027;&#20040;&#36827;&#34892;&#19979;&#19968;&#27493;&#30340;&#25805;&#20316;&#65292;
    </p>
    <p>
      &#21487;&#20197;&#30475;&#21040;change_bits&#26159;&#22312;HUB_INIT2&#38454;&#27573;&#34987;&#32622;&#20301;&#30340;&#65292;&#25152;&#20197;&#36825;&#37324;&#30340;if&#21028;&#26029;&#36820;&#22238;&#30340;&#26159;TRUE
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#3300cc" DESTINATION="ID_127588619" ENDARROW="Default" ENDINCLINATION="392;39;" ID="Arrow_ID_1644446309" STARTARROW="None" STARTINCLINATION="-33;34;"/>
<node CREATED="1600328482133" ID="ID_1386428614" MODIFIED="1600328622030">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      port_event(hub, i);
    </p>
    <p>
      &#20989;&#25968;&#21407;&#22411;&#65306;
    </p>
    <p>
      static void port_event(struct usb_hub *hub, int port1)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;__must_hold(&amp;port_dev-&gt;status_lock)
    </p>
  </body>
</html></richcontent>
<node CREATED="1600332241225" ID="ID_1318591766" MODIFIED="1600332403657">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hub_port_status(hub, port1, &amp;portstatus, &amp;portchange)&#160;&#160;&#36825;&#37324;&#33719;&#21462;&#21040;&#20102;&#31471;&#28857;&#30340;&#26368;&#26032;&#30340;&#29366;&#24577;
    </p>
    <p>
      
    </p>
    <p>
      &#21518;&#38754;&#30340;&#20195;&#30721;&#26159;&#22788;&#29702;&#31471;&#28857;&#30340;&#19968;&#31995;&#21015;&#29366;&#24577;&#30340;&#20195;&#30721;&#65292;&#24456;&#22810;
    </p>
    <p>
      
    </p>
    <p>
      &#26368;&#37325;&#35201;&#30340;&#20195;&#30721;&#35843;&#29992;&#26159;&#26368;&#21518;&#19968;&#21477;
    </p>
    <p>
      hub_port_connect_change(hub, port1, portstatus, portchange);
    </p>
    <p>
      &#20989;&#25968;&#21407;&#22411;&#22914;&#19979;&#65306;
    </p>
    <p>
      <b>static void hub_port_connect_change(</b>struct usb_hub *hub, int port1,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u16 portstatus, u16 portchange<b>)</b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;__must_hold(&amp;port_dev-&gt;status_lock)
    </p>
  </body>
</html></richcontent>
<node CREATED="1600332808250" ID="ID_1750918902" MODIFIED="1600332873819">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;struct usb_port *port_dev = hub-&gt;ports[port1 - 1];
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device *udev = port_dev-&gt;child;
    </p>
    <p>
      &#33719;&#21462;port&#35774;&#22791;&#20197;&#21450;port&#35774;&#22791;&#23545;&#24212;&#36830;&#25509;&#30340;usb&#35774;&#22791;&#65292;&#19981;&#36807;&#31532;&#19968;&#27425;&#35843;&#29992;&#35813;&#20989;&#25968;&#30340;&#26102;&#20505;&#65292;
    </p>
    <p>
      &#30456;&#20449;udev&#26159;&#31354;&#20540;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600332891262" ID="ID_329326200" MODIFIED="1600332985078">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      dev_dbg(&amp;port_dev-&gt;dev, &quot;status %04x, change %04x, %s\n&quot;, portstatus,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;portchange, portspeed(hub, portstatus));
    </p>
    <p>
      &#36755;&#20986;&#26085;&#24535;&#65292;&#23545;&#24212;&#30340;&#26085;&#24535;&#35760;&#24405;&#65306;
    </p>
    <p>
      <b><font color="#ff0033">usb usb1-port1: status 0101, change 0000, 12 Mb/s</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600333011711" ID="ID_1726603969" MODIFIED="1600333024792" TEXT="&#x4e00;&#x4e9b;&#x72b6;&#x6001;&#x76d1;&#x6d4b;&#x4ee3;&#x7801;&#xff0c;&#x5ffd;&#x7565;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;&#x3002;"/>
<node CREATED="1600333042165" ID="ID_42527397" MODIFIED="1600333117501">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hub_port_connect(hub, port1, portstatus, portchange)
    </p>
    <p>
      &#20989;&#25968;&#21407;&#22411;&#22914;&#19979;&#65306;
    </p>
    <p>
      static void hub_port_connect(struct usb_hub *hub, int port1, u16 portstatus,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u16 portchange)
    </p>
  </body>
</html></richcontent>
<node CREATED="1600333146699" ID="ID_1912658948" MODIFIED="1600333230818">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device *hdev = hub-&gt;hdev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_hcd *hcd = bus_to_hcd(hdev-&gt;bus);
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_port *port_dev = hub-&gt;ports[port1 - 1];
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device *udev = port_dev-&gt;child;&#160; <b>&#27492;&#26102;&#24212;&#35813;&#26159;&#31354;&#20540;</b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;static int unreliable_port = -1;
    </p>
    <p>
      &#160;&#160;&#160;&#160;enum usb_device_speed dev_speed = USB_SPEED_UNKNOWN;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600392457371" ID="ID_168631835" MODIFIED="1600392501778">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#24403;&#21069;port&#23545;&#24212;&#30340;usb_device&#24050;&#32463;&#19981;&#20026;&#31354;&#65292;&#37027;&#20040;&#20808;&#26029;&#24320;&#36319;&#35813;&#35774;&#22791;&#30340;&#36830;&#25509;
    </p>
    <p>
      if (udev) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (hcd-&gt;usb_phy &amp;&amp; !hdev-&gt;parent)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_phy_notify_disconnect(hcd-&gt;usb_phy, udev-&gt;speed);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_disconnect(&amp;port_dev-&gt;child);
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600392895920" ID="ID_1206899805" MODIFIED="1600392949682">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font face="Times New Roman" size="4" color="#0000ff">&#36319;&#29366;&#24577;&#21644;debounce&#30456;&#20851;&#30340;&#19968;&#20123;&#25805;&#20316;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;</font></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600392963974" ID="ID_394763712" MODIFIED="1600393003479">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#24403;&#21069;&#30340;hub&#26159;superspeed&#65292;&#37027;&#20040; unit_load&#35774;&#32622;&#25104;150&#65292;
    </p>
    <p>
      &#21542;&#21017;&#35774;&#32622;&#25104;100
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600393644167" ID="ID_168752794" MODIFIED="1600393660478">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; SET_CONFIG_TRIES; i++)
    </p>
  </body>
</html></richcontent>
<node CREATED="1600393690936" ID="ID_655535134" MODIFIED="1600425916707">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>udev = usb_alloc_dev(hdev, hdev-&gt;bus, port1);</b>
    </p>
    <p>
      &#21160;&#24577;&#20998;&#37197;&#19968;&#20010;usb_device&#65292; &#35813;udev&#30340;parent&#26174;&#28982;&#26159;usb hub
    </p>
    <p>
      
    </p>
    <p>
      <font color="#ff0000">&#20851;&#27880;&#19968;&#19979;&#38169;&#35823;&#21457;&#29983;&#30340;&#26465;&#20214; </font>
    </p>
    <p>
      <font color="#ff0000">couldn't allocate usb_device</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600418911635" FOLDED="true" ID="ID_72732383" MODIFIED="1600425882799">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="4" color="#ff0000">&#20989;&#25968;&#21407;&#22411; </font>
    </p>
    <p>
      <font face="Times New Roman" size="4" color="#ff0000">struct usb_device *usb_alloc_dev(struct usb_device *parent, </font>
    </p>
    <p>
      <font face="Times New Roman" size="4" color="#ff0000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_bus *bus, unsigned port1) </font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600419508065" ID="ID_764321867" MODIFIED="1600419519656">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      xhci_alloc_dev
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1600393756564" ID="ID_834205654" MODIFIED="1600393779736">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_set_device_state(udev, USB_STATE_POWERED);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;bus_mA = hub-&gt;mA_per_port;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;level = hdev-&gt;level + 1;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;wusb = hub_is_wusb(hub);
    </p>
    <p>
      &#37197;&#32622;usb device
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600393789017" ID="ID_1682454713" MODIFIED="1600393842925">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#24403;hub&#26159;usb3.0&#30340;hub&#30340;&#26102;&#20505;&#65292;&#35774;&#32622;
    </p>
    <p>
      udev-&gt;speed = USB_SPEED_SUPER;
    </p>
    <p>
      &#21542;&#21017;&#35774;&#32622;
    </p>
    <p>
      udev-&gt;speed = USB_SPEED_UNKNOWN;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600395246922" ID="ID_1138956751" MODIFIED="1600395307325">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      choose_devnum(udev);
    </p>
    <p>
      &#36825;&#37324;&#35774;&#32622;devnum: devnum = udev-&gt;portnum + 1;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600394225803" ID="ID_1673266331" MODIFIED="1600394252888">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20013;&#38388;&#30340;&#19968;&#20123;&#22788;&#29702;&#27969;&#31243;&#65292;&#30465;&#30053;&#19981;&#30475;&#12290;&#12290;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600394267040" ID="ID_186688806" MODIFIED="1600394533262">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#cc00cc">status = usb_new_device(udev);</font></b>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#cc00ff" DESTINATION="ID_186688806" ENDARROW="None" ENDINCLINATION="-2081;201;" ID="Arrow_ID_1294228912" SOURCE="ID_1387301750" STARTARROW="None" STARTINCLINATION="7679;0;"/>
</node>
<node CREATED="1600394797550" ID="ID_604144829" MODIFIED="1600394812870">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (hcd-&gt;usb_phy &amp;&amp; !hdev-&gt;parent)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_phy_notify_connect(hcd-&gt;usb_phy,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;udev-&gt;speed);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600394825760" ID="ID_412920529" MODIFIED="1600394840711">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      status = hub_power_remaining(hub);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1600305445426" ID="ID_234247538" MODIFIED="1600305487416">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#24403;&#20256;&#20837;&#30340;type&#19981;&#26159;HUB_RESUME&#30340;&#26102;&#20505;&#65292;
    </p>
    <p>
      &#20570;&#22914;&#19979;&#30340;&#22788;&#29702;&#24037;&#20316;&#65306;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600305836265" ID="ID_992566704" MODIFIED="1600305895545">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#24403;&#21028;&#26029;&#24403;&#21069;&#30340;hub&#19981;&#26159;root hub&#65292;&#24182;&#19988;&#24403;&#21069;&#30340;hub&#26159;super speed&#35774;&#22791;&#30340;&#26102;&#20505;&#65292;
    </p>
    <p>
      &#20570;&#19968;&#20123;&#22788;&#29702;&#24037;&#20316;&#65292;&#36825;&#37096;&#20998;&#20195;&#30721;&#30053;&#36807;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600305899442" ID="ID_732106635" MODIFIED="1600306610247">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#24403;&#21069;&#20256;&#36882;&#36827;&#26469;&#30340;type&#26159;HUB_INIT&#65292;
    </p>
    <p>
      &#37027;&#20040;&#25105;&#20204;&#20570;&#22914;&#19979;&#30340;&#22788;&#29702;&#24037;&#20316;&#65306;
    </p>
  </body>
</html></richcontent>
<node CREATED="1600306521154" ID="ID_833217112" MODIFIED="1600306557713">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      delay = hub_power_on_good_delay(hub);
    </p>
    <p>
      &#35745;&#31639;hub&#19978;&#30005;&#21040;&#27491;&#24120;&#29366;&#24577;&#19979;&#25152;&#38656;&#35201;&#30340;&#26102;&#24310;&#65292;&#26368;&#22823;&#20540;&#26159;100ms
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600306614099" ID="ID_1540764801" MODIFIED="1600306918127">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hub_power_on(hub, false)
    </p>
    <p>
      <b><font face="Times New Roman" size="4" color="#3300ff">&#20989;&#25968;&#21407;&#22411;&#65306; static void hub_power_on(struct usb_hub *hub, bool do_delay)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1600306978706" ID="ID_828937849" MODIFIED="1600307005224">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21464;&#37327;&#22768;&#26126;
    </p>
    <p>
      int port1;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600307008426" ID="ID_1687935645" MODIFIED="1600307102072">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21028;&#26029;&#24403;&#21069;&#30340;hub&#26159;&#21542;&#25317;&#26377;power switch, &#24182;&#20998;&#21035;&#25171;&#21360;&#22914;&#19979;&#30340;2&#20010;&#26085;&#24535;&#20043;&#19968;
    </p>
    <p>
      <b><font color="#ff0033">dev_dbg(hub-&gt;intfdev, &quot;enabling power on all ports\n&quot;); </font></b>
    </p>
    <p>
      <b><font color="#ff0033">dev_dbg(hub-&gt;intfdev, &quot;trying to enable port power on &quot;&quot;non-switchable hub\n&quot;);</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600308146841" ID="ID_1600008520" MODIFIED="1600310159699">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36827;&#20837;for&#24490;&#29615;&#65292;&#26816;&#27979;&#27599;&#20010;port&#26159;&#21542;&#24050;&#32463;&#19978;&#30005;&#65292;&#24182;&#26681;&#25454;&#19978;&#30005;&#24050;&#21542;&#65292;&#26469;&#35774;&#32622;port&#30340;feature bit&#29305;&#24615;
    </p>
    <p>
      <font size="4" face="Times New Roman">for (port1 = 1; port1 &lt;= hub-&gt;hdev-&gt;maxchild; port1++)</font>
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (test_bit(port1, hub-&gt;power_bits))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;set_port_feature(hub-&gt;hdev, port1, USB_PORT_FEAT_POWER);
    </p>
    <p>
      &#27880;&#24847;&#65306;&#24403;&#35774;&#32622;USB_PORT_FEAT_POWER&#30340;&#26102;&#20505;&#65292;&#26368;&#32456;&#20250;&#35843;&#29992;&#21040;xhci_hub_control&#20989;&#25968;&#65292;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#35813;&#20989;&#25968;&#22788;&#29702;USB_PORT_FEAT_POWER&#25351;&#20196;&#65292;&#20351;&#33021;port&#65292;&#24182;&#25171;&#21360;&#26085;&#24535;&#65306;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <b><font color="#3300ff">xhci_dbg(xhci, &quot;set port power, actual port %d status&#160;&#160;= 0x%x\n&quot;, wIndex, temp);</font></b>
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;usb_clear_port_feature(hub-&gt;hdev, port1,USB_PORT_FEAT_POWER);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600308549697" ID="ID_1977251388" MODIFIED="1600308603085">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (do_delay)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;msleep(hub_power_on_good_delay(hub));
    </p>
    <p>
      &#22914;&#26524;&#20256;&#20837;&#30340;do_delay&#26159;true&#65292;&#37027;&#20040;&#23601;&#35843;&#29992;&#20241;&#30496;&#20989;&#25968;&#36827;&#34892;&#20241;&#30496;&#25805;&#20316;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600308770334" ID="ID_677574427" MODIFIED="1600309452454">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21021;&#22987;&#21270;&#19968;&#20010;delay work&#23558;usb hub&#30340;&#21021;&#22987;&#21270;&#19978;&#30005;&#27969;&#31243;&#24310;&#21518;&#36827;&#34892;&#65292;
    </p>
    <p>
      &#36825;&#26159;&#20026;&#20102;&#21152;&#36895;&#31995;&#32479;&#30340;&#21551;&#21160;&#27969;&#31243;
    </p>
    <p>
      INIT_DELAYED_WORK(&amp;hub-&gt;init_work, hub_init_func2); ----&#12299; hub_init_func2&#23454;&#38469;&#19978;&#35843;&#29992;&#30340;&#26159;<b><i><font color="#ff0033">hub_activate(hub, HUB_INIT2);</font></i></b>
    </p>
    <p>
      queue_delayed_work(system_power_efficient_wq,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&amp;hub-&gt;init_work,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;msecs_to_jiffies(delay));
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ff0000" DESTINATION="ID_1958584060" ENDARROW="Default" ENDINCLINATION="682;0;" ID="Arrow_ID_357783304" STARTARROW="None" STARTINCLINATION="-101;-36;"/>
</node>
<node CREATED="1600309170385" ID="ID_1374069204" MODIFIED="1600309191399">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_autopm_get_interface_no_resume(
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;to_usb_interface(hub-&gt;intfdev)); &#31105;&#27490;&#33258;&#21160;&#25346;&#36215;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600309194299" ID="ID_818227581" MODIFIED="1600309223350">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      return &#20174;&#36825;&#37324;&#36820;&#22238;&#65292;&#21097;&#19979;&#30340;&#21021;&#22987;&#21270;&#24037;&#20316;&#30001;delay work&#26469;&#23436;&#25104;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1600395662710" ID="ID_1940580000" MODIFIED="1600395670869" TEXT="&#x4ee3;&#x7801;&#x5b8c;&#x7ed3;&#xff0c;&#x8fd4;&#x56de;"/>
</node>
<node CREATED="1600332080029" ID="ID_557863197" MODIFIED="1600332088569" TEXT="&#x4ee3;&#x7801;&#x5b8c;&#x7ed3;&#xff0c;&#x8fd4;&#x56de;"/>
</node>
</node>
<node CREATED="1600395534679" ID="ID_1036074308" MODIFIED="1600395554656" TEXT="create_intf_ep_devs(intf);"/>
<node CREATED="1600395558737" ID="ID_593881270" MODIFIED="1600395566329" TEXT="&#x4ee3;&#x7801;&#x5b8c;&#x7ed3;"/>
</node>
<node CREATED="1600395573873" ID="ID_819652516" MODIFIED="1600395602464">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_autosuspend_device(dev);
    </p>
    <p>
      &#20195;&#30721;&#23436;&#32467;&#65292;&#36820;&#22238;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600332003554" ID="ID_894703517" MODIFIED="1600332019570">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usb_notify_add_device(udev);
    </p>
    <p>
      
    </p>
    <p>
      &#20195;&#30721;&#23436;&#32467;&#65292;&#36820;&#22238;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1598838635799" ID="ID_6685330" MODIFIED="1598838696119">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" color="#009966">&#22914;&#26524;udev-&gt;parent&#19981;&#20026;&#31354;&#65292;&#37027;&#20040;&#36824;&#38656;&#35201;&#20570;&#22914;&#19979;&#30340;&#19968;&#20123;&#22788;&#29702;&#24037;&#20316;&#65292; </font>
    </p>
    <p>
      <font face="Times New Roman" color="#009966">&#36825;&#37324;&#20808;&#24573;&#30053;&#19981;&#30475;&#12290;&#12290;&#12290;&#12290;&#12290;&#12290;</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1598838727204" ID="ID_1110616975" MODIFIED="1599805241061">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      (void) usb_create_ep_devs(&amp;udev-&gt;dev, &amp;udev-&gt;ep0, udev);
    </p>
    <p>
      <i>&#20989;&#25968;&#21407;&#22411; </i>
    </p>
    <p>
      <i>int usb_create_ep_devs(struct device *parent, </i>
    </p>
    <p>
      <i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_host_endpoint *endpoint, </i>
    </p>
    <p>
      <i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usb_device *udev)</i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1599805305869" ID="ID_436501446" MODIFIED="1599805357961">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct ep_device *ep_dev;
    </p>
    <p>
      ep_dev = kzalloc(sizeof(*ep_dev), GFP_KERNEL);
    </p>
    <p>
      &#21160;&#24577;&#20998;&#37197;&#31471;&#28857;&#35774;&#22791;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599805452584" ID="ID_1704424840" MODIFIED="1599805515078">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#160;&#160;&#160;&#160;ep_dev-&gt;desc = &amp;endpoint-&gt;desc;
    </p>
    <p>
      &#160;&#160;&#160;&#160;ep_dev-&gt;udev = udev;
    </p>
    <p>
      &#160;&#160;&#160;&#160;ep_dev-&gt;dev.groups = ep_dev_groups;
    </p>
    <p>
      &#160;&#160;&#160;&#160;ep_dev-&gt;dev.type = &amp;usb_ep_device_type;
    </p>
    <p>
      &#160;&#160;&#160;&#160;ep_dev-&gt;dev.parent = parent;
    </p>
    <p>
      &#160;&#160;&#160;&#160;dev_set_name(&amp;ep_dev-&gt;dev, &quot;ep_%02x&quot;, endpoint-&gt;desc.bEndpointAddress);
    </p>
    <p>
      &#21021;&#22987;&#21270;end point device
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599805732253" ID="ID_593874349" MODIFIED="1599805777660">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff3333">retval = device_register(&amp;ep_dev-&gt;dev);</font></b>
    </p>
    <p>
      &#27880;&#20876;&#31471;&#28857;&#35774;&#22791;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1599805792093" ID="ID_1251869046" MODIFIED="1599805795202" TEXT="endpoint-&gt;ep_dev = ep_dev;"/>
</node>
<node CREATED="1600331942985" ID="ID_96331082" MODIFIED="1600331951245" TEXT="&#x4ee3;&#x7801;&#x5b8c;&#x7ed3;&#xff0c;&#x8fd4;&#x56de;"/>
</node>
<node CREATED="1600331780357" ID="ID_872481804" MODIFIED="1600331785768" TEXT="hcd-&gt;rh_registered = 1;"/>
<node CREATED="1600331801635" ID="ID_1692465217" MODIFIED="1600331805117" TEXT="usb_dev-&gt;dev.of_node = sysdev-&gt;of_node;"/>
<node CREATED="1600331808309" ID="ID_1090081678" MODIFIED="1600331826555">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23436;&#32467;&#36820;&#22238;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600331136877" ID="ID_278126909" MODIFIED="1600331155549">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>retval = sysfs_create_group(&amp;rhdev-&gt;dev.kobj, &amp;usb_bus_attr_group);</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600331219959" ID="ID_452894559" MODIFIED="1600331270013">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (hcd-&gt;uses_new_polling &amp;&amp; HCD_POLL_RH(hcd))
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <b>usb_hcd_poll_rh_status(hcd);&#160; &#160;&#26377;&#31354;&#20877;&#20998;&#26512;&#35813;&#20989;&#25968;</b>
    </p>
    <p>
      
    </p>
    <p>
      root hub&#30340;&#19968;&#31181;&#26032;&#30340;polling&#26426;&#21046;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1600331839140" ID="ID_32211982" MODIFIED="1600331848130" TEXT="&#x4ee3;&#x7801;&#x5b8c;&#x7ed3;&#xff0c;&#x8fd4;&#x56de;"/>
</node>
<node CREATED="1597827182148" ID="ID_1171844584" MODIFIED="1597827184509" TEXT="device_wakeup_enable(&amp;hcd-&gt;self.root_hub-&gt;dev);"/>
<node CREATED="1597827193726" ID="ID_177423701" MODIFIED="1597827195966" TEXT="usb_add_hcd(xhci-&gt;shared_hcd, irq, IRQF_SHARED)"/>
<node CREATED="1597827204971" ID="ID_199421990" MODIFIED="1597827207363" TEXT="device_wakeup_enable(&amp;xhci-&gt;shared_hcd-&gt;self.root_hub-&gt;dev)"/>
<node CREATED="1597827218497" ID="ID_740225486" MODIFIED="1597827220878" TEXT="device_create_file(&amp;pdev-&gt;dev, &amp;dev_attr_config_imod);"/>
</node>
</node>
<node CREATED="1598942603628" ID="ID_27501688" MODIFIED="1598942635970">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman">&#32593;&#32476;&#36164;&#26009; </font></b>
    </p>
    <p>
      
    </p>
    <p>
      <b><font face="Times New Roman">https://blog.csdn.net/z1026544682/article/details/101023041</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1597836292023" ID="ID_1950559460" MODIFIED="1597836325550">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36825;&#20010;&#20869;&#26680;patch&#35814;&#32454;&#35828;&#26126;&#20102;xHCI&#27880;&#20876;2&#20010;usb root hub&#30340;&#21407;&#22240;
    </p>
    <p>
      commit f6ff0ac878eb420011fa2448851dd48c3a7e7b31
    </p>
    <p>
      Author: Sarah Sharp &lt;sarah.a.sharp@linux.intel.com&gt;
    </p>
    <p>
      Date:&#160;&#160;&#160;Thu Dec 16 11:21:10 2010 -0800
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;xhci: Register second xHCI roothub.
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1597716618643" ID="ID_1291328375" MODIFIED="1597716913253">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#26576;&#39033;&#30446;uvc camera iso&#20256;&#36755;&#30340;&#26102;&#20505;&#20869;&#26680;&#39537;&#21160;&#25253;&#38169;
    </p>
    <p>
      WARN: HC couldn't access mem fast enough
    </p>
    <p>
      &#35813;&#38169;&#35823;&#26159;&#22312;&#20989;&#25968;
    </p>
    <p>
      static int handle_tx_event(struct xhci_hcd *xhci,struct xhci_transfer_event *event)
    </p>
  </body>
</html></richcontent>
<node CREATED="1597716991590" ID="ID_691173208" MODIFIED="1597717618069">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman">struct xhci_transfer_event { </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;/* 64-bit buffer address, or immediate data */ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;__le64&#160;&#160;buffer; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;__le32&#160;&#160;transfer_len; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;/* This field is interpreted differently based on the type of TRB */ </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#160;&#160;&#160;&#160;__le32&#160;&#160;flags; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">};</font>
    </p>
    <p>
      &#23545;transfer_len&#36827;&#34892;&#22914;&#19979;&#30340;&#22788;&#29702;&#65292;&#20250;&#24471;&#21040;&#20256;&#36755;&#30340;&#20195;&#30721;
    </p>
    <p>
      #define COMP_CODE_MASK&#160;&#160;&#160;&#160;&#160;&#160;(0xff &lt;&lt; 24)
    </p>
    <p>
      #define GET_COMP_CODE(p)&#160;&#160;&#160;&#160;(((p) &amp; COMP_CODE_MASK) &gt;&gt; 24)
    </p>
    <p>
      
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_SUCCESS&#160;&#160;&#160;&#160;1 </font>
    </p>
    <p style="text-align: left">
      <b><font face="Times New Roman">/* Data Buffer Error */ </font></b>
    </p>
    <p style="text-align: left">
      <b><font face="Times New Roman">#define COMP_DB_ERR 2&#160; </font><font color="#ff0033" face="Times New Roman">ISO&#27169;&#24335;&#25253;&#27492;&#38169;&#35823;</font></b>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Babble Detected Error */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_BABBLE 3 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* USB Transaction Error */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_TX_ERR 4 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* TRB Error - some TRB field is invalid */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_TRB_ERR&#160;&#160;&#160;&#160;5 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Stall Error - USB device is stalled */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_STALL&#160;&#160;6 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Resource Error - HC doesn't have memory for that device configuration */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_ENOMEM 7 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Bandwidth Error - not enough room in schedule for this dev config */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_BW_ERR 8 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* No Slots Available Error - HC ran out of device slots */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_ENOSLOTS&#160;&#160;&#160;9 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Invalid Stream Type Error */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_STREAM_ERR 10 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Slot Not Enabled Error - doorbell rung for disabled device slot */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_EBADSLT&#160;&#160;&#160;&#160;11 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Endpoint Not Enabled Error */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_EBADEP 12 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Short Packet */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_SHORT_TX&#160;&#160;&#160;13 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Ring Underrun - doorbell rung for an empty isoc OUT ep ring */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_UNDERRUN&#160;&#160;&#160;14 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Ring Overrun - isoc IN ep ring is empty when ep is scheduled to RX */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_OVERRUN&#160;&#160;&#160;&#160;15 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Virtual Function Event Ring Full Error */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_VF_FULL&#160;&#160;&#160;&#160;16 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Parameter Error - Context parameter is invalid */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_EINVAL 17 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Bandwidth Overrun Error - isoc ep exceeded its allocated bandwidth */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_BW_OVER&#160;&#160;&#160;&#160;18 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Context State Error - illegal context state transition requested */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_CTX_STATE&#160;&#160;19 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* No Ping Response Error - HC didn't get PING_RESPONSE in time to TX */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_PING_ERR&#160;&#160;&#160;20 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Event Ring is full */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_ER_FULL&#160;&#160;&#160;&#160;21 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Incompatible Device Error */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_DEV_ERR&#160;&#160;&#160;&#160;22 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Missed Service Error - HC couldn't service an isoc ep within interval */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_MISSED_INT 23 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Successfully stopped command ring */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_CMD_STOP&#160;&#160;&#160;24 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Successfully aborted current command and stopped command ring */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_CMD_ABORT&#160;&#160;25 </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">/* Stopped - transfer was terminated by a stop endpoint command */ </font>
    </p>
    <p style="text-align: left">
      <font face="Times New Roman">#define COMP_STOP&#160;&#160;&#160;26</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597736312021" ID="ID_1943010635" MODIFIED="1597736593357">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      eb380df Manu Gautam:mgautam@codeaurora.org 1 year, 2 months ago usb: dwc3-msm: Use dummy buffer as doorbell until GSI is ready
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597741062785" ID="ID_1423192723" MODIFIED="1597741071130">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      git log --pretty='%h %an:%ae %cr %s'
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1471340686216" FOLDED="true" ID="ID_1438474488" MODIFIED="1597645032218">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>usb&#x70ed;&#x63d2;&#x62d4; </i></b>
    </p>
    <p>
      <b><i>http://blog.csdn.net/qq_21593899/article/details/51726697</i></b>
    </p>
    <p>
      int usb_hub_init(void)&#x51fd;&#x6570;&#x5b8c;&#x6210;hub&#x7684;driver&#x5373;<b>struct usb_driver hub_drive</b>r&#x6ce8;&#x518c;&#xff0c;&#x5229;&#x7528;
    </p>
    <p>
      <b>kthread_run(hub_thread, NULL, "khubd")</b>&#x521b;&#x5efa;&#x5185;&#x6838;&#x7ebf;&#x7a0b;&#x76d1;&#x63a7;
    </p>
    <p>
      hub&#x7684;&#x72b6;&#x6001;
    </p>
    <p>
      &#x5728;hub_driver&#x7684;hub_probe&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x8c03;&#x7528;hub_configure&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x7ed9;usb_hub&#x5f53;&#x4e2d;&#x7684;urb&#x5206;&#x914d;&#x7a7a;&#x95f4;&#xff0c;&#x4f7f;&#x7528;usb_fill_int_urb&#x51fd;&#x6570;&#x6765;&#x521d;&#x59cb;&#x5316;urb&#xff0c;
    </p>
    <p>
      &#x5305;&#x62ec;&#x914d;&#x7f6e;urb&#x5f53;&#x4e2d;&#x7684;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x51fd;&#x6570;<b>hub_irq</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1471343628411" ID="ID_1120670438" MODIFIED="1471418643507">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5f53;&#x6709;&#x65b0;&#x7684;&#x8bbe;&#x5907;&#x63d2;&#x5165;&#x5230;hub&#x5f53;&#x4e2d;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f1a;&#x89e6;&#x53d1;&#x4e2d;&#x65ad;&#x51fd;&#x6570;
    </p>
    <p>
      <b>static void hub_irq(struct urb *urb) </b>
    </p>
    <p>
      &#x8be5;&#x4e2d;&#x65ad;&#x51fd;&#x6570;&#x5229;&#x7528;kick_khubd&#x51fd;&#x6570;&#x5c06;usb_hub&#x5f53;&#x4e2d;&#x7684;
    </p>
    <p>
      event_list&#x6302;&#x5230;khubd&#x5185;&#x6838;&#x7ebf;&#x7a0b;&#x7684;hub_event_list&#x5f53;&#x4e2d;,
    </p>
    <p>
      &#x7136;&#x540e;&#x5524;&#x9192;khubd&#x7ebf;&#x7a0b;,&#x8fdb;&#x5165;hub_events&#x51fd;&#x6570;&#x5904;&#x7406;events,
    </p>
    <p>
      &#x5728;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#xff0c;&#x5bf9;&#x6bcf;&#x4e2a;hub&#x7684;port&#x8c03;&#x7528;&#x51fd;&#x6570;port_event(hub, i)
    </p>
    <p>
      &#x8fdb;&#x884c;&#x5904;&#x7406;&#xff0c;&#x5982;&#x679c;port&#x7684;&#x8fde;&#x63a5;&#x72b6;&#x6001;&#x53d1;&#x751f;&#x53d8;&#x5316;&#x6216;&#x8005;&#x7531;&#x4e8e;EMI&#x5e72;&#x6270;&#x5bfc;&#x81f4;&#x8fde;&#x63a5;&#x4f7f;&#x80fd;&#x72b6;&#x6001;&#x53d1;&#x751f;&#x53d8;&#x5316;&#xff0c;
    </p>
    <p>
      &#x5219;&#x5728;port_event&#x51fd;&#x6570;&#x7684;&#x6700;&#x540e;&#x8c03;&#x7528;&#x51fd;&#x6570;
    </p>
    <p>
      <b><i>hub_port_connect_change(hub, port1, portstatus, portchange);</i></b>
    </p>
    <p>
      &#x5904;&#x7406;&#x5177;&#x4f53;&#x7684;port&#x7684;change
    </p>
    <p>
      &#x5982;&#x679c;&#x5728;hub_port_connect_change&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x786e;&#x8ba4;&#x8be5;&#x8bbe;&#x5907;&#x662f;&#x65b0;&#x63d2;&#x5165;&#x7684;&#x8bbe;&#x5907;&#xff0c;&#x5c31;&#x4f1a;
    </p>
    <p>
      &#x5728;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x8c03;&#x7528;<b><i>hub_port_connect(hub, port1, portstatus, portchange) </i></b>
    </p>
    <p>
      &#x51fd;&#x6570;&#xff0c;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x4f1a;&#x5206;&#x914d;usb_device,&#x8bfb;&#x53d6;&#x8be5;device&#x7684;&#x63cf;&#x8ff0;&#x7b26;&#xff0c;&#x6ce8;&#x518c;&#x8be5;device
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1471749180863" FOLDED="true" ID="ID_1298452644" MODIFIED="1597645024037">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#df0f0f">USB HID&#x8bbe;&#x5907;&#x9a71;&#x52a8;</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1471752843042" ID="ID_1666279250" MODIFIED="1471830038488">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#225637">int usbhid_probe(struct usb_interface *intf, const struct usb_device_id *id)&#x51fd;&#x6570; </font></b>
    </p>
    <p>
      <font color="#2f3238">1.hid = hid_allocate_device();&#x51fd;&#x6570;&#x751f;&#x6210;&#x4e86;hid_device,&#x5e76;&#x4e14; </font>
    </p>
    <p>
      &#x7ed9;&#x8be5;device&#x8d4b;&#x503c;bus_type&#x4e3a;hdev-&gt;dev.bus = &amp;hid_bus_type
    </p>
    <p>
      hid_bus_type&#x91cc;&#x9762;&#x7684;hid_bus_match&#x548c;hid_device_probe&#x51fd;&#x6570;&#x5c06;&#x4f1a;&#x5728;&#x540e;&#x9762;&#x88ab;&#x8c03;&#x7528;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1593568933358" FOLDED="true" ID="ID_1409541483" MODIFIED="1597645020905">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff3333" size="4">usb hid linux&#27979;&#35797;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1593569384667" FOLDED="true" ID="ID_489444161" MODIFIED="1594781532379" TEXT="1. &#x6d4b;&#x8bd5;&#x5de5;&#x5177;&#x603b;&#x7ed3;">
<node CREATED="1593569403984" ID="ID_1915419709" MODIFIED="1593569451336">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbhid-dump
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1593570213504" FOLDED="true" ID="ID_1395745334" MODIFIED="1594781531513" TEXT="1. &#x7f51;&#x7edc;&#x8d44;&#x6599;&#x94fe;&#x63a5;">
<node CREATED="1593570229652" ID="ID_1504158918" MODIFIED="1593570256192">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#ff3333">https://01.org/linuxgraphics/gfx-docs/drm/hid/hiddev.html</font></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1593583792486" ID="ID_863728706" MODIFIED="1593583803470">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      https://docs.zephyrproject.org/2.1.0/samples/subsys/usb/testusb/README.html
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1593583820966" ID="ID_1163791754" MODIFIED="1593583823169" TEXT="http://www.linux-usb.org/usbtest/"/>
<node CREATED="1593583844509" ID="ID_457683775" MODIFIED="1593583846629" TEXT="http://www.linux-usb.org/tools.html"/>
</node>
</node>
<node CREATED="1597645047982" ID="ID_1973188002" MODIFIED="1597645248074">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      4.4&#20869;&#26680;
    </p>
    <p>
      drivers/usb/core/urb.c &#25991;&#20214;
    </p>
    <p>
      int usb_submit_urb(struct urb *urb, gfp_t mem_flags) &#20989;&#25968;&#20998;&#26512;
    </p>
  </body>
</html></richcontent>
<node CREATED="1597646881836" ID="ID_1123864827" MODIFIED="1597651511862">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0000ff" face="Times New Roman">static int proc_do_submiturb(</font>struct usb_dev_state *ps, struct usbdevfs_urb *uurb,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;struct usbdevfs_iso_packet_desc __user *iso_frame_desc,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;void __user *arg<font color="#0000ff" face="Times New Roman">) </font>
    </p>
    <p>
      &#35813;&#20989;&#25968;&#35843;&#29992;&#20102;usb_submit_urb&#20989;&#25968;
    </p>
    <p>
      &#35813;&#20989;&#25968;&#39318;&#20808;&#20998;&#37197;&#20102;&#19968;&#20010;struct async&#32467;&#26500;&#20307;
    </p>
    <p>
      struct async {
    </p>
    <p>
      struct list_head asynclist;
    </p>
    <p>
      struct usb_dev_state *ps;
    </p>
    <p>
      struct pid *pid;
    </p>
    <p>
      const struct cred *cred;
    </p>
    <p>
      unsigned int signr;
    </p>
    <p>
      unsigned int ifnum;
    </p>
    <p>
      void __user *userbuffer;
    </p>
    <p>
      void __user *userurb;
    </p>
    <p>
      <font color="#006666">struct urb *urb;&#160;&#160;&#20998;&#37197;async&#30340;&#26102;&#20505;&#20998;&#37197;&#65292;&#20351;&#29992;GFP_KERNEL </font>
    </p>
    <p>
      <font color="#006666">&#26681;&#25454;&#19978;&#23618;&#37197;&#32622;&#30340;buffer_length&#32473;urb&#37324;&#38754;&#20998;&#37197;buffer, </font>
    </p>
    <p>
      <font color="#006666">urb-&gt;transfer_buffer = kmalloc(uurb-&gt;buffer_length,GFP_KERNEL) </font>
    </p>
    <p>
      <font color="#006666">&#35774;&#32622;flag </font>
    </p>
    <p>
      <font color="#006666">u = (is_in ? URB_DIR_IN : URB_DIR_OUT); </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;if (uurb-&gt;flags &amp; USBDEVFS_URB_ISO_ASAP) </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u |= URB_ISO_ASAP; </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;if (allow_short &amp;&amp; uurb-&gt;flags &amp; USBDEVFS_URB_SHORT_NOT_OK) </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u |= URB_SHORT_NOT_OK; </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;if (uurb-&gt;flags &amp; USBDEVFS_URB_NO_FSBR) </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u |= URB_NO_FSBR; </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;if (allow_zero &amp;&amp; uurb-&gt;flags &amp; USBDEVFS_URB_ZERO_PACKET) </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u |= URB_ZERO_PACKET; </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;if (uurb-&gt;flags &amp; USBDEVFS_URB_NO_INTERRUPT) </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u |= URB_NO_INTERRUPT; </font>
    </p>
    <p>
      <font color="#006666">&#160;&#160;&#160;&#160;as-&gt;urb-&gt;transfer_flags = u; </font>
    </p>
    <p>
      
    </p>
    <p>
      struct usb_memory *usbm;
    </p>
    <p>
      unsigned int mem_usage; &#23558;u&#36171;&#20540;&#32473;mem_usage
    </p>
    <p>
      int status;
    </p>
    <p>
      u32 secid;
    </p>
    <p>
      u8 bulk_addr;
    </p>
    <p>
      u8 bulk_status;
    </p>
    <p>
      }&#65307;
    </p>
    <p>
      <i><font color="#ff0000">u += sizeof(struct async) + sizeof(struct urb) + uurb-&gt;buffer_length + </font></i>
    </p>
    <p>
      <i><font color="#ff0000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;num_sgs * sizeof(struct scatterlist);</font></i>&#160;&#160;&#23545;&#20110;interrupt&#20256;&#36755;&#65292;num_sgs&#20026;0
    </p>
    <p>
      async&#23558;&#29992;&#25143;&#23618;&#30340;buffer&#20445;&#23384;&#36215;&#26469;
    </p>
    <p>
      as-&gt;userbuffer = uurb-&gt;buffer;
    </p>
    <p>
      as-&gt;signr = uurb-&gt;signr;
    </p>
    <p>
      as-&gt;ifnum = ifnum;
    </p>
    <p>
      as-&gt;pid = get_pid(task_pid(current));
    </p>
    <p>
      as-&gt;cred = get_current_cred();
    </p>
    <p>
      
    </p>
    <p>
      &#23545;&#20110;&#20013;&#26029;&#20256;&#36755; &#35843;&#29992;<b><font color="#3300cc">&#160; ret = usb_submit_urb(as-&gt;urb, GFP_KERNEL);</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597655106849" ID="ID_1445254186" MODIFIED="1597655414123">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#20110;usb3.0&#26469;&#35828;&#65292;usb_submit_urb&#26368;&#32456;&#20250;&#35843;&#29992;&#21040;xhci&#23618;&#30340;&#20989;&#25968;
    </p>
    <p>
      <b>int xhci_urb_enqueue(struct usb_hcd *hcd, struct urb *urb, gfp_t mem_flags)</b>
    </p>
    <p>
      &#35813;&#20989;&#25968;&#23545;&#20110;bulk&#20256;&#36755;&#35843;&#29992;
    </p>
    <p>
      <font color="#ff0000">xhci_queue_bulk_tx</font>
    </p>
    <p>
      &#23545;&#20110;interrupt&#20256;&#36755;&#35843;&#29992;
    </p>
    <p>
      <font color="#ff0000">xhci_queue_intr_tx</font>&#65292; &#20294;&#26159;xhci_queue_intr_tx&#20869;&#37096;&#26159;&#35843;&#29992;&#20102;xhci_queue_bulk_tx&#20989;&#25968;&#30340;&#65292;&#24182;&#19988;&#20989;&#25968;
    </p>
    <p>
      &#30340;&#24320;&#22987;&#26377;&#27880;&#37322;xHCI uses normal TRBs for both bulk and interrupt.
    </p>
    <p>
      &#20010;&#20154;&#35748;&#20026;&#22312;&#39033;&#30446;&#24403;&#20013;&#30340;IMU&#20256;&#36755;&#26159;&#20351;&#29992;&#30340;interrupt&#20256;&#36755;&#65292;uvc&#22914;&#26524;&#20351;&#29992;bulk&#30340;&#35805;&#65292;&#20250;
    </p>
    <p>
      &#20351;&#24471;IMU&#24433;&#21709;uvc&#30340;&#20256;&#36755;
    </p>
    <p>
      
    </p>
    <p>
      &#23545;&#20110;ISO&#20256;&#36755;&#26159;&#21333;&#29420;&#30340;ring&#26469;&#36827;&#34892;&#30340;
    </p>
    <p>
      <font color="#ff0000">xhci_queue_isoc_tx_prepare</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1586741548092" FOLDED="true" ID="ID_1849032320" MODIFIED="1600236560704">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#3333ff">android usb&#26694;&#26550;&#23398;&#20064;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1586763325701" ID="ID_1557004871" MODIFIED="1586763442420">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0000">Android&#20860;&#23481;&#24615;&#26694;&#26550;&#31243;&#24207;&#21253;&#21547;3&#20010;&#20851;&#38190;&#30340;&#37096;&#20998;&#65306;</font></b>
    </p>
    <ol>
      <li>
        &#20860;&#23481;&#24615;&#23450;&#20041;&#25991;&#26723;Compatibility Definition Document(CDD)
      </li>
      <li>
        Android Platform Source Code
      </li>
      <li>
        Compatibility Test Suite(CTS)
      </li>
    </ol>
  </body>
</html></richcontent>
</node>
<node CREATED="1587518583383" ID="ID_1606938324" MODIFIED="1597641462911" TEXT="Android4.4 usb&#x6846;&#x67b6;&#x56fe;">
<node CREATED="1587518657075" FOLDED="true" ID="ID_21090498" MODIFIED="1597301973287">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/android4.4-usb&#x6846;&#x67b6;&#x56fe;.PNG" />
  </body>
</html></richcontent>
<node CREATED="1587518850232" ID="ID_558135401" MODIFIED="1587518970636">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22823;&#22810;&#25968;&#30340;USB Function&#26159;&#22312;&#20869;&#26680;&#31354;&#38388;&#23454;&#29616;&#30340;&#65292;&#20294;&#26159;&#20363;&#22914;ADB&#21644;MTP&#36825;&#26679;&#30340;&#21151;&#33021;&#65292;
    </p>
    <p>
      &#21017;&#26159;&#23454;&#29616;&#25104;&#20026;&#29992;&#25143;&#31354;&#38388;&#30340;daemon&#31243;&#24207;&#23884;&#20837;&#21040;framework&#37324;&#38754;&#30340;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587519340933" ID="ID_313219232" MODIFIED="1587519482110">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20195;&#34920;USB API&#30340;&#26159; <font color="#3333ff" size="4" face="Times New Roman">android.hardware.usb</font>&#160;&#21253;
    </p>
    <p>
      
    </p>
    <p>
      &#22312;USB device&#27169;&#24335;&#19979;&#38754;&#65292;&#36825;&#20123;API&#37117;&#34987;&#35774;&#35745;&#25104;&#21482;&#20855;&#26377;&#26368;&#23567;&#21270;&#35282;&#33394;&#30340;&#24418;&#24335;&#65292;
    </p>
    <p>
      &#30446;&#21069;&#36824;&#27809;&#26377;&#31649;&#29702;&#25152;&#26377;&#30340;usb functionality&#30340;API
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587520118854" ID="ID_7596632" MODIFIED="1587520196420">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#20110;framework&#23618;&#20854;&#20182;&#23545;usb&#27169;&#22359;&#29366;&#24577;&#24863;&#20852;&#36259;&#30340;&#27169;&#22359;&#65292;&#23427;&#20204;&#20250;&#23558;&#33258;&#24049;hook&#21040;
    </p>
    <p>
      usb&#27169;&#22359;&#24403;&#20013;&#65292;&#24182;&#19988;&#30417;&#21548;use service&#20135;&#29983;&#30340;Intent
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587520535777" ID="ID_1506999841" MODIFIED="1587520755604">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      a. &#22312;host&#27169;&#24335;&#19979;&#38754;&#65292;&#22823;&#37096;&#20998;&#30340;&#21151;&#33021;&#20063;&#26159;&#23454;&#29616;&#22312;&#20869;&#26680;&#24403;&#20013;&#30340;&#65292;&#21482;&#26377;&#23569;&#37096;&#20998;&#30340;&#21151;&#33021;&#26159;&#22312;
    </p>
    <p>
      &#29992;&#25143;&#31354;&#38388;&#23454;&#29616;&#30340;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      b. device&#27169;&#24335;&#19979;&#38754;&#30340;device stack&#26159;gadget driver&#65292;&#36825;&#36319;&#20869;&#26680;&#20027;&#32447;&#26159;&#19981;&#19968;&#33268;&#30340;&#65292;
    </p>
    <p>
      &#22312;host&#27169;&#24335;&#19979;&#38754;&#20351;&#29992;&#30340;host stacke&#26159;&#36319;&#20869;&#26680;&#20027;&#32447;&#19968;&#33268;&#30340;&#12290;&#34429;&#28982;&#20869;&#26680;&#20195;&#30721;&#22312;host&#27169;&#24335;&#19979;&#38754;&#25903;&#25345;&#20960;&#20046;
    </p>
    <p>
      &#25152;&#26377;&#30340;usb&#35774;&#22791;&#65292;&#20294;&#26159;&#23433;&#21331;&#35774;&#22791;&#26159;&#21151;&#33021;&#34987;&#38480;&#21046;&#30340;&#23884;&#20837;&#24335;usb host&#25110;&#32773;usb otg host&#65292;&#22240;&#27492;&#25903;&#25345;&#30340;&#21151;&#33021;&#26159;&#26377;&#38480;&#30340;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1587521003133" ID="ID_856817180" MODIFIED="1597641466891">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/android4.4-usb-host&#x6a21;&#x5f0f;&#x6846;&#x67b6;.PNG" />
  </body>
</html></richcontent>
<node CREATED="1589900567769" ID="ID_621333953" MODIFIED="1589900583245" TEXT="http://www.programmersought.com/article/9227178606/"/>
<node CREATED="1590411957146" ID="ID_124695838" MODIFIED="1597976860126">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      frameworks/base/services/usb/java/com/android/server/usb/UsbService.java
    </p>
    <p>
      &#35813;&#25991;&#20214;&#26159;&#21551;&#21160;usb&#26381;&#21153;&#29992;&#30340;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590447339789" ID="ID_1152882171" MODIFIED="1597986019057">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#35813;&#25991;&#20214;&#23450;&#20041;&#20102;&#19968;&#20010;server&#31867;
    </p>
    <p>
      
    </p>
    <p>
      public class UsbService extends IUsbManager.Stub
    </p>
    <p>
      
    </p>
    <p>
      &#35813;&#31867;&#22312;&#20869;&#37096;&#23450;&#20041;&#20102;&#19968;&#20010;Lifecycle&#31867;&#65292;&#25105;&#20204;&#30475;&#19968;&#19979;&#35813;&#31867;&#30340;&#23450;&#20041;
    </p>
    <p>
      public static class Lifecycle extends SystemService
    </p>
    <p>
      
    </p>
    <p>
      &#35813;&#20869;&#37096;&#31867;&#30340;&#20960;&#20010;&#27604;&#36739;&#37325;&#35201;&#30340;&#20989;&#25968;&#22914;&#19979;
    </p>
    <p>
      
    </p>
    <p>
      public void onStart()
    </p>
    <p>
      public void onBootPhase(int phase)
    </p>
    <p>
      public void onSwitchUser(int newUserId)
    </p>
    <p>
      public void onStopUser(int userHandle)
    </p>
  </body>
</html></richcontent>
<node CREATED="1590448415914" FOLDED="true" ID="ID_1171186956" MODIFIED="1594781590256">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#30475;&#19968;&#19979;onStart&#20989;&#25968;&#65292;&#35813;&#20989;&#25968;&#29983;&#25104;&#20102;&#19968;&#20010;usb&#26381;&#21153;
    </p>
    <p>
      
    </p>
    <p>
      mUsbService = new UsbService(getContext());
    </p>
  </body>
</html></richcontent>
<node CREATED="1590448649664" ID="ID_207073050" MODIFIED="1590448659536">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mUserManager = context.getSystemService(UserManager.class);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590448677919" ID="ID_1807184311" MODIFIED="1590448691341">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mSettingsManager = new UsbSettingsManager(context)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590448707567" ID="ID_1926577073" MODIFIED="1590448716372">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mAlsaManager = new UsbAlsaManager(context)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590448861429" FOLDED="true" ID="ID_1422724161" MODIFIED="1594781589111">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mHostManager = new UsbHostManager(context, mAlsaManager, mSettingsManager)
    </p>
  </body>
</html></richcontent>
<node CREATED="1590464460687" ID="ID_60336978" MODIFIED="1590464462937" TEXT="mContext = context;"/>
<node CREATED="1590464473111" ID="ID_1345279296" MODIFIED="1590464481319">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mHostBlacklist = context.getResources().getStringArray(
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;com.android.internal.R.array.config_usbHostBlacklist);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590464572021" ID="ID_1052375053" MODIFIED="1590464574836" TEXT="mUsbAlsaManager = alsaManager"/>
<node CREATED="1590464583548" ID="ID_1550503334" MODIFIED="1590464586290" TEXT="mSettingsManager = settingsManager"/>
<node CREATED="1590464634301" ID="ID_619365717" MODIFIED="1590464646936">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      setUsbDeviceConnectionHandler(ComponentName.unflattenFromString(
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; deviceConnectionHandler));
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1590448885882" ID="ID_890522101" MODIFIED="1590448914944">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;/sys/class/android_usb&#25991;&#20214;&#23384;&#22312;
    </p>
    <p>
      
    </p>
    <p>
      mDeviceManager = new UsbDeviceManager(context, mAlsaManager, mSettingsManager)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590448941287" FOLDED="true" ID="ID_1673520586" MODIFIED="1594781587991">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mPortManager = new UsbPortManager(context)
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#0000ff" DESTINATION="ID_1880951371" ENDARROW="None" ENDINCLINATION="-268;-180;" ID="Arrow_ID_1748010757" STARTARROW="None" STARTINCLINATION="-236;-130;"/>
<node CREATED="1590463346810" ID="ID_1092502163" MODIFIED="1590463349612" TEXT="mContext = context;"/>
<node CREATED="1590463360673" ID="ID_521614212" MODIFIED="1590463363944" TEXT="ServiceNotification serviceNotification = new ServiceNotification()"/>
<node CREATED="1590463377206" ID="ID_1381606195" MODIFIED="1590463585710">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      boolean ret = IServiceManager.getService().
    </p>
    <p>
      .registerForNotifications(&quot;<b><font color="#ff0033" face="&#x96b6;&#x4e66;" size="4"><i>android.hardware.usb@1.0::IUsb</i></font></b>&quot;,&quot;&quot;, serviceNotification);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590463539710" FOLDED="true" ID="ID_74352772" MODIFIED="1594781586623" TEXT="connectToProxy(null);">
<node CREATED="1590463811192" ID="ID_1219351592" MODIFIED="1590463813596" TEXT="mProxy = IUsb.getService();"/>
<node CREATED="1590463823764" ID="ID_1627086164" MODIFIED="1590463825644" TEXT="mProxy.linkToDeath(new DeathRecipient(pw), USB_HAL_DEATH_COOKIE)"/>
<node CREATED="1590463840114" ID="ID_1344979701" MODIFIED="1590463842006" TEXT="mProxy.setCallback(mHALCallback)"/>
<node CREATED="1590463926705" ID="ID_300917465" MODIFIED="1590463928985" TEXT="mProxy.queryPortStatus()"/>
</node>
</node>
<node CREATED="1590448966454" ID="ID_141327628" MODIFIED="1590448974858">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      onSwitchUser(UserHandle.USER_SYSTEM)
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1590449226905" FOLDED="true" ID="ID_1660837365" MODIFIED="1594781591544">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#30475;&#19968;&#19979;onBootPhase&#20989;&#25968;
    </p>
    <p>
      
    </p>
    <p>
      UsbService.systemReady() &#35843;&#29992;&#20102;ready&#20989;&#25968;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590449512076" ID="ID_1573839285" MODIFIED="1590449522224">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mAlsaManager.systemReady()
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590449535509" FOLDED="true" ID="ID_1460522169" MODIFIED="1594781578782">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mDeviceManager.systemReady()
    </p>
  </body>
</html></richcontent>
<node CREATED="1590462596687" ID="ID_46821916" MODIFIED="1590462728313">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mNotificationManager = (NotificationManager)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mContext.getSystemService(Context.NOTIFICATION_SERVICE)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590462805275" ID="ID_1310204353" MODIFIED="1590462814896">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      final StorageManager storageManager = StorageManager.from(mContext)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590462826510" ID="ID_695596045" MODIFIED="1590462829520" TEXT="final StorageVolume primary = storageManager.getPrimaryVolume();"/>
<node CREATED="1590462840262" ID="ID_1156498373" MODIFIED="1590462848283">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      massStorageSupported = primary != null &amp;&amp; primary.allowMassStorage();
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590462912393" ID="ID_343390749" MODIFIED="1590462926137">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mUseUsbNotification = !massStorageSupported &amp;&amp; mContext.getResources().getBoolean(
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;com.android.internal.R.bool.config_usbChargingMessage);
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1590449557670" FOLDED="true" ID="ID_1258193865" MODIFIED="1594781576680">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mHostManager.systemReady()
    </p>
  </body>
</html></richcontent>
<node CREATED="1590462979018" FOLDED="true" ID="ID_98161081" MODIFIED="1594781575140">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20027;&#35201;&#30340;&#24037;&#20316;&#23601;&#26159;&#21019;&#24314;&#19968;&#20010;&#32447;&#31243;&#35843;&#29992;native&#20195;&#30721;&#65292;&#24182;&#31561;&#24453;
    </p>
    <p>
      host&#20107;&#20214;&#65292;
    </p>
    <p>
      &#22312;usb device add&#21644;usb device remove&#20107;&#20214;&#21457;&#29983;&#30340;&#26102;&#20505;&#65292;&#35813;&#32447;&#31243;&#20250;&#36827;&#34892;&#22238;&#35843;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590463055675" FOLDED="true" ID="ID_1260668502" MODIFIED="1594781574066">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Runnable runnable = this::monitorUsbHostBus;
    </p>
    <p>
      &#36825;&#26159;JNI&#30340;&#35843;&#29992;
    </p>
    <p>
      static void android_server_UsbHostManager_monitorUsbHostBus(JNIEnv* /* env */, jobject thiz)
    </p>
  </body>
</html></richcontent>
<node CREATED="1592376893000" ID="ID_384096451" MODIFIED="1592376901092">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_host_context* context = usb_host_init()
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1590463074294" ID="ID_59999841" MODIFIED="1590463077150" TEXT="new Thread(null, runnable, &quot;UsbService host thread&quot;).start();"/>
</node>
</node>
<node CREATED="1590449580783" FOLDED="true" ID="ID_541413861" MODIFIED="1594781577666">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mPortManager.systemReady()
    </p>
  </body>
</html></richcontent>
<node CREATED="1590463940802" ID="ID_1781263440" MODIFIED="1590463942993" TEXT="mProxy.queryPortStatus();"/>
</node>
</node>
</node>
<node CREATED="1590927567767" ID="ID_1574925776" MODIFIED="1597986022756">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      public ParcelFileDescriptor openDevice(String deviceName)
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#e80f0f" DESTINATION="ID_1574925776" ENDARROW="Default" ENDINCLINATION="157;-230;" ID="Arrow_ID_1056625645" SOURCE="ID_1027131434" STARTARROW="None" STARTINCLINATION="242;-20;"/>
<node CREATED="1590928089823" ID="ID_1155631639" MODIFIED="1590928098469">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ParcelFileDescriptor fd = null;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590928846731" ID="ID_398993194" MODIFIED="1590928850645" TEXT="int userIdInt = UserHandle.getCallingUserId();"/>
<node CREATED="1590928864952" ID="ID_1056661616" MODIFIED="1590928875474">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      boolean isCurrentUser = isCallerInCurrentUserProfileGroupLocked()
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590928893985" ID="ID_1797272238" MODIFIED="1591222316691">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      fd = mHostManager.openDevice(deviceName, getSettingsForUser(userIdInt))
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#232be6" DESTINATION="ID_1213928534" ENDARROW="Default" ENDINCLINATION="-51;132;" ID="Arrow_ID_136270759" STARTARROW="None" STARTINCLINATION="-86;35;"/>
</node>
</node>
</node>
<node CREATED="1592374948705" FOLDED="true" ID="ID_1143456721" MODIFIED="1593310293315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x6977;&#x4f53;">usb&#35774;&#22791;&#30340;&#26816;&#27979;</font>
    </p>
    <p>
      
    </p>
    <p>
      <font size="4" face="Times New Roman">frameworks/base/services/usb/java/com/android/server/usb/UsbPortManager.java</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1592375112160" FOLDED="true" ID="ID_1880951371" MODIFIED="1593310292375">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      public UsbPortManager(Context context)
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#0000ff" DESTINATION="ID_1880951371" ENDARROW="None" ENDINCLINATION="-268;-180;" ID="Arrow_ID_1748010757" SOURCE="ID_1673520586" STARTARROW="None" STARTINCLINATION="-236;-130;"/>
<node CREATED="1592375143514" ID="ID_67631559" MODIFIED="1592375153094">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mContext = context
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1592375171617" ID="ID_1067322377" MODIFIED="1592375184253">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ServiceNotification serviceNotification = new ServiceNotification()
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1592375246655" ID="ID_1517504943" MODIFIED="1592375291533">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      boolean ret = IServiceManager.getService()
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; .registerForNotifications(&quot;android.hardware.usb@1.0::IUsb&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;&quot;, serviceNotification)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1592375318567" FOLDED="true" ID="ID_1078712262" MODIFIED="1593310291414" TEXT="connectToProxy(null)">
<node CREATED="1592375407187" ID="ID_383663963" MODIFIED="1592375431881">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mProxy = IUsb.getService()
    </p>
    <p>
      &#33719;&#21462;HIDL&#26381;&#21153;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1592375444031" ID="ID_386970786" MODIFIED="1592375453148">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mProxy.linkToDeath(new DeathRecipient(pw), USB_HAL_DEATH_COOKIE)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1592375465674" ID="ID_698988801" MODIFIED="1592375616056">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mProxy.setCallback(mHALCallback)
    </p>
    <p>
      &#35774;&#32622;&#22238;&#35843;&#20989;&#25968;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1590929204692" FOLDED="true" ID="ID_438006144" MODIFIED="1593310290294">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman"><i>frameworks/base/services/usb/java/com/android/server/usb/UsbHostManager.java </i></font>
    </p>
    <p>
      <font size="4" face="Times New Roman"><i>&#20998;&#26512;</i></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1591222135014" FOLDED="true" ID="ID_1213928534" MODIFIED="1593310289114">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="4"><i>public ParcelFileDescriptor openDevice(String deviceName, UsbUserSettingsManager settings) </i></font>
    </p>
    <p>
      <font face="Times New Roman" size="4"><i>&#20989;&#25968;&#20998;&#26512;</i></font>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#232be6" DESTINATION="ID_1213928534" ENDARROW="Default" ENDINCLINATION="-51;132;" ID="Arrow_ID_136270759" SOURCE="ID_1797272238" STARTARROW="None" STARTINCLINATION="-86;35;"/>
<node CREATED="1591222199285" ID="ID_1487950822" MODIFIED="1591222203249" TEXT="UsbDevice device = mDevices.get(deviceName)"/>
<node CREATED="1591222218410" ID="ID_161983031" MODIFIED="1591222221316" TEXT="settings.checkPermission(device);"/>
<node CREATED="1591222234571" ID="ID_1175788925" MODIFIED="1591744139885">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      return nativeOpenDevice(deviceName)
    </p>
    <p>
      
    </p>
    <p>
      &#36825;&#37324;&#26159;JNI&#35843;&#29992;&#20102;&#65292;&#38656;&#35201;&#30475;JNI&#20195;&#30721;
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#f30404" DESTINATION="ID_385258752" ENDARROW="Default" ENDINCLINATION="178;0;" ID="Arrow_ID_899289542" STARTARROW="None" STARTINCLINATION="178;0;"/>
</node>
</node>
</node>
<node CREATED="1591222486533" FOLDED="true" ID="ID_872559397" MODIFIED="1593310287623">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>frameworks/base/services/core/jni/com_android_server_UsbHostManager.cpp</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1591222523735" FOLDED="true" ID="ID_385258752" MODIFIED="1593310284679">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#30475;&#19968;&#19979;&#36825;&#37324;&#38754;&#30340;JNI&#26041;&#27861;&#30340;&#35843;&#29992;
    </p>
    <p>
      
    </p>
    <p>
      static const JNINativeMethod method_table[] = {
    </p>
    <p>
      &#160;&#160;&#160;&#160;{ &quot;monitorUsbHostBus&quot;, &quot;()V&quot;, (void*)android_server_UsbHostManager_monitorUsbHostBus },
    </p>
    <p>
      &#160;&#160;&#160;&#160;{ &quot;<b>nativeOpenDevice</b>&quot;,&#160; &quot;(Ljava/lang/String;)Landroid/os/ParcelFileDescriptor;&quot;,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(void*)<b>android_server_UsbHostManager_openDevice</b>&#160; },
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#f30404" DESTINATION="ID_385258752" ENDARROW="Default" ENDINCLINATION="178;0;" ID="Arrow_ID_899289542" SOURCE="ID_1175788925" STARTARROW="None" STARTINCLINATION="178;0;"/>
<node CREATED="1591223215224" FOLDED="true" ID="ID_330863373" MODIFIED="1593310280804">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      static jobject android_server_UsbHostManager_openDevice(JNIEnv *env, jobject /* thiz */,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;jstring deviceName)
    </p>
  </body>
</html></richcontent>
<node CREATED="1591224654196" ID="ID_1598282678" MODIFIED="1591224679180">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#33719;&#21462;&#35774;&#22791;&#21517;&#31216;&#23383;&#31526;&#20018;
    </p>
    <p>
      const char *deviceNameStr = env-&gt;GetStringUTFChars(deviceName, NULL)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591224752047" ID="ID_1884075564" MODIFIED="1591744170500">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_device* device = usb_device_open(deviceNameStr);
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#451df2" DESTINATION="ID_773602220" ENDARROW="Default" ENDINCLINATION="541;192;" ID="Arrow_ID_1840744410" STARTARROW="None" STARTINCLINATION="-640;-585;"/>
</node>
<node CREATED="1591225080342" ID="ID_394634235" MODIFIED="1591225084073" TEXT="int fd = usb_device_get_fd(device);"/>
<node CREATED="1591225096461" ID="ID_1054183459" MODIFIED="1591225099005" TEXT="int newFD = dup(fd);"/>
<node CREATED="1591225133502" ID="ID_808409407" MODIFIED="1591225143759">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      jobject fileDescriptor = jniCreateFileDescriptor(env, newFD);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591225157137" ID="ID_429207726" MODIFIED="1591225166166">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      return env-&gt;NewObject(gParcelFileDescriptorOffsets.mClass,
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;gParcelFileDescriptorOffsets.mConstructor, fileDescriptor);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1591853106799" FOLDED="true" ID="ID_1194776941" MODIFIED="1594781568791">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="4">frameworks/base/core/jni/android_hardware_UsbDeviceConnection.cpp</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1591853191689" ID="ID_1415918844" MODIFIED="1592185085078">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#ff0000">static jboolean </font></i>
    </p>
    <p>
      <i><font color="#ff0000">android_hardware_UsbDeviceConnection_open(JNIEnv *env, jobject thiz, jstring deviceName, </font></i>
    </p>
    <p>
      <i><font color="#ff0000">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;jobject fileDescriptor)</font></i>
    </p>
    <p>
      <b><font color="#cc00cc">{</font></b>
    </p>
    <p>
      &#160;&#160;&#160;&#160;int fd = jniGetFDFromFileDescriptor(env, fileDescriptor);
    </p>
    <p>
      &#160;&#160;&#160;&#160;// duplicate the file descriptor, since ParcelFileDescriptor will eventually close its copy
    </p>
    <p>
      &#160;&#160;&#160;&#160;fd = dup(fd);
    </p>
    <p>
      &#160;&#160;&#160;&#160;if (fd &lt; 0)
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return JNI_FALSE;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;const char *deviceNameStr = env-&gt;GetStringUTFChars(deviceName, NULL);
    </p>
    <p>
      &#160;&#160;&#160;&#160;struct usb_device* device = usb_device_new(deviceNameStr, fd); //New <font color="#0000cc">&#25171;&#24320;usb&#35774;&#22791;&#65292;&#33719;&#21462;&#35774;&#22791;&#25551;&#36848;&#31526;</font>
    </p>
    <p>
      &#160;&#160;&#160;&#160;if (device) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;env-&gt;SetLongField(thiz, field_context, (jlong)device); <font color="#0000cc">//SetLongField&#20445;&#23384;usb_device&#35774;&#22791;</font>
    </p>
    <p>
      &#160;&#160;&#160;&#160;} else {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ALOGE(&quot;usb_device_open failed for %s&quot;, deviceNameStr);
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;close(fd);
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;env-&gt;ReleaseStringUTFChars(deviceName, deviceNameStr);
    </p>
    <p>
      &#160;&#160;&#160;&#160;return (device != NULL) ? JNI_TRUE : JNI_FALSE;
    </p>
    <p>
      <b><font color="#cc00cc">}</font></b>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#cc00cc" DESTINATION="ID_1415918844" ENDARROW="Default" ENDINCLINATION="745;0;" ID="Arrow_ID_1923540076" SOURCE="ID_385998011" STARTARROW="None" STARTINCLINATION="-664;0;"/>
</node>
</node>
<node CREATED="1591224819607" ID="ID_438303258" MODIFIED="1597643712732">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="&#x96b6;&#x4e66;"><b>system/core/libusbhost/usbhost.c &#25991;&#20214;&#20998;&#26512;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1591519501606" FOLDED="true" ID="ID_773602220" MODIFIED="1594781562756" TEXT="struct usb_device *usb_device_open(const char *dev_name)">
<linktarget COLOR="#451df2" DESTINATION="ID_773602220" ENDARROW="Default" ENDINCLINATION="541;192;" ID="Arrow_ID_1840744410" SOURCE="ID_1884075564" STARTARROW="None" STARTINCLINATION="-640;-585;"/>
<node CREATED="1591519675668" ID="ID_1758388424" MODIFIED="1591519686438">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      fd = open(dev_name, O_RDWR)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591519701696" FOLDED="true" ID="ID_434684274" MODIFIED="1594781561564">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_device* result = usb_device_new(dev_name, fd)
    </p>
    <p>
      
    </p>
    <p>
      struct usb_device {
    </p>
    <p>
      &#160;&#160;&#160;&#160;char dev_name[64];
    </p>
    <p>
      &#160;&#160;&#160;&#160;unsigned char desc[4096];
    </p>
    <p>
      &#160;&#160;&#160;&#160;int desc_length;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int fd;
    </p>
    <p>
      &#160;&#160;&#160;&#160;int writeable;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<node CREATED="1591658930650" FOLDED="true" ID="ID_1006364404" MODIFIED="1594781560537">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_device *usb_device_new(const char *dev_name, int fd)
    </p>
  </body>
</html></richcontent>
<node CREATED="1591659021216" ID="ID_434262675" MODIFIED="1591659038025">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_device *device = calloc(1, sizeof(struct usb_device))
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591659090754" ID="ID_1234333459" MODIFIED="1591659122903">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      length = read(fd, device-&gt;desc, sizeof(device-&gt;desc))
    </p>
    <p>
      
    </p>
    <p>
      &#35835;&#21462;&#35774;&#22791;&#25551;&#36848;&#31526;&#65311;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591659234460" ID="ID_1197365385" MODIFIED="1591659271442">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      strncpy(device-&gt;dev_name, dev_name, sizeof(device-&gt;dev_name) - 1);&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      device-&gt;fd = fd;
    </p>
    <p>
      device-&gt;desc_length = length;
    </p>
    <p>
      // assume we are writeable, since usb_device_get_fd will only return writeable fds&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;
    </p>
    <p>
      device-&gt;writeable = 1;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1591658040096" ID="ID_773084979" MODIFIED="1591658053876">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      result-&gt;writeable = writeable
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591658063152" ID="ID_191002664" MODIFIED="1591658075325">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      return result
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1592377005244" ID="ID_1915654690" MODIFIED="1592377015594">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct usb_host_context *usb_host_init()
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597643742440" ID="ID_1170556044" MODIFIED="1597643771029">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0000ff">int usb_request_queue(struct usb_request *req)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1597644154419" ID="ID_694225515" MODIFIED="1597644177944">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman">struct usbdevfs_urb *urb = (struct usbdevfs_urb*)req-&gt;private_data; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;int res; </font>
    </p>
    <p>
      
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;urb-&gt;status = -1; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;urb-&gt;buffer = req-&gt;buffer; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;// need to limit request size to avoid EINVAL </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;if (req-&gt;buffer_length &gt; MAX_USBFS_BUFFER_SIZE) </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;urb-&gt;buffer_length = MAX_USBFS_BUFFER_SIZE; </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;else </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;urb-&gt;buffer_length = req-&gt;buffer_length; </font>
    </p>
    <p>
      
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;do { </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;res = ioctl(req-&gt;dev-&gt;fd, USBDEVFS_SUBMITURB, urb); </font>
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;} while((res &lt; 0) &amp;&amp; (errno == EINTR)); </font>
    </p>
    <p>
      
    </p>
    <p>
      <font face="Times New Roman">&#160;&#160;&#160;&#160;return res;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1590470503943" ID="ID_251366722" MODIFIED="1597986009675">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#cc0033" face="Times New Roman" size="4">frameworks/base/core/java/android/hardware/usb</font></b>
    </p>
    <p>
      
    </p>
    <p>
      &#35813;&#30446;&#24405;&#19979;&#38754;&#30340;&#25991;&#20214;&#24212;&#35813;&#26159;APK&#21487;&#20197;&#30452;&#25509;&#35775;&#38382;&#30340;&#25509;&#21475;&#20102;
    </p>
    <p>
      .
    </p>
    <p>
      &#9500;&#9472;&#9472; IUsbManager.aidl
    </p>
    <p>
      &#9500;&#9472;&#9472; package.html
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbAccessory.aidl
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbAccessory.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbConfiguration.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbConstants.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbDevice.aidl
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbDeviceConnection.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbDevice.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbEndpoint.aidl
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbEndpoint.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbInterface.aidl
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbInterface.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbManager.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbPort.aidl
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbPort.java
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbPortStatus.aidl
    </p>
    <p>
      &#9500;&#9472;&#9472; UsbPortStatus.java
    </p>
    <p>
      &#9492;&#9472;&#9472; UsbRequest.java
    </p>
  </body>
</html></richcontent>
<node CREATED="1590924771628" FOLDED="true" ID="ID_816208898" MODIFIED="1593310254385">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20998;&#26512;&#19968;&#19979; UsbManager.java &#25991;&#20214;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590926879648" FOLDED="true" ID="ID_1003050487" MODIFIED="1593310253325">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman" size="4" color="#102aec">public UsbDeviceConnection openDevice(UsbDevice device) </font>
    </p>
    <p>
      <font face="Times New Roman" size="4" color="#102aec">&#20989;&#25968;&#20998;&#26512;</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1590927346353" ID="ID_54428716" MODIFIED="1590927357178">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      String deviceName = device.getDeviceName()
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590927372531" ID="ID_1027131434" MODIFIED="1591745431543">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ParcelFileDescriptor pfd = mService.openDevice(deviceName)
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#e80f0f" DESTINATION="ID_1574925776" ENDARROW="Default" ENDINCLINATION="157;-230;" ID="Arrow_ID_1056625645" STARTARROW="None" STARTINCLINATION="242;-20;"/>
</node>
<node CREATED="1591744191524" ID="ID_1610680558" MODIFIED="1591744194758" TEXT="UsbDeviceConnection connection = new UsbDeviceConnection(device);"/>
<node CREATED="1591744218087" ID="ID_525488220" MODIFIED="1591744220450" TEXT="boolean result = connection.open(deviceName, pfd, mContext);"/>
<node CREATED="1591744230183" ID="ID_1383185006" MODIFIED="1591744231966" TEXT="pfd.close()"/>
<node CREATED="1591744242270" ID="ID_1099429201" MODIFIED="1591744244175" TEXT="return connection"/>
</node>
</node>
<node CREATED="1591745493283" FOLDED="true" ID="ID_422337655" MODIFIED="1594781554490">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#1412ef"><b>&#20998;&#26512;&#19968;&#19979;&#25991;&#20214; UsbDeviceConnection.java</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1591745646652" ID="ID_1135823725" MODIFIED="1591745667180">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      public UsbDeviceConnection(UsbDevice device) {
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;mDevice = device;
    </p>
    <p>
      &#160;&#160;&#160;&#160;}
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591745725213" FOLDED="true" ID="ID_1771860120" MODIFIED="1594781553344">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      boolean open(String name, ParcelFileDescriptor pfd, @NonNull Context context)
    </p>
  </body>
</html></richcontent>
<node CREATED="1591745770770" ID="ID_1556417788" MODIFIED="1591745787468">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mContext = context.getApplicationContext();
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1591745802271" ID="ID_385998011" MODIFIED="1592185172860">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      boolean wasOpened = native_open(name, pfd.getFileDescriptor())
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#cc00cc" DESTINATION="ID_1415918844" ENDARROW="Default" ENDINCLINATION="745;0;" ID="Arrow_ID_1923540076" STARTARROW="None" STARTINCLINATION="-664;0;"/>
</node>
<node CREATED="1591745830271" ID="ID_843277170" MODIFIED="1591745838356">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      return wasOpened
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1593580999455" FOLDED="true" ID="ID_679443488" MODIFIED="1594781515882">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#0000cc" face="&#x96b6;&#x4e66;">&#26085;&#24535;&#20998;&#26512;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1593581048952" ID="ID_1013692780" MODIFIED="1593581092436">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x5b8b;&#x4f53;">sdm845:/ # logcat *:v|grep usbhost </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.424&#160;&#160;1262&#160;&#160;1486 I usbhost : new device /dev/bus/usb/001/001 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.425&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_open /dev/bus/usb/001/001 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.425&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new /dev/bus/usb/001/001 fd: 173 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.425&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new read returned 43 errno 0 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.429&#160;&#160;1262&#160;&#160;1486 I usbhost : new device /dev/bus/usb/002/001 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.429&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_open /dev/bus/usb/002/001 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.429&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new /dev/bus/usb/002/001 fd: 173 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.429&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new read returned 49 errno 0 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.898&#160;&#160;1262&#160;&#160;1486 I usbhost : new device /dev/bus/usb/001/002 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:20.898&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_open /dev/bus/usb/001/002 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.007&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new /dev/bus/usb/001/002 fd: 173 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.007&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new read returned 818 errno 0 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.052&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_open /dev/bus/usb/001/002 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.052&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new /dev/bus/usb/001/002 fd: 255 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.052&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new read returned 818 errno 0 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.321&#160;&#160;1262&#160;&#160;1486 I usbhost : new device /dev/bus/usb/002/002 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.321&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_open /dev/bus/usb/002/002 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.414&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new /dev/bus/usb/002/002 fd: 255 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.414&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new read returned 284 errno 88 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.421&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_open /dev/bus/usb/002/002 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.421&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new /dev/bus/usb/002/002 fd: 266 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">07-01 05:22:21.421&#160;&#160;1262&#160;&#160;1486 I usbhost : usb_device_new read returned 284 errno 0 </font>
    </p>
    <p>
      
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">sdm845:/ # lsusb </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">Bus 002 Device 002: ID 05a9:0680 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">Bus 001 Device 001: ID 1d6b:0002 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">Bus 001 Device 002: ID 6366:3370 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">Bus 002 Device 001: ID 1d6b:0003 </font>
    </p>
    <p>
      <font face="&#x5b8b;&#x4f53;">sdm845:/ #</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1587526528654" FOLDED="true" ID="ID_1651791632" MODIFIED="1597301966014">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff0000"><b>OTG&#30340;&#27010;&#24565;</b></font>
    </p>
    <p>
      
    </p>
    <p>
      USB OTG&#21644;Embedded Host&#26159;&#23545;usb2.0&#35268;&#33539;&#30340;&#19968;&#31181;&#34917;&#20805;&#65292;&#24182;&#24341;&#20837;&#20102;&#19977;&#31181;&#27807;&#36890;&#21327;&#35758;
    </p>
    <p>
      Attach Detection Protocol(ADP)
    </p>
    <p>
      Session Request Protocol(SRP)
    </p>
    <p>
      Host Negotiation Protocol(HNP)
    </p>
  </body>
</html></richcontent>
<node CREATED="1587536925809" ID="ID_938388029" MODIFIED="1595231197960">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/usb-connector-mating.PNG" />
  </body>
</html></richcontent>
<node CREATED="1587537881433" ID="ID_589164227" MODIFIED="1587537891476">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/usb-cable.PNG" />
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1587537971218" ID="ID_1507013953" MODIFIED="1587538569272">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#25903;&#25345;OTG&#21151;&#33021;&#30340;&#35774;&#22791;&#19978;&#37117;&#26377;mini-AB&#25110;&#32773;&#26159;micro-AB&#25509;&#25554;&#24231;&#65292;
    </p>
    <p>
      &#35813;&#25509;&#25554;&#24231;&#21487;&#20197;&#25509;&#20837;A&#22411;&#25110;&#32773;B&#22411;&#30340;plug&#12290;&#26631;&#20934;&#30340;OTG cable&#22312;&#19968;&#31471;&#25317;&#26377;A&#22411;plug&#65292;&#22312;&#21478;&#19968;&#31471;&#25317;&#26377;B&#22411;plug,
    </p>
    <p>
      &#22914;&#26524;&#19968;&#20010;&#35774;&#22791;&#34987;A&#22411;plug&#25554;&#20837;&#65292;&#37027;&#20040;&#35813;&#35774;&#22791;&#20316;&#20026;OTA A&#22411;&#35774;&#22791;&#65307;&#22914;&#26524;&#34987;B&#22411;plug&#25554;&#20837;&#65292;&#37027;&#20040;&#35813;&#35774;&#22791;&#20316;&#20026;
    </p>
    <p>
      OTA B&#22411;&#35774;&#22791;&#12290;
    </p>
    <p>
      A&#22411;plug&#21644;B&#22411;plug&#30340;&#21306;&#20998;&#20027;&#35201;&#26159;&#38752;ID&#24341;&#33050;&#65292;A&#22411;plug&#30340;ID&#33050;&#26159;&#25509;&#22320;&#30340;&#65292;B&#22411;plug&#30340;ID&#33050;&#26159;&#24748;&#31354;&#30340;&#65288;&#22312;micro&#25509;&#21475;&#37324;&#38754;
    </p>
    <p>
      &#25317;&#26377;&#19981;&#21516;&#30340;&#19978;&#25289;&#30005;&#38459;&#65289;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1593574160842" ID="ID_1820715428" MODIFIED="1593574172368">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      https://www.cnblogs.com/haoxing990/p/8799133.html
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1574250103965" ID="ID_27661495" MODIFIED="1597653344146" TEXT="USB&#x534f;&#x8bae;&#x5b66;&#x4e60;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1574250173205" ID="ID_1335167454" MODIFIED="1574767377667">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0000cc">Endpoints&#x7684;&#x6982;&#x5ff5;</font></b>
    </p>
    <p>
      
    </p>
    <p>
      &#x7aef;&#x70b9;&#x53ef;&#x4ee5;&#x88ab;&#x63cf;&#x8ff0;&#x6210;&#x6570;&#x636e;&#x7684;source&#x6216;&#x8005;&#x662f;sink&#x7684;&#x6982;&#x5ff5;&#xff0c;&#x4f46;&#x662f;&#x7aef;&#x70b9;&#x53ea;&#x5b58;&#x5728;&#x4e8e;usb device&#x5f53;&#x4e2d;&#x3002;
    </p>
    <p>
      &#x50a8;&#x5b58;&#x5728;&#x7aef;&#x70b9;&#x91cc;&#x9762;&#x7684;&#x6570;&#x636e;&#x6216;&#x8005;&#x662f;&#x4ece;host&#x53d1;&#x9001;&#x8fc7;&#x6765;&#x7684;&#xff0c;&#x6216;&#x8005;&#x662f;&#x7b49;&#x5f85;&#x53d1;&#x9001;&#x7ed9;host&#x3002;&#x7aef;&#x70b9;&#x53ef;&#x4ee5;&#x8bbe;&#x7f6e;&#x6210;&#x652f;&#x6301;&#x591a;&#x8fbe;
    </p>
    <p>
      &#x56db;&#x79cd;&#x4f20;&#x8f93;&#x7c7b;&#x578b;(control transfers, interrupt transfers, Isochronous Transfers&#x548c;Bulk Transfers)
    </p>
    <p>
      a. &#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x53ef;&#x4ee5;&#x62e5;&#x6709;&#x591a;&#x8fbe;16&#x4e2a;out&#x548c;16&#x4e2a;in&#x7684;&#x7aef;&#x70b9;
    </p>
    <p>
      b.&#x6bcf;&#x4e2a;&#x7aef;&#x70b9;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#x4f20;&#x8f93;&#x65b9;&#x5411;
    </p>
    <p>
      c.&#x7aef;&#x70b9;0&#x53ea;&#x662f;&#x7528;&#x4f5c;&#x63a7;&#x5236;&#x4f20;&#x8f93;&#x7684;&#xff0c;&#x4e0d;&#x80fd;&#x88ab;&#x7528;&#x505a;&#x5176;&#x4ed6;&#x7684;&#x7528;&#x9014;
    </p>
    <p>
      d.OUT&#x548c;IN&#x7684;&#x6982;&#x5ff5;&#x90fd;&#x662f;&#x4ece;host&#x7684;&#x89d2;&#x5ea6;&#x6765;&#x8bf4;&#x660e;&#x7684;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1574820199268" ID="ID_1584959843" MODIFIED="1574820227647">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#3333ff">&#x6587;&#x6863;&#x4e0b;&#x8f7d;&#xff1a; </font></b>
    </p>
    <p>
      <b><font color="#3333ff">http://www.usb.org/developers/docs</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1583898131646" ID="ID_1604355950" MODIFIED="1597653348896">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x96b6;&#x4e66;" size="4"><b>usb 2.0&#21327;&#35758;&#23398;&#20064;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1583898150784" FOLDED="true" ID="ID_558301305" MODIFIED="1602569720467">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0033" face="Narkisim" size="4">&#31532;&#22235;&#31456; Architectural overview</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1583903465408" ID="ID_1702717644" MODIFIED="1600849746757">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>USB System Description</b>
    </p>
    <p>
      <b><font color="#009900">USB interconnect </font></b>
    </p>
    <p>
      <b><font color="#009900">USB devices </font></b>
    </p>
    <p>
      <b><font color="#009900">USB host</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1583903551104" ID="ID_909692596" MODIFIED="1600849749116">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      USB&#20114;&#36830;&#26159;&#19968;&#31181;&#35774;&#22791;&#20043;&#38388;&#30456;&#20114;&#36830;&#25509;&#20197;&#21450;&#35774;&#22791;&#36319;host&#20043;&#38388;&#36890;&#20449;&#30340;&#26041;&#24335;&#65292;&#23427;&#21253;&#25324;&#22914;&#19979;&#30340;&#23450;&#20041;:
    </p>
    <ol>
      <li>
        Bus Topology
      </li>
      <li>
        Inter-layer Relationshipsa
      </li>
      <li>
        Data Flow Model
      </li>
      <li>
        USB Schedule
      </li>
    </ol>
  </body>
</html></richcontent>
<node CREATED="1586329829483" ID="ID_1056426447" MODIFIED="1586329913815">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <img src="usb/bus-topology.PNG" />
      
    </p>
    <p>
      
    </p>
    <p>
      <b><font color="#ff3333">&#25105;&#20204;&#21487;&#20197;&#30475;&#21040;&#22312;host&#22788;&#26159;&#26377;&#19968;&#20010;root hub&#30340;&#65292;&#20063;&#23601;&#26159;&#35828;hub&#26159;&#24517;&#39035;&#23384;&#22312;&#30340;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1584349642630" ID="ID_1307913161" MODIFIED="1586327971270">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Physical Interface</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584349657634" FOLDED="true" ID="ID_285726959" MODIFIED="1597641284880">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Power</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1584349758490" ID="ID_1175352672" MODIFIED="1584349818717">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Power distribution&#35299;&#20915;&#30340;&#26159;usb&#35774;&#22791;&#22914;&#20309;&#28040;&#32791;usb host&#25552;&#20379;&#30340;&#30005;&#21147;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584349835892" ID="ID_32150454" MODIFIED="1584349899436">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Power management &#35299;&#20915;&#30340;&#26159;usb&#30340;&#31995;&#32479;&#36719;&#20214;&#21644;usb&#35774;&#22791;&#22914;&#20309;&#36866;&#24212;
    </p>
    <p>
      &#22522;&#20110;usb host&#30340;&#30005;&#21147;&#31649;&#29702;&#31995;&#32479;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1584349664978" FOLDED="true" ID="ID_212315004" MODIFIED="1597641283367">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">Bus Protocol</font></b>
    </p>
    <p>
      
    </p>
    <p>
      usb bus is a polled bus, host controller initiates all data transfer
    </p>
  </body>
</html></richcontent>
<node CREATED="1586315074288" ID="ID_1326408339" MODIFIED="1586315642616">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font size="4" color="#ff0000">token packet</font></i></b>
    </p>
    <p>
      
    </p>
    <p>
      &#30001;host controller&#21457;&#20986;&#65292;&#35813;packet&#26159;&#29992;&#20110;&#25551;&#36848;&#20256;&#36755;&#30340;&#31867;&#22411;&#21644;&#26041;&#21521;&#65292;USB&#35774;&#22791;&#22320;&#22336;&#65292;&#31471;&#28857;&#21495;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586315405955" ID="ID_1424274753" MODIFIED="1586315612973">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font size="4" color="#ff3300">host&#21644;endpoint&#20043;&#38388;&#30340;&#25968;&#25454;&#20256;&#36755;&#27169;&#22411;&#23601;&#31216;&#20043;&#20026;pipe</font></i></b>
    </p>
    <p>
      &#26377;&#20004;&#31181;pipe&#30340;&#31867;&#22411;&#65306;stream&#21644;message
    </p>
    <p>
      
    </p>
    <p>
      &#19968;&#20010;message pipe&#21644;&#19968;&#20010;&#40664;&#35748;&#30340;&#25511;&#21046;pipe&#22312;&#35774;&#22791;&#19978;&#30005;&#20043;&#21518;&#23601;&#23384;&#22312;&#20102;&#65292;&#36825;&#20004;&#20010;pipe
    </p>
    <p>
      &#26159;&#29992;&#26469;&#33719;&#21462;&#35774;&#22791;&#30340;&#37197;&#32622;&#12289;&#29366;&#24577;&#21644;&#25511;&#21046;&#20449;&#24687;&#30340;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586315695569" ID="ID_210082348" MODIFIED="1586317475007">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#ff3300">&#27969;&#25511;</font></i></b>
    </p>
    <p>
      
    </p>
    <p>
      &#20107;&#21153;&#30340;&#35843;&#24230;&#20801;&#35768;&#23545;&#19968;&#20123;stream pipe&#36827;&#34892;&#27969;&#25511;&#21046;&#65292;&#22312;&#30828;&#20214;&#23618;&#38754;&#65292;&#36825;&#31181;&#31574;&#30053;&#21487;&#20197;&#38450;&#27490;&#30828;&#20214;&#30340;&#32531;&#23384;&#20986;&#29616;
    </p>
    <p>
      overrun&#21644;underrun, &#27969;&#25511;&#26159;&#36890;&#36807;&#20351;&#29992;NAK&#25569;&#25163;&#26469;&#25233;&#21046;&#25968;&#25454;&#36895;&#29575;&#30340;&#65292;&#24403;NAK&#34987;&#21457;&#20986;&#20043;&#21518;&#65292;&#19968;&#20010;&#20107;&#21153;&#20250;&#22312;
    </p>
    <p>
      bus&#26102;&#38388;&#21040;&#26469;&#30340;&#26102;&#20505;&#34987;&#37325;&#26032;&#23581;&#35797;&#36827;&#34892;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1586316069783" ID="ID_1087000540" MODIFIED="1586316149864">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">Robustness</font></b>
    </p>
    <p>
      
    </p>
    <p>
      USB&#26377;&#20960;&#31181;&#23646;&#24615;&#21487;&#20197;&#20445;&#35777;&#25968;&#25454;&#30340;&#31361;&#21457;&#24615;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586328039397" FOLDED="true" ID="ID_1926415233" MODIFIED="1597653693547">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">System Configuration</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1586329502657" ID="ID_253032338" MODIFIED="1586332218861">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      USB&#35774;&#22791;&#25554;&#20837;&#30340;&#24773;&#20917;
    </p>
    <p>
      
    </p>
    <p>
      &#25152;&#26377;&#30340;usb&#35774;&#22791;&#37117;&#26159;&#36890;&#36807;&#19968;&#31181;&#29305;&#27530;&#30340;usb&#35774;&#22791;-hub&#30340;&#31471;&#21475;&#26469;&#25509;&#20837;&#30340;&#12290;Hub&#36890;&#36807;&#29366;&#24577;bit&#26469;
    </p>
    <p>
      &#30830;&#23450;&#23427;&#31471;&#21475;&#19978;&#38754;&#30340;&#35774;&#22791;&#30340;&#25509;&#20837;&#21644;&#31227;&#38500;&#12290;host&#20250;&#35810;&#38382;hub&#26469;&#33719;&#21462;&#36825;&#20123;bit&#12290;&#22312;&#35774;&#22791;&#25554;&#20837;&#30340;
    </p>
    <p>
      &#24773;&#20917;&#19979;&#65292;host&#20250;&#36890;&#36807;usb&#35774;&#22791;&#30340;&#25511;&#21046;pipe&#26469;&#20351;&#33021;usb&#35774;&#22791;&#30340;&#31471;&#21475;&#21644;&#22320;&#22336;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      host&#20250;&#23558;&#19968;&#20010;&#29420;&#29305;&#30340;&#35774;&#22791;&#22320;&#22336;&#36171;&#20540;&#32473;&#35813;&#35774;&#22791;&#65292;&#24182;&#19988;&#20250;&#21028;&#26029;&#24403;&#21069;&#25554;&#20837;&#30340;&#35774;&#22791;&#26159;&#19968;&#20010;hub&#25110;&#32773;&#26159;&#19968;&#20010;function,
    </p>
    <p>
      &#22914;&#26524;&#21028;&#26029;&#25554;&#20837;&#30340;&#26159;&#19968;&#20010;function&#65292;&#37027;&#20040;&#25554;&#20837;&#30340;&#36890;&#30693;&#20250;&#34987;&#21457;&#32473;host&#31995;&#32479;&#24403;&#20013;&#22788;&#29702;&#35813;function&#30340;&#36719;&#20214;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586332286950" ID="ID_1840585403" MODIFIED="1586332303705">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#35774;&#22791;&#25300;&#20986;&#30340;&#24773;&#20917;&#22788;&#29702;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586332315150" ID="ID_137592709" MODIFIED="1586332430895">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Bus Enumeration &#24635;&#32447;&#26522;&#20030;
    </p>
    <p>
      
    </p>
    <p>
      bus&#30340;&#26522;&#20030;&#27963;&#21160;&#26159;&#26102;&#21051;&#37117;&#22312;&#36827;&#34892;&#24403;&#20013;&#30340;&#65292;&#35813;&#27963;&#21160;&#22312;&#35774;&#22791;&#25554;&#20837;&#30340;&#26102;&#20505;&#23558;&#29420;&#29305;&#30340;
    </p>
    <p>
      &#35774;&#22791;&#22320;&#22336;&#36171;&#20540;&#32473;&#35813;&#35774;&#22791;&#65292;&#24403;&#35774;&#22791;&#25300;&#20986;&#30340;&#26102;&#20505;&#20063;&#20250;&#20570;&#30456;&#24212;&#30340;&#22788;&#29702;&#24037;&#20316;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1586339762440" ID="ID_116372361" MODIFIED="1597653388267">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">Data Flow Types</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1586339846463" ID="ID_1685716203" MODIFIED="1586769681294">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22235;&#31181;&#22522;&#26412;&#30340;&#25968;&#25454;&#20256;&#36755;&#31867;&#22411;&#65306;
    </p>
    <p>
      control transfer &#29992;&#20110;&#22312;&#35774;&#22791;attach&#21160;&#20316;&#30340;&#26102;&#20505;&#37197;&#32622;&#35774;&#22791;&#65292;&#24182;&#19988;&#21487;&#20197;&#29992;&#20110;&#20854;&#20182;&#30340;&#19968;&#20123;&#30340;&#20855;&#20307;&#30340;&#30446;&#30340;&#65306;
    </p>
    <p>
      &#27604;&#22914;&#23545;&#35774;&#22791;&#19978;&#20854;&#20182;&#30340;pipe&#30340;&#25511;&#21046;&#27963;&#21160;
    </p>
    <p>
      
    </p>
    <p>
      bulk data transfer &#20135;&#29983;&#25110;&#32773;&#28040;&#32791;&#30340;&#25968;&#37327;&#22823;&#19988;&#26159;&#31361;&#21457;&#24615;&#30340;
    </p>
    <p>
      
    </p>
    <p>
      interrupt data transfer &#29992;&#20110;&#21450;&#26102;&#32780;&#21487;&#38752;&#30340;&#25968;&#25454;&#20256;&#36755;
    </p>
    <p>
      
    </p>
    <p>
      isochronous data transfer &#25968;&#25454;&#20256;&#36755;&#36807;&#31243;&#24403;&#20013;&#21344;&#29992;&#30340;usb&#24102;&#23485;&#21644;&#26102;&#24310;&#37117;&#26159;&#39044;&#20808;&#21327;&#21830;&#23436;&#25104;&#30340;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1586826236294" FOLDED="true" ID="ID_1135984869" MODIFIED="1597641279638">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">USB Devices </font></b>
    </p>
    <p>
      
    </p>
    <p>
      usb&#35774;&#22791;&#34987;&#21010;&#20998;&#25104;&#35774;&#22791;&#31867;(device classes),&#27604;&#22914;hub, human interface, printer, imaging &#25110;&#32773;&#26159;
    </p>
    <p>
      &#22823;&#23481;&#37327;&#23384;&#20648;&#35774;&#22791;&#12290;hub&#35774;&#22791;&#31867;&#26174;&#31034;&#20986;&#36825;&#31181;&#35774;&#22791;&#26159;&#19968;&#31181;&#29305;&#27530;&#35774;&#35745;&#20986;&#26469;&#30340;USB&#35774;&#22791;&#65292;&#29992;&#20110;&#25552;&#20379;&#28508;&#22312;&#30340;
    </p>
    <p>
      USB&#38468;&#30528;&#28857;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      USB&#35774;&#22791;&#34987;&#35201;&#27714;&#25658;&#24102;&#20851;&#20110;&#33258;&#36523;&#26631;&#35782;&#21644;&#36890;&#29992;&#37197;&#32622;&#30340;&#20449;&#24687;&#12290;&#23427;&#20204;&#20063;&#20250;&#34987;&#35201;&#27714;&#20197;USB&#35774;&#22791;&#29366;&#24577;&#26469;&#23637;&#29616;&#20986;&#34892;&#20026;&#19978;&#30340;
    </p>
    <p>
      &#19968;&#33268;&#24615;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1586827171731" ID="ID_413829231" MODIFIED="1586827538498">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22120;&#20214;&#29305;&#24615;
    </p>
    <p>
      
    </p>
    <p>
      &#25152;&#26377;&#30340;USB&#35774;&#22791;&#37117;&#26159;&#36890;&#36807;USB&#35774;&#22791;&#22312;&#38468;&#30528;&#25110;&#32773;&#26522;&#20030;&#38454;&#27573;&#34987;&#36171;&#20104;&#30340;USB&#22320;&#22336;&#26469;&#35775;&#38382;&#30340;&#12290;
    </p>
    <p>
      &#27599;&#20010;USB&#35774;&#22791;&#36890;&#36807;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#31649;&#36947;&#26469;&#36319;host&#36827;&#34892;&#36890;&#20449;&#12290;
    </p>
    <p>
      &#25152;&#26377;&#30340;USB&#35774;&#22791;&#24517;&#39035;&#25903;&#25345;&#19968;&#20010;&#29305;&#27530;&#30340;&#20301;&#20110;&#31471;&#28857;0&#30340;&#31649;&#36947;&#65292;usb&#35774;&#22791;&#30340;&#25511;&#21046;&#31649;&#36947;&#23601;&#20250;&#38468;&#30528;&#22312;&#35813;&#31649;&#36947;&#20043;&#19978;&#12290;
    </p>
    <p>
      &#25152;&#26377;&#30340;USB&#35774;&#22791;&#25903;&#25345;&#36890;&#29992;&#30340;&#35775;&#38382;&#26426;&#21046;&#65292;&#29992;&#26469;&#36890;&#36807;&#25511;&#21046;&#31649;&#36947;&#33719;&#21462;&#20449;&#24687;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586827985676" ID="ID_971132215" MODIFIED="1586831495059">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36319;&#25511;&#21046;&#31649;&#36947;&#30456;&#20851;&#30340;&#20449;&#24687;&#20250;&#34987;&#35201;&#27714;&#29992;&#26469;&#23436;&#20840;&#22320;&#25551;&#36848;USB&#35774;&#22791;&#65292;&#35813;&#20449;&#24687;&#34987;&#20998;&#25104;&#22914;&#19979;&#30340;&#20960;&#20010;&#31867;&#22411;&#65306;
    </p>
    <p>
      <b>Standard </b>&#35813;&#20449;&#24687;&#23545;&#20110;&#25152;&#26377;&#30340;USB&#35774;&#22791;&#37117;&#26159;&#36890;&#29992;&#30340;&#65292;&#21253;&#25324;vendor&#26631;&#35782;&#31526;&#12289;&#35774;&#22791;class&#12289;&#30005;&#28304;&#31649;&#29702;&#33021;&#21147;&#12290;
    </p>
    <p>
      Device, configuration, interface, and endpoint descriptions&#25658;&#24102;&#30528;&#36319;&#35813;&#35774;&#22791;&#30456;&#20851;&#30340;&#37197;&#32622;&#20449;&#24687;&#12290;
    </p>
    <p>
      &#20851;&#20110;&#36825;&#20123;&#25551;&#36848;&#31526;&#30340;&#35814;&#32454;&#20449;&#24687;&#21487;&#20197;&#22312;&#31532;&#20061;&#31456;&#25214;&#21040;
    </p>
    <p>
      <b>Class</b>&#160;&#20851;&#20110;&#36825;&#37096;&#20998;&#20449;&#24687;&#30340;&#23450;&#20041;&#26159;&#22810;&#31181;&#22810;&#26679;&#30340;&#65292;&#20381;&#36182;&#20110;USB &#35774;&#22791;&#30340;&#35774;&#22791;&#31867;&#22411;
    </p>
    <p>
      <b>USB Vendor</b>&#160;&#35774;&#22791;&#21378;&#21830;&#21487;&#20197;&#25918;&#32622;&#19968;&#20123;&#24819;&#35201;&#30340;&#20449;&#24687;&#22312;&#36825;&#37324;&#65292;&#20294;&#26159;&#20449;&#24687;&#30340;&#26684;&#24335;&#19981;&#26159;&#26412;&#21327;&#35758;&#35268;&#23450;&#30340;
    </p>
    <p>
      
    </p>
    <p>
      &#24635;&#32780;&#35328;&#20043;&#65292;&#27599;&#20010;usb&#35774;&#22791;&#37117;&#25658;&#24102;USB&#25511;&#21046;&#21644;&#29366;&#24577;&#20449;&#24687;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1602580408977" ID="ID_507788725" MODIFIED="1602580467793">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff0033" size="5"><b>&#31532;&#20116;&#31456; USB&#25968;&#25454;&#27969;&#27169;&#22411;</b></font>
    </p>
  </body>
</html>
</richcontent>
<node CREATED="1602580474850" ID="ID_599055698" MODIFIED="1602580553558">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Frames&#21644;MicroFrames
    </p>
    <p>
      
    </p>
    <p>
      USB establishes a 1 millisecond time base called a frame on a full-/low-speed bus and a 125 &#181; s time base
    </p>
    <p>
      called a microframe on a high-speed bus. A (micro)frame can contain several transactions. Each transfer
    </p>
    <p>
      type defines what transactions are allowed within a (micro)frame for an endpoint. Isochronous and interrupt
    </p>
    <p>
      endpoints are given opportunities to the bus every N (micro)frames. The values of N and other details about
    </p>
    <p>
      isochronous and interrupt transfers are described in Sections 5.6 and 5.7.
    </p>
    <p>
      
    </p>
    <p>
      &#20174;spec&#30340;&#35299;&#37322;&#26469;&#30475;&#65292;Frames&#21644;MicroFrames&#29992;&#20110;&#24314;&#31435;&#26102;&#38388;&#22522;&#20934;
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html>
</richcontent>
</node>
</node>
<node CREATED="1587094074196" FOLDED="true" ID="ID_598985936" MODIFIED="1602569725925">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff0000" face="&#x6977;&#x4f53;" size="5"><b>&#31532;&#20843;&#31456; &#21327;&#35758;&#23618;</b></font>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1587095156428" ID="ID_1389791646" MODIFIED="1587100801197">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Bit&#39034;&#24207;&#21644;&#23383;&#33410;Byte&#39034;&#24207;</b>
    </p>
    <p>
      LSb -------------&gt; MSb &#20256;&#36755;bit&#20301;
    </p>
    <p>
      &#25353;&#29031;LSB ----&gt; MSB&#30340;&#39034;&#24207;&#26469;&#20256;&#36755;&#23383;&#33410;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587100244329" ID="ID_858652665" MODIFIED="1587100406155">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3333ff"><b>SYNC Field</b></font>
    </p>
    <p>
      
    </p>
    <p>
      &#21516;&#27493;&#22495;&#26159;&#29992;&#20110;&#21516;&#27493;&#26102;&#38047;&#30340;&#65292;&#23545;&#20110;full/low-speed&#26159;8bit&#65292;&#23545;&#20110;high-speed&#26159;32bit&#65292;
    </p>
    <p>
      &#25509;&#25910;&#21040;&#30340;SYNC&#22495;&#21487;&#33021;&#27604;&#23450;&#20041;&#30340;&#35201;&#30701;&#65292;&#36825;&#20010;&#26080;&#20809;&#32039;&#35201;&#65292;&#22240;&#20026;&#21516;&#27493;&#22495;&#30340;&#30446;&#30340;&#23601;&#26159;&#20026;&#20102;&#21516;&#27493;&#20351;&#29992;&#30340;&#12290;
    </p>
    <p>
      &#21516;&#27493;&#22495;&#30340;&#26368;&#21518;2&#20010;bit&#26159;&#29992;&#26469;&#25351;&#31034;SYNC&#22495;&#30340;&#32456;&#32467;&#30340;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587100563146" ID="ID_1514438101" MODIFIED="1589189993108">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Packet Field Formats</b>
    </p>
    <p>
      
    </p>
    <p>
      &#23545;&#20110;token packet&#12289;data packet&#21644;handshake packet&#30340;&#22495;&#26684;&#24335;&#25551;&#36848;&#20250;&#23637;&#29616;&#22312;&#22914;&#19979;&#30340;&#37096;&#20998;&#24403;&#20013;&#12290;
    </p>
    <p>
      &#25152;&#26377;&#25968;&#25454;&#21253;&#37324;&#38754;&#23545;&#20110;&#27599;&#20010;bit&#30340;&#25551;&#36848;&#37117;&#26159;&#25551;&#36848;&#30340;&#26410;&#21152;&#23494;&#20043;&#21069;&#30340;bit&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#25152;&#26377;&#30340;&#21253;&#37117;&#26377;start&#21644;end&#30028;&#23450;&#31526;&#65292;SOP&#30028;&#23450;&#31526;&#26159;sync&#22495;&#30340;&#19968;&#37096;&#20998;&#65292;EOP&#30028;&#23450;&#31526;&#22312;&#31532;&#19971;&#31456;&#24403;&#20013;&#25551;&#36848;&#21040;&#20102;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1587100844529" ID="ID_338290071" MODIFIED="1589190110659">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff" size="4" face="Times New Roman">Packet Identifier Field</font>
    </p>
    <p>
      &#20174;&#21517;&#31216;&#19978;&#23601;&#21487;&#20197;&#30475;&#21040;PID&#26159;&#29992;&#26469;&#25351;&#31034;&#21253;&#30340;&#31867;&#22411;&#30340;&#65292;PID&#32039;&#36319;&#22312;SYNC&#22495;&#30340;&#21518;&#38754;&#12290;
    </p>
    <p>
      &#19968;&#20010;PID&#30001;4&#20010;bit&#30340;&#21253;&#31867;&#22411;&#22495;&#21152;&#19978;4&#20010;bit&#30340;&#26816;&#26597;&#22495;&#25152;&#32452;&#25104;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1587101309831" ID="ID_943691289" MODIFIED="1587101318181">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/PID-Type.PNG" />
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1587108013669" ID="ID_1860154716" MODIFIED="1589190106552">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff" face="Times New Roman"><b>Address Fields</b></font>
    </p>
    <p>
      
    </p>
    <p>
      &#20351;&#29992;2&#20010;&#22495;&#26469;&#23547;&#22336;function&#36319;endpoints: function address&#21644;endpoint address
    </p>
    <p>
      &#20219;&#20309;&#19968;&#20010;&#22320;&#22336;&#30340;&#19981;&#21305;&#37197;&#37117;&#20250;&#23548;&#33268;token&#34987;&#24573;&#30053;&#25481;&#65292;
    </p>
    <p>
      &#35775;&#38382;&#38750;&#21021;&#22987;&#21270;&#36807;&#30340;&#31471;&#28857;&#20063;&#20250;&#23548;&#33268;token&#34987;&#24573;&#30053;&#25481;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1587108410296" ID="ID_65604216" MODIFIED="1587113043808">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff" face="Times New Roman"><b>function&#22320;&#22336;&#22495;&#30001;ADDR0~ADDR1 7&#20010;bit&#25152;&#32452;&#25104;</b></font>&#65292; ADDR&#22495;&#21482;&#22312;
    </p>
    <p>
      IN&#12289;SETUP&#21644;OUT &#36825;&#19977;&#31181;token packet&#65292;
    </p>
    <p>
      PING&#21644;SPLIT&#36825;&#20004;&#31181;special packet&#37324;&#38754;&#23384;&#22312;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#26681;&#25454;&#23450;&#20041;&#65292;&#27599;&#20010;ADDR&#22495;&#23450;&#20041;&#20102;&#19968;&#20010;&#21333;&#19968;&#30340;function&#12290;&#22312;&#37325;&#32622;&#21644;&#19978;&#30005;&#30340;&#38454;&#27573;&#65292;
    </p>
    <p>
      &#19968;&#20010;function&#30340;&#22320;&#22336;&#40664;&#35748;&#26159;0&#65292;&#24182;&#19988;&#24517;&#39035;&#30001;host&#22312;&#26522;&#20030;&#38454;&#27573;&#36827;&#34892;&#32534;&#31243;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587112646302" ID="ID_203970280" MODIFIED="1587112996897">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300cc" face="Times New Roman"><b>Endpoint Field</b></font>
    </p>
    <p>
      
    </p>
    <p>
      4&#20010;bit&#65292; Endp0~Endp3&#29992;&#26469;&#25351;&#23450;&#31471;&#28857;&#21495;&#65288;&#24403;&#31471;&#28857;&#21495;&#36229;&#36807;&#19968;&#20010;&#65289;
    </p>
    <p>
      &#38500;&#20102;&#31471;&#28857;&#21495;0&#20043;&#22806;&#65292;&#31471;&#28857;&#21495;&#26159;&#30001;function&#25351;&#23450;&#30340;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#35813;&#22495;&#21482;&#23545;IN&#12289;SETUP&#12289;OUT&#12289;PING&#36825;&#22235;&#31181;&#21253;&#37324;&#38754;&#20570;&#20102;&#23450;&#20041;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#20302;&#36895;&#35774;&#22791;&#26368;&#22810;&#21482;&#25903;&#25345;3&#20010;&#31471;&#28857;&#65292;&#39640;&#36895;&#35774;&#22791;&#26368;&#22810;&#21487;&#20197;&#25903;&#25345;16&#20010;IN/OUT &#31471;&#28857;
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1587113206335" ID="ID_1610996358" MODIFIED="1587113317035">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300cc" face="Times New Roman"><b>Frame Number Field</b></font>
    </p>
    <p>
      
    </p>
    <p>
      11&#20010;bit&#30340;&#20301;&#65292;framenumber&#26159;&#30001;host&#26469;&#36827;&#34892;&#36882;&#22686;&#25805;&#20316;&#30340;&#65292;host&#22312;
    </p>
    <p>
      SOF token&#37324;&#38754;&#23558;framenumber&#21457;&#36865;&#32473;device
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587113387146" ID="ID_367962959" MODIFIED="1587113441521">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff" face="Times New Roman"><b>&#25968;&#25454;&#22495; </b></font>&#23601;&#26159;&#20256;&#36755;&#30340;&#30495;&#23454;&#25968;&#25454;&#20102;&#65292;
    </p>
    <p>
      &#25968;&#25454;&#22495;&#20801;&#35768;&#20256;&#36755;&#30340;&#23383;&#33410;&#33539;&#22260;&#26159; 0~1024 &#23383;&#33410;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1587347248518" ID="ID_1640901797" MODIFIED="1589190091487">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman"><b>Packet Formats</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1587353863582" ID="ID_1082840299" MODIFIED="1587353869777" TEXT="Token Packets"/>
<node CREATED="1587353975033" ID="ID_232272443" MODIFIED="1589190095047">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3300ff"><b>Split Transaction Special Token Packets</b></font>
    </p>
    <p>
      
    </p>
    <p>
      &#35813;token packets&#30456;&#27604;&#20110;&#19968;&#33324;&#30340;token packets&#26469;&#35828;&#65292;&#22810;&#20102;&#19968;&#20010;&#23383;&#33410;&#65292;&#21363;&#22235;&#20010;&#23383;&#33410;
    </p>
    <p>
      split transaction token&#30340;&#20986;&#29616;&#26159;&#20026;&#20102;&#25903;&#25345;&#20027;&#26426;&#25511;&#21046;&#22120;&#36319;&#39640;&#36895;&#27169;&#24335;&#19979;&#30340;hub&#20043;&#38388;&#30340;split transactions&#38382;&#39064;&#65292;
    </p>
    <p>
      &#39640;&#36895;hub&#36830;&#25509;&#30528; full-/low-speed &#35774;&#22791;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#26377;&#20004;&#31181;split transaction&#20351;&#29992;split transaction special token&#36827;&#34892;&#23450;&#20041;&#65292;
    </p>
    <p>
      &#19968;&#31181;&#26159;start-split transaction(SSPLIT), &#21478;&#19968;&#31181;&#26159;complete-split transaction(CSPLIT)
    </p>
  </body>
</html></richcontent>
<node CREATED="1587465604112" ID="ID_1475560113" MODIFIED="1587467108931">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      split transaction&#30340;&#21151;&#33021;
    </p>
    <p>
      
    </p>
    <p>
      high-speed split transaction&#20027;&#35201;&#26159;&#29992;&#22312;host controller&#21644;hub&#20043;&#38388;&#30340;&#65292;&#35813;hub&#26377;full-speed/low-speed&#35774;&#22791;
    </p>
    <p>
      &#38468;&#30528;&#22312;hub&#19978;&#38754;&#12290;&#35813;high-speed split transaction&#20027;&#35201;&#26159;&#29992;&#20110;&#21551;&#21160;hub&#21644;&#35774;&#22791;&#20043;&#38388;&#30340;full-speed/low-speed&#20256;&#36755;&#30340;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#35813;&#26041;&#27861;&#20027;&#35201;&#26159;&#20026;&#20102;&#35753;&#25511;&#21046;&#22120;&#20351;&#29992;high-speed &#20256;&#36755;&#26041;&#24335;&#21551;&#21160;full/low speed&#20256;&#36755;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1586831124918" FOLDED="true" ID="ID_1413673833" MODIFIED="1602569727909">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#ff0000">&#31532;&#20061;&#31456; USB Device Framework</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1586833147202" ID="ID_1299421022" MODIFIED="1586835190171">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#3300ff">&#25551;&#36848;&#31526;</font></b>
    </p>
    <p>
      
    </p>
    <p>
      USB&#35774;&#22791;&#20351;&#29992;&#25551;&#36848;&#31526;&#26469;&#25253;&#21578;&#20182;&#20204;&#30340;&#23646;&#24615;&#12290;&#19968;&#20010;&#25551;&#36848;&#31526;&#23601;&#26159;&#19968;&#20010;&#39044;&#23450;&#20041;&#30340;&#25968;&#25454;&#32467;&#26500;&#12290;
    </p>
    <p>
      &#27599;&#20010;&#25551;&#36848;&#31526;&#20197;&#19968;&#20010;&#23383;&#33410;&#23485;&#30340;&#22495;&#24320;&#22987;&#65292;&#35813;&#22495;&#25551;&#36848;&#20102;&#25551;&#36848;&#31526;&#30340;&#24635;&#38271;&#24230;&#65307;
    </p>
    <p>
      &#32039;&#36319;&#30528;&#19968;&#20010;&#23383;&#33410;&#22495;&#25551;&#36848;&#20102;&#25551;&#36848;&#31526;&#30340;&#31867;&#22411;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#25551;&#36848;&#31526;&#20801;&#35768;&#23545;&#27599;&#31181;&#29420;&#31435;&#30340;&#37197;&#32622;&#30340;&#23646;&#24615;&#36827;&#34892;&#31616;&#27905;&#30340;&#23384;&#20648;&#65292;&#22240;&#20026;&#27599;&#20010;&#37197;&#32622;&#21487;&#33021;&#20250;&#37325;&#22797;&#20351;&#29992;&#25110;&#32773;&#37096;&#20998;&#20351;&#29992;&#20854;&#20182;
    </p>
    <p>
      &#37197;&#32622;&#30340;&#25551;&#36848;&#31526;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#36866;&#24403;&#30340;&#26102;&#20505;&#65292;&#25551;&#36848;&#31526;&#20250;&#21253;&#21547;&#19968;&#20010;&#25351;&#21521;&#23383;&#31526;&#20018;&#25551;&#36848;&#31526;&#30340;&#24341;&#29992;&#65292;&#29992;&#26469;&#20197;&#20154;&#31867;&#21487;&#35835;&#30340;&#26041;&#24335;&#23637;&#29616;&#25551;&#36848;&#31526;&#30340;&#20449;&#24687;&#12290;&#23545;&#23383;&#31526;&#20018;&#25551;&#36848;&#31526;
    </p>
    <p>
      &#30340;&#21253;&#21547;&#26159;&#21487;&#36873;&#30340;&#65292;&#20294;&#26159;&#24341;&#29992;&#23383;&#27573;&#26159;&#24517;&#39035;&#26377;&#30340;&#12290;&#22914;&#26524;&#19968;&#20010;&#35774;&#22791;&#19981;&#25903;&#25345;&#23383;&#31526;&#20018;&#24418;&#24335;&#30340;&#25551;&#36848;&#31526;&#65292;&#37027;&#20040;&#24341;&#29992;&#23383;&#27573;&#24517;&#39035;&#34987;&#37325;&#32622;&#25104;0.
    </p>
    <p>
      
    </p>
    <p>
      <i><b>&#19968;&#20010;&#35774;&#22791;&#21487;&#33021;&#20250;&#20197;&#22914;&#19979;&#30340;2&#31181;&#26041;&#24335;&#36820;&#22238;&#23545;&#24212;class&#25110;&#32773;vendor&#30340;&#25551;&#36848;&#31526;&#65306;</b></i>
    </p>
    <p>
      &#22914;&#26524;class&#25110;&#32773;vendor&#25551;&#36848;&#31526;&#26159;&#25353;&#29031;standard&#25551;&#36848;&#31526;&#30340;&#26684;&#24335;&#30340;&#65292;&#37027;&#20040;&#22312;&#35843;&#29992;GetDescriptor&#35831;&#27714;&#33719;&#21462;&#37197;&#32622;&#20449;&#24687;&#30340;&#26102;&#20505;&#65292;
    </p>
    <p>
      &#24517;&#39035;&#36319;standard&#25551;&#36848;&#31526;&#20132;&#26367;&#36820;&#22238;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#22914;&#20309;class&#25110;&#32773;vendor&#25551;&#36848;&#31526;&#26159;&#29420;&#31435;&#20110;&#37197;&#32622;&#20449;&#24687;&#30340;&#25110;&#32773;&#26159;&#20351;&#29992;&#20102;&#38750;&#26631;&#20934;&#30340;&#26684;&#24335;&#65292;GetDescriptor&#35831;&#27714;&#20250;&#25351;&#23450;&#25551;&#36848;&#31526;&#30340;&#31867;&#22411;&#21644;&#32034;&#24341;&#26469;&#33719;&#21462;
    </p>
    <p>
      &#25551;&#36848;&#31526;&#12290;class&#25110;&#32773;vendor&#25991;&#26723;&#20250;&#35814;&#32454;&#35828;&#26126;&#25551;&#36848;&#31526;&#33719;&#21462;&#30340;&#26041;&#24335;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590568668525" FOLDED="true" ID="ID_1380168016" MODIFIED="1597653376004">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" face="&#x6977;&#x4f53;">&#26631;&#20934;&#30340;&#35774;&#22791;&#35831;&#27714;</font></b>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ff0000" DESTINATION="ID_1380168016" ENDARROW="None" ENDINCLINATION="229;368;" ID="Arrow_ID_1769105816" SOURCE="ID_905192057" STARTARROW="None" STARTINCLINATION="8099;0;"/>
<node CREATED="1590570486903" FOLDED="true" ID="ID_290790155" MODIFIED="1597641274724">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#25152;&#26377;&#30340;USB&#35774;&#22791;&#37117;&#20250;&#21709;&#24212;&#26469;&#33258;&#20110;host&#30340;&#35831;&#27714;&#65288;&#20301;&#20110;&#35774;&#22791;&#40664;&#35748;&#30340;&#25511;&#21046;pipe&#65289;,
    </p>
    <p>
      &#36825;&#20123;&#35831;&#27714;&#26159;&#20351;&#29992;&#25511;&#21046;&#20256;&#36755;&#26469;&#21457;&#20986;&#30340;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#35831;&#27714;&#21644;&#35831;&#27714;&#30340;&#21442;&#25968;&#26159;&#36890;&#36807;<b><font color="#0033ff">SETUP</font></b>&#25968;&#25454;&#21253;&#26469;&#21457;&#20986;&#32473;&#35774;&#22791;&#30340;&#65292;host&#38656;&#35201;&#22635;&#20805;&#34920;&#26684;
    </p>
    <p>
      9-2&#25152;&#26631;&#35782;&#20986;&#26469;&#30340;&#25968;&#25454;&#22495;&#65292;&#27599;&#20010;SETUP&#25968;&#25454;&#21253;&#37117;&#25317;&#26377;8&#20010;&#23383;&#33410;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590570762437" FOLDED="true" ID="ID_38163087" MODIFIED="1597641269591">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/usb-setup-packet.PNG" />
  </body>
</html></richcontent>
<node CREATED="1590570885402" ID="ID_815365475" MODIFIED="1590570891795">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/usb-&#x6807;&#x51c6;&#x8bbe;&#x5907;&#x8bf7;&#x6c42;.PNG" />
  </body>
</html></richcontent>
</node>
<node CREATED="1590572355850" ID="ID_52172350" MODIFIED="1590572470061">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      bmRequestType&#21487;&#20197;&#25351;&#23450;&#35831;&#27714;&#30340;&#23545;&#35937;&#26159;device&#12289;interface&#25110;&#32773;&#26159;endpoint,
    </p>
    <p>
      &#24403;&#25509;&#21475;&#25110;&#32773;&#26159;&#31471;&#21475;&#34987;&#25351;&#23450;&#20043;&#21518;&#65292;wIndex&#22495;&#29992;&#20110;&#26631;&#35782;&#20986;&#25509;&#21475;&#25110;&#32773;&#31471;&#28857;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1586835240741" FOLDED="true" ID="ID_460016905" MODIFIED="1597653378865" TEXT="&#x6807;&#x51c6;USB&#x63cf;&#x8ff0;&#x7b26;&#x7684;&#x5b9a;&#x4e49;">
<node CREATED="1586835254441" FOLDED="true" ID="ID_884773065" MODIFIED="1597641264334" TEXT="Device">
<node CREATED="1586842124002" FOLDED="true" ID="ID_913103023" MODIFIED="1597641263271">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#19968;&#20010;&#35774;&#22791;&#25551;&#36848;&#31526;&#25551;&#36848;&#20102;&#19968;&#20010;USB&#35774;&#22791;&#30340;&#36890;&#29992;&#20449;&#24687;&#65292;
    </p>
    <p>
      &#23427;&#21253;&#21547;&#20102;&#21487;&#20197;&#20840;&#23616;&#24615;&#22320;&#24212;&#29992;&#21040;&#35774;&#22791;&#30340;&#20449;&#24687;&#20197;&#21450;&#25152;&#26377;&#35774;&#22791;&#30340;&#37197;&#32622;&#65292;
    </p>
    <p>
      &#19968;&#20010;USB&#35774;&#22791;&#21482;&#26377;&#19968;&#20010;&#35774;&#22791;&#25551;&#36848;&#31526;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1591927757737" ID="ID_92658134" MODIFIED="1591927817954">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Finished? No! I have not told you the whole history: many devices actually
    </p>
    <p>
      put their class information in the Interface <a href="http://www.beyondlogic.org/usbnutshell/usb5.htm" rel="nofollow">Descriptor</a>&#160;instead of the Device <a href="http://www.beyondlogic.org/usbnutshell/usb5.htm" rel="nofollow">Descriptor</a>.
    </p>
    <p>
      
    </p>
    <p>
      &#35774;&#22791;&#30340;class&#20449;&#24687;&#24448;&#24448;&#19981;&#26159;&#25918;&#32622;&#22312;&#35774;&#22791;&#25551;&#36848;&#31526;&#37324;&#38754;&#65292;&#32780;&#26159;&#25918;&#32622;&#22312;&#25509;&#21475;&#25551;&#36848;&#31526;&#37324;&#38754;&#30340;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1586842459412" ID="ID_132755764" MODIFIED="1586842548062">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#20110;&#39640;&#36895;&#21644;&#20840;&#36895;&#20855;&#26377;&#19981;&#21516;&#35774;&#22791;&#20449;&#24687;&#30340;&#39640;&#36895;&#35774;&#22791;&#65292;&#24517;&#39035;&#26377;&#19968;&#20010; device_qualifier &#25551;&#36848;&#31526;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586842608107" ID="ID_1780977293" MODIFIED="1586842809394">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#20110;&#39640;&#36895;&#35774;&#22791;&#26469;&#35828;&#65292;&#20854;&#35774;&#22791;&#25551;&#36848;&#31526;&#24403;&#20013;&#30340;version number&#26159;2.0&#65288;0200H&#65289;
    </p>
    <p>
      &#22914;&#26524;&#35774;&#22791;&#26159;&#20840;&#36895;&#35774;&#22791;&#25110;&#32773;&#26159;&#20302;&#36895;&#35774;&#22791;&#65292;&#35813;version number&#22914;&#26524;&#26159;2.0&#65292;&#23601;&#34920;&#26126;&#35813;&#35774;&#22791;&#20250;&#23545;&#35831;&#27714;
    </p>
    <p>
      device_qualifier&#25551;&#36848;&#31526;&#36825;&#26679;&#30340;&#35831;&#27714;&#20316;&#20986;&#30456;&#24212;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586843019382" FOLDED="true" ID="ID_1982406789" MODIFIED="1589890107184">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      bNumConfigurations &#34920;&#26126;&#22312;&#24403;&#21069;&#30340;&#36816;&#34892;&#36895;&#24230;&#20043;&#19979;&#30340;&#37197;&#32622;&#20449;&#24687;&#30340;&#20010;&#25968;&#65292;
    </p>
    <p>
      &#23545;&#20110;&#20854;&#20182;&#36816;&#34892;&#36895;&#24230;&#20043;&#19979;&#30340;&#37197;&#32622;&#30340;&#25968;&#37327;&#19981;&#21253;&#25324;&#22312;&#24403;&#21069;&#30340;bNumConfigurations&#37324;&#38754;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1586843156881" ID="ID_274331399" MODIFIED="1586843280915">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#35774;&#22791;&#24037;&#20316;&#22312;&#39640;&#36895;&#29366;&#24577;&#65292;bMaxPacketSize0 &#22495;&#24517;&#39035;&#26159;64&#65292;&#29992;&#26469;&#34920;&#26126;&#21253;&#30340;&#26368;&#22823;&#22823;&#23567;&#26159;64&#23383;&#33410;&#12290;
    </p>
    <p>
      &#23545;&#20110;&#25511;&#21046;&#31471;&#28857;&#65292;&#39640;&#36895;&#25805;&#20316;&#27169;&#24335;&#19979;&#19981;&#20801;&#35768;&#26377;&#20854;&#20182;&#30340;&#26368;&#22823;&#21253;&#22823;&#23567;&#20540;&#23384;&#22312;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1586843417047" ID="ID_956756316" MODIFIED="1586843799535">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#25152;&#26377;&#30340;USB&#35774;&#22791;&#37117;&#26377;&#19968;&#20010;&#40664;&#35748;&#30340;&#25511;&#21046;&#31649;&#36947;&#65292;&#35813;&#31649;&#36947;&#25903;&#25345;&#30340;&#26368;&#22823;&#21253;&#30340;&#22823;&#23567;&#34987;&#23450;&#20041;&#22312;&#20102;&#35774;&#22791;
    </p>
    <p>
      &#25551;&#36848;&#31526;&#37324;&#38754;&#12290;&#36319;&#26576;&#20010;&#20855;&#20307;&#30340;&#37197;&#32622;&#21644;&#25509;&#21475;&#30456;&#20851;&#30340;&#31471;&#21475;&#37117;&#22312;&#37197;&#32622;&#25551;&#36848;&#31526;&#37324;&#38754;&#36827;&#34892;&#20102;&#25551;&#36848;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1586835260884" ID="ID_1456415372" MODIFIED="1586835271686" TEXT="Device_Qualifier"/>
<node CREATED="1586835275781" FOLDED="true" ID="ID_1018149002" MODIFIED="1597641261352" TEXT="Configuration">
<node CREATED="1586850156121" FOLDED="true" ID="ID_1863865221" MODIFIED="1597641259730">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#37197;&#32622;&#25551;&#36848;&#31526;&#29992;&#26469;&#25551;&#36848;&#19968;&#20010;&#20855;&#20307;&#30340;&#35774;&#22791;&#37197;&#32622;&#12290;&#35813;&#25551;&#36848;&#31526;&#21253;&#21547;&#19968;&#20010;bConfigurationValue&#22495;&#65292;&#35813;
    </p>
    <p>
      &#22495;&#30340;&#20540;&#21487;&#20197;&#20316;&#20026;SetConfiguraton&#35831;&#27714;&#30340;&#21442;&#25968;&#65292;&#29992;&#26469;&#25351;&#23450;&#25551;&#36848;&#31526;&#25152;&#25551;&#36848;&#30340;&#37197;&#32622;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#37197;&#32622;&#25551;&#36848;&#31526;&#25551;&#36848;&#20102;&#30001;&#35813;&#37197;&#32622;&#25152;&#25552;&#20379;&#30340;&#25509;&#21475;&#30340;&#25968;&#37327;&#12290;&#27599;&#20010;&#25509;&#21475;&#37117;&#21487;&#20197;&#29420;&#31435;&#22320;&#36827;&#34892;&#25805;&#20316;&#12290;&#20030;&#20363;&#26469;&#35828;&#65292;&#19968;&#20010;
    </p>
    <p>
      ISDN&#35774;&#22791;&#21487;&#20197;&#34987;&#37197;&#32622;&#25104;&#20855;&#26377;2&#20010;&#25509;&#21475;&#65292;&#27599;&#20010;&#25509;&#21475;&#37117;&#21487;&#20197;&#25552;&#20379;64Kb/s&#30340;&#21452;&#21521;&#36890;&#36947;&#65307;&#32780;&#21478;&#19968;&#20010;&#37197;&#32622;&#21017;&#26377;&#21487;&#33021;&#23558;
    </p>
    <p>
      ISDN&#35774;&#22791;&#37197;&#32622;&#25104;&#21482;&#26377;1&#20010;&#25509;&#21475;&#65292;&#35813;&#25509;&#21475;&#23558;2&#20010;&#36890;&#36947;&#32465;&#23450;&#25104;1&#20010;128Kb/s&#30340;&#21452;&#21521;&#36890;&#36947;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      <font face="&#x6977;&#x4f53;" size="4">&#24403;&#20027;&#26426;&#31471;&#35831;&#27714;&#37197;&#32622;&#25551;&#36848;&#31526;&#65292;&#25152;&#26377;&#30456;&#20851;&#30340;&#25509;&#21475;&#21644;&#31471;&#28857;&#25551;&#36848;&#31526;&#37117;&#20250;&#34987;&#36820;&#22238;&#12290; </font>
    </p>
    <p>
      
    </p>
    <p>
      &#19968;&#20010;USB&#35774;&#22791;&#25317;&#26377;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#37197;&#32622;&#25551;&#36848;&#31526;&#65292;&#27599;&#20010;&#37197;&#32622;&#25551;&#36848;&#31526;&#25317;&#26377;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#25509;&#21475;&#65292;&#27599;&#20010;&#25509;&#21475;&#25317;&#26377;0&#20010;&#25110;&#32773;&#22810;&#20010;
    </p>
    <p>
      &#31471;&#28857;&#12290;<font size="4">&#160;</font><font color="#ff0000" face="&#x96b6;&#x4e66;" size="4">&#22312;&#19968;&#20010;&#21333;&#19968;&#30340;&#37197;&#32622;&#37324;&#38754;&#65292;&#31471;&#28857;&#22312;&#21508;&#20010;&#25509;&#21475;&#20043;&#38388;&#26159;&#19981;&#33021;&#20849;&#20139;&#30340;&#65292;&#20294;&#26159;&#22312;&#19981;&#21516;&#24403;2&#20010;&#25509;&#21475;&#22788;&#20110;&#19981;&#21516;&#30340;&#37197;&#32622;&#37324;&#38754;&#65292; </font>
    </p>
    <p>
      <font color="#ff0000" face="&#x96b6;&#x4e66;" size="4">&#31471;&#28857;&#26159;&#21487;&#20197;&#23454;&#29616;&#20849;&#20139;&#30340;&#12290; </font>
    </p>
    <p>
      
    </p>
    <p>
      <i><font color="#0000cc" size="3">&#22914;&#26524;&#19968;&#20010;&#37197;&#32622;&#19979;&#38754;&#26377;&#22810;&#20010;interface&#65292;&#21017;&#21487;&#35270;&#20026;&#26159;&#22797;&#21512;&#35774;&#22791; </font></i>
    </p>
    <p>
      <i><font color="#0000cc" size="3">A device with more than one interface is called a composite device. When you connect your multifunction printer to your computer, the Operating System would load two different drivers: one for each &quot;logical&quot; peripheral you have</font></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1586915524633" ID="ID_681460826" MODIFIED="1586915548055">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/&#x914d;&#x7f6e;&#x63cf;&#x8ff0;&#x7b26;-1.PNG" />
  </body>
</html></richcontent>
</node>
<node CREATED="1586915550302" ID="ID_959179452" MODIFIED="1586915556827">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/&#x914d;&#x7f6e;&#x63cf;&#x8ff0;&#x7b26;-2.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1586835287070" FOLDED="true" ID="ID_1741543590" MODIFIED="1589890096598" TEXT="Other_Speed_Configuration">
<node CREATED="1586917653001" ID="ID_1568818615" MODIFIED="1586918069313">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#19968;&#20010;&#39640;&#36895;&#35774;&#22791;&#24037;&#20316;&#22312;&#20854;&#20182;&#21487;&#33021;&#30340;&#36895;&#24230;&#19979;&#65292;&#37027;&#20040;&#35813;&#25551;&#36848;&#31526;&#23601;&#25551;&#36848;&#20102;&#36825;&#31181;&#24773;&#20917;&#30340;&#37197;&#32622;&#12290;
    </p>
    <p>
      &#35813;&#37197;&#32622;&#30340;&#32467;&#26500;&#36319;&#19978;&#38754;&#30340;&#37197;&#32622;&#25551;&#36848;&#31526;&#26159;&#19968;&#33268;&#30340;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      <font color="#009900" face="Segoe UI Semibold" size="4">The host accesses this descriptor using the GetDescriptor() request</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1586835328644" FOLDED="true" ID="ID_130985147" MODIFIED="1597641255206" TEXT="Interface">
<node CREATED="1586920277758" ID="ID_883214754" MODIFIED="1587030019877">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#25509;&#21475;&#25551;&#36848;&#31526;&#25551;&#36848;&#20102;&#22312;&#19968;&#20010;&#37197;&#32622;&#37324;&#38754;&#30340;&#20855;&#20307;&#30340;&#25509;&#21475;&#12290;&#19968;&#20010;&#37197;&#32622;&#25552;&#20379;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#25509;&#21475;&#65292;&#27599;&#20010;
    </p>
    <p>
      &#25509;&#21475;&#37324;&#38754;&#26377;0&#20010;&#25110;&#32773;&#22810;&#20010;&#31471;&#28857;&#25551;&#36848;&#31526;-&#32452;&#25104;&#20102;&#29420;&#29305;&#30340;&#31471;&#28857;&#30340;&#38598;&#21512;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      <font face="&#x6977;&#x4f53;" color="#3300ff" size="4">&#24403;&#19968;&#20010;&#37197;&#32622;&#25903;&#25345;&#36229;&#36807;&#19968;&#20010;&#25509;&#21475;&#30340;&#26102;&#20505;&#65292;&#24403;&#25105;&#20204;&#35843;&#29992;GetConfiguration()&#35831;&#27714;&#30340;&#26102;&#20505;&#65292;&#31471;&#28857;&#25551;&#36848;&#31526;&#20250;&#36319;&#22312; </font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;" color="#3300ff" size="4">&#25509;&#21475;&#25551;&#36848;&#31526;&#21518;&#38754;&#34987;&#36820;&#22238;&#21040;&#35843;&#29992;&#32773;&#12290;&#25509;&#21475;&#25551;&#36848;&#31526;&#24635;&#26159;&#20250;&#20316;&#20026;&#37197;&#32622;&#25551;&#36848;&#31526;&#30340;&#19968;&#37096;&#20998;&#34987;&#36820;&#22238;&#12290;&#25509;&#21475;&#25551;&#36848;&#31526;&#26080;&#27861; </font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;" color="#3300ff" size="4">&#36890;&#36807;GetDescriptor()&#25110;&#32773;SetDescriptor()&#35843;&#29992;&#35831;&#27714;&#26469;&#35775;&#38382;<i>&#12290;</i></font>
    </p>
    <p>
      
    </p>
    <p>
      &#19968;&#20010;&#25509;&#21475;&#21487;&#33021;&#20250;&#21253;&#21547;&#19968;&#20123;&#21487;&#36873;&#30340;&#35774;&#32622;&#65292;&#35813;&#35774;&#32622;&#20801;&#35768;&#31471;&#28857;&#20197;&#21450;&#23427;&#20204;&#30340;&#29305;&#24615;&#21464;&#24471;&#22810;&#26679;&#12290;&#19968;&#20010;&#25509;&#21475;&#30340;&#40664;&#35748;setting&#23601;&#26159;
    </p>
    <p>
      setting 0, SetInterface&#65288;&#65289;&#35831;&#27714;&#23601;&#26159;&#29992;&#26469;&#35774;&#32622;&#21487;&#36873;setting&#25110;&#32773;&#35774;&#32622;&#25104;default setting&#30340;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#24403;&#19968;&#20010;&#37197;&#32622;&#37324;&#38754;&#30340;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#25509;&#21475;&#37117;&#26377;&#21487;&#36873;&#30340;setting&#30340;&#26102;&#20505;&#65292;&#19968;&#20010;&#29420;&#31435;&#30340;&#25509;&#21475;&#25551;&#36848;&#31526;&#21644;&#36319;&#20854;&#20851;&#32852;&#30340;&#31471;&#28857;&#25551;&#36848;&#31526;&#20250;&#34987;&#21253;&#21547;&#21040;
    </p>
    <p>
      &#27599;&#20010;setting&#37324;&#38754;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587030118075" ID="ID_1071162804" MODIFIED="1587030387466">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22914;&#26524;&#19968;&#20010;&#37197;&#32622;&#20165;&#20165;&#25903;&#25345;&#19968;&#20010;&#25509;&#21475;&#65292;&#24182;&#19988;&#35813;&#25509;&#21475;&#26377;2&#20010;&#21487;&#36873;&#30340;setting&#65292;&#37027;&#20040;
    </p>
    <p>
      &#37197;&#32622;&#25551;&#36848;&#31526;&#21518;&#38754;&#20250;&#36319;&#30528;&#19968;&#20010;&#25509;&#21475;&#25551;&#36848;&#31526;&#65292;&#35813;&#25509;&#21475;&#25551;&#36848;&#31526;&#37324;&#38754;&#30340;bInterfaceNumber&#21644;bAlternateSetting
    </p>
    <p>
      &#22495;&#20250;&#34987;&#37197;&#32622;&#25104;0&#65292;&#32039;&#25509;&#30528;&#30340;&#23601;&#26159;&#35813;setting&#30340;&#31471;&#21475;&#25551;&#36848;&#31526;&#65292;&#22312;&#36825;&#20043;&#21518;&#36824;&#26377;&#21478;&#19968;&#20010;&#25509;&#21475;&#25551;&#36848;&#31526;&#20197;&#21450;&#36319;&#35813;
    </p>
    <p>
      &#25509;&#21475;&#30456;&#20851;&#32852;&#30340;&#31471;&#28857;&#25551;&#36848;&#31526;&#12290; &#31532;&#20108;&#20010;&#25509;&#21475;&#25551;&#36848;&#31526;&#30340;bInterfaceNumber&#20173;&#28982;&#26159;0&#65292;&#20294;&#26159;bAlternateSetting&#26159;1
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587032032407" ID="ID_1883218995" MODIFIED="1587032078376">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="&#x6977;&#x4f53;" color="#ff0000">&#25509;&#21475;&#25551;&#36848;&#31526;&#37324;&#38754;&#30340;&#31471;&#28857;&#25551;&#36848;&#31526;&#30340;&#25968;&#37327;&#26159;&#19981;&#21253;&#21547;&#31471;&#28857;0&#30340;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1587086459828" FOLDED="true" ID="ID_425228010" MODIFIED="1597641252288" TEXT="&#x63a5;&#x53e3;&#x63cf;&#x8ff0;&#x7b26;">
<node CREATED="1587086471636" ID="ID_330554015" MODIFIED="1587086486720">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/&#x63a5;&#x53e3;&#x63cf;&#x8ff0;&#x7b26;-1.PNG" />
  </body>
</html></richcontent>
</node>
<node CREATED="1587086489918" ID="ID_593198962" MODIFIED="1587086495830">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/&#x63a5;&#x53e3;&#x63cf;&#x8ff0;&#x7b26;-2.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1586835335150" FOLDED="true" ID="ID_225054674" MODIFIED="1597641248279" TEXT="Endpoint">
<node CREATED="1587087575124" FOLDED="true" ID="ID_1361751977" MODIFIED="1597641244627">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#27599;&#19968;&#20010;&#29992;&#20110;&#25509;&#21475;&#30340;&#31471;&#28857;&#37117;&#26377;&#23427;&#33258;&#24049;&#30340;&#25551;&#36848;&#31526;&#12290;&#35813;&#25551;&#36848;&#31526;&#21253;&#21547;&#20027;&#26426;&#38656;&#35201;&#30340;&#20449;&#24687;&#65292;&#29992;&#20197;&#20915;&#23450;
    </p>
    <p>
      &#27599;&#20010;&#31471;&#28857;&#38656;&#35201;&#30340;&#24102;&#23485;&#12290;
    </p>
  </body>
</html></richcontent>
<node CREATED="1587088434098" ID="ID_863418511" MODIFIED="1587088442296">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/&#x7aef;&#x70b9;&#x63cf;&#x8ff0;&#x7b26;-1.PNG" />
  </body>
</html></richcontent>
</node>
<node CREATED="1587088445034" FOLDED="true" ID="ID_1390943319" MODIFIED="1597641242692">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/&#x7aef;&#x70b9;&#x63cf;&#x8ff0;&#x7b26;-2.PNG" />
  </body>
</html></richcontent>
<node CREATED="1587091468989" ID="ID_575865460" MODIFIED="1587091910671">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      a. &#19968;&#20010;&#21453;&#39304;&#31471;&#28857;&#38656;&#35201;&#36319;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#21516;&#27493;&#25968;&#25454;&#31471;&#28857;&#32465;&#23450;&#36215;&#26469;&#65292;&#20026;&#21516;&#27493;&#25968;&#25454;&#31471;&#28857;&#25552;&#20379;&#21453;&#39304;&#26381;&#21153;&#12290;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#32465;&#23450;&#26159;&#22522;&#20110;&#31471;&#28857;&#21495;&#21305;&#37197;&#30340;&#12290;
    </p>
    <p>
      b. &#21453;&#39304;&#31471;&#28857;&#36319;&#23427;&#25152;&#26381;&#21153;&#30340;&#25968;&#25454;&#31471;&#28857;&#30340;&#26041;&#21521;&#24635;&#26159;&#30456;&#21453;&#30340;&#12290;
    </p>
    <p>
      c. &#22914;&#26524;&#22810;&#20010;&#25968;&#25454;&#31471;&#28857;&#26159;&#30001;&#21516;&#19968;&#20010;&#21453;&#39304;&#31471;&#28857;&#36827;&#34892;&#26381;&#21153;&#30340;&#65292;&#37027;&#20040;&#25968;&#25454;&#31471;&#28857;&#30340;&#31471;&#28857;&#21495;&#24517;&#39035;&#26159;&#21319;&#24207;&#27169;&#24335;&#65292;&#24182;&#19988;&#31532;&#19968;&#20010;&#25968;&#25454;&#31471;&#28857;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#36319;&#21453;&#39304;&#31471;&#28857;&#30340;&#31471;&#28857;&#21495;&#24517;&#39035;&#26159;&#19968;&#26679;&#30340;&#65292;&#36825;&#31181;&#35268;&#23450;&#26159;&#20026;&#20102;&#35753;&#25968;&#25454;&#31471;&#28857;&#33021;&#22815;&#26041;&#20415;&#25214;&#21040;&#20854;&#23545;&#24212;&#30340;&#21453;&#39304;&#31471;&#28857;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1587088454586" ID="ID_1516228870" MODIFIED="1587088460047">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/&#x7aef;&#x70b9;&#x63cf;&#x8ff0;&#x7b26;-3.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1586835343872" ID="ID_31833363" MODIFIED="1586835345838" TEXT="String"/>
</node>
</node>
</node>
<node CREATED="1589270232078" FOLDED="true" ID="ID_1037565906" MODIFIED="1593483792960">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x96b6;&#x4e66;" size="4"><b>HID&#21327;&#35758;&#23398;&#20064;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1589270306538" ID="ID_1555301254" MODIFIED="1590471172008" TEXT="&#x7b2c;&#x4e94;&#x7ae0; &#x64cd;&#x4f5c;&#x6a21;&#x578b;">
<node CREATED="1589270325023" ID="ID_943364280" MODIFIED="1590471222258" TEXT="&#x8bbe;&#x5907;&#x63cf;&#x8ff0;&#x7b26;&#x7ed3;&#x6784;">
<node CREATED="1589270516564" FOLDED="true" ID="ID_1510827710" MODIFIED="1589890072193">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid&#x63cf;&#x8ff0;&#x7b26;&#x7ed3;&#x6784;.PNG" />
  </body>
</html></richcontent>
<node CREATED="1589270621540" ID="ID_406489073" MODIFIED="1589270982058">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0000ff" face="&#x5b8b;&#x4f53;" size="4"><i>&#23545;&#20110;HID class&#35774;&#22791;&#26469;&#35828;&#65292;class type&#26159;&#23450;&#20041;&#22312;&#25509;&#21475;&#25551;&#36848;&#31526;&#37324;&#38754;&#30340; </i></font>
    </p>
    <p>
      <font color="#ff0000" size="4">&#25509;&#21475;&#25551;&#36848;&#31526;&#37324;&#38754;&#30340;subclass&#22495;&#26159;&#29992;&#26469;&#36776;&#35782;boot devices&#29992;&#30340;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1589333905415" ID="ID_669531579" MODIFIED="1590471174318" TEXT="Report &#x63cf;&#x8ff0;&#x7b26;">
<node CREATED="1589333927795" ID="ID_1957526304" MODIFIED="1590471181920">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x534e;&#x6587;&#x6977;&#x4f53;" size="4">&#25253;&#21578;&#25551;&#36848;&#31526;&#26159;&#30001;&#20449;&#24687;&#29255;&#25152;&#32452;&#25104;&#30340;&#65292;&#27599;&#20010;&#20449;&#24687;&#29255;&#34987;&#31216;&#20026;Item&#12290; </font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;" size="4">&#19968;&#20010;Item&#23601;&#26159;&#19968;&#39033;&#20851;&#20110;&#35774;&#22791;&#30340;&#20449;&#24687;&#65292;&#25152;&#26377;&#30340;Item&#37117;&#25317;&#26377;&#19968;&#20010;&#23383;&#33410;&#30340;&#21069;&#32512;&#65292;&#35813;&#21069;&#32512; </font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;" size="4">&#21253;&#21547;Item tag, Item type&#20197;&#21450;Item size&#12290; </font>
    </p>
    <p>
      
    </p>
    <p>
      &#19968;&#20010;Item&#21487;&#33021;&#20250;&#21253;&#25324;&#21487;&#36873;&#30340;Item data&#12290;&#19968;&#20010;Item&#30340;data&#37096;&#20998;&#26159;&#30001;&#20854;&#22522;&#30784;&#31867;&#22411;&#26469;&#20915;&#23450;&#30340;&#12290;
    </p>
    <p>
      &#26377;&#20004;&#31181;&#22522;&#26412;&#30340;Item&#31867;&#22411;&#65306; short item &#21644; long item
    </p>
    <p>
      &#22914;&#33509;Item&#26159;short item&#65292;&#37027;&#20040;&#20854;&#21487;&#36873;&#30340;data size&#21487;&#33021;&#26159;0,1,2&#25110;&#32773;4&#23383;&#33410;&#12290;
    </p>
    <p>
      &#22914;&#26524;Item&#26159;long item&#65292;&#37027;&#20040;&#20854;bSize value&#24635;&#26159;2
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1589335495101" ID="ID_891161745" MODIFIED="1589335508688">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-item.PNG" />
  </body>
</html></richcontent>
</node>
<node CREATED="1589335511391" ID="ID_874377158" MODIFIED="1589335518700">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-long-item.PNG" />
  </body>
</html></richcontent>
<node CREATED="1590542841155" ID="ID_891989961" MODIFIED="1590542956839">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0033ff" face="&#x96b6;&#x4e66;" size="4"><i>bLongItemTag &#26159;&#34987;&#20445;&#30041;&#22312;&#26410;&#26469;&#20351;&#29992;&#30340;&#65292; </i></font>
    </p>
    <p>
      <font color="#0033ff" face="&#x96b6;&#x4e66;" size="4"><i>Tag &#20540; 0xF0~0xFF &#26159;vendor&#33258;&#23450;&#20041;&#20351;&#29992;&#30340;&#12290;</i></font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1589336169588" ID="ID_1335201557" MODIFIED="1590471215863">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x6977;&#x4f53;" size="4">Item Parser</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1589336197540" ID="ID_83681619" MODIFIED="1589336344029">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      HID class driver&#21253;&#21547;&#19968;&#20010;parser&#65292;&#29992;&#20110;&#20998;&#26512;&#22312;&#25253;&#21578;&#25551;&#36848;&#31526;&#37324;&#38754;&#21457;&#29616;&#30340;Items&#12290;
    </p>
    <p>
      parser&#22312;&#36941;&#21382;&#25551;&#36848;&#31526;&#30340;&#26102;&#20505;&#65292;&#25910;&#38598;&#27599;&#20010;&#24050;&#30693;&#30340;item&#30340;&#29366;&#24577;&#65292;&#24182;&#23558;&#29366;&#24577;&#20445;&#23384;&#21040;item&#29366;&#24577;&#34920;&#37324;&#38754;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1590471448440" ID="ID_1701941777" MODIFIED="1590471565159">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#31532;&#20845;&#31456; &#25551;&#36848;&#31526;
    </p>
    <p>
      
    </p>
    <p>
      HID class&#35774;&#22791;&#31867;&#20351;&#29992;&#22914;&#19979;&#26631;&#20934;&#30340;USB&#25551;&#36848;&#31526;
    </p>
    <p>
      Device
    </p>
    <p>
      Configuration
    </p>
    <p>
      Interface
    </p>
    <p>
      Endpoint
    </p>
    <p>
      String
    </p>
  </body>
</html></richcontent>
<node CREATED="1590471574631" ID="ID_538834036" MODIFIED="1592450705879">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      HID class&#20855;&#20307;&#30340;&#25551;&#36848;&#31526;
    </p>
    <p>
      
    </p>
    <p>
      HID
    </p>
    <p>
      Report
    </p>
    <p>
      Physical
    </p>
  </body>
</html></richcontent>
<node CREATED="1590471835650" ID="ID_1074857536" MODIFIED="1590471842751" TEXT="HID &#x63cf;&#x8ff0;&#x7b26;">
<node CREATED="1590471851002" ID="ID_164691712" MODIFIED="1590471895590">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#29992;&#20110;&#23450;&#20041;&#19979;&#23646;&#30340;&#25551;&#36848;&#31526;&#30340;&#31867;&#22411;&#21644;&#38271;&#24230;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590472584882" ID="ID_1635338766" MODIFIED="1590472680428">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-description.PNG" />
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1590472945009" ID="ID_1577172728" MODIFIED="1590482245580">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Report &#25551;&#36848;&#31526;
    </p>
    <p>
      
    </p>
    <p>
      &#20027;&#26426;&#36890;&#36807;&#35299;&#26512;&#20174;&#26426;&#19978;&#20256;&#30340;&#25253;&#21578;&#25551;&#36848;&#31526;&#65292;&#25165;&#33021;&#30693;&#36947;&#20174;&#26426;&#19978;&#20256;&#30340;&#25253;&#21578;&#26159;&#20160;&#20040;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590473030481" ID="ID_1402388428" MODIFIED="1590557348660">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      report&#25551;&#36848;&#31526;&#30340;&#38271;&#24230;&#21644;&#20869;&#23481;&#26159;&#20381;&#36182;&#20110;&#35813;report&#30340;data&#37096;&#20998;&#30340;&#12290;
    </p>
    <p>
      Report&#25551;&#36848;&#31526;&#26159;&#30001;Item&#32452;&#20214;&#26500;&#25104;&#30340;&#12290;
    </p>
    <p>
      Item type&#26377;&#19977;&#31181;&#65306;
    </p>
    <p>
      Main&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0
    </p>
    <p>
      Global&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;1
    </p>
    <p>
      Local&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;2
    </p>
    <p>
      Reserved&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;3
    </p>
    <p>
      
    </p>
    <p>
      Main type&#26377;&#20116;&#31181;tag&#65306;
    </p>
    <p>
      Input&#160;&#160;&#20195;&#34920;&#26469;&#33258;&#35774;&#22791;&#30340;&#25968;&#25454;
    </p>
    <p>
      Output&#160;&#160;&#20195;&#34920;&#21457;&#24448;&#35774;&#22791;&#30340;&#25968;&#25454;
    </p>
    <p>
      Feature &#25551;&#36848;&#31526;&#35774;&#22791;&#30340;&#36755;&#20837;&#21644;&#36755;&#20986;
    </p>
    <p>
      Collection &#20195;&#34920;Input&#12289;Output&#12289;Feature&#30340;&#32452;&#21512;
    </p>
    <p>
      End &#20195;&#34920;collection tag&#30340;&#32456;&#32467;
    </p>
    <p>
      
    </p>
    <p>
      Local type&#65306;
    </p>
    <p>
      &#25551;&#36848;&#36319;&#22312;&#35813;item&#20043;&#21518;&#30340;main type&#30340;item&#37324;&#38754;&#30340;data&#22495;
    </p>
    <p>
      &#20030;&#20363;&#26469;&#35828;&#65306;&#22914;&#26524;&#19968;&#20010;Input item&#23450;&#20041;&#20102;5&#20010;controls&#65292; &#35813;input item&#21069;&#38754;&#21448;&#23450;&#20041;&#20102;
    </p>
    <p>
      3&#20010;usage, &#37027;&#20040;&#36825;3&#20010;usage&#20250;&#34987;&#39034;&#24207;&#23545;&#24212;&#21040;&#21069;&#38754;3&#20010;control, &#31532;&#19977;&#20010;usage&#20250;&#23545;&#24212;
    </p>
    <p>
      &#21097;&#19979;&#30340;2&#20010;control
    </p>
    <p>
      
    </p>
    <p>
      Global type:
    </p>
    <p>
      &#23545;&#20110;&#24403;&#21069;&#30340;&#25551;&#36848;&#31526;&#37324;&#38754;&#30340;&#25152;&#26377;data&#22495;&#30340;&#40664;&#35748;&#23646;&#24615;
    </p>
    <p>
      
    </p>
    <p>
      <font size="4" face="Times New Roman">Global Items:(6.2.2.7 Global Items) </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">&#35813;&#37197;&#32622;&#23545;&#21518;&#38754;&#25152;&#26377;&#25968;&#25454;&#26377;&#25928;&#65292;&#38500;&#38750;&#34987;&#26032;&#30340;Global Items&#30340;&#37197;&#32622;&#25152;&#35206;&#30422;&#12290; </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">bTag: </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">0b0000 ---- Usage Page </font>
    </p>
    <p>
      <b><font color="#0033ff" face="Times New Roman" size="4">usage&#26159;&#19968;&#20010;32bit&#30340;&#25968;&#20540;&#65292;&#32780;usage page&#32452;&#25104;&#39640;&#20301;&#30340;16bit</font></b>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0001 ---- Logical Minimum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0010 ---- Logical Maximum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0011 ---- Physical Minimum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0100 ---- Physical Maximum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0101 ---- Unit Exponent </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0110 ---- Unit (Unit values) </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;0b0111 ---- Report Size </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b1000 ---- Report ID </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b1001 ---- Report Count </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b1010 ---- Push </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b1011 ---- Pop </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;---- other reserved </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">Local Items (6.2.28 Local Items) </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">bTag: </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0000 ---- Usage </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0001 ---- Usage Minimum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0010 ---- Usage Maximum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0011 ---- Designator Index </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0100 ---- Designator Minimum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0101 ---- Designator Maximum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b0111 ---- String Index </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b1000 ---- String Minimum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b1001 ---- String Maximum </font>
    </p>
    <p>
      <font face="Times New Roman" size="4">0b1010 ---- Delimiter</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1590544041258" ID="ID_46705844" MODIFIED="1590544267580">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="&#x96b6;&#x4e66;">Main items&#26159;&#29992;&#20110;&#22312;&#25253;&#21578;&#25551;&#36848;&#31526;&#37324;&#38754;&#23450;&#20041;&#25110;&#32773;&#32452;&#21512;&#29305;&#23450;&#31867;&#22411;&#30340;&#25968;&#25454;&#22495; </font>
    </p>
    <p>
      &#26377;&#20004;&#31181;&#31867;&#22411;&#30340;Main items: data&#21644;non-data
    </p>
    <p>
      data&#31867;&#22411;&#30340;Main items&#29992;&#20110;&#22312;&#25253;&#21578;&#20869;&#37096;&#21019;&#24314;&#19968;&#20010;&#22495;&#65292;&#24182;&#19988;&#21253;&#21547;Input&#12289;Output&#21644;Feature
    </p>
  </body>
</html></richcontent>
<node CREATED="1590544898607" ID="ID_217469651" MODIFIED="1590545148841">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-main-item.PNG" />
  </body>
</html></richcontent>
<linktarget COLOR="#ff0033" DESTINATION="ID_217469651" ENDARROW="Default" ENDINCLINATION="75;161;" ID="Arrow_ID_788383113" SOURCE="ID_1015479552" STARTARROW="None" STARTINCLINATION="-396;-426;"/>
<node CREATED="1590653709613" ID="ID_2880689" MODIFIED="1590654643573">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Array&#25552;&#20379;&#20102;&#19968;&#31181;&#21487;&#36873;&#30340;&#26041;&#24335;&#65292;&#29992;&#20110;&#25551;&#36848;&#26469;&#33258;&#20110;&#19968;&#32452;buttons&#30340;&#36820;&#22238;&#25968;&#25454;&#12290;
    </p>
    <p>
      &#19981;&#21516;&#20110;&#20026;&#32452;&#20869;&#30340;&#27599;&#19968;&#20010;button&#36820;&#22238;&#19968;&#20010;bit, array&#22312;&#27599;&#19968;&#20010;&#22495;&#37324;&#38754;&#36820;&#22238;&#23545;&#24212;&#20110;&#25353;&#19979;&#30340;
    </p>
    <p>
      button&#30340;&#32034;&#24341;&#21495;&#12290;&#22914;&#26524;&#22312;array &#22495;&#37324;&#38754;&#30340;&#20540;&#36229;&#20986;&#20102;&#35774;&#23450;&#30340;&#33539;&#22260;&#65292;&#35813;&#20540;&#26159;&#34987;&#35748;&#20026;&#27809;&#26377;&#25511;&#21046;&#21151;&#33021;&#30340;&#12290;
    </p>
    <p>
      &#22312;array&#24403;&#20013;&#30340;buttons&#25110;&#32773;keys&#65292;&#22914;&#26524;&#34987;&#21516;&#26102;&#25353;&#19979;&#65292;&#37027;&#20040;&#23601;&#38656;&#35201;&#20351;&#29992;&#22810;&#20010;fileds&#26469;&#36827;&#34892;&#25253;&#21578;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      &#25152;&#20197;Report Count&#34920;&#26126;&#26368;&#22823;&#30340;&#21516;&#27493;&#25511;&#21046;&#25968;&#37327;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#19968;&#20010;keyboard&#21487;&#20197;&#25903;&#25345;&#21516;&#27493;&#25253;&#21578;3&#20010;&#25353;&#38190;&#65292;&#22240;&#27492;&#20351;&#29992;&#19968;&#20010;&#25317;&#26377;3&#20010;8-bti fields&#30340;array(Report Size=8, Report Count=3)
    </p>
    <p>
      &#22312;array&#37324;&#38754;&#30340;&#20803;&#32032;&#30340;&#25968;&#37327;&#35745;&#31639;&#26041;&#24335;&#65306;<b><font color="#0033ff" face="Times New Roman" size="4"><i>&#160; Logical Maximum - Logical Minimum + 1</i></font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1590545046109" ID="ID_1015479552" MODIFIED="1590545155451">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21487;&#20197;&#30475;&#21040;Input&#12289;Output&#12289;Feature&#12289;Collection&#30340;data&#22495;&#30340;&#31532;&#19968;&#20010;&#23383;&#33410;
    </p>
    <p>
      &#30340;&#21508;&#20010;bit&#26159;&#26377;&#24847;&#20041;&#30340;
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ff0033" DESTINATION="ID_217469651" ENDARROW="Default" ENDINCLINATION="75;161;" ID="Arrow_ID_788383113" STARTARROW="None" STARTINCLINATION="-396;-426;"/>
</node>
<node CREATED="1590549915077" ID="ID_332000745" MODIFIED="1590550121255">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Input item&#21644;Output item&#37117;&#21487;&#20197;&#36890;&#36807;control pipe
    </p>
    <p>
      &#30340;Get_Report&#21644;Set_Report&#25509;&#21475;&#33719;&#21462;&#65292;
    </p>
    <p>
      &#20063;&#21487;&#20197;&#36890;&#36807;Interrupt In pipe&#21644;Interrupt Out pipe&#26469;&#33719;&#21462;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590550588909" ID="ID_1706993744" MODIFIED="1590550597412" TEXT="Collection Item&#x7684;&#x7c7b;&#x578b;">
<node CREATED="1590556311529" ID="ID_1187335033" MODIFIED="1590556452432">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="Times New Roman">Physical&#160;&#160;&#160;&#160;0x00 </font>
    </p>
    <p>
      <font face="Times New Roman">Application 0x01 </font>
    </p>
    <p>
      <font face="Times New Roman">Logical&#160;&#160;&#160;&#160;&#160;0x02 </font>
    </p>
    <p>
      <font face="Times New Roman">Report&#160;&#160;&#160;&#160;&#160;&#160;0x03 </font>
    </p>
    <p>
      <font face="Times New Roman">Named Array 0x04 </font>
    </p>
    <p>
      <font face="Times New Roman">Usage Switch 0x05 </font>
    </p>
    <p>
      <font face="Times New Roman">Usage Modifier 0x06 </font>
    </p>
    <p>
      <font face="Times New Roman">Reserved 0x07~0x7F </font>
    </p>
    <p>
      <font face="Times New Roman">Vendor-defined 0x80~0xFF</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1590556637743" ID="ID_1974821000" MODIFIED="1590556961333">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#25152;&#26377;&#20301;&#20110;Collection Item&#21644;End Collection Item&#20043;&#38388;&#30340;Main items&#37117;&#21253;&#21547;&#20110;collection,
    </p>
    <p>
      collection&#21487;&#20197;&#21253;&#21547;&#20854;&#20182;nested collection
    </p>
    <p>
      
    </p>
    <p>
      Collection Item&#19981;&#20135;&#29983;&#25968;&#25454;&#65292;Usage Item&#24517;&#39035;&#36319;&#19968;&#20010;Collection Item&#30456;&#20851;&#32852;&#36215;&#26469;
    </p>
    <p>
      
    </p>
    <p>
      &#22914;&#26524;&#36935;&#21040;&#26410;&#30693;&#31867;&#22411;&#30340;collection, &#37027;&#20040;&#35813;collection&#37324;&#38754;&#25152;&#26377;&#30340;main item&#37117;&#20250;&#34987;&#24573;&#30053;&#65292;&#20294;&#26159;&#37324;&#38754;&#30340;
    </p>
    <p>
      global item&#20250;&#24433;&#21709;&#29366;&#24577;&#34920;
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1590558786170" ID="ID_303338633" MODIFIED="1590558965654">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman">Usage page + Usage ID &#32452;&#21512;&#36215;&#26469;&#24418;&#25104;&#20102;32bit&#30340;usage </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">Usage page &#26159;16bit </font>
    </p>
    <p>
      <font size="4" face="Times New Roman">Usage ID&#160;&#160;&#160;&#160;&#160;&#160;&#26159;16bit</font>
    </p>
    <p>
      &#160;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590559037794" ID="ID_481523776" MODIFIED="1590559047683">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-usage-page-01.PNG" />
  </body>
</html></richcontent>
</node>
<node CREATED="1590559050890" ID="ID_291325574" MODIFIED="1590559057165">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-usagepage-02.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1590484610915" ID="ID_1859585255" MODIFIED="1590484948291">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20351;&#29992;HID Descriptor Tool &#21487;&#20197;&#24555;&#36895;&#21046;&#20316;HID&#25253;&#21578;&#25551;&#36848;&#31526;&#65292;
    </p>
    <p>
      HID&#25253;&#21578;&#25551;&#36848;&#31526;&#30340;&#27599;&#19968;&#39033;&#26159;&#19968;&#20010;item&#65292;&#20030;&#20010;&#20363;&#23376;
    </p>
    <p>
      
    </p>
    <p>
      0x05, 0x01 (USAGE_PAGE Generic Desktop)
    </p>
    <p>
      
    </p>
    <p>
      0x05 = 0b00000101 &#21363;&#34920;&#31034;item tag&#26159;0000&#65292; item type&#26159;Global, item size&#26159;1
    </p>
    <p>
      0x01&#30340;&#24847;&#20041;&#21487;&#20197;&#21442;&#32771;Universal Serial Bus HID Usage Table.pdf
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1590491311683" ID="ID_1754188773" MODIFIED="1590491561728">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#19968;&#20010;&#25253;&#21578;&#25551;&#36848;&#31526;&#21487;&#33021;&#20250;&#21253;&#21547;&#20960;&#20010;Main items, &#19968;&#20010;&#25253;&#21578;&#25551;&#36848;&#31526;&#24517;&#39035;&#21253;&#21547;&#19979;&#38754;&#30340;
    </p>
    <p>
      items&#26469;&#25551;&#36848;&#35774;&#22791;&#30340;&#25968;&#25454;
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman" size="4"><i>Input (Output or Feature) </i></font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman" size="4"><i>Usage </i></font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman" size="4"><i>Usage Page </i></font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman" size="4"><i>Logical Minimum </i></font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman" size="4"><i>Logical Maximum </i></font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman" size="4"><i>Report Size </i></font>
    </p>
    <p>
      <font color="#ff0033" face="Times New Roman" size="4"><i>Report Count</i></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1590492008763" ID="ID_272920320" MODIFIED="1590492136851">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#36825;&#37324;&#25552;&#20379;&#19968;&#20010;&#25551;&#36848;&#31526;&#30340;&#20195;&#30721;&#20363;&#23376;&#65292;
    </p>
    <p>
      &#36825;&#37324;&#25552;&#20379;&#30340;&#26159;Global item, &#29992;&#26469;&#25551;&#36848;&#19968;&#20010;3&#25353;&#38190;&#30340;&#40736;&#26631;&#65292;
    </p>
    <p>
      Global item&#26159;&#32039;&#36319;&#22312;Main item&#21518;&#38754;&#30340;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590492180566" ID="ID_1593170899" MODIFIED="1590492188846">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-report-description.PNG" />
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1590492336341" ID="ID_1217064548" MODIFIED="1590492539564">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Usage&#26159;&#29992;&#20110;&#35782;&#21035;hid&#25253;&#21578;&#24403;&#20013;data&#37096;&#20998;&#30340;&#24847;&#20041;&#30340;&#65292;
    </p>
    <p>
      Usage&#20063;&#21487;&#20197;&#34987;&#29992;&#20110;&#19968;&#32452;data items&#30340;&#24847;&#20041;&#65292;&#36825;&#26159;&#36890;&#36807;&#19968;&#31181;&#23618;&#27425;&#24615;&#30340;&#23558;usage&#20449;&#24687;&#36171;&#20540;
    </p>
    <p>
      &#32473;collections&#26469;&#23436;&#25104;&#30340;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1590566219191" ID="ID_1176555969" MODIFIED="1592450737098">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#31532;&#19971;&#31456; Request
    </p>
  </body>
</html></richcontent>
<node CREATED="1590567366906" ID="ID_905192057" MODIFIED="1590577561987" TEXT="Standard Requests">
<arrowlink COLOR="#ff0000" DESTINATION="ID_1380168016" ENDARROW="None" ENDINCLINATION="229;368;" ID="Arrow_ID_1769105816" STARTARROW="None" STARTINCLINATION="8099;0;"/>
<node CREATED="1590567385801" ID="ID_1861863409" MODIFIED="1590568054961">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      HID class&#20351;&#29992;&#26631;&#20934;&#35831;&#27714;Get_Description
    </p>
    <p>
      
    </p>
    <p>
      &#24403; Get_Description(Configuration)&#34987;&#35843;&#29992;&#20043;&#21518;&#65292;&#23427;&#20250;&#36820;&#22238;&#37197;&#32622;&#25551;&#36848;&#31526;&#12289;&#25152;&#26377;&#30340;&#25509;&#21475;&#25551;&#36848;&#31526;&#12289;&#25152;&#26377;&#30340;&#31471;&#28857;&#25551;&#36848;&#31526;&#20197;&#21450;
    </p>
    <p>
      &#23545;&#24212;&#20110;&#27599;&#20010;&#25509;&#21475;&#30340;HID&#25551;&#36848;&#31526;&#65292;&#20005;&#31105;&#36820;&#22238;string&#25551;&#36848;&#31526;&#12289;hid&#25253;&#21578;&#25551;&#36848;&#31526;&#25110;&#32773;&#20219;&#20309;&#21487;&#36873;&#30340;hid class&#25551;&#36848;&#31526;&#12290;
    </p>
    <p>
      HID&#25551;&#36848;&#31526;&#26159;&#25554;&#20837;&#21040;&#25509;&#21475;&#25551;&#36848;&#31526;&#20043;&#21518;&#30340;&#65292;&#22914;&#19979;&#38754;&#25152;&#31034;
    </p>
    <p>
      
    </p>
    <p>
      <font face="Times New Roman"><i>Configuration descriptor </i></font>
    </p>
    <p>
      <font face="Times New Roman"><i>&#160;&#160;&#160;&#160;Interface descriptor (specifying HID Class) </i></font>
    </p>
    <p>
      <font face="Times New Roman"><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;HID descriptor (associated with above Interface) </i></font>
    </p>
    <p>
      <font face="Times New Roman"><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Endpoint descriptor (for HID Interrupt In Endpoint) </i></font>
    </p>
    <p>
      <font face="Times New Roman"><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Optional Endpoint descriptor (for HID Interrupt Out Endpoint)</i></font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1590635521075" ID="ID_1991850945" MODIFIED="1590635532437" TEXT="&#x8ddf;class&#x76f8;&#x5173;&#x7684;&#x5177;&#x4f53;&#x8bf7;&#x6c42;">
<node CREATED="1590635598198" ID="ID_1982343548" MODIFIED="1590658224135">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-class&#x5c42;&#x9762;&#x7684;get_report&#x8c03;&#x7528;.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1590636459554" ID="ID_544280071" MODIFIED="1592450724155" TEXT="&#x7b2c;&#x516b;&#x7ae0; Report Protocol">
<node CREATED="1590636529606" ID="ID_1199150114" MODIFIED="1590652105053">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#32508;&#36848;
    </p>
    <p>
      
    </p>
    <p>
      Reports&#21253;&#21547;&#26469;&#33258;&#20110;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;items&#30340;&#25968;&#25454;&#12290;&#25968;&#25454;&#20256;&#36755;&#20197;reports&#30340;&#24418;&#24335;&#36890;&#36807;&#20013;&#26029;In&#31471;&#21475;&#65292;
    </p>
    <p>
      &#20174;&#35774;&#22791;&#21457;&#36865;&#21040;host&#12290;Reports&#21487;&#33021;&#20250;&#36890;&#36807;control pipe&#34987;&#35831;&#27714;&#21644;&#21457;&#36865;&#65292;&#20063;&#21487;&#20197;&#21487;&#36873;&#22320;&#36890;&#36807;&#20013;&#26029;out&#31471;&#21475;
    </p>
    <p>
      &#36827;&#34892;&#21457;&#36865;&#12290;
    </p>
    <p>
      &#24212;&#29992;&#36719;&#20214;&#36127;&#36131;&#22522;&#20110;report&#25551;&#36848;&#31526;&#26469;&#35299;&#20986;&#27599;&#20010;&#29420;&#31435;&#30340;item
    </p>
    <p>
      
    </p>
    <p>
      Item data&#20250;&#34987;&#39034;&#24207;&#25490;&#21015;&#36215;&#26469;&#65292;&#23601;&#20687;items&#22312;report&#25551;&#36848;&#31526;&#37324;&#38754;&#25490;&#21015;&#30340;&#37027;&#26679;
    </p>
  </body>
</html></richcontent>
<node CREATED="1590658087675" ID="ID_390783073" MODIFIED="1590658104126">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="usb/hid-report-example.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1590708897277" ID="ID_309514240" MODIFIED="1590708917152">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21442;&#32771;&#36164;&#26009;&#65306;
    </p>
    <p>
      <a http-equiv="content-type" content="text/html; charset=utf-8" href="http://www.suoniao.com/article/41038">http://www.suoniao.com/article/41038</a>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1582681542935" FOLDED="true" ID="ID_1319645320" MODIFIED="1594781611306">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#ff0033">UVC&#21327;&#35758;&#23398;&#20064;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1582681649472" FOLDED="true" ID="ID_1282617983" MODIFIED="1594781610399" TEXT="&#x4e00;&#x3001;&#x7f51;&#x7edc;&#x8d44;&#x6599;&#x5b66;&#x4e60;">
<node CREATED="1582681713795" FOLDED="true" ID="ID_166431576" MODIFIED="1594781608920">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20197;&#19979;&#23398;&#20064;&#24635;&#32467;&#26469;&#33258;&#20110;&#32593;&#32476;&#38142;&#25509;
    </p>
    <p>
      <a href="https://blog.csdn.net/go_str/article/details/80844175">https://blog.csdn.net/go_str/article/details/80844175</a>
    </p>
  </body>
</html></richcontent>
<node CREATED="1582681778697" ID="ID_271383624" MODIFIED="1582681857594">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20855;&#26377;uvc&#21151;&#33021;&#30340;&#35270;&#39057;&#35774;&#22791;&#38656;&#35201;&#20004;&#31181;&#25509;&#21475;&#65292;&#19968;&#31181;&#26159;&#35270;&#39057;&#25511;&#21046;&#25509;&#21475;VC Interface&#65292;
    </p>
    <p>
      &#21478;&#19968;&#31181;&#26159;&#35270;&#39057;&#27969;&#25509;&#21475;VS Interface
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1582681871427" FOLDED="true" ID="ID_1051944900" MODIFIED="1594781607548">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      UVC&#30340;&#20027;&#35201;&#30340;&#35774;&#22791;&#32452;&#25104;
    </p>
    <p>
      
    </p>
    <p>
      Input Terminal
    </p>
    <p>
      Output Terminal
    </p>
    <p>
      Camera Terminal
    </p>
    <p>
      Selector Unit
    </p>
    <p>
      Processing Unit
    </p>
    <p>
      Extension Unit
    </p>
  </body>
</html></richcontent>
<node CREATED="1582682092564" ID="ID_1152274431" MODIFIED="1582682135390">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/uvc-camera-topology.png" />
  </body>
</html></richcontent>
</node>
<node CREATED="1582700849140" ID="ID_1015738720" MODIFIED="1582701153099">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Unit&#35268;&#23450;&#26377;&#19968;&#20010;&#25110;&#32773;&#22810;&#20010;&#20837;&#21475;&#65292;&#32780;&#20986;&#21475;&#21482;&#33021;&#26377;&#19968;&#20010;
    </p>
    <p>
      &#35268;&#33539;1.5&#24403;&#20013;&#23450;&#20041;&#20102;&#22235;&#31181;unit
    </p>
    <p>
      Selector Unit &#25511;&#21046;&#22270;&#20687;&#25968;&#25454;&#37319;&#38598;&#28304;&#30340;&#20999;&#25442;&#21644;&#36873;&#25321;
    </p>
    <p>
      Processing Unit &#23545;&#37319;&#38598;&#22270;&#20687;&#25968;&#25454;&#36827;&#34892;&#21152;&#24037;
    </p>
    <p>
      Encode Unit
    </p>
    <p>
      Extension Unit &#20026;&#29305;&#23450;&#20379;&#24212;&#21830;&#25552;&#20379;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1582681663964" ID="ID_1779716478" MODIFIED="1582681676718" TEXT="&#x4e8c;&#x3001;&#x534f;&#x8bae;&#x6587;&#x6863;&#x5b66;&#x4e60;"/>
<node CREATED="1582681680739" ID="ID_1406732789" MODIFIED="1582681689365" TEXT="&#x4e09;&#x3001;&#x9a71;&#x52a8;&#x4ee3;&#x7801;&#x5b66;&#x4e60;"/>
<node CREATED="1582681693454" ID="ID_1682288860" MODIFIED="1582681703079" TEXT="&#x56db;&#x3001;android hal&#x5c42;&#x4ee3;&#x7801;&#x5b66;&#x4e60;"/>
</node>
<node CREATED="1583807347078" FOLDED="true" ID="ID_1782104180" MODIFIED="1602667554980">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="5"><b>type-c&#25509;&#21475;</b></font>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="16"/>
<node CREATED="1583811492711" FOLDED="true" ID="ID_1770181570" MODIFIED="1602667553714" TEXT="&#x63a5;&#x53e3;&#x7269;&#x7406;Pin&#x5b9a;&#x4e49;">
<node CREATED="1583811504680" FOLDED="true" ID="ID_417028225" MODIFIED="1597301956353">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/type-c_receptable_pin_definition.PNG" />
  </body>
</html></richcontent>
<node CREATED="1584582689899" ID="ID_1861607838" MODIFIED="1584582970450">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      SBU&#22312;DP&#21327;&#35758;&#24403;&#20013;&#20250;&#34987;&#29992;&#20316;AUX channel&#65292;&#35813;&#21322;&#21452;&#24037;&#30340;channel&#26159;&#29992;&#20110;&#25658;&#24102;&#38500;video&#20449;&#21495;&#20043;&#22806;&#30340;
    </p>
    <p>
      &#20854;&#20182;&#20449;&#21495;&#30340;&#65292;&#21253;&#25324;audio, EDID, HDCP, touchscreen data&#31561;&#31561;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584583755869" ID="ID_48784288" MODIFIED="1584583793253">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/typec-to-dp.png" />
  </body>
</html></richcontent>
</node>
<node CREATED="1587544040022" ID="ID_1784887271" MODIFIED="1587544155470">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      CC&#33050;&#38500;&#20102;&#21487;&#20197;&#29992;&#26469;&#20915;&#23450;cable orientation, &#36824;&#21487;&#20197;&#29992;&#26469;&#20256;&#36755;Standard IDentification(SID), &#35813;SID
    </p>
    <p>
      &#29992;&#26469;&#21327;&#21830;&#35774;&#22791;&#25903;&#25345;&#21738;&#20123;&#20449;&#21495;&#20197;&#21450;&#21738;&#20123;&#20449;&#21495;&#23558;&#34987;&#20351;&#29992;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1583811529378" ID="ID_636783228" MODIFIED="1602553938927">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/440px-USB_Type-C_Receptacle_Pinout.svg.png" />
  </body>
</html></richcontent>
</node>
<node CREATED="1583812309352" ID="ID_1624487073" MODIFIED="1583812317044">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/440px-USB_Type-C_plug_pinout.svg.png" />
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1475896151069" FOLDED="true" ID="ID_1362020755" MODIFIED="1598863509472" POSITION="left" TEXT="&#x7535;&#x6e90;&#x7ba1;&#x7406;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1475999878646" FOLDED="true" ID="ID_1055025927" MODIFIED="1499823186488">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e10505">Generic PM</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1475999888353" FOLDED="true" ID="ID_803433592" MODIFIED="1499823181219" TEXT="suspend&#x8fc7;&#x7a0b;">
<node CREATED="1475999900201" ID="ID_1184571104" MODIFIED="1476064570971">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>Linux&#x5185;&#x6838;&#x63d0;&#x4f9b;&#x4e86;&#x4e09;&#x79cd;suspend:</i></b>
    </p>
    <p>
      Freeze
    </p>
    <p>
      Standby
    </p>
    <p>
      STR(suspend to ram)
    </p>
    <p>
      &#x6d89;&#x53ca;&#x5230;&#x7684;&#x6a21;&#x5757;&#x6709;:
    </p>
    <p>
      <font color="#dc0a0a"><i>PM Core. Device PM. &#x5404;&#x4e2a;&#x8bbe;&#x5907;&#x7684;&#x9a71;&#x52a8; </i></font>
    </p>
    <p>
      <font color="#dc0a0a"><i>Platform dependent PM. CPU control</i></font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1475999973409" FOLDED="true" ID="ID_191845463" MODIFIED="1499823177933">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5185;&#x6838;suspend&#x7684;&#x51e0;&#x5927;&#x6a21;&#x5757;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1476000767394" ID="ID_704336645" MODIFIED="1482854908105">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#e10a0a"><i>PM Core----&#x4e3b;&#x8981;&#x7684;&#x4ee3;&#x7801;&#x4f4d;&#x7f6e;</i></font></b>
    </p>
    <p>
      kernel/power/main.c &#x63d0;&#x4f9b;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x63a5;&#x53e3;/sys/power/state
    </p>
    <p>
      kernel/power/suspend.c suspend&#x529f;&#x80fd;&#x7684;&#x4e3b;&#x8981;&#x903b;&#x8f91;
    </p>
    <p>
      kernel/power/console.c suspend&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x5bf9;&#x63a7;&#x5236;&#x53f0;&#x7684;&#x5904;&#x7406;&#x903b;&#x8f91;
    </p>
    <p>
      kernel/power/process.c suspend&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x5bf9;&#x8fdb;&#x7a0b;&#x7684;&#x5904;&#x7406;&#x903b;&#x8f91;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476001101330" FOLDED="true" ID="ID_771430393" MODIFIED="1499823173137">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#de0505"><i>Device Pm </i></font>
    </p>
    <p>
      <font color="#0c0b1a"><i>Device Power Manager Interface</i></font>
    </p>
    <p>
      &#x5b9a;&#x4e49;device pm&#x76f8;&#x5173;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;&#xff0c;&#x8ba9;&#x9a71;&#x52a8;&#x51fd;&#x6570;&#x5b9e;&#x73b0;&#xff0c;
    </p>
    <p>
      &#x5b9e;&#x73b0;&#x7edf;&#x4e00;&#x7684;pm&#x64cd;&#x4f5c;&#x51fd;&#x6570;&#xff0c;&#x4f9b;pm&#x6838;&#x5fc3;&#x8c03;&#x7528;
    </p>
    <p>
      Interface&#x7684;&#x4ee3;&#x7801;&#x5b9e;&#x73b0;&#x4e8e;&#x201c;include/linux/pm.h&#x201d;&#x3001;&#x201c;drivers/base/power/main.c&#x201d;
    </p>
  </body>
</html></richcontent>
<node CREATED="1476064615323" FOLDED="true" ID="ID_1113783024" MODIFIED="1499823170149">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      device pm callbacks
    </p>
    <p>
      &#x6700;&#x65b0;&#x7684;&#x5185;&#x6838;&#x4ee3;&#x7801;&#x5c06;&#x8bbe;&#x5907;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x76f8;&#x5173;&#x7684;&#x51fd;&#x6570;&#x7edf;&#x4e00;
    </p>
    <p>
      &#x5c01;&#x88c5;&#x5230;&#x7ed3;&#x6784;&#x4f53;struct dev_pm_ops&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
<node CREATED="1482767397879" FOLDED="true" ID="ID_185471824" MODIFIED="1499823165452">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5185;&#x6838;&#x4e3a;&#x4e86;&#x65b9;&#x4fbf;&#x5bf9;device pm callback
    </p>
    <p>
      &#x51fd;&#x6570;&#x8fdb;&#x884c;&#x64cd;&#x4f5c;&#xff0c;&#x5b9a;&#x4e49;&#x4e86;&#x5927;&#x91cf;&#x7684;&#x8f85;&#x52a9;&#x51fd;&#x6570;&#x3002;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x51fd;&#x6570;&#x5728;&#x603b;&#x4f53;&#x4e0a;&#x53ef;&#x4ee5;&#x5206;&#x6210;&#x4e24;&#x7c7b;
    </p>
  </body>
</html></richcontent>
<node CREATED="1482767468839" ID="ID_1157036342" MODIFIED="1482767815075">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x8f85;&#x52a9;&#x6027;&#x8d28;&#x7684;API,&#x8fd9;&#x4e9b;API&#x76f4;&#x63a5;&#x8c03;&#x7528;&#x8bbe;&#x5907;&#x6240;&#x7ed1;&#x5b9a;&#x7684;
    </p>
    <p>
      driver&#x5f53;&#x4e2d;&#x7684;pm&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#x8bbe;&#x7f6e;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x3002;
    </p>
    <p>
      extern int pm_generic_prepare(struct device *dev);
    </p>
    <p>
      extern int pm_generic_suspend_late(struct device *dev);
    </p>
    <p>
      extern int pm_generic_suspend_noirq(struct device *dev);
    </p>
    <p>
      extern int pm_generic_suspend(struct device *dev);
    </p>
    <p>
      extern int pm_generic_resume_early(struct device *dev);
    </p>
    <p>
      extern int pm_generic_resume_noirq(struct device *dev);
    </p>
    <p>
      extern int pm_generic_resume(struct device *dev);
    </p>
    <p>
      extern int pm_generic_freeze_noirq(struct device *dev);
    </p>
    <p>
      extern int pm_generic_freeze_late(struct device *dev);
    </p>
    <p>
      extern int pm_generic_freeze(struct device *dev);
    </p>
    <p>
      extern int pm_generic_thaw_noirq(struct device *dev);
    </p>
    <p>
      extern int pm_generic_thaw_early(struct device *dev);
    </p>
    <p>
      extern int pm_generic_thaw(struct device *dev);
    </p>
    <p>
      extern int pm_generic_restore_noirq(struct device *dev);
    </p>
    <p>
      extern int pm_generic_restore_early(struct device *dev);
    </p>
    <p>
      extern int pm_generic_restore(struct device *dev);
    </p>
    <p>
      extern int pm_generic_poweroff_noirq(struct device *dev);
    </p>
    <p>
      extern int pm_generic_poweroff_late(struct device *dev);
    </p>
    <p>
      extern int pm_generic_poweroff(struct device *dev);
    </p>
    <p>
      extern void pm_generic_complete(struct device *dev);
    </p>
    <p>
      extern void pm_complete_with_resume_check(struct device *dev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1482767857788" ID="ID_1707369280" MODIFIED="1482768083279">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x8ddf;&#x6574;&#x4f53;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x884c;&#x4e3a;&#x76f8;&#x5173;&#x7684;API&#xff0c;&#x8fd9;&#x7c7b;API
    </p>
    <p>
      &#x7684;&#x76ee;&#x7684;&#x5c31;&#x662f;&#x5c06;&#x5404;&#x4e2a;&#x72ec;&#x7acb;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x884c;&#x4e3a;&#x7ec4;&#x5408;&#x8d77;&#x6765;&#xff0c;&#x7ec4;&#x6210;&#x4e00;&#x4e2a;&#x8f83;&#x4e3a;&#x5b8c;&#x6574;&#x7684;&#x529f;&#x80fd;&#x3002;
    </p>
    <p>
      <font color="#e52908"><i>extern void device_pm_lock(void); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern void dpm_resume_start(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern void dpm_resume_end(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern void dpm_resume_noirq(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern void dpm_resume_early(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern void dpm_resume(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern void dpm_complete(pm_message_t state); </i></font>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#e52908"><i>extern void device_pm_unlock(void); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern int dpm_suspend_end(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern int dpm_suspend_start(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern int dpm_suspend_noirq(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern int dpm_suspend_late(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern int dpm_suspend(pm_message_t state); </i></font>
    </p>
    <p>
      <font color="#e52908"><i>extern int dpm_prepare(pm_message_t state);</i></font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1482486666181" ID="ID_1414779687" MODIFIED="1486971400853">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#ef0303">struct device { </font></i>
    </p>
    <p>
      
    </p>
    <p>
      <i><font color="#ef0303">struct dev_pm_info&#xa0;&#xa0;power; </font></i>
    </p>
    <p>
      <i><font color="#ef0303">struct dev_pm_domain&#xa0;&#xa0;&#xa0;&#xa0;*pm_domain; </font></i>
    </p>
    <p>
      
    </p>
    <p>
      <i><font color="#ef0303">}</font></i>
    </p>
    <p>
      power&#x5b57;&#x6bb5;&#x4e3b;&#x8981;&#x662f;&#x8bb0;&#x5f55;&#x5f53;&#x524d;&#x8bbe;&#x5907;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;
    </p>
    <p>
      struct dev_pm_info {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;pm_message_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;power_state;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0; <b>unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;can_wakeup:1;</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;async_suspend:1;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;bool&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;is_prepared:1;&#xa0;&#xa0;/* Owned by the PM core */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;bool&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;is_suspended:1; /* Ditto */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;bool&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;is_noirq_suspended:1;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;bool&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;is_late_suspended:1;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;..........
    </p>
    <p>
      }
    </p>
    <p>
      can_wakeup&#x5b57;&#x6bb5;&#x4e3b;&#x8981;&#x662f;&#x7528;&#x4e8e;&#x8bb0;&#x5f55;&#x5185;&#x6838;&#x662f;&#x5426;&#x5141;&#x8bb8;&#x8be5;&#x8bbe;&#x5907;&#x51fa;&#x53d1;&#x5524;&#x9192;&#x4e8b;&#x4ef6;&#x6216;&#x8005;&#x662f;&#x5426;
    </p>
    <p>
      &#x5141;&#x8bb8;&#x8be5;&#x8bbe;&#x5907;&#x6253;&#x65ad;suspend to ram&#x7684;&#x6d41;&#x7a0b;
    </p>
    <p>
      
    </p>
    <p>
      struct dev_pm_domain {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct dev_pm_ops&#xa0;&#xa0;&#xa0;ops;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void (*detach)(struct device *dev, bool power_off);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int (*activate)(struct device *dev);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void (*sync)(struct device *dev);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void (*dismiss)(struct device *dev);
    </p>
    <p>
      };&#xa0;
    </p>
    <p>
      &#x5728;linux&#x5f53;&#x4e2d;&#xff0c;&#x662f;&#x5141;&#x8bb8;&#x6ca1;&#x6709;&#x9a71;&#x52a8;&#x7684;&#x8bbe;&#x5907;&#x5b58;&#x5728;&#x7684;&#xff0c;&#x5bf9;&#x8fd9;&#x4e00;&#x7c7b;&#x7684;&#x8bbe;&#x5907;&#x6765;&#x8bf4;&#xff0c;
    </p>
    <p>
      pm_domain&#x4f1a;&#x5bf9;&#x5b83;&#x8fdb;&#x884c;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7684;&#x64cd;&#x4f5c;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1482853604696" ID="ID_1065280956" MODIFIED="1482854886513">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#db0707"><i>&#x5e73;&#x53f0;&#x76f8;&#x5173;&#x7684;PM</i></font></b>
    </p>
    <p>
      include/linux/suspend.h----&#x5b9a;&#x4e49;platform dependent PM&#x6709;&#x5173;&#x7684;&#x64cd;&#x4f5c;&#x51fd;&#x6570;&#x96c6;
    </p>
    <p>
      arch/xxx/mach-xxx/xxx.c&#x6216;&#x8005;
    </p>
    <p>
      arch/xxx/plat-xxx/xxx.c----&#x5e73;&#x53f0;&#x76f8;&#x5173;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x64cd;&#x4f5c;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1483238846872" FOLDED="true" ID="ID_1084913528" MODIFIED="1499823158324" TEXT="suspend&#x4ee3;&#x7801;&#x5206;&#x6790;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1483349770591" ID="ID_354720761" MODIFIED="1483349790780" TEXT="1.suspend&#x6d41;&#x7a0b;&#x56fe;&#xff0c;&#x89c1;UML&#x6587;&#x4ef6;"/>
<node CREATED="1483349794935" FOLDED="true" ID="ID_1784812268" MODIFIED="1499823156626">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.freezing of task
    </p>
    <p>
      &#x8fdb;&#x7a0b;&#x7684;freezing&#x529f;&#x80fd;&#x662f;&#x8fdb;&#x7a0b;&#x7684;suspend,hibernate&#x529f;&#x80fd;&#x7684;&#x4e00;&#x4e2a;&#x7ec4;&#x6210;&#x90e8;&#x5206;&#xff0c;
    </p>
    <p>
      &#x76ee;&#x7684;&#x662f;&#x4e3a;&#x4e86;&#x5728;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#x7684;&#x5207;&#x6362;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#xff0c;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x8fdb;&#x7a0b;&#x548c;&#x5185;&#x6838;&#x7684;
    </p>
    <p>
      &#x90e8;&#x5206;&#x7ebf;&#x7a0b;&#x5904;&#x4e8e;&#x4e00;&#x4e2a;&#x7a33;&#x5b9a;&#x7684;&#x72b6;&#x6001;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1495806429229" ID="ID_1465641167" MODIFIED="1495806563979">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#d30b0b">&#x5728;suspend&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x4f1a;freeze&#x7528;&#x6237;&#x8fdb;&#x7a0b;&#x548c;&#x5185;&#x6838;&#x8fdb;&#x7a0b;&#xff0c; </font></i>
    </p>
    <p>
      <i><font color="#d30b0b">&#x5982;&#x679c;&#x53d1;&#x73b0;&#x5f53;&#x524d;&#x662f;&#x53d1;&#x8d77;suspend&#x7684;&#x8fdb;&#x7a0b;&#xff0c;&#x5219;freeze&#x4f1a;&#x8df3;&#x8fc7;&#x8be5;&#x8fdb;&#x7a0b;&#xff0c; </font></i>
    </p>
    <p>
      <i><font color="#d30b0b">&#x6240;&#x4ee5;&#x53d1;&#x8d77;suspend&#x7684;&#x7528;&#x6237;&#x8fdb;&#x7a0b;&#x6216;&#x8005;&#x5185;&#x6838;&#x7ebf;&#x7a0b;&#x662f;&#x4e0d;&#x4f1a;&#x88ab;&#x51bb;&#x7ed3;&#x7684;</font></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1483356480711" ID="ID_1655803082" MODIFIED="1483356506435">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3. PM notifier&#x7684;&#x7279;&#x6b8a;&#x7528;&#x9014;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1487055830274" FOLDED="true" ID="ID_968320327" MODIFIED="1499823153990" TEXT="&#x5185;&#x6838;Documentation/power/suspend-and-interrupts.txt &#x6587;&#x6863;&#x9605;&#x8bfb;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1487055856874" ID="ID_1731558711" MODIFIED="1487057714580">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x4e2d;&#x65ad;&#x8bf7;&#x6c42;&#x7ebf;&#x5728;&#x7cfb;&#x7edf;suspend&#x671f;&#x95f4;&#x4e00;&#x822c;&#x662f;&#x88ab;&#x7981;&#x7528;&#x7684;&#xff0c; &#x5728;&#x65e9;&#x671f;&#x7684;&#x5185;&#x6838;&#x5904;&#x7406;&#x5f53;&#x4e2d;&#xff0c;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x5f80;&#x5f80;&#x5bf9;&#x5728;&#x8bbe;&#x5907;&#x5df2;&#x7ecf;suspend&#x671f;&#x95f4;&#x53d1;&#x751f;&#x7684;&#x4e2d;&#x65ad;&#x7684;&#x5904;&#x7406;&#x662f;&#x4e0d;&#x5b8c;&#x5584;&#x7684;&#xff0c;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x6709;&#x7684;
    </p>
    <p>
      &#x65f6;&#x5019;&#x4f1a;&#x8bbf;&#x95ee;&#x5df2;&#x7ecf;&#x6302;&#x8d77;&#x7684;&#x8bbe;&#x5907;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#xff0c;&#x8fd9;&#x5f80;&#x5f80;&#x4f1a;&#x5bfc;&#x81f4;&#x4e0d;&#x53ef;&#x9884;&#x77e5;&#x7684;&#x9519;&#x8bef;&#x3002;
    </p>
    <p>
      &#x51fd;&#x6570;<b><i>suspend_device_irqs()</i></b>&#x7684;&#x5f15;&#x7528;&#xff0c;&#x4ee5;&#x53ca;&#x5728;"noirq"&#x671f;&#x95f4;&#x7684;suspend&#x548c;resume&#x4f1a;&#x51cf;&#x8f7b;
    </p>
    <p>
      &#x8fd9;&#x79cd;&#x672a;&#x77e5;&#x7684;&#x9519;&#x8bef;&#x3002;
    </p>
    <p>
      &#x5728;&#x7cfb;&#x7edf;resume&#x671f;&#x95f4;&#x786e;&#x5207;&#x5730;&#x8bf4;&#x662f;&#x5728;&#x8c03;&#x7528;&#x51fd;&#x6570;resume_early&#x4e4b;&#x524d;&#xff0c;&#x8bbe;&#x5907;&#x7684;irq&#x4f1a;&#x88ab;&#x91cd;&#x65b0;&#x4f7f;&#x80fd;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x9879;&#x5de5;&#x4f5c;&#x662f;&#x7531;&#x51fd;&#x6570;<b><i>resume_device_irqs()</i></b>&#x6765;&#x5b8c;&#x6210;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487057722138" ID="ID_1045454357" MODIFIED="1487058365979">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x5728;Linux&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x5b58;&#x5728;&#x7740;&#x4e00;&#x4e9b;&#x4e2d;&#x65ad;&#xff0c;&#x5373;&#x4f7f;&#x662f;&#x5728;&#x6574;&#x4e2a;&#x7cfb;&#x7edf;suspend&#x548c;resume&#x671f;&#x95f4;&#x4e5f;&#x53ef;&#x4ee5;
    </p>
    <p>
      &#x88ab;&#x5408;&#x7406;&#x5730;&#x89e6;&#x53d1;&#xff0c;&#x5305;&#x62ec;suspend&#x7684;"noirq"&#x671f;&#x95f4;&#x548c;&#x8bbe;&#x5907;&#x7684;resume&#x671f;&#x95f4;&#x4ee5;&#x53ca;noboot cpu&#x4e0b;&#x7ebf;&#x548c;
    </p>
    <p>
      &#x4e0a;&#x7ebf;&#x671f;&#x95f4;&#x3002;&#x8fd9;&#x79cd;&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad;&#x9996;&#x5148;&#x4f1a;&#x88ab;&#x4f7f;&#x7528;&#x5230;&#x5b9a;&#x65f6;&#x5668;&#x4e2d;&#x65ad;&#x5f53;&#x4e2d;&#xff0c;&#x5176;&#x6b21;&#x4f1a;&#x88ab;&#x5e94;&#x7528;&#x5230;IPIs&#xff0c;&#x548c;&#x4e00;&#x4e9b;
    </p>
    <p>
      &#x7279;&#x6b8a;&#x7528;&#x9014;&#x7684;&#x4e2d;&#x65ad;&#x4e0a;&#x3002;
    </p>
    <p>
      &#x5f53;&#x6211;&#x4eec;&#x4f7f;&#x7528;<b>IRQF_NO_SUSPEND</b>&#x6807;&#x5fd7;&#x6765;&#x7533;&#x8bf7;&#x4e2d;&#x65ad;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x53ef;&#x4ee5;&#x4fdd;&#x8bc1;suspend_device_irqs()
    </p>
    <p>
      &#x5728;&#x6267;&#x884c;&#x671f;&#x95f4;&#x4ecd;&#x7136;&#x4f7f;&#x80fd;&#x5bf9;&#x5e94;&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x5e76;&#x4e14;&#x53ef;&#x4ee5;&#x4fdd;&#x8bc1;&#x8be5;&#x4e2d;&#x65ad;&#x5728;suspend-resume&#x5468;&#x671f;&#x5f53;&#x4e2d;&#x53ef;&#x4ee5;&#x6b63;&#x5e38;
    </p>
    <p>
      &#x5de5;&#x4f5c;&#xff0c;&#x4f46;&#x662f;&#x4e0d;&#x80fd;&#x4fdd;&#x8bc1;&#x8be5;&#x4e2d;&#x65ad;&#x53ef;&#x4ee5;&#x5c06;&#x7cfb;&#x7edf;&#x4ece;suspended&#x72b6;&#x6001;&#x5f53;&#x4e2d;&#x5524;&#x9192;&#x3002;&#x5982;&#x679c;&#x5e0c;&#x671b;&#x4e2d;&#x65ad;&#x53ef;&#x4ee5;&#x5c06;&#x7cfb;&#x7edf;
    </p>
    <p>
      &#x4ece;suspended&#x72b6;&#x6001;&#x5524;&#x9192;&#xff0c;&#x90a3;&#x4e48;&#x9700;&#x8981;&#x8c03;&#x7528;<b>enable_irq_wake()</b>&#x51fd;&#x6570;&#x3002;&#x7531;&#x4e8e;IRQF_NO_SUSPEND
    </p>
    <p>
      &#x6807;&#x5fd7;&#x662f;&#x5168;&#x5c40;&#x6027;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x5e94;&#x5f53;&#x7981;&#x6b62;&#x628a;&#x8be5;&#x6807;&#x5fd7;&#x4e0e;IRQF_SHARED&#x6807;&#x5fd7;&#x540c;&#x65f6;&#x4f7f;&#x7528;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487058369706" ID="ID_1685871924" MODIFIED="1487059723486">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x7cfb;&#x7edf;&#x7ea7;&#x7684;&#x5524;&#x9192;&#x4e2d;&#x65ad;enable_irq_wake() &#x548c; disable_irq_wake()
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x5524;&#x9192;&#x4e2d;&#x65ad;&#x901a;&#x5e38;&#x9700;&#x8981;&#x88ab;&#x914d;&#x7f6e;&#x7528;&#x6765;&#x5bf9;&#x5904;&#x4e8e;sleep&#x72b6;&#x6001;&#x7684;&#x7cfb;&#x7edf;&#x8fdb;&#x884c;&#x5524;&#x9192;&#x52a8;&#x4f5c;&#xff0c;&#x8fd9;&#x53ef;&#x80fd;
    </p>
    <p>
      &#x9700;&#x8981;&#x6253;&#x5f00;&#x5e73;&#x53f0;&#x76f8;&#x5173;&#x7684;&#x7279;&#x6b8a;&#x7684;&#x5904;&#x7406;&#x903b;&#x8f91;&#xff0c;&#x8fd9;&#x6837;&#x4e2d;&#x65ad;&#x4fe1;&#x53f7;&#x53ef;&#x4ee5;&#x5728;&#x7cfb;&#x7edf;&#x7761;&#x7720;&#x671f;&#x95f4;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;
    </p>
    <p>
      &#x4e0d;&#x540c;&#x7684;&#x8def;&#x5f84;&#x88ab;&#x8def;&#x7531;&#x3002;&#x6bd4;&#x5982;&#x5e73;&#x53f0;&#x53ef;&#x80fd;&#x4f1a;&#x6709;&#x4e00;&#x4e2a;&#x7279;&#x5b9a;&#x7684;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x5668;&#x7528;&#x6765;&#x5904;&#x7406;&#x5524;&#x9192;&#x4e2d;&#x65ad;&#x3002;
    </p>
    <p>
      linux&#x7cfb;&#x7edf;&#x63d0;&#x4f9b;&#x4e86;&#x4e24;&#x4e2a;&#x5e2e;&#x52a9;&#x51fd;&#x6570;&#x7528;&#x6765;&#x6253;&#x5f00;&#x5e73;&#x53f0;&#x76f8;&#x5173;&#x7684;&#x7279;&#x6b8a;&#x7684;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x903b;&#x8f91;&#xff0c;&#x8fd9;&#x4e24;&#x4e2a;&#x51fd;&#x6570;&#x5206;&#x522b;&#x662f;
    </p>
    <p>
      <b><i>enable_irq_wake()&#x548c;disable_irq_wake()</i></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487059728421" ID="ID_865688034" MODIFIED="1487060436478">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      4. &#x4e2d;&#x65ad;&#x548c;suspend-to-idle
    </p>
    <p>
      Suspend-to-idle(&#x5373;freeze&#x72b6;&#x6001;)&#x662f;&#x4e00;&#x79cd;&#x6bd4;&#x8f83;&#x65b0;&#x5f15;&#x8fdb;&#x7684;&#x7cfb;&#x7edf;&#x7761;&#x7720;&#x72b6;&#x6001;&#xff0c;&#x5373;&#x5728;noirq&#x9636;&#x6bb5;&#x4e4b;&#x540e;
    </p>
    <p>
      &#x6240;&#x6709;&#x7684;&#x5904;&#x7406;&#x5668;&#x5904;&#x4e8e;idle&#x72b6;&#x6001;&#xff0c;&#x7b49;&#x5f85;&#x4e2d;&#x65ad;&#x3002;&#x8fd9;&#x5c31;&#x610f;&#x5473;&#x7740;&#x6240;&#x6709;&#x5e26;&#x6709;IRQF_NO_SUSPEND&#x6807;&#x5fd7;&#x7684;&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x5c06;&#x5904;&#x7406;&#x5668;&#x8131;&#x79bb;idle&#x72b6;&#x6001;&#xff0c;&#x4f46;&#x662f;&#x4e0d;&#x80fd;&#x8ba9;IRQ subsystem&#x5524;&#x9192;&#x6574;&#x4e2a;&#x7cfb;&#x7edf;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487060441013" ID="ID_403985166" MODIFIED="1487061005981">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      4.IRQF_NO_SUSPEND &#x548c; enable_irq_wake()
    </p>
    <p>
      &#x51e0;&#x4e4e;&#x6ca1;&#x6709;&#x6709;&#x6548;&#x7684;&#x7406;&#x7531;&#x5728;&#x540c;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#x7ebf;&#x4e0a;&#x540c;&#x65f6;&#x4f7f;&#x7528;IRQF_NO_SUSPEND&#x548c;
    </p>
    <p>
      enabble_irq_wake&#x51fd;&#x6570;&#xff0c;&#x5728;&#x540c;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x4e0a;&#x540c;&#x65f6;&#x4f7f;&#x7528;&#x4ece;&#x6765;&#x90fd;&#x662f;&#x65e0;&#x6548;&#x7684;&#x3002;
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1482849652149" ID="ID_929921751" MODIFIED="1482849668826">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/generic-pm-architecture.gif"/>
  </body>
</html></richcontent>
</node>
<node CREATED="1483282137541" FOLDED="true" ID="ID_1687444721" MODIFIED="1499823184366" TEXT="/sys/power/wakeup_count">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1483282174502" ID="ID_820863831" MODIFIED="1483328734873">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8be5;&#x63a5;&#x53e3;&#x7531;CONFIG_PM_SLEEP&#x5b8f;&#x6765;&#x8fdb;&#x884c;&#x63a7;&#x5236;&#xff0c;&#x5b83;&#x7684;&#x5b58;&#x5728;
    </p>
    <p>
      &#x662f;&#x4e3a;&#x4e86;&#x89e3;&#x51b3;sleep&#x548c;wakeup&#x4e4b;&#x95f4;&#x7684;&#x540c;&#x6b65;&#x95ee;&#x9898;&#x3002;
    </p>
    <p>
      wakeup_count&#x662f;&#x5185;&#x6838;&#x7528;&#x6765;&#x4fdd;&#x5b58;&#x5f53;&#x524d;wakeup event&#x53d1;&#x751f;&#x7684;&#x8ba1;&#x6570;
    </p>
    <p>
      1.&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7a0b;&#x5e8f;&#x5728;&#x5199;&#x5165;state&#x5207;&#x6362;&#x72b6;&#x6001;&#x4e4b;&#x524d;&#xff0c;&#x5e94;&#x8be5;&#x7ebf;&#x8bfb;&#x53d6;wakeup_count&#x503c;
    </p>
    <p>
      &#x5e76;&#x628a;&#x8be5;&#x503c;&#x5199;&#x56de;&#x5230;wakeup_count&#x91cc;&#x9762;&#x53bb;&#x3002;
    </p>
    <p>
      2.&#x5185;&#x6838;&#x4f1a;&#x5bf9;&#x6bd4;&#x5f53;&#x524d;&#x7684;wakeup_count&#x503c;&#x548c;&#x5199;&#x5165;&#x7684;wakeup_count&#x503c;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x4e0d;&#x4e00;&#x6837;&#xff0c;&#x5c31;&#x8bf4;&#x660e;&#x5728;&#x8bfb;&#x53d6;&#x548c;&#x5199;&#x5165;&#x4e4b;&#x95f4;&#x4ea7;&#x751f;&#x4e86;&#x65b0;&#x7684;wakeup event&#x4e8b;&#x4ef6;&#x3002;
    </p>
    <p>
      &#x5185;&#x6838;&#x4f1a;&#x8fd4;&#x56de;&#x9519;&#x8bef;&#x3002;
    </p>
    <p>
      3.&#x5982;&#x679c;&#x5185;&#x6838;&#x6bd4;&#x5bf9;&#x6210;&#x529f;&#xff0c;&#x4f1a;&#x8bb0;&#x5f55;&#x5f53;&#x524d;wakeup_count&#x65f6;&#x7684;event&#x5feb;&#x7167;&#xff0c;
    </p>
    <p>
      &#x540e;&#x9762;&#x8fdb;&#x884c;suspend&#x52a8;&#x4f5c;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f1a;&#x68c0;&#x67e5;&#x662f;&#x5426;&#x548c;&#x5feb;&#x7167;&#x76f8;&#x7b26;&#xff0c;&#x5982;&#x679c;&#x76f8;&#x7b26;&#x5c31;&#x7ee7;&#x7eed;&#x8fdb;&#x884c;
    </p>
    <p>
      suspend&#x7684;&#x52a8;&#x4f5c;&#x3002;
    </p>
    <p>
      4.&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7a0b;&#x5e8f;&#x5728;&#x68c0;&#x6d4b;&#x5230;&#x5199;&#x5165;&#x6ca1;&#x6709;&#x9519;&#x8bef;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5c31;&#x4f1a;&#x5199;&#x5165;state,&#x4ece;&#x800c;&#x5f15;&#x53d1;&#x4e00;&#x6b21;&#x72b6;&#x6001;
    </p>
    <p>
      &#x7684;&#x5207;&#x6362;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1482769214002" FOLDED="true" ID="ID_1092459693" MODIFIED="1499823197060">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x603b;&#x4f53;&#x67b6;&#x6784;.gif"/>
  </body>
</html></richcontent>
<node CREATED="1494648663537" FOLDED="true" ID="ID_1070180731" MODIFIED="1499823195707">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b><font color="#0e956e">syscore</font></b></i>
    </p>
    <p>
      &#x53c2;&#x8003;&#x7f51;&#x7ad9;: http://blog.csdn.net/lixiaojie1012/article/details/45625699
    </p>
    <p>
      syscore&#x662f;&#x4f5c;&#x4e3a;&#x4f4e;&#x529f;&#x8017;&#x6d41;&#x7a0b;&#x7684;&#x4e00;&#x90e8;&#x5206;&#x7684;&#xff0c;&#x6d89;&#x53ca;&#x7684;&#x6587;&#x4ef6;&#x4e3b;&#x8981;&#x6709;
    </p>
    <p>
      syscore_ops.h&#x548c;syscore.c&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x4e00;&#x7ea7;&#x522b;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x662f;&#x5728;&#x5b8c;&#x5168;&#x5c4f;&#x853d;&#x4e2d;&#x65ad;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#x8fdb;&#x884c;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1494648879796" ID="ID_428671027" MODIFIED="1494662811529">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x4e3b;&#x8981;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;
    </p>
    <p>
      struct syscore_ops {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct list_head node;&#x7528;&#x4e8e;&#x94fe;&#x8868;&#x63a7;&#x5236;&#xff0c;&#x6ce8;&#x518c;&#x548c;&#x5220;&#x9664;syscore&#x5bf9;&#x8c61;&#x65f6;&#x64cd;&#x4f5c;&#x6b64;&#x94fe;&#x8868;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int (*suspend)(void); &#x7761;&#x7720;&#x6d41;&#x7a0b;&#x56de;&#x8c03;&#x51fd;&#x6570;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void (*resume)(void); &#x5524;&#x9192;&#x6d41;&#x7a0b;&#x56de;&#x8c03;&#x51fd;&#x6570;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void (*shutdown)(void);&#x7528;&#x4e8e;&#x7cfb;&#x7edf;&#x7ea7;&#x7684;&#x91cd;&#x542f;&#xff0c;&#x505c;&#x6b62;&#x6216;&#x8005;&#x6389;&#x7535;
    </p>
    <p>
      };
    </p>
    <p>
      &#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x662f;syscore&#x64cd;&#x4f5c;&#x7684;&#x5bf9;&#x8c61;&#x7c7b;&#x578b;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494662956993" ID="ID_1863003744" MODIFIED="1494663094540">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x4e3b;&#x8981;&#x7684;&#x63a5;&#x53e3;&#x51fd;&#x6570;
    </p>
    <p>
      void register_syscore_ops(struct syscore_ops *ops)
    </p>
    <p>
      void unregister_syscore_ops(struct syscore_ops *ops)
    </p>
    <p>
      int syscore_suspend(void)
    </p>
    <p>
      void syscore_resume(void)
    </p>
    <p>
      void syscore_shutdown(void)
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1494688976550" ID="ID_33123216" MODIFIED="1494753274315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b><font color="#167284">Wakelock&#x673a;&#x5236; </font></b></i>
    </p>
    <p>
      <font color="#ea0914">http://blog.csdn.net/g_salamander/article/details/7978772</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1483357585049" FOLDED="true" ID="ID_1605872444" MODIFIED="1486974916734">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b><font color="#da1414">wakeup events framework </font></b></i>
    </p>
    <p>
      &#x8981;&#x89e3;&#x51b3;&#x7684;&#x95ee;&#x9898;:
    </p>
    <p>
      system suspend&#x548c;system wakeup events
    </p>
    <p>
      &#x4e4b;&#x95f4;&#x7684;&#x540c;&#x6b65;&#x95ee;&#x9898;
    </p>
  </body>
</html></richcontent>
<node CREATED="1483358003206" ID="ID_978302896" MODIFIED="1486965068810">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ef0303"><i>&#x4e24;&#x79cd;&#x7a7a;&#x95f4;&#x91cc;&#x9762;&#x7684;&#x540c;&#x6b65;:</i></font></b>
    </p>
    <p>
      1.&#x5185;&#x6838;&#x7a7a;&#x95f4;&#x7684;&#x540c;&#x6b65;
    </p>
    <p>
      wake up event&#x4ea7;&#x751f;&#x4e4b;&#x540e;&#xff0c;&#x901a;&#x5e38;&#x662f;&#x4ee5;&#x4e2d;&#x65ad;&#x7684;&#x5f62;&#x5f0f;&#x901a;&#x77e5;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x9a71;&#x52a8;&#xff0c;&#x5728;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x5904;&#x7406;&#x4e2d;&#x65ad;&#x7684;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#xff0c;&#x7cfb;&#x7edf;&#x4e0d;&#x80fd;suspend,
    </p>
    <p>
      &#x82e5;&#x8bbe;&#x5907;&#x4e2d;&#x65ad;&#x88ab;&#x5173;&#x95ed;&#x5219;&#x4e0d;&#x5b58;&#x5728;&#x540c;&#x6b65;&#x95ee;&#x9898;&#x3002;(<b><font color="#e20d0d">framework&#x7684;&#x6838;&#x5fc3;&#x529f;&#x80fd;</font></b>)
    </p>
    <p>
      
    </p>
    <p>
      2.&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x540c;&#x6b65;
    </p>
    <p>
      wake up events&#x88ab;&#x9a71;&#x52a8;&#x5904;&#x7406;&#x4e4b;&#x540e;&#x4f1a;&#x88ab;&#x4e0a;&#x62a5;&#x5230;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#xff0c;&#x8fd9;&#x65f6;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x5904;&#x7406;&#x4e3a;
    </p>
    <p>
      a. &#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7a0b;&#x5e8f;&#x6839;&#x672c;&#x6ca1;&#x6709;&#x88ab;&#x8c03;&#x5ea6;&#xff0c;events&#x65e0;&#x6cd5;&#x88ab;&#x4e0a;&#x62a5;&#x5230;&#x7528;&#x6237;&#x7a7a;&#x95f4;(<b><font color="#f50e0e">wakeup count</font></b>)
    </p>
    <p>
      b. &#x7528;&#x6237;&#x7a7a;&#x95f4;&#x8fdb;&#x7a0b;&#x5f97;&#x5230;&#x4e86;&#x8c03;&#x5ea6;&#xff0c;&#x5728;&#x5904;&#x7406;&#x7684;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x6216;&#x8005;&#x5904;&#x7406;&#x5b8c;&#x6210;&#x4e4b;&#x540e;&#x7528;&#x6237;&#x8fdb;&#x7a0b;&#x51b3;&#x5b9a;
    </p>
    <p>
      &#x4e0d;&#x8fdb;&#x5165;&#x4f11;&#x7720;&#x72b6;&#x6001;&#xff0c; &#x7cfb;&#x7edf;&#x5fc5;&#x987b;&#x505c;&#x6b62;suspend&#x3002;(<b><font color="#ef0808">wake lock</font></b>)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1486965809036" ID="ID_172572929" MODIFIED="1486965809036" TEXT=""/>
</node>
<node CREATED="1486974884753" FOLDED="true" ID="ID_1048613728" MODIFIED="1499823205686">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x7cfb;&#x7edf;&#x5524;&#x9192;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1486974920735" FOLDED="true" ID="ID_1347078890" MODIFIED="1494223900470" TEXT="1.ACPI&#x517c;&#x5bb9;&#x7cfb;&#x7edf;&#x7684;&#x8bbe;&#x5907;&#x5982;&#x4f55;&#x5524;&#x9192;&#x7cfb;&#x7edf;">
<node CREATED="1486974974526" ID="ID_721029365" MODIFIED="1487127494344">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5982;&#x679c;&#x5728;/proc/acpi/wakeup&#x5f53;&#x4e2d;&#x53ef;&#x4ee5;&#x6253;&#x5370;&#x51fa;&#x76f8;&#x5173;&#x7684;&#x8bbe;&#x5907;&#xff0c;&#x5e76;&#x4e14;
    </p>
    <p>
      &#x4e3a;enable&#xff0c;&#x5219;&#x53ef;&#x4ee5;&#x65ad;&#x5b9a;&#x8be5;&#x8bbe;&#x5907;&#x53ef;&#x4ee5;&#x5524;&#x9192;&#x7cfb;&#x7edf;&#x3002;&#x6240;&#x6709;&#x5728;&#x8be5;&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x6709;&#x663e;&#x793a;&#x7684;&#x8bbe;&#x5907;
    </p>
    <p>
      &#x90fd;&#x88ab;&#x52a0;&#x5165;&#x5230;&#x4e86;acpi_wakeup_device_list&#x94fe;&#x8868;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487136797169" ID="ID_397069053" MODIFIED="1487136824304">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.ACPI&#x5b9a;&#x4e49;&#x7684;&#x51e0;&#x4e2a;&#x7cfb;&#x7edf;&#x7684;&#x72b6;&#x6001;</b>
    </p>
    <p>
      G1 Sleeping subdivides into the four states S1 through S4.
    </p>
    <p>
      S1: The CPU(s) stop(s) executing instructions.
    </p>
    <p>
      S2: The CPU is powered off.
    </p>
    <p>
      S3: Suspend to RAM.
    </p>
    <p>
      S4: Suspend to disk or hibernate.
    </p>
    <p>
      G2 (S5) Soft off Almost the same as G3 but computer can "wake" from input from the keyboard, clock, modem, LAN, or USB device.
    </p>
    <p>
      G3 Mechanical off
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1490165194139" ID="ID_1564199583" MODIFIED="1490165200299" TEXT="http://blog.csdn.net/wavemcu/article/details/8544333">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
<node CREATED="1494223925055" FOLDED="true" ID="ID_1813003510" MODIFIED="1499823204566" TEXT="Intel soc &#x4f4e;&#x529f;&#x8017;/&#x4f11;&#x7720;&#x673a;&#x5236;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1494223960112" ID="ID_1944115341" MODIFIED="1494223968320" TEXT="Atom&#x7cfb;&#x5217;"/>
<node CREATED="1494223978807" FOLDED="true" ID="ID_639406366" MODIFIED="1499823203086">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e50e0e"><i>&#x76f8;&#x5173;&#x7684;&#x6d4b;&#x8bd5;&#x547d;&#x4ee4;</i></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1494223989631" ID="ID_75631460" MODIFIED="1494224036963">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x6d4b;&#x8bd5;s0i3&#x7684;&#x5360;&#x7528;&#x6bd4;</b>
    </p>
    <p>
      adb shell cat /sys/kernel/debug/pmc_atom/sleep_state
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1494224749965" ID="ID_188575836" MODIFIED="1494224772977">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e30303"><i>rfkill&#x673a;&#x5236;</i></font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
</node>
<node CREATED="1556269771221" ID="ID_1717929756" MODIFIED="1556615921951">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0000ff">&#x9ad8;&#x901a;&#x5e73;&#x53f0;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x673a;&#x5236; Resource Power Manager (RPM) &#x5b66;&#x4e60;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1557475798806" FOLDED="true" ID="ID_548551169" MODIFIED="1598863494064">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0000ff">&#x9ad8;&#x901a;&#x5e73;&#x53f0;PMIC&#x5b66;&#x4e60;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1557475833899" ID="ID_1777086641" MODIFIED="1557475838679" TEXT="PMI8996"/>
<node CREATED="1585638420852" FOLDED="true" ID="ID_1906000665" MODIFIED="1588239158049" TEXT="PMI8998">
<node CREATED="1585638901695" ID="ID_71942166" MODIFIED="1585638921414">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#25171;&#21360;pmic &#23492;&#23384;&#22120;
    </p>
    <p>
      echo 0x6ff &gt; /sys/kernel/debug/regmap/spmi0-02/count;
    </p>
    <p>
      echo 0x1000 &gt; /sys/kernel/debug/regmap/spmi0-02/address;
    </p>
    <p>
      cat /sys/kernel/debug/regmap/spmi0-02/data &gt;&gt; /data/record.txt;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1585638958334" ID="ID_313864824" MODIFIED="1585638976930" TEXT="&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x503c;&#x7684;&#x610f;&#x601d;&#x9700;&#x8981;&#x53c2;&#x8003;8998 hardware register description&#x6587;&#x6863;"/>
<node CREATED="1586423627987" ID="ID_1170595685" MODIFIED="1586423634178" TEXT="&#x4e2d;&#x65ad;&#x5904;&#x7406;">
<node CREATED="1586423638603" ID="ID_353649143" MODIFIED="1586423727812">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20013;&#26029;&#26816;&#27979;
    </p>
    <p>
      
    </p>
    <p>
      pmic &#22806;&#22260;&#35774;&#22791;&#30340;&#20013;&#26029;&#20250;&#36890;&#36807;spmi&#30340;write&#21629;&#20196;&#21457;&#36865;&#32473;master(&#21363;msm),
    </p>
    <p>
      &#20013;&#26029;&#30340;&#28040;&#24687;&#21253;&#25324;&#22806;&#22260;&#35774;&#22791;&#30340;id&#21495;&#20197;&#21450;&#35302;&#21457;&#30340;&#20013;&#26029;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586423731415" ID="ID_893975846" MODIFIED="1586423866608">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#20013;&#26029;&#30340;&#21518;&#26399;&#22788;&#29702;&#65306;&#20197;GPIO&#20013;&#26029;&#20026;&#20363;&#23376;
    </p>
  </body>
</html></richcontent>
<node CREATED="1586423813074" ID="ID_654057314" MODIFIED="1586423825544">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/pmi8998-spmi&#x4e2d;&#x65ad;&#x5904;&#x7406;.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1557475842558" ID="ID_1338687156" MODIFIED="1557475848208" TEXT="PM8996"/>
<node CREATED="1585374121049" FOLDED="true" ID="ID_1278228773" MODIFIED="1588239156021" TEXT="qpnp-smb2.txt&#x5185;&#x6838;&#x6587;&#x6863;&#x7ffb;&#x8bd1;&#x5b66;&#x4e60;">
<node CREATED="1585374154041" ID="ID_722962858" MODIFIED="1585374265391">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      SMB2 Charger&#26159;&#19968;&#27454;&#39640;&#25928;&#30340;&#21487;&#32534;&#31243;&#30005;&#27744;charger, &#25903;&#25345;micro-USB&#20805;&#30005;&#65292;&#25903;&#25345;
    </p>
    <p>
      USB Type-c&#19979;&#30340;QC2.0&#21644;QC3.0&#20805;&#30005;&#25216;&#26415;&#65292;&#25903;&#25345;PD&#20805;&#30005;&#25216;&#26415;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1585374281287" ID="ID_692894022" MODIFIED="1585374321092">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      SMB2 Charger&#20351;&#29992;2&#20010;&#23618;&#27425;&#30340;&#35774;&#22791;&#33410;&#28857;&#36827;&#34892;&#25551;&#36848;
    </p>
  </body>
</html></richcontent>
<node CREATED="1585374343516" ID="ID_654421833" MODIFIED="1585732246571">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Charger&#20855;&#20307;&#23646;&#24615;&#30340;&#25551;&#36848;
    </p>
    <p>
      compatible &quot;qcom,qpnp-smb2&quot;
    </p>
    <p>
      
    </p>
    <p>
      qcom,pmic-revid &#29992;&#20110;&#25351;&#23450;PMI&#30340;revid&#27169;&#22359;&#30340;phandle, &#35813;&#23646;&#24615;&#29992;&#26469;
    </p>
    <p>
      &#23450;&#20041;PMI&#30340;subtype
    </p>
    <p>
      
    </p>
    <p>
      qcom,fcc-max-ua &#25351;&#23450;&#26368;&#22823;&#30340;&#24555;&#36895;&#20805;&#30005;&#30005;&#27969;
    </p>
    <p>
      
    </p>
    <p>
      qcom,fv-max-uv &#25351;&#23450;&#26368;&#22823;&#30340;&#28014;&#21160;&#30005;&#21387;&#65292;&#22914;&#26524;&#27809;&#26377;&#25351;&#23450;&#65292;&#37027;&#20040;&#40664;&#35748;&#30340;&#20540;&#26159;4.35V
    </p>
    <p>
      
    </p>
    <p>
      qcom,usb-icl-ua &#25351;&#23450;USB &#36755;&#20837;&#30005;&#27969;&#30340;&#38480;&#21046;
    </p>
    <p>
      
    </p>
    <p>
      qcom,usb-ocl-ua &#25351;&#23450;OTG&#36755;&#20986;&#30005;&#27969;&#30340;&#38480;&#21046;
    </p>
    <p>
      
    </p>
    <p>
      qcom,dc-icl-ua &#25351;&#23450;DC&#36755;&#20837;&#30005;&#27969;&#30340;&#38480;&#21046;
    </p>
    <p>
      
    </p>
    <p>
      qcom,boost-threshold-ua &#25351;&#23450;boost&#30005;&#27969;&#38400;&#38376;
    </p>
    <p>
      
    </p>
    <p>
      qcom,thermal-mitigation &#23545;&#20110;&#31995;&#32479;&#30340;&#19981;&#21516;&#25955;&#28909;&#31561;&#32423;&#25152;&#25351;&#23450;&#30340;&#26368;&#22823;&#24555;&#20805;&#30005;&#27969;&#38480;&#21046;
    </p>
    <p>
      
    </p>
    <p>
      <font color="#ff0000"><b>io-channels &#25351;&#23450;iio&#36890;&#36947;&#29992;&#30340;&#21477;&#26564;&#65306;</b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>io-channels = &lt;&amp;pmi8998_rradc 8&gt;, </i></b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&amp;pmi8998_rradc 10&gt;, </i></b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&amp;pmi8998_rradc 3&gt;, </i></b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;&amp;pmi8998_rradc 4&gt;; </i></b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>io-channel-names = &quot;charger_temp&quot;, </i></b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;charger_temp_max&quot;, </i></b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;usbin_i&quot;, </i></b></font>
    </p>
    <p>
      <font color="#3300ff"><b><i>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;usbin_v&quot;;</i></b></font>
    </p>
    <p>
      
    </p>
    <p>
      qcom,float-option &#29992;&#20110;&#23450;&#20041;&#24403;float charger&#25554;&#20837;&#30340;&#26102;&#20505;&#65292; charger&#30340;&#34892;&#20026;,
    </p>
    <p>
      float charge&#26159;&#19968;&#31181;&#24658;&#23450;&#30005;&#21387;&#12289;&#23567;&#30005;&#27969;&#30340;&#20805;&#30005;&#26041;&#24335;
    </p>
    <p>
      Treat as a DCP
    </p>
    <p>
      Treat as a SDP
    </p>
    <p>
      Disable charging
    </p>
    <p>
      Suspend USB input
    </p>
    <p>
      
    </p>
    <p>
      qcom,chg-inhibit-threshold-mv&#160;&#160;&#24403;&#30005;&#27744;&#30005;&#21387;&#22312;&#36825;&#20010;&#33539;&#22260;&#20869;&#30340;&#26102;&#20505;&#65292;&#20805;&#30005;&#34987;&#31105;&#27490;&#65292;
    </p>
    <p>
      &#40664;&#35748;&#26159;&#31105;&#27490;&#30340;&#65292;&#20801;&#35768;&#35774;&#32622;&#30340;&#20540;&#26159;50, 100, 200, 300
    </p>
    <p>
      
    </p>
    <p>
      qcom,auto-recharge-soc &#29992;&#20110;&#25351;&#23450;&#33258;&#21160;&#37325;&#26032;&#20805;&#30005;&#26159;&#21542;&#26159;&#22522;&#20110;battery soc&#30340;&#65311;&#22914;&#26524;&#27809;&#26377;&#25351;&#23450;&#35813;&#23646;&#24615;&#65292;
    </p>
    <p>
      &#37027;&#20040;recharge&#21151;&#33021;&#26159;&#22522;&#20110;&#30005;&#27744;&#30005;&#21387;&#30340;
    </p>
    <p>
      
    </p>
    <p>
      qcom,step-charging-enable &#29992;&#20110;&#20351;&#33021;step charge&#21151;&#33021;
    </p>
    <p>
      
    </p>
    <p>
      qcom,sw-jeita-enable&#160;&#160;&#20351;&#33021;&#36719;&#20214;&#34917;&#20607;jeita&#160;&#160;jeita&#20840;&#31216;&#26159;&#26085;&#26412;&#30005;&#23376;&#20449;&#24687;&#24037;&#19994;&#21327;&#20250;&#65292;&#23427;&#25351;&#23450;&#20102;&#38146;&#30005;&#27744;&#20805;&#30005;&#30340;&#23433;&#20840;&#35268;&#33539;
    </p>
    <p>
      
    </p>
    <p>
      qcom,battery-data &#25351;&#23450;&#21253;&#21547;&#20805;&#30005;&#26354;&#32447;&#30340;&#33410;&#28857;handle, &#35813;&#33410;&#28857;&#21253;&#21547;&#20102;step charge&#21644;sw-jeita&#30340;&#37197;&#32622;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;qcom,step-chg-ranges, qcom,jeita-fcc-ranges, qcom,jeita-fv-ranges
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1585733510386" ID="ID_240121485" MODIFIED="1585734105119">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      RRADC&#20840;&#31216;&#26159;PMIC Round Robin ADC
    </p>
    <p>
      
    </p>
    <p>
      PMIC RRADC&#20026;&#25903;&#25345;&#30340;channel&#32473;&#23458;&#25143;&#31471;&#25552;&#20379;&#35835;&#21462;&#30005;&#21387;&#12289;&#30005;&#27969;&#21644;&#28201;&#24230;&#30340;&#25509;&#21475;&#65292;
    </p>
    <p>
      &#27604;&#22914;battery id&#12289;battery&#28909;&#25935;&#30005;&#38459;&#12289;die temp&#12289;charger temp&#12289;USB_IN&#30340;&#30005;&#21387;&#21644;&#30005;&#27969;&#12290;
    </p>
    <p>
      &#33410;&#28857;&#23646;&#24615;&#20171;&#32461;&#65306;
    </p>
    <p>
      compatible
    </p>
    <p>
      reg&#65306; RRADC&#22312;pmic&#23492;&#23384;&#22120;map&#24403;&#20013;&#30340;&#22522;&#22320;&#22336;&#21644;&#38271;&#24230;
    </p>
    <p>
      #io-channel-cells&#65306;&#24517;&#39035;&#23450;&#20041;&#25104;1&#65292;&#35814;&#32454;&#20449;&#24687;&#21442;&#32771;
    </p>
    <p>
      Documentation/devicetree/bindings/iio/iio-bindings.txt
    </p>
    <p>
      
    </p>
    <p>
      IIO&#23458;&#25143;&#31471;&#22312;&#35831;&#27714;ADC&#35835;&#21462;&#30340;&#26102;&#20505;&#65292;&#38656;&#35201;&#25351;&#23450;RRADC&#30340;channel number,
    </p>
    <p>
      RRADC&#25903;&#25345;&#30340;channel number&#21487;&#20197;&#22312;&#25991;&#20214; drivers/iio/adc/qcom-rradc.c
    </p>
    <p>
      &#24403;&#20013;&#25214;&#21040;&#65292;&#25628;&#23547; <font color="#3300ff"><b>rradc_channel_id</b></font>
    </p>
    <p>
      
    </p>
    <p>
      <i><b>enum rradc_channel_id {</b></i>
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_BATT_ID = 0,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_BATT_THERM,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_SKIN_TEMP,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_USBIN_I,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_USBIN_V,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_DCIN_I,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_DCIN_V,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_DIE_TEMP,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_CHG_TEMP,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_GPIO,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_CHG_HOT_TEMP,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_CHG_TOO_HOT_TEMP,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_SKIN_HOT_TEMP,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_SKIN_TOO_HOT_TEMP,
    </p>
    <p>
      &#160;&#160;&#160;&#160;RR_ADC_MAX
    </p>
    <p>
      <i><b>};</b></i>
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1585721596989" ID="ID_1847029751" MODIFIED="1585721783315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Second Level Nodes - SMB2 Charger Peripherals &#20805;&#30005;&#22806;&#22260;&#35774;&#22791;
    </p>
    <p>
      
    </p>
    <p>
      smb2&#19979;&#25346;&#30340;&#35774;&#22791;&#38656;&#35201;&#23450;&#20041;reg, interrupts,interrupt-names&#31561;&#23646;&#24615;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1585819968591" FOLDED="true" ID="ID_1069046019" MODIFIED="1588239153954">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0000">pmic voter&#25237;&#31080;&#26426;&#21046;</font></b>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1585820570959" ID="ID_830471941" MODIFIED="1585820782357">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22312;&#20998;&#26512;&#39640;&#36890;smb&#20805;&#30005;&#39537;&#21160;&#30340;&#26102;&#20505;&#65292;&#27880;&#24847;&#21040;&#20195;&#34920;&#20805;&#30005;&#22120;&#30340;&#32467;&#26500;&#20307; struct smb_charger&#37324;&#38754;&#26377;&#22823;&#37327;&#30340;
    </p>
    <p>
      votable&#23545;&#35937;&#65292;&#36825;&#23601;&#29301;&#28041;&#21040;&#20102;&#39640;&#36890;pmic&#30340;&#25237;&#31080;&#26426;&#21046;&#12290;
    </p>
    <p>
      &#31616;&#21333;&#24471;&#35828;&#25237;&#31080;&#38656;&#35201;&#26377;&#25237;&#31080;&#32773;client&#21644;&#25237;&#31080;&#30340;&#23545;&#35937;&#65292;&#25237;&#31080;&#23545;&#35937;votable&#26159;&#26377;type&#30340;&#65292;&#35813;type&#20915;&#23450;&#35813;votable
    </p>
    <p>
      &#20250;&#25509;&#21463;&#37027;&#31181;&#31867;&#22411;&#30340;&#25237;&#31080;&#65288;&#27604;&#22914;&#26368;&#22823;&#20540;&#30340;&#25237;&#31080;&#25110;&#32773;&#26368;&#23567;&#20540;&#30340;&#25237;&#31080;&#65289;
    </p>
    <p>
      voter&#20195;&#30721;&#25991;&#20214;&#65306; pmic-voter.c
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1585376685328" ID="ID_734187619" MODIFIED="1596790632405" TEXT="&#x7f51;&#x7edc;&#x8d44;&#x6599;">
<node CREATED="1585376692664" ID="ID_73152561" MODIFIED="1585650890288">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      https://evsio0n.com/archives/305/
    </p>
    <p>
      &#20171;&#32461;&#39640;&#36890;835&#20805;&#30005;&#26550;&#26500;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1585639140247" ID="ID_1775432289" MODIFIED="1585639179375">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <span style="font-weight: 400; color: rgb(103, 114, 131); font-family: QualcommNext, Arial, sans-serif; text-transform: none; display: inline !important; text-align: start; word-spacing: 0px; letter-spacing: normal; font-style: normal; text-indent: 0px; background-color: rgb(255, 255, 255); font-size: 18px; white-space: normal; float: none"><font color="rgb(103, 114, 131)" face="QualcommNext, Arial, sans-serif" size="18px">Quick Charge 4 features the third release of INOV (Intelligent Negotiation for Optimum Voltage), a unique power-management algorithm designed by Qualcomm Technologies. INOV now includes real-time thermal management, a technology industry first, which is designed to advance charging optimization by automatically determining and selecting the optimal power transfer level for a given thermal condition. </font></span>
    </p>
    <p>
      
    </p>
    <p>
      <span style="font-weight: 400; color: rgb(103, 114, 131); font-family: QualcommNext, Arial, sans-serif; text-transform: none; display: inline !important; word-spacing: 0px; text-align: start; letter-spacing: normal; font-style: normal; text-indent: 0px; background-color: rgb(255, 255, 255); font-size: 18px; white-space: normal; float: none"><font color="rgb(103, 114, 131)" face="QualcommNext, Arial, sans-serif" size="18px">INOV&#36319;thermal&#26694;&#26550;&#32467;&#21512;&#36215;&#26469;</font></span>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1585151877673" ID="ID_1986497145" MODIFIED="1595300774752" TEXT="SPMI&#x63a5;&#x53e3;">
<node CREATED="1585151893509" FOLDED="true" ID="ID_314490469" MODIFIED="1588239145045">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Solution: The chipsets with multiple PMICs can be written to or read from the SPMI based on their SPMI slave IDs. The primary PMIC of a chipset uses SPMI slave IDs 0 and 1. If the chipset has a PMI (interface/charger PMIC), then the PMI uses SPMI slave IDs 2 and 3. If the chipset has a secondary PMIC that is not a PMI (interface/charger PMIC), then the secondary PMIC uses SPMI slave IDs 4 and 5.
    </p>
    <p>
      
    </p>
    <p>
      For example:
    </p>
    <p>
      
    </p>
    <p>
      When PM8941 uses slave IDs 0 and 1; PM8841 uses slave IDs 4 and 5:
    </p>
    <p>
      
    </p>
    <p>
      ADB shell register reads from PM8941 0x810 (slave ID 0):
    </p>
    <p>
      adb shell echo 0x810 &gt; /sys/kernel/debug/spmi/spmi-0/address
    </p>
    <p>
      adb shell cat /sys/kernel/debug/spmi/spmi-0/data
    </p>
    <p>
      
    </p>
    <p>
      ADB shell register reads from PM8941 0x14F10 (slave ID 1):
    </p>
    <p>
      adb shell echo 0x14F10 &gt; /sys/kernel/debug/spmi/spmi-0/address
    </p>
    <p>
      adb shell cat /sys/kernel/debug/spmi/spmi-0/data
    </p>
    <p>
      
    </p>
    <p>
      ADB shell register reads from PM8841 0x810 (slave ID 4):
    </p>
    <p>
      adb shell echo 0x40810 &gt; /sys/kernel/debug/spmi/spmi-0/address
    </p>
    <p>
      &#183;&#160;&#160;&#160;&#160;&#160;&#160;&#160;adb shell cat /sys/kernel/debug/spmi/spmi-0/data
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      &#183;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;When PM8994 uses slave IDs 0 and 1; PMI8994 uses slave IDs 2 and 3:
    </p>
    <p>
      
    </p>
    <p>
      ADB shell register reads from PM8994 0x810 (slave ID 0):
    </p>
    <p>
      adb shell echo 0x810 &gt; /sys/kernel/debug/spmi/spmi-0/address
    </p>
    <p>
      adb shell cat /sys/kernel/debug/spmi/spmi-0/data
    </p>
    <p>
      
    </p>
    <p>
      ADB shell register reads from PMI8994 0x810 (slave ID 2):
    </p>
    <p>
      adb shell echo 0x20810 &gt; /sys/kernel/debug/spmi/spmi-0/address
    </p>
    <p>
      adb shell cat /sys/kernel/debug/spmi/spmi-0/data
    </p>
    <p>
      &#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;
    </p>
    <p>
      &#29256;&#26435;&#22768;&#26126;&#65306;&#26412;&#25991;&#20026;CSDN&#21338;&#20027;&#12300;Jaimex8&#12301;&#30340;&#21407;&#21019;&#25991;&#31456;&#65292;&#36981;&#24490; CC 4.0 BY &#29256;&#26435;&#21327;&#35758;&#65292;&#36716;&#36733;&#35831;&#38468;&#19978;&#21407;&#25991;&#20986;&#22788;&#38142;&#25509;&#21450;&#26412;&#22768;&#26126;&#12290;
    </p>
    <p>
      &#21407;&#25991;&#38142;&#25509;&#65306;https://blog.csdn.net/Ciellee/article/details/87633691
    </p>
  </body>
</html></richcontent>
<node CREATED="1586421531067" ID="ID_7710899" MODIFIED="1586422667810">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#20110;PM8998&#21644;PMI8998&#36825;&#26679;&#30340;&#30005;&#28304;&#31649;&#29702;&#33455;&#29255;&#65292;&#39537;&#21160;&#19978;&#38754;&#30340;SPMI&#25509;&#21475;&#24050;&#32463;&#21457;&#29983;&#20102;&#21464;&#21270;
    </p>
    <p>
      
    </p>
    <p>
      PM8998&#36890;&#24120;&#23545;&#24212;/sys/kernel/debug/regmap/spmi0-00 &#25110;&#32773; /sys/kernel/debug/regmap/spmi0-01
    </p>
    <p>
      PMI8998 &#36890;&#24120;&#23545;&#24212; /sys/kernel/debug/regmap/spmi0-02 &#25110;&#32773; /sys/kernel/debug/regmap/spmi0-03
    </p>
    <p>
      
    </p>
    <p>
      pmic8998&#30340;&#23492;&#23384;&#22120;&#22320;&#22336;&#32452;&#25104;&#65306;
    </p>
    <p>
      
    </p>
    <p>
      USID(4bit)-Peripheral ID(8bit)-Reg offset(8bit)
    </p>
    <p>
      
    </p>
    <p>
      USID&#23601;&#26159;&#23545;&#24212;spmi0-0&#21518;&#38754;&#30340;&#24207;&#21495;
    </p>
    <p>
      &#25152;&#20197;&#27599;&#20010;&#22806;&#22260;&#35774;&#22791;&#37117;&#34987;&#20998;&#37197;&#20102;256&#20010;&#23492;&#23384;&#22120;&#65292;&#36825;&#37096;&#20998;&#23492;&#23384;&#22120;&#30340;map&#34987;&#20570;&#20102;&#22914;&#19979;&#30340;&#20998;&#31867;
    </p>
    <p>
      0x00~0x10&#160;&#160;&#29366;&#24577;&#23492;&#23384;&#22120;
    </p>
    <p>
      0x10~0x20 &#20013;&#26029;&#23492;&#23384;&#22120;
    </p>
    <p>
      0x20~0x40 &#20445;&#30041;&#20351;&#29992;
    </p>
    <p>
      0x40~0xE0 &#25511;&#21046;&#23492;&#23384;&#22120;
    </p>
    <p>
      0xE0~&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#20445;&#30041;&#20351;&#29992;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1585152638890" ID="ID_1663677913" MODIFIED="1585152675827">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      SPMI is specified by the MIPI (Mobile Industry Process Interface) Alliance.
    </p>
    <p>
      
    </p>
    <p>
      Documentation/devicetree/bindings/spmi/qcom,spmi-pmic-arb.txt
    </p>
    <p>
      Documentation/devicetree/bindings/spmi/spmi.txt
    </p>
    <p>
      drivers/spmi/Kconfig
    </p>
    <p>
      drivers/spmi/Makefile
    </p>
    <p>
      drivers/spmi/spmi-dbgfs.c
    </p>
    <p>
      drivers/spmi/spmi-dbgfs.h
    </p>
    <p>
      drivers/spmi/spmi-pmic-arb.c
    </p>
    <p>
      drivers/spmi/spmi.c
    </p>
    <p>
      include/linux/spmi.h
    </p>
    <p>
      
    </p>
    <p>
      Overview
    </p>
    <p>
      
    </p>
    <p>
      The MIPI System Power Management Interface, MIPI SPMI&#8480;, specifies the hardware interface between baseband or application processors and peripheral components to support advanced power management techniques. The specification also reduces design costs and shortens time to market of mobile devices by simplifying the interconnection of devices from different manufacturers. It is used in smartphones, tablets, and other portable devices.
    </p>
    <p>
      
    </p>
    <p>
      The MIPI System Power Management Interface is a two-wire serial interface that uses CMOS I/Os for the physical layer. The interface connects the integrated power controller of a system-on-chip (SoC) processor system with one or more power management IC voltage regulation systems. The interface can be used to accurately monitor and control processor performance levels required for a given workload or application and dynamically control the various supply voltages in real time based on the performance levels.
    </p>
    <p>
      
    </p>
    <p>
      Features include a low pin count and low gate count, high speed, low latency, ability to support multiple processor devices on the same shared bus, priority management by traffic classes, and command acknowledgement.
    </p>
    <p>
      
    </p>
    <p>
      The interface is developed by the MIPI Alliance System Power Management Working Group. The current release, v2.0, was released in 2012.
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1584432587307" FOLDED="true" ID="ID_253610130" MODIFIED="1598863498479">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0033cc">&#39640;&#36890;&#24179;&#21488;PD&#20805;&#30005;&#27969;&#31243;&#23398;&#20064;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1584435295414" ID="ID_165827177" MODIFIED="1595230800902">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0000ff"><b>1.&#22522;&#30784;&#27010;&#24565;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1584435311535" ID="ID_1261407435" MODIFIED="1588239944117">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Downstream Facing Port(DFP) &#36890;&#24120;&#25351;&#20301;&#20110;host&#31471;&#30340;type-c&#31471;&#21475;
    </p>
    <p>
      Upstream Facing Port(UFP) &#36890;&#24120;&#25351;&#20301;&#20110;device&#31471;&#30340;type-c&#31471;&#21475;
    </p>
    <p>
      
    </p>
    <p>
      DFP&#36890;&#24120;&#26159;&#20379;&#30005;&#30340;source&#31471;&#65292;UFP&#36890;&#24120;&#26159;&#20379;&#30005;&#30340;sink&#31471;
    </p>
  </body>
</html></richcontent>
<node CREATED="1584435477879" FOLDED="true" ID="ID_1541131537" MODIFIED="1588239112863">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/DFP-AND-UFP.jpg" />
  </body>
</html></richcontent>
<node CREATED="1584610847378" ID="ID_1276263764" MODIFIED="1584611343058">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      In addition, the PHY Layer Shall control the Rp resistor value to avoid collisions between Source and Sink
    </p>
    <p>
      transmissions. The Source Shall set an Rp value corresponding to a current of 3A to indicate to the Sink that it May
    </p>
    <p>
      initiate an AMS. The Source Shall set an Rp value corresponding to a current of 1.5A this Shall indicate to the Sink
    </p>
    <p>
      USB Power Delivery Specification Revision 3.0, Version 1.2 Page 79
    </p>
    <p>
      at it Shall Not initiate an AMS and Shall only respond to Messages as part of an AMS . See [USB Type-C 1.3] for details of
    </p>
    <p>
      the corresponding Rp values.
    </p>
    <p>
      Table 5-13 details the Rp values that Shall be used by the Source to control Sink initiation of an AMS.
    </p>
    <p>
      Table 5-13 Rp values used for Collision Avoidance
    </p>
    <p>
      Source Rp Parameter Description Sink operation Source operation
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1584435500505" ID="ID_100486113" MODIFIED="1595316800818">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Dual Role Port (DRP) &#31471;&#21475;&#36890;&#24120;&#26159;&#20855;&#26377;&#20379;&#30005;&#30340;source&#21644;sink&#21151;&#33021;&#65292;
    </p>
    <p>
      DRP&#26082;&#21487;&#20197;&#20805;&#24403;DFP&#12289;UFP&#65292;&#20063;&#21487;&#20197;&#20805;&#24403;&#20379;&#30005;&#30340;source&#21644;sink,
    </p>
    <p>
      &#22240;&#27492;&#36825;&#31181;&#32452;&#21512;&#21152;&#36215;&#26469;&#26377;&#22235;&#31181;
    </p>
  </body>
</html></richcontent>
<node CREATED="1584435636406" ID="ID_1367088381" MODIFIED="1584435658859">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <table>
      <tr>
        <td style="width: 29px">
          <p>
            No.
          </p>
        </td>
        <td style="width: 58px">
          <p>
            Port Data Role
          </p>
        </td>
        <td style="width: 113px">
          <p>
            Port Power Role
          </p>
        </td>
        <td style="width: 144px">
          <p>
            CC Terminations
          </p>
        </td>
      </tr>
      <tr>
        <td style="width: 29px">
          <p>
            1
          </p>
        </td>
        <td style="width: 58px">
          <p>
            DFP
          </p>
        </td>
        <td style="width: 113px">
          <p>
            Source (Power Provider)
          </p>
        </td>
        <td style="width: 144px">
          <p>
            Connect Rp and disconnect Rd
          </p>
        </td>
      </tr>
      <tr>
        <td style="width: 29px">
          <p>
            2
          </p>
        </td>
        <td style="width: 58px">
          <p>
            DFP
          </p>
        </td>
        <td style="width: 113px">
          <p>
            Sink (Power Consumer)
          </p>
        </td>
        <td style="width: 144px">
          <p>
            Disconnect Rp and connect Rd
          </p>
        </td>
      </tr>
      <tr>
        <td style="width: 29px">
          <p>
            3
          </p>
        </td>
        <td style="width: 58px">
          <p>
            UFP
          </p>
        </td>
        <td style="width: 113px">
          <p>
            Source (Power Provider)
          </p>
        </td>
        <td style="width: 144px">
          <p>
            Connect Rp and disconnect Rd
          </p>
        </td>
      </tr>
      <tr>
        <td style="width: 29px">
          <p>
            4
          </p>
        </td>
        <td style="width: 58px">
          <p>
            UFP
          </p>
        </td>
        <td style="width: 113px">
          <p>
            Sink (Power Consumer)
          </p>
        </td>
        <td style="width: 144px">
          <p>
            Disconnect Rp and connect Rd
          </p>
        </td>
      </tr>
    </table>
  </body>
</html></richcontent>
</node>
<node CREATED="1584435663697" ID="ID_1290877816" MODIFIED="1584435670828">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/DRP.jpg" />
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1584437432709" ID="ID_1808511054" MODIFIED="1595316898258" TEXT="USB Power Delivery Protocol View">
<node CREATED="1584437531444" ID="ID_1679671093" MODIFIED="1584437598492">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      DFP&#21644;UFP&#22312;CC&#33050;&#19978;&#36890;&#36807;BMC&#21327;&#35758;&#26469;&#21452;&#21521;&#21327;&#21830;&#20805;&#30005;&#30005;&#27969;&#21644;&#20805;&#30005;&#30005;&#21387;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584437746702" ID="ID_1291721358" MODIFIED="1584437760421">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/PD-over-typec.jpg" />
  </body>
</html></richcontent>
</node>
<node CREATED="1584439443526" ID="ID_1190387612" MODIFIED="1595316913841">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      type-c&#25509;&#21475;&#36890;&#36807;EMCA&#35013;&#32622;&#26469;&#26816;&#27979;&#20986;&#25554;&#20837;&#30340;&#35774;&#22791;&#26159;&#21542;&#25903;&#25345;pd&#21327;&#35758;
    </p>
  </body>
</html></richcontent>
<node CREATED="1584439553553" ID="ID_1722754385" MODIFIED="1584439561964">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/EMCA-TYPEC.jpg" />
  </body>
</html></richcontent>
</node>
<node CREATED="1584439564913" ID="ID_427457554" MODIFIED="1584439583104">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/PD&#x534f;&#x5546;&#x8fc7;&#x7a0b;.jpg" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1584513875086" FOLDED="true" ID="ID_583367687" MODIFIED="1588239120361">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/usb&#x5145;&#x7535;&#x534f;&#x8bae;&#x4e00;&#x89c8;.jpg" />
  </body>
</html></richcontent>
<node CREATED="1584513899803" ID="ID_837966337" MODIFIED="1584513909197">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/usb&#x5404;&#x79cd;&#x63a5;&#x53e3;&#x4e00;&#x89c8;.jpg" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1584436105512" ID="ID_1412793510" MODIFIED="1596790617993">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0000ff"><b>2.&#32593;&#32476;&#36164;&#26009;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1584436115687" ID="ID_613981889" MODIFIED="1584436137014">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#3333ff">https://www.embedded.com/usb-type-c-and-power-delivery-101-ports-and-connections/</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1584594562994" ID="ID_1486098016" MODIFIED="1595297306748">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0000ff"><b>3. PD&#20805;&#30005;&#27969;&#31243;&#39537;&#21160;&#26085;&#24535;&#20998;&#26512;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1584594650565" ID="ID_541549427" MODIFIED="1584594711827">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: received message: type(10) num_objs(0)
    </p>
    <p>
      
    </p>
    <p>
      The PR_Swap Message May be sent by either Port Partner to request an exchange of power roles.
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584594716122" ID="ID_1682202694" MODIFIED="1584595014983">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: received message: type(6) num_objs(0)
    </p>
    <p>
      
    </p>
    <p>
      The PS_RDY Message Shall be sent by the Source (or by both the new Sink and new Source during the Power Role
    </p>
    <p>
      Swap sequence or Fast Role Swap sequence) to indicate its power supply has reached the desired operating condition
    </p>
    <p>
      (see Section 8.3.2.2).
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584595043095" ID="ID_1518236552" MODIFIED="1584609417961">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: received message: type(1) num_objs(5)
    </p>
    <p>
      
    </p>
    <p>
      Source_Capabilities Message (see Figure 6-12). Power Data Objects are used to convey a Source Port&#8217;s capabilities
    </p>
    <p>
      <font color="#ff0000">[&#160;&#160;101.314547] usbpd usbpd0: handle state SNK_Discovery&#160; </font><font color="#0000ff"><b>soc&#36827;&#20837;&#21040;sink&#21457;&#29616;&#38454;&#27573;</b></font>
    </p>
    <p>
      <font color="#ff0000">[&#160;&#160;101.320309] usbpd usbpd0: SNK_Discovery -&gt; SNK_Evaluate_Capability</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584611599855" ID="ID_1000478008" MODIFIED="1584611748424">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: received message: type(3) num_objs(0)
    </p>
    <p>
      <b>&#36825;&#37324;&#26159;&#21542;&#26159;source&#23545;sink&#31471;&#20805;&#30005;selection&#30340;&#22238;&#22797;&#65311;</b>
    </p>
    <p>
      
    </p>
    <p>
      The Accept Message is a Valid response in the following cases:
    </p>
    <p>
      &#8226; Source to signal the Sink that the Source is willing to meet the Request Message.
    </p>
    <p>
      
    </p>
    <p>
      usbpd usbpd0: SNK_Select_Capability -&gt; SNK_Transition_Sink
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584611774939" ID="ID_703729036" MODIFIED="1584611992721">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: received message: type(6) num_objs(0)
    </p>
    <p>
      source&#20934;&#22791;&#22909;&#36827;&#20837;&#20805;&#30005;&#29366;&#24577;
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      The PS_RDY Message Shall be sent by the Source (or by both the new Sink and new Source during the Power Role
    </p>
    <p>
      Swap sequence or Fast Role Swap sequence) to indicate its power supply has reached the desired operating condition
    </p>
    <p>
      (see Section 8.3.2.2).
    </p>
    <p>
      
    </p>
    <p>
      usbpd usbpd0: SNK_Transition_Sink -&gt; SNK_Ready
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584612068124" ID="ID_838894695" MODIFIED="1584612150576">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: received message: type(11) num_objs(0)
    </p>
    <p>
      
    </p>
    <p>
      Vconn_swap message
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584612267470" ID="ID_542895400" MODIFIED="1584612333429">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>[&#160;&#160;103.056780] usbpd usbpd0: received message: type(9) num_objs(0)&#160; &#160;<font color="#ff0000">DR_Swap message&#21442;&#30475;&#21327;&#35758;&#25163;&#20876;112&#39029;</font></b>
    </p>
    <p>
      [&#160;&#160;103.063082] usbpd usbpd0: handle state SNK_Ready
    </p>
    <p>
      [&#160;&#160;103.070298] usbpd usbpd0: dr_swap: current_dr(0)
    </p>
    <p>
      [&#160;&#160;103.075005] msm-dwc3 a600000.ssusb: vbus:0 event received
    </p>
    <p>
      [&#160;&#160;103.082293] msm-dwc3 a600000.ssusb: host:1 (id:0) event received
    </p>
    <p>
      [&#160;&#160;103.083399] msm-dwc3 a600000.ssusb: dwc3_resume_work: dwc3 resume work
    </p>
    <p>
      [&#160;&#160;103.083416] msm-dwc3 a600000.ssusb: XCVR: ID set
    </p>
    <p>
      [&#160;&#160;103.083424] msm-dwc3 a600000.ssusb: XCVR: BSV clear
    </p>
    <p>
      [&#160;&#160;103.083432] msm-dwc3 a600000.ssusb: XCVR: SUSP clear
    </p>
    <p>
      [&#160;&#160;103.083492] msm-dwc3 a600000.ssusb: b_peripheral state
    </p>
    <p>
      [&#160;&#160;103.083513] msm-dwc3 a600000.ssusb: !id || !bsv
    </p>
    <p>
      [&#160;&#160;103.083538] msm-dwc3 a600000.ssusb: dwc3_otg_start_peripheral: turn off gadget dwc3-gadget
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1584684619773" FOLDED="true" ID="ID_1392387884" MODIFIED="1588239134209">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: received message: type(15) num_objs(5)
    </p>
    <p>
      
    </p>
    <p>
      <font color="#ff3333"><b>Vendor_Defined message </b></font>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#3333ff"><b>VDM&#29992;&#20110;&#25215;&#36733;alternate mode&#21327;&#21830;&#65292;&#27604;&#22914;DP&#21327;&#35758;&#21487;&#20197;&#20351;&#29992;VDM&#26469;&#21327;&#21830;&#23545;usb3.0 tx/rx&#30340;&#22797;&#29992; </b></font>
    </p>
    <p>
      <font color="#333333">The USB Power Delivery (PD) Specification defines a standard set of messages for communicating </font>
    </p>
    <p>
      <font color="#333333">between an upstream-facing port (UFP) and a downstream-facing port (DFP) using a bi-phase marked </font>
    </p>
    <p>
      <font color="#333333">coding (BMC) modem on a dedicated channel of the USB Type-C cable called the configuration channel </font>
    </p>
    <p>
      <font color="#333333">(CC). The primary function of these USB PD messages is to negotiate a power contract between the two </font>
    </p>
    <p>
      <font color="#333333">connected devices, but the USB PD specification also defines a framework for vendors and standards </font>
    </p>
    <p>
      <font color="#333333">bodies to extend USB PD using alternate modes. Alternate modes may be applied towards a variety of </font>
    </p>
    <p>
      <font color="#333333">uses, but the most common and powerful functionality is to re-purpose the SuperSpeed differential pairs of </font>
    </p>
    <p>
      <font color="#333333">the USB Type-C cable from their default USB3 signaling to carry other high-speed signals, such as </font>
    </p>
    <p>
      <font color="#333333">DisplayPort or Thunderbolt. </font>
    </p>
    <p>
      &#20063;&#21363;&#26159;&#35828;ALT Mode&#26159;&#20381;&#36182;&#20110;power delivery&#21327;&#35758;&#30340;&#65311;
    </p>
  </body>
</html></richcontent>
<node CREATED="1584684805368" ID="ID_755260240" MODIFIED="1584684965576">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      usbpd usbpd0: VDM rx: svid:ff00 cmd:1 cmd_type:1 vdm_hdr:ff008041
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Discover Identity
    </p>
    <p>
      usbpd usbpd0: VDM rx: svid:ff00 cmd:2 cmd_type:1 vdm_hdr:ff008042
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Discover SVIDs
    </p>
    <p>
      usbpd usbpd0: VDM rx: svid:ff01 cmd:3 cmd_type:1 vdm_hdr:ff018043
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Discover Modes
    </p>
    <p>
      usbpd usbpd0: VDM rx: svid:ff01 cmd:4 cmd_type:1 vdm_hdr:ff018144
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Enter Modes
    </p>
    <p>
      usbpd usbpd0: VDM rx: svid:ff01 cmd:10 cmd_type:1 vdm_hdr:ff018150
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reserved
    </p>
    <p>
      usbpd usbpd0: VDM rx: svid:ff01 cmd:11 cmd_type:1 vdm_hdr:ff018151
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reserved
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1584699186877" ID="ID_1306205353" MODIFIED="1584699224991">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#ff3333"><i><b>power/supply/qcom/qpnp-fg-gen3.c</b></i></font>:3097:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <b>pr_err(&quot;battery profile is not loaded\n&quot;);</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1588239202469" ID="ID_553337002" MODIFIED="1588239284507">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3" face="&#x6977;&#x4f53;" color="#0000cc"><b>4. msm-4.9/drivers/usb/pd &#30446;&#24405;&#19979;&#20195;&#30721;&#20998;&#26512;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1588239347361" ID="ID_703443" MODIFIED="1595303356783" TEXT="&#x5de5;&#x7a0b;&#x95ee;&#x9898;&#x603b;&#x7ed3;">
<node CREATED="1588239364268" ID="ID_1972039896" MODIFIED="1588239382865">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/PD&#x5145;&#x7535;&#x95ee;&#x9898;.png" />
  </body>
</html></richcontent>
<node CREATED="1588239812103" ID="ID_623020168" MODIFIED="1588239837604">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font face="&#x6977;&#x4f53;"><i>/* Indicates USB Type-C CC connection status */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>enum power_supply_typec_mode { </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_NONE, </i></font>
    </p>
    <p>
      
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;/* Acting as source */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_SINK,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Rd only */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_SINK_POWERED_CABLE,&#160;&#160;&#160;&#160;&#160;&#160;/* Rd/Ra */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_SINK_DEBUG_ACCESSORY,&#160;&#160;&#160;&#160;/* Rd/Rd */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_SINK_AUDIO_ADAPTER,&#160;&#160;&#160;&#160;&#160;&#160;/* Ra/Ra */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_POWERED_CABLE_ONLY,&#160;&#160;&#160;&#160;&#160;&#160;/* Ra only */ </i></font>
    </p>
    <p>
      
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;/* Acting as sink */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_SOURCE_DEFAULT,&#160;&#160;&#160;&#160;&#160;&#160;/* Rp default */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_SOURCE_MEDIUM,&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Rp 1.5A */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_SOURCE_HIGH,&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;/* Rp 3A */ </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>&#160;&#160;&#160;&#160;POWER_SUPPLY_TYPEC_NON_COMPLIANT, </i></font>
    </p>
    <p>
      <font face="&#x6977;&#x4f53;"><i>}; </i></font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1456929335533" FOLDED="true" ID="ID_1088410273" MODIFIED="1574904170276" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#d71313">Linux&#x4e2d;&#x65ad;&#x7cfb;&#x7edf;&#x67b6;&#x6784;</font></b>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1456929648265" ID="ID_1830484819" MODIFIED="1456930560458">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5c42;&#x6b21;&#x7ed3;&#x6784; </b>
    </p>
    <p>
      <b>IRQ&#x4e2d;&#x65ad;&#x6d41;&#x63a7;&#x5c42;&#xa0;&#xa0;&lt;------------&gt;&#xa0;&#xa0;&#x4e2d;&#x65ad;&#x901a;&#x7528;&#x903b;&#x8f91;&lt;-------&gt;&#x786c;&#x4ef6;&#x5c01;&#x88c5;&#x5c42; </b>
    </p>
    <p>
      
    </p>
    <p>
      <i><b>&#x786c;&#x4ef6;&#x5c01;&#x88c5;&#x5c42;</b></i>&#xff1a;&#x5305;&#x542b;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x76f8;&#x5173;&#x7684;&#x4ee3;&#x7801;&#xff0c;&#x5305;&#x542b;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x62bd;&#x8c61;&#xff0c;
    </p>
    <p>
      arch&#x76f8;&#x5173;&#x7684;&#x4e2d;&#x65ad;&#x521d;&#x59cb;&#x5316;&#xff0c;&#x5404;&#x4e2a;IRQ&#x7684;&#x76f8;&#x5173;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x7684;&#x521d;&#x59cb;&#x5316;&#x5de5;&#x4f5c;&#x3002;
    </p>
    <p>
      cpu&#x7684;&#x4e2d;&#x65ad;&#x5165;&#x53e3;&#x4e5f;&#x4f1a;&#x5728;arch&#x76f8;&#x5173;&#x7684;&#x4ee3;&#x7801;&#x5f53;&#x4e2d;&#x521d;&#x59cb;&#x5316;&#x3002;
    </p>
    <p>
      <i><b>&#x4e2d;&#x65ad;&#x901a;&#x7528;&#x903b;&#x8f91;&#x5c42;</b></i>&#xff1a;&#x5b9a;&#x4e49;&#x6807;&#x51c6;&#x7684;&#x5c01;&#x88c5;&#x63a5;&#x53e3;&#xff0c;&#x5373;struct irq_chip&#x5b9a;&#x4e49;&#x7684;&#x63a5;&#x53e3;
    </p>
    <p>
      &#x63a7;&#x5236;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x884c;&#x4e3a;&#xff0c;&#x4e2d;&#x65ad;&#x5165;&#x53e3;&#x51fd;&#x6570;&#x83b7;&#x53d6;IRQ&#x7f16;&#x53f7;&#x4e4b;&#x540e;&#x901a;&#x8fc7;&#x4e2d;&#x65ad;&#x901a;&#x7528;
    </p>
    <p>
      &#x903b;&#x8f91;&#x8f6c;&#x5230;&#x4e2d;&#x65ad;&#x6d41;&#x63a7;&#x5c42;&#x91cc;&#x9762;&#x8fd0;&#x884c;&#x3002;
    </p>
    <p>
      <i><b>&#x4e2d;&#x65ad;&#x6d41;&#x63a7;&#x5c42;</b></i>&#xff1a;&#x6839;&#x636e;&#x4e0d;&#x540c;&#x7684;&#x4e2d;&#x65ad;&#x7535;&#x6c14;&#x7c7b;&#x578b;&#xff0c;&#x5b9e;&#x73b0;&#x4e0d;&#x540c;&#x7684;&#x4e2d;&#x65ad;&#x6d41;&#x5904;&#x7406;&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x5e76;&#x5c06;&#x6700;&#x7ec8;&#x7684;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x6743;&#x4f20;&#x9012;&#x7ed9;&#x9a71;&#x52a8;&#x6ce8;&#x518c;&#x7684;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x53e5;&#x67c4;&#x6216;&#x8005;&#x662f;&#x7ebf;&#x7a0b;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1457969453362" ID="ID_1271920120" MODIFIED="1527039178605">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ff0000">&#x5173;&#x4e8e;&#x4e2d;&#x65ad;&#x7cfb;&#x7edf;&#x7684;&#x590d;&#x6742;&#x6570;&#x636e;&#x7ed3;&#x6784;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node COLOR="#cc0000" CREATED="1461079575435" FOLDED="true" ID="ID_81324376" MODIFIED="1560958843075" TEXT="2440&#x4e2d;&#x65ad;&#x7cfb;&#x7edf;&#x4ee3;&#x7801;&#x5206;&#x6790;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1510455009202" FOLDED="true" ID="ID_38009795" MODIFIED="1560958840955">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#0c0ef2">arm linux&#x5f02;&#x5e38;&#x5411;&#x91cf;&#x8868;&#x7684;&#x5efa;&#x7acb;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1510455119410" ID="ID_1816810487" MODIFIED="1510471099185">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4ee3;&#x7801;&#x8c03;&#x7528;&#x7684;&#x4f4d;&#x7f6e;:
    </p>
    <p>
      void __init setup_arch(char **cmdline_p) ------&gt;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;paging_init(mdesc) ---------&gt;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;devicemaps_init(mdesc)-----&gt;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;vectors = early_alloc(PAGE_SIZE * 2);
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;early_trap_init(vectors);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1510471104226" FOLDED="true" ID="ID_944323132" MODIFIED="1560958836827">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#137d2a">void __init early_trap_init(void *vectors_base)</font></b>
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;......
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;memcpy((void *)vectors, __vectors_start, __vectors_end - __vectors_start);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;memcpy((void *)vectors + 0x1000, __stubs_start, __stubs_end - __stubs_start);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;......
    </p>
    <p>
      
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#e01717" DESTINATION="ID_944323132" ENDARROW="None" ENDINCLINATION="2187;0;" ID="Arrow_ID_1021296289" SOURCE="ID_677439937" STARTARROW="None" STARTINCLINATION="3180;0;"/>
<node CREATED="1510471273471" ID="ID_1150404517" MODIFIED="1543121793795">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>__vectors_start&#x5b9a;&#x4e49;&#x5728;&#x6587;&#x4ef6;entry-armv.S&#x5f53;&#x4e2d;</b>
    </p>
    <p>
      __vectors_start:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(b)&#xa0;&#xa0;&#xa0;&#xa0;vector_rst&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(b)&#xa0;&#xa0;&#xa0;&#xa0;vector_und
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(ldr)&#xa0;&#xa0;pc, __vectors_start + 0x1000&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(b)&#xa0;&#xa0;&#xa0;&#xa0;vector_pabt&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(b)&#xa0;&#xa0;&#xa0;&#xa0;vector_dabt
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(b)&#xa0;&#xa0;&#xa0;&#xa0;vector_addrexcptn&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(b)&#xa0;&#xa0;&#xa0;&#xa0;vector_irq&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;W(b)&#xa0;&#xa0;&#xa0;&#xa0;vector_fiq
    </p>
    <p>
      <b><font color="#e71010"><i>&#x7cfb;&#x7edf;&#x5b9a;&#x4e49;&#x4e86;7&#x79cd;&#x5f02;&#x5e38;&#x6a21;&#x5f0f;</i></font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1510471439970" FOLDED="true" ID="ID_520343036" MODIFIED="1560958834957">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      __stubs_start&#x4e5f;&#x5b9a;&#x4e49;&#x5728;&#x6587;&#x4ef6;entry-armv.S&#x5f53;&#x4e2d;&#xff0c;&#x5b9a;&#x4e49;&#x4e86;&#x5404;&#x79cd;&#x5f02;&#x5e38;&#x7684;&#x5904;&#x7406;&#x903b;&#x8f91;
    </p>
    <p>
      
    </p>
    <p>
      <b>__stubs_start:</b>
    </p>
    <p>
      .word&#xa0;&#xa0;&#xa0;vector_swi
    </p>
    <p>
      vector_rst:
    </p>
    <p>
      &#xa0;ARM(&#xa0;&#xa0;&#xa0;swi SYS_ERROR0&#xa0;&#xa0;)
    </p>
    <p>
      &#xa0;THUMB( svc #0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;)
    </p>
    <p>
      &#xa0;THUMB( nop&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;b&#xa0;&#xa0;&#xa0;vector_und
    </p>
    <p>
      vector_stub irq, IRQ_MODE, 4
    </p>
    <p>
      vector_stub dabt, ABT_MODE, 8
    </p>
    <p>
      vector_stub pabt, ABT_MODE, 4
    </p>
    <p>
      vector_stub und, UND_MODE
    </p>
    <p>
      vector_addrexcptn:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;b&#xa0;&#xa0;&#xa0;vector_addrexcptn
    </p>
    <p>
      vector_stub fiq, FIQ_MODE, 4
    </p>
  </body>
</html></richcontent>
<node CREATED="1510471645817" FOLDED="true" ID="ID_220290384" MODIFIED="1548949412997">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#xa0;<b>&#xa0;.macro&#xa0;&#xa0;vector_stub, name, mode, correction=0</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.align&#xa0;&#xa0;5
    </p>
    <p>
      
    </p>
    <p>
      vector_\name:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.if \correction
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;sub lr, lr, #\correction&#xa0;&#xa0;&#x8c03;&#x6574;&#x8fd4;&#x56de;&#x503c;pc,&#x6bd4;&#x5982;&#x5bf9;&#x4e8e;irq,&#x9700;&#x8981;&#x51cf;&#x53bb;&#x5f53;&#x524d;lr&#x503c;&#x7684;4&#x5c31;&#x662f;&#x8fd4;&#x56de;&#x4e4b;&#x540e;&#x7684;pc&#x503c;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.endif
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@ Save r0, lr_&lt;exception&gt; (parent PC) and spsr_&lt;exception&gt;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@ (parent CPSR)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;stmia&#xa0;&#xa0;&#xa0;sp, {r0, lr}&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ save r0, lr&#xa0; <b>stmia (Increase after)&#x5c06;ro, lr&#x4fdd;&#x5b58;&#x8d77;&#x6765;&#x4e4b;&#x540e;&#xff0c;sp&#x589e;&#x957f;&#x4e86;8</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;mrs lr, spsr
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;str lr, [sp, #8]&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ save spsr
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;<b><font color="#f61515">&#xa0;&#xa0;*********** </font></b>
    </p>
    <p>
      <b><font color="#f61515">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;r0 </font></b>
    </p>
    <p>
      <b><font color="#f61515">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;lr </font></b>
    </p>
    <p>
      <b><font color="#f61515">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;SPSR&#xa0;&#xa0;&#xa0;&lt;---------&#xa0;&#xa0;sp &#xa0; </font></b>
    </p>
    <p>
      <b><font color="#f61515">&#xa0;&#xa0;&#xa0;**************</font></b>
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@ Prepare for SVC32 mode.&#xa0;&#xa0;IRQs remain disabled.
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;mrs r0, cpsr
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;eor r0, r0, #(\mode ^ SVC_MODE | PSR_ISETSTATE)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;msr spsr_cxsf, r0
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@ the branch table must immediately follow this code
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;and lr, lr, #0x0f&#xa0;&#xa0; <b><font color="#a60f0f">*****lr&#x5f53;&#x524d;&#x4fdd;&#x5b58;&#x4e86;&#x7a0b;&#x5e8f;&#x8fdb;&#x5165;&#x5f02;&#x5e38;&#x4e4b;&#x524d;&#x7684;&#x72b6;&#x6001;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x503c;&#xff0c;&#x8fd9;&#x91cc;&#x4e0e;&#x4e0a;0x0f&#x5c31;&#x662f;&#x53d6;&#x6700;&#x4f4e;&#x7684;&#x56db;&#x4f4d;bit,&#x5373;&#x8fdb;&#x5165;&#x5f02;&#x5e38;&#x4e4b;&#x524d;&#x7684;&#x6a21;&#x5f0f;&#x7684;&#x503c;</font></b>
    </p>
    <p>
      &#xa0;THUMB( adr r0, 1f&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;)&#xa0; <b>r0&#x6307;&#x5411;&#x6807;&#x8bb0;"1:",&#x5373;&#x5b8f;&#x5b9a;&#x4e49;&#x7684;&#x7ed3;&#x675f;&#x4f4d;&#x7f6e;</b>
    </p>
    <p>
      &#xa0;THUMB( ldr lr, [r0, lr, lsl #2]&#xa0;&#xa0;&#xa0;&#xa0;)&#xa0;&#xa0; <b>r0 + lr * 4&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x5373;lr&#x6307;&#x5411;__irq_usr&#x6216;&#x8005;__irq_svc</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;mov r0, sp&#xa0;&#xa0;&#xa0;&#xa0;-----&gt; <b><i>&#x5c06;&#x5f53;&#x524d;&#x6a21;&#x5f0f;&#x7684;&#x6808;&#x6307;&#x9488;&#x4f20;&#x9012;&#x7ed9;&#x5373;&#x5c06;&#x8fdb;&#x5165;&#x7684;svc&#x6a21;&#x5f0f;&#x4f7f;&#x7528;</i></b>
    </p>
    <p>
      <b>&#xa0;ARM(&#xa0;&#xa0;&#xa0;ldr lr, [pc, lr, lsl #2]&#xa0;&#xa0;&#xa0;&#xa0;)</b>&#xa0; <b><font color="#280ef0">&#xa0;lr = &#x8fdb;&#x5165;&#x5f02;&#x5e38;&#x4e4b;&#x524d;&#x7684;&#x6a21;&#x5f0f;&#x7684;&#x503c; * 4 + &#x5f53;&#x524d;&#x7684;pc&#x503c;</font></b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;<b>movs&#xa0;&#xa0;&#xa0;&#xa0;pc, lr</b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ branch to handler in SVC mode&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      <font color="#232f7a"><b>&#x6ce8;&#x610f;&#x8fd9;&#x6bb5;&#x4ee3;&#x7801;&#x5f88;&#x5fae;&#x5999;&#xff0c;movs&#x91cc;&#x9762;&#x7684;s&#x4ee3;&#x8868;&#x5c06;spsr&#x7684;&#x503c;&#x62f7;&#x8d1d;&#x5230;cpsr&#xff0c;&#x5373;&#x6211;&#x4eec;&#x4f1a;&#x8fdb;&#x5165;svc&#x7684;&#x6a21;&#x5f0f;&#xff0c; </b></font>
    </p>
    <p>
      <font color="#232f7a"><b>&#x540c;&#x65f6;&#x6839;&#x636e;&#x4e2d;&#x65ad;&#x4e4b;&#x524d;&#x7684;&#x6a21;&#x5f0f;&#x7684;&#x503c;&#xff0c;&#x4ee3;&#x7801;&#x4f1a;&#x8df3;&#x8f6c;&#x5230;__irq_usr&#x6216;&#x8005;__irq_svc&#xff0c;&#x5373;&#x662f;&#x4ece;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x8fdb;&#x5165;&#x7684; </b></font>
    </p>
    <p>
      <font color="#232f7a"><b>&#x4e2d;&#x65ad;&#x8fd8;&#x662f;&#x4ece;&#x5185;&#x6838;&#x7a7a;&#x95f4;&#x8fdb;&#x5165;&#x7684;&#x4e2d;&#x65ad;</b></font><b>&#x3002;</b>
    </p>
    <p>
      <i><font color="#d42323">&#x4e3e;&#x4f8b;&#x5b50;&#x6765;&#x8bf4;:&#xa0;&#xa0;&#x5982;&#x4e0b;&#xff0c;&#x5982;&#x679c;&#x8fdb;irq&#x5f02;&#x5e38;&#x4e4b;&#x524d;&#x662f;usr&#x6a21;&#x5f0f;&#xff0c;&#x90a3;&#x4e48; lr = 0 * 4 + pc&#x503c;&#xff0c; &#x90a3;&#x4e48;&#x5c31;&#x4f1a;&#x8df3;&#x8f6c;&#x5230;__irq_usr&#x6807;&#x7b7e;&#x6267;&#x884c;&#x7a0b;&#x5e8f; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;vector_stub irq, IRQ_MODE, 4&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_usr&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;0&#xa0;&#xa0;(USR_26 / USR_32)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;1&#xa0;&#xa0;(FIQ_26 / FIQ_32)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;2&#xa0;&#xa0;(IRQ_26 / IRQ_32)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_svc&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;3&#xa0;&#xa0;(SVC_26 / SVC_32)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;4&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;5&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;6&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;7&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;8&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;9&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;a&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;b&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;c&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;d&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;e&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#d42323">&#xa0;&#xa0;&#xa0;&#xa0;.long&#xa0;&#xa0;&#xa0;__irq_invalid&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;f&#xa0;&#xa0; </font></i>
    </p>
    <p>
      
    </p>
    <p>
      ENDPROC(vector_\name)
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.align&#xa0;&#xa0;2
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@ handler addresses follow this label
    </p>
    <p>
      1:
    </p>
    <p>
      &#xa0; <b>&#xa0;&#xa0;.endm</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1510474222364" FOLDED="true" ID="ID_750027485" MODIFIED="1544867518866">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      __irq_usr:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;usr_entry
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;kuser_cmpxchg_check
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;irq_handler
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;get_thread_info tsk
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;mov why, #0
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;b&#xa0;&#xa0;&#xa0;ret_to_user_from_irq
    </p>
    <p>
      &#xa0;UNWIND(.fnend&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;)
    </p>
    <p>
      ENDPROC(__irq_usr)
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      .macro&#xa0;&#xa0;irq_handler
    </p>
    <p>
      #ifdef CONFIG_MULTI_IRQ_HANDLER
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ldr r1, =handle_arch_irq
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;mov r0, sp
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;badr&#xa0;&#xa0;&#xa0;&#xa0;lr, 9997f
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ldr pc, [r1]
    </p>
    <p>
      #else
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;arch_irq_handler_default
    </p>
    <p>
      #endif
    </p>
    <p>
      9997:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.endm
    </p>
    <p>
      
    </p>
    <p>
      /*
    </p>
    <p>
      &#xa0;* Interrupt handling.&#xa0;&#xa0;Preserves r7, r8, r9
    </p>
    <p>
      &#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.macro&#xa0;&#xa0;arch_irq_handler_default
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;<b>get_irqnr_preamble r6, lr</b>&#xa0; &#x8be5;&#x51fd;&#x6570;&#x5728;s3c2440&#x5e73;&#x53f0;&#x4e0b;&#x9762;&#x662f;&#x7a7a;&#x51fd;&#x6570;
    </p>
    <p>
      1:&#xa0;&#xa0;<b>get_irqnr_and_base r0, r2, r6, lr&#xa0; &#x8be5;&#x51fd;&#x6570;&#x5728;3.0&#x5185;&#x6838;&#x7248;&#x672c;&#x4e4b;&#x540e;&#x9488;&#x5bf9;s3c2440&#x7684;&#x4ee3;&#x7801;&#x597d;&#x50cf;&#x5df2;&#x7ecf;&#x6d88;&#x5931;&#xff0c; </b>
    </p>
    <p>
      &#x53ea;&#x5728;2.6&#x5185;&#x6838;&#x4ee3;&#x7801;&#x91cc;&#x9762;&#x627e;&#x5230;&#x5bf9;&#x5e94;&#x7684;&#x5b9e;&#x73b0;&#xff0c;&#x53ef;&#x4ee5;&#x53c2;&#x8003;&#x4e00;&#x4e0b;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;movne&#xa0;&#xa0;&#xa0;r1, sp
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@ routine called with r0 = irq number, r1 = struct pt_regs *
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;@&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;badrne&#xa0;&#xa0;lr, 1b
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;bne asm_do_IRQ
    </p>
    <p>
      
    </p>
    <p>
      #ifdef CONFIG_SMP
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/*&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* XXX
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* this macro assumes that irqstat (r2) and base (r6) are
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* preserved from get_irqnr_and_base above
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ALT_SMP(test_for_ipi r0, r2, r6, lr)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ALT_UP_B(9997f)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;movne&#xa0;&#xa0;&#xa0;r1, sp
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;badrne&#xa0;&#xa0;lr, 1b
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;bne do_IPI
    </p>
    <p>
      #endif
    </p>
    <p>
      9997:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.endm
    </p>
  </body>
</html></richcontent>
<node CREATED="1510501465739" ID="ID_544420287" MODIFIED="1510501780182">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mach-s3c2410/include/mach/entry-macro.S
    </p>
    <p>
      
    </p>
    <p>
      <b>.macro&#xa0;&#xa0;get_irqnr_and_base, irqnr, irqstat, base, tmp </b>
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mov \base, #S3C24XX_VA_IRQ
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@@ try the interrupt offset register, since it is there
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ldr \irqstat, [ \base, #INTPND ]
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;teq \irqstat, #0
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;beq 1002f
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ldr \irqnr, [ \base, #INTOFFSET ]
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mov \tmp, #1
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;tst \irqstat, \tmp, lsl \irqnr
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bne 1001f
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@@ the number specified is not a valid irq, so try
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@@ and work it out for ourselves
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mov \irqnr, #0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@@ start here
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@@ work out which irq (if any) we got
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;movs&#xa0;&#xa0;&#xa0;&#xa0;\tmp, \irqstat, lsl#16
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;addeq&#xa0;&#xa0;&#xa0;\irqnr, \irqnr, #16
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;moveq&#xa0;&#xa0;&#xa0;\irqstat, \irqstat, lsr#16
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;tst \irqstat, #0xff
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;addeq&#xa0;&#xa0;&#xa0;\irqnr, \irqnr, #8
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;moveq&#xa0;&#xa0;&#xa0;\irqstat, \irqstat, lsr#8
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;tst \irqstat, #0xf
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;addeq&#xa0;&#xa0;&#xa0;\irqnr, \irqnr, #4
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;moveq&#xa0;&#xa0;&#xa0;\irqstat, \irqstat, lsr#4
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;tst \irqstat, #0x3
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;addeq&#xa0;&#xa0;&#xa0;\irqnr, \irqnr, #2
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;moveq&#xa0;&#xa0;&#xa0;\irqstat, \irqstat, lsr#2
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;tst \irqstat, #0x1
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;addeq&#xa0;&#xa0;&#xa0;\irqnr, \irqnr, #1
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@@ we have the value
    </p>
    <p>
      1001:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;adds&#xa0;&#xa0;&#xa0;&#xa0;\irqnr, \irqnr, #IRQ_EINT0
    </p>
    <p>
      1002:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@@ exit here, Z flag unset if IRQ
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.endm
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* currently don't need an disable_fiq macro */
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.macro&#xa0;&#xa0;disable_fiq
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.endm</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1542986996543" ID="ID_884424485" MODIFIED="1542987039889">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>vector_swi</b>&#x5b9a;&#x4e49;&#x5728;&#x6587;&#x4ef6;<b>entry-common.S</b>&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1510587987982" FOLDED="true" ID="ID_92627058" MODIFIED="1560958842060">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#2418e9">s3c2440&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x5b66;&#x4e60;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1510588667180" ID="ID_1140848239" MODIFIED="1510589402883">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#d21515">s3c2440&#x7684;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x6bd4;&#x8f83;&#x7b80;&#x5355;&#xff0c;&#x8ddf;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x76f8;&#x5173;&#x7684;&#x4e94;&#x4e2a;&#x5bc4;&#x5b58;&#x5668;&#x5982;&#x4e0b;:</font></b>
    </p>
    <p>
      <b>source pending register</b>&#xa0; &#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x4f1a;&#x8bb0;&#x5f55;&#x4e2d;&#x65ad;&#x53d1;&#x751f;&#x6e90;&#xff0c;&#x5f53;mask&#x5bc4;&#x5b58;&#x5668;&#x67d0;&#x4e2a;&#x4f4d;&#x88ab;&#x7f6e;1&#x7684;&#x65f6;&#x5019;&#xff0c;&#x8be5;pending&#x5bc4;&#x5b58;&#x5668;&#x5bf9;&#x5e94;&#x7684;&#x4f4d;&#x7f6e;&#x4e5f;&#x4f1a;&#x7f6e;1
    </p>
    <p>
      <b>interrupt mode register</b>&#xa0; &#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x5c06;pending&#x5bc4;&#x5b58;&#x5668;&#x5f53;&#x4e2d;&#x7684;&#x4e2d;&#x65ad;&#x5206;&#x6210;irq&#x4e2d;&#x65ad;&#x548c;fiq&#x4e2d;&#x65ad;&#xff0c;&#x4ece;datasheet&#x7684;&#x903b;&#x8f91;&#x6846;&#x56fe;&#x770b;firq&#x4e0d;&#x53d7;mask&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x5f71;&#x54cd;
    </p>
    <p>
      <b>mask register</b>
    </p>
    <p>
      <b>priority register</b>
    </p>
    <p>
      <b>interrupt pending register</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1526982556400" FOLDED="true" ID="ID_1183321409" MODIFIED="1565876754793">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">tiny4412&#x4e2d;&#x65ad;&#x7cfb;&#x7edf;&#x4ee3;&#x7801;&#x5b66;&#x4e60;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526982612255" FOLDED="true" ID="ID_1999652857" MODIFIED="1560958817523">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#2411f0">gic&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x6ce8;&#x518c; </font></b>
    </p>
    <p>
      
    </p>
    <p>
      &#x4ee3;&#x7801;&#x4f4d;&#x7f6e;:
    </p>
    <p>
      drivers/irqchip/irq-gic.c
    </p>
    <p>
      arch/arm/mach-exynos/exynos.c
    </p>
    <p>
      arch/arm/kernel/entry-armv.S
    </p>
  </body>
</html></richcontent>
<node CREATED="1526982773237" ID="ID_1236269787" MODIFIED="1526989690587">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x521d;&#x59cb;&#x5316;&#x7684;&#x4ee3;&#x7801;&#x662f;gic_of_init&#xff0c;&#x4f4d;&#x4e8e;irq-gic.c&#x6587;&#x4ef6;&#x91cc;&#x9762;</b>
    </p>
    <p>
      &#x6211;&#x4eec;&#x770b;&#x5230;&#x5728;&#x8be5;&#x6587;&#x4ef6;&#x91cc;&#x9762;&#x6709;&#x5982;&#x4e0b;&#x7684;&#x58f0;&#x660e;:
    </p>
    <p>
      IRQCHIP_DECLARE(cortex_a9_gic, "arm,cortex-a9-gic", gic_of_init);
    </p>
    <p>
      
    </p>
    <p>
      #define IRQCHIP_DECLARE(name, compat, fn) OF_DECLARE_2(irqchip, name, compat, fn)
    </p>
    <p>
      
    </p>
    <p>
      #define OF_DECLARE_2(table, name, compat, fn) \
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;_OF_DECLARE(table, name, compat, fn, of_init_fn_2)
    </p>
    <p>
      
    </p>
    <p>
      #define _OF_DECLARE(table, name, compat, fn, fn_type)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;\
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;static const struct of_device_id __of_table_##name&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;\
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__used __section(__##table##_of_table)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;\
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= { .compatible = compat,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;\
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.data = (fn == (fn_type)NULL) ? fn : fn&#xa0;&#xa0;}
    </p>
    <p>
      &#x53ef;&#x89c1;&#x8fd9;&#x91cc;&#x58f0;&#x660e;&#x4e86;&#x4e00;&#x4e2a;struct of_device_id&#x7684;&#x53d8;&#x91cf;&#xff0c;&#x5c06;gic_of_init&#x8d4b;&#x503c;&#x7ed9;&#x4e86;&#x8be5;&#x53d8;&#x91cf;&#x7684;data&#x6210;&#x5458;&#xff0c;
    </p>
    <p>
      &#x5e76;&#x4e14;&#x8be5;&#x53d8;&#x53d8;&#x91cf;&#x88ab;&#x7edf;&#x4e00;&#x653e;&#x7f6e;&#x5230;&#x4e86;&#x5185;&#x6838;&#x7684; __irqchip_of_table&#x6bb5;&#xff0c;&#x5f53;&#x7cfb;&#x7edf;&#x542f;&#x52a8;&#x7684;&#x65f6;&#x5019;&#x4f1a;&#x8c03;&#x7528;mach-exynos/exynos.c
    </p>
    <p>
      &#x6587;&#x4ef6;&#x91cc;&#x9762;&#x7684;machine&#x63cf;&#x8ff0;&#x7b26;&#x91cc;&#x9762;&#x7684;.init_irq&#x51fd;&#x6570;&#xff0c;&#x5373;exynos_init_irq&#x51fd;&#x6570;&#x3002;
    </p>
    <p>
      exynos_init_irq ------&gt; irqchip_init ------&gt; of_irq_init(__irqchip_of_table) &#x904d;&#x5386;&#x8be5;table&#x6bb5;&#xff0c;&#x6700;&#x7ec8;&#x8c03;&#x7528;
    </p>
    <p>
      &#x5230;&#x51fd;&#x6570;gic_of_init&#x51fd;&#x6570;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527037455543" FOLDED="true" ID="ID_1330730680" MODIFIED="1560958813740">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x770b;&#x4e00;&#x4e0b;&#x51fd;&#x6570;:
    </p>
    <p>
      &#x57fa;&#x4e8e;kernel 4.4.40&#x5206;&#x6790;&#xff0c;&#x53c2;&#x8003;http://www.wowotech.net/linux_kenrel/gic_driver.html
    </p>
    <p>
      static int&#xa0;&#xa0;__init
    </p>
    <p>
      <b><font size="4">gic_of_init</font></b>(struct device_node *node, struct device_node *parent)
    </p>
  </body>
</html></richcontent>
<node CREATED="1527043612782" ID="ID_951107162" MODIFIED="1527043659678">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>dist_base = of_iomap(node, 0);</b>
    </p>
    <p>
      &#x6620;&#x5c04;distributor&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x5730;&#x5740;&#x7a7a;&#x95f4;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527043674478" ID="ID_462600256" MODIFIED="1527043706276">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>cpu_base = of_iomap(node, 1);&#xa0;</b>
    </p>
    <p>
      &#x83b7;&#x53d6;cpu interface&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x5730;&#x5740;&#x6620;&#x5c04;&#x7a7a;&#x95f4;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1550916389571" ID="ID_596485602" MODIFIED="1550935557919">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (gic_cnt == 0 &amp;&amp; !gic_check_eoimode(node, &amp;cpu_base))
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;<b>static_key_slow_dec(&amp;supports_deactivat</b>e);
    </p>
    <p>
      
    </p>
    <p>
      &#x5224;&#x65ad;&#x8be5;gic&#x662f;&#x5426;&#x652f;&#x6301;eoimode, eoimode&#x662f;&#x4ece;gic v2&#x5f00;&#x59cb;&#x652f;&#x6301;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x5f53;&#x524d;&#x4f7f;&#x7528;&#x7684;gic v1&#x662f;&#x4e0d;&#x652f;&#x6301;&#x7684;&#xff0c;
    </p>
    <p>
      &#x90a3;&#x4e48;&#x5c31;&#x5c06;supports_deactivate&#x7684;&#x503c;&#x7ed9;&#x53cd;&#x8f6c;&#x8fc7;&#x6765;&#xff0c;&#x8fd9;&#x91cc;&#x7684;&#x5904;&#x7406;&#x4f1a;&#x5f71;&#x54cd;&#x51fd;&#x6570;
    </p>
    <p>
      gic_irq_domain_map&#x7684;&#x6267;&#x884c;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#3a1cf1" DESTINATION="ID_596485602" ENDARROW="None" ENDINCLINATION="5684;0;" ID="Arrow_ID_1382277748" SOURCE="ID_867725001" STARTARROW="None" STARTINCLINATION="3111;0;"/>
</node>
<node CREATED="1527044206696" FOLDED="true" ID="ID_1827729914" MODIFIED="1560958811532">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3" color="#eb2c2c"><i>if (of_property_read_u32(node, "cpu-offset", &amp;percpu_offset)) </i></font>
    </p>
    <p>
      <font size="3" color="#eb2c2c"><i>&#xa0;&#xa0;&#xa0;&#xa0;percpu_offset = 0; </i></font>
    </p>
    <p>
      <font size="3" color="#eb2c2c"><i>&#x5904;&#x7406;cpu-offset&#x5c5e;&#x6027;</i></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527045930365" ID="ID_27329532" MODIFIED="1527045941324">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8981;&#x4e86;&#x89e3;cpu-offset&#x5c5e;&#x6027;&#xff0c;&#x9996;&#x5148;&#x8981;&#x4e86;&#x89e3;&#x4ec0;&#x4e48;&#x662f;banked register&#x3002;
    </p>
    <p>
      &#x6240;&#x8c13;banked register&#x5c31;&#x662f;&#x5728;&#x4e00;&#x4e2a;&#x5730;&#x5740;&#x4e0a;&#x63d0;&#x4f9b;&#x591a;&#x4e2a;&#x5bc4;&#x5b58;&#x5668;&#x526f;&#x672c;&#x3002;
    </p>
    <p>
      &#x6bd4;&#x5982;&#x8bf4;&#x7cfb;&#x7edf;&#x4e2d;&#x6709;&#x56db;&#x4e2a;CPU&#xff0c;&#x8fd9;&#x4e9b;CPU&#x8bbf;&#x95ee;&#x67d0;&#x4e2a;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x65f6;&#x5019;&#x5730;&#x5740;&#x662f;&#x4e00;&#x6837;&#x7684;&#xff0c;
    </p>
    <p>
      &#x4f46;&#x662f;&#x5bf9;&#x4e8e;banked register&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#xff0c;&#x4e0d;&#x540c;&#x7684;CPU&#x8bbf;&#x95ee;&#x7684;&#x662f;&#x4e0d;&#x540c;&#x7684;&#x5bc4;&#x5b58;&#x5668;&#xff0c;
    </p>
    <p>
      &#x867d;&#x7136;&#x5b83;&#x4eec;&#x7684;&#x5730;&#x5740;&#x662f;&#x4e00;&#x6837;&#x7684;&#x3002;&#x5982;&#x679c;GIC&#x6ca1;&#x6709;banked register&#xff0c;
    </p>
    <p>
      &#x90a3;&#x4e48;&#x9700;&#x8981;&#x63d0;&#x4f9b;&#x6839;&#x636e;CPU index&#x7ed9;&#x51fa;&#x4e00;&#x7cfb;&#x5217;&#x5730;&#x5740;&#x504f;&#x79fb;&#xff0c;&#x800c;&#x5730;&#x5740;&#x504f;&#x79fb;=cpu-offset * cpu-nr&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1527044321552" FOLDED="true" ID="ID_1225604136" MODIFIED="1560958807252">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>__gic_init_bases(gic_cnt, -1, dist_base, cpu_base, percpu_offset, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&amp;node-&gt;fwnode); </b>
    </p>
    <p>
      
    </p>
    <p>
      <b>static void __init __gic_init_bases(unsigned int gic_nr, int irq_start,&#xa0;&#xa0;void __iomem *dist_base, void __iomem *cpu_base,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u32 percpu_offset, struct fwnode_handle *handle)&#xa0; </b>
    </p>
    <p>
      irq_start&#x4e3a;-1&#x8868;&#x793a;&#x4e0d;&#x6307;&#x5b9a;IRQ number, &#x6709;&#x7684;&#x573a;&#x666f;&#x4f1a;&#x6307;&#x5b9a;irq_start,&#x8fd9;&#x4e2a;&#x65f6;&#x5019;&#x9700;&#x8981;&#x5bf9;irq_start&#x8fdb;&#x884c;&#x5bf9;&#x5176;&#x7684;&#x64cd;&#x4f5c;.
    </p>
  </body>
</html></richcontent>
<node CREATED="1527062311864" ID="ID_196995705" MODIFIED="1527062352657">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gic = &amp;gic_data[gic_nr];
    </p>
    <p>
      
    </p>
    <p>
      get gic chip data
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527062534623" ID="ID_681772391" MODIFIED="1535294640445">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gic-&gt;dist_base.common_base = dist_base;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      gic-&gt;cpu_base.common_base = cpu_base;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      gic_set_base_accessor(gic, gic_get_common_base); //&#x8be5;&#x51fd;&#x6570;&#x662f;&#x9488;&#x5bf9;non banked&#x5bc4;&#x5b58;&#x5668;&#x6a21;&#x5f0f;&#x7684;&#xff0c;
    </p>
    <p>
      &#x5728;banked &#x5bc4;&#x5b58;&#x5668;&#x6a21;&#x5f0f;&#x4e0b;&#x9762;&#x8be5;&#x51fd;&#x6570;&#x4e0d;&#x8d77;&#x4efb;&#x4f55;&#x4f5c;&#x7528;
    </p>
    <p>
      
    </p>
    <p>
      <b>save the distributor base address and cpu interface base address</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527062932541" FOLDED="true" ID="ID_968908173" MODIFIED="1560958804676">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gic_irqs = readl_relaxed(gic_data_dist_base(gic) + GIC_DIST_CTR) &amp; 0x1f; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;gic_irqs = (gic_irqs + 1) * 32;
    </p>
    <p>
      
    </p>
    <p>
      #define GIC_DIST_CTR&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;0x004
    </p>
    <p>
      
    </p>
    <p>
      <b>&#x83b7;&#x53d6;&#x8be5;gic&#x6240;&#x652f;&#x6301;&#x7684;&#x6700;&#x5927;&#x7684;&#x4e2d;&#x65ad;&#x6570;&#x91cf; </b>
    </p>
    <p>
      
    </p>
    <p>
      <b>if (gic_irqs &gt; 1020) </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gic_irqs = 1020; </b>
    </p>
    <p>
      &#x5728;&#x67d0;&#x4e2a;cpu&#x7684;context&#x4e0b;&#x53ea;&#x652f;&#x6301;&#x6700;&#x5927;1020&#x4e2a;&#x4e2d;&#x65ad;
    </p>
  </body>
</html></richcontent>
<node CREATED="1546673456912" ID="ID_111006518" MODIFIED="1546673491594">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/GIC-ICDICTR.png"/>
  </body>
</html></richcontent>
</node>
</node>
<node COLOR="#000000" CREATED="1527062994684" FOLDED="true" ID="ID_1571655776" MODIFIED="1560958800596">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gic-&gt;domain = irq_domain_create_linear(handle, gic_irqs,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&amp;gic_irq_domain_hierarchy_ops,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gic);
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      static inline struct irq_domain *irq_domain_create_linear(struct fwnode_handle *fwnode,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; <b><font color="#ed1616">unsigned int size</font></b>,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct irq_domain_ops *ops,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *host_data)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      {&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0; <b>return __irq_domain_add(fwnode, size, size, 0, ops, host_data);</b>
    </p>
    <p>
      }
    </p>
    <p>
      
    </p>
    <p>
      &#x6b64;&#x65f6;&#x6ca1;&#x6709;&#x5206;&#x914d;virtual irq, &#x4e5f;&#x6ca1;&#x6709;&#x8bbe;&#x7f6e;virtual irq&#x5f88;hw irq&#x4e4b;&#x95f4;&#x7684;&#x6620;&#x5c04;&#x5173;&#x7cfb;&#xff0c;&#x5230;&#x540e;&#x9762;&#x6709;&#x4eba;&#x7533;&#x8bf7;&#x7684;&#x65f6;&#x5019;&#x4f1a;&#x5efa;&#x7acb;&#x8be5;&#x6620;&#x5c04;
    </p>
  </body>
</html></richcontent>
<node CREATED="1527063346406" FOLDED="true" ID="ID_1449831963" MODIFIED="1560958799397">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#291aed"><i>__irq_domain_add(fwnode, size, size, 0, ops, host_data)</i></font></b>
    </p>
    <p>
      
    </p>
    <p>
      /**
    </p>
    <p>
      &#xa0;* __irq_domain_add() - Allocate a new irq_domain data structure
    </p>
    <p>
      &#xa0;* @of_node: optional device-tree node of the interrupt controller&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;* @size: Size of linear map; 0 for radix mapping only
    </p>
    <p>
      &#xa0;* @hwirq_max: Maximum number of interrupts supported by controller
    </p>
    <p>
      &#xa0;* @direct_max: Maximum value of direct maps; Use ~0 for no limit; 0 for no&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;*&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;direct mapping&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;* @ops: domain callbacks
    </p>
    <p>
      &#xa0;* @host_data: Controller private data pointer&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;*
    </p>
    <p>
      &#xa0;* Allocates and initialize and irq_domain structure.&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;* Returns pointer to IRQ domain, or NULL on failure.&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;*/
    </p>
    <p>
      struct irq_domain *__irq_domain_add(struct fwnode_handle *fwnode, int size,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t hwirq_max, int direct_max,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct irq_domain_ops *ops,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *host_data)
    </p>
  </body>
</html></richcontent>
<node CREATED="1527256477024" ID="ID_800428195" MODIFIED="1527256541794">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x52a8;&#x6001;&#x5206;&#x914d;&#x4e00;&#x4e2a;irq domain
    </p>
    <p>
      struct irq_domain *domain;
    </p>
    <p>
      domain = kzalloc_node(sizeof(*domain) + (sizeof(unsigned int) * size),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;GFP_KERNEL, of_node_to_nid(of_node));
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527256547552" ID="ID_1021508160" MODIFIED="1558447805254">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x521d;&#x59cb;&#x5316;irq domain &#xff08;&#x7531;&#x4e8e;&#x4f20;&#x5165;&#x7684;&#x53c2;&#x6570;&#x5f53;&#x4e2d;size&#x4e0d;&#x4e3a;&#x96f6;&#xff0c;direct_max&#x4e3a;&#x96f6;,
    </p>
    <p>
      &#x5f88;&#x660e;&#x663e;&#x5730;&#x914d;&#x7f6e;&#x7684;&#x662f;&#x7ebf;&#x6027;&#x6620;&#x5c04;)
    </p>
    <p>
      
    </p>
    <p>
      INIT_RADIX_TREE(&amp;domain-&gt;revmap_tree, GFP_KERNEL);
    </p>
    <p>
      <b>domain-&gt;ops = ops;</b>
    </p>
    <p>
      
    </p>
    <p>
      static const struct irq_domain_ops <b>gic_irq_domain_hierarchy_ops</b>&#xa0;= {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.translate = gic_irq_domain_translate,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.alloc = gic_irq_domain_alloc,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.free = irq_domain_free_irqs_top,
    </p>
    <p>
      };
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      domain-&gt;host_data = host_data;
    </p>
    <p>
      domain-&gt;fwnode = fwnode;
    </p>
    <p>
      domain-&gt;hwirq_max = hwirq_max;
    </p>
    <p>
      domain-&gt;revmap_size = size;
    </p>
    <p>
      domain-&gt;revmap_direct_max_irq = direct_max;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#da1919" DESTINATION="ID_1021508160" ENDARROW="Default" ENDINCLINATION="2457;0;" ID="Arrow_ID_887632958" SOURCE="ID_1580496762" STARTARROW="None" STARTINCLINATION="-303;-86;"/>
</node>
<node CREATED="1527257267107" ID="ID_41936618" MODIFIED="1527257312284">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#341ff5">irq_domain_check_hierarchy(domain);</font></b>
    </p>
    <p>
      &#x6dfb;&#x52a0;IRQ_DOMAIN_FLAG_HIERARCHY&#x6807;&#x5fd7;&#x4f4d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527257336019" ID="ID_1729295102" MODIFIED="1527257372839">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>list_add(&amp;domain-&gt;link, &amp;irq_domain_list);</i></b>
    </p>
    <p>
      &#x5c06;&#x8be5;irq domain&#x6dfb;&#x52a0;&#x5230;&#x7cfb;&#x7edf;irq domain&#x7684;&#x94fe;&#x8868;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1527258138547" ID="ID_817350386" MODIFIED="1527258546306">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5982;&#x679c;&#x5f53;&#x524d;&#x7684;gic controller&#x662f;root controller,&#x5219;&#x8fdb;&#x884c;&#x5982;&#x4e0b;&#x7684;&#x52a8;&#x4f5c;
    </p>
    <p>
      
    </p>
    <p>
      set_smp_cross_call(gic_raise_softirq);&#xa0;&#xa0;&#x8bbe;&#x7f6e;&#x591a;&#x4e2a;cpu&#x4e4b;&#x95f4;&#x901a;&#x4fe1;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;
    </p>
    <p>
      &#x4e3a;gic_raise_softirq, &#x8be5;&#x51fd;&#x6570;&#x7684;&#x4f5c;&#x7528;&#x5176;&#x5b9e;&#x662f;&#x7528;&#x6765;&#x51fa;&#x53d1;IPI&#x4e2d;&#x65ad;
    </p>
    <p>
      
    </p>
    <p>
      register_cpu_notifier(&amp;gic_cpu_notifier);&#xa0;&#xa0;&#x5f53;cpu&#x7684;&#x72b6;&#x6001;&#x53d1;&#x751f;&#x53d8;&#x5316;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x9700;&#x8981;&#x901a;&#x77e5;
    </p>
    <p>
      gic,&#x8fd9;&#x91cc;&#x662f;&#x5411;&#x901a;&#x77e5;&#x94fe;&#x4e0a;&#x6ce8;&#x518c;&#x4e00;&#x4e2a;&#x56de;&#x8c03;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527258588569" ID="ID_735150460" MODIFIED="1549420637619">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>set_handle_irq(gic_handle_irq); </b>
    </p>
    <p>
      <font color="#d30b0b">&#x8bbe;&#x5b9a;&#x8ddf;arch&#x76f8;&#x5173;&#x7684;irq handler</font>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#1511ec" DESTINATION="ID_735150460" ENDARROW="Default" ENDINCLINATION="2126;0;" ID="Arrow_ID_594282455" SOURCE="ID_952819675" STARTARROW="None" STARTINCLINATION="512;0;"/>
</node>
<node CREATED="1527258723098" ID="ID_279297015" MODIFIED="1549435638497">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>gic_dist_init(gic); </b>
    </p>
    <p>
      <b>gic_cpu_init(gic); </b>
    </p>
    <p>
      <b>gic_pm_init(gic);</b>
    </p>
    <p>
      &#x5bf9;gic&#x7684;distributor, cpu interface, pm&#x6a21;&#x5757;&#x8fdb;&#x884c;&#x521d;&#x59cb;&#x5316;&#x64cd;&#x4f5c;
    </p>
  </body>
</html></richcontent>
<node CREATED="1527263968617" FOLDED="true" ID="ID_1822864386" MODIFIED="1560958797509">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#2408f6">static void __init gic_dist_init(struct gic_chip_data *gic)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527264027089" ID="ID_1002812060" MODIFIED="1527264049321">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      unsigned int gic_irqs = gic-&gt;gic_irqs;
    </p>
    <p>
      &#x83b7;&#x53d6;&#x652f;&#x6301;&#x7684;irq&#x7684;&#x6570;&#x91cf;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527264066841" ID="ID_41171938" MODIFIED="1527264098838">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x83b7;&#x53d6;distributor&#x7684;&#x57fa;&#x5730;&#x5740;
    </p>
    <p>
      void __iomem *base = gic_data_dist_base(gic);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527264587301" ID="ID_1684360765" MODIFIED="1527264624373">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>writel_relaxed(GICD_DISABLE, base + GIC_DIST_CTRL);</b>
    </p>
    <p>
      <b>&#x7981;&#x6b62;&#x6240;&#x6709;&#x7684;&#x5916;&#x56f4;&#x8bbe;&#x5907;&#x4e2d;&#x65ad;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527299085047" ID="ID_1547183112" MODIFIED="1558838066053">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      cpumask = gic_get_cpumask(gic);
    </p>
    <p>
      &#x6211;&#x4eec;&#x770b;&#x4e00;&#x4e0b;&#x8be5;&#x51fd;&#x6570;&#x7684;&#x5b9e;&#x73b0;&#x5185;&#x5bb9;:
    </p>
    <p>
      for (i = mask = 0; i &lt; 32; i += 4) {
    </p>
    <p>
      mask = readl_relaxed(base + GIC_DIST_TARGET + i);
    </p>
    <p>
      mask |= mask &gt;&gt; 16;
    </p>
    <p>
      mask |= mask &gt;&gt; 8;
    </p>
    <p>
      if (mask)
    </p>
    <p>
      break;
    </p>
    <p>
      }
    </p>
    <p>
      gic&#x521d;&#x59cb;&#x5316;&#x90e8;&#x5206;&#x7684;&#x4ee3;&#x7801;&#x5728;&#x7cfb;&#x7edf;&#x542f;&#x52a8;&#x7684;&#x65f6;&#x5019;&#x662f;&#x7531;&#x67d0;&#x4e2a;&#x56fa;&#x5b9a;&#x7684;cpu&#x6838;&#x5fc3;&#x6765;&#x6267;&#x884c;&#x7684;&#xff0c;gic&#x7684;&#x524d;32&#x4e2a;&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x5373;SGI&#x4e2d;&#x65ad;&#x548c;PPI&#x4e2d;&#x65ad;&#x662f;cpu&#x6838;&#x5fc3;&#x72ec;&#x4eab;&#x7684;&#x4e2d;&#x65ad;&#xff0c;Processor targets register&#x91cc;&#x9762;&#x8bb0;&#x5f55;&#x4e86;&#x524d;32&#x4e2a;&#x4e2d;&#x65ad;&#x5404;&#x81ea;
    </p>
    <p>
      &#x8def;&#x7531;&#x5230;&#x54ea;&#x4e2a;cpu&#x6838;&#x5fc3;&#x4e86;&#x3002;&#x8bb0;&#x5f55;SGI&#x548c;PPI&#x8def;&#x7531;&#x60c5;&#x51b5;&#x4e00;&#x5171;&#x9700;&#x8981;&#x516b;&#x4e2a;&#x8fd9;&#x6837;&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x3002;&#xff08;<font color="#ef0c0c">&#x4e00;&#x4e2a;&#x5bc4;&#x5b58;&#x5668;&#x662f;32bit,&#x53ef;&#x4ee5;&#x6309;8 bit&#x4e00;&#x7ec4; </font>
    </p>
    <p>
      <font color="#ef0c0c">&#x5206;&#x6210;4&#x7ec4;&#xff0c;&#x6bcf;&#x4e00;&#x7ec4;&#x4ee3;&#x8868;&#x67d0;&#x4e2a;&#x4e2d;&#x65ad;id&#x53f7;&#x8def;&#x7531;&#x5230;&#x7684;cpu interface&#x7684;&#x7f16;&#x53f7;&#xff0c;&#x6240;&#x4ee5;&#x4e00;&#x4e2a;32bit&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x53ef;&#x4ee5;&#x914d;&#x7f6e;4&#x4e2a;&#x4e2d;&#x65ad;&#x6240;&#x5bf9;&#x5e94; </font>
    </p>
    <p>
      <font color="#ea0909">&#x7684;cpu interface</font>&#xff09;
    </p>
    <p>
      &#x5047;&#x8bbe;&#x76ee;&#x524d;&#x662f;&#x7531;cpu0&#x6765;&#x6267;&#x884c;&#x521d;&#x59cb;&#x5316;&#x4ee3;&#x7801;&#xff0c;&#x90a3;&#x4e48;&#x53ef;&#x4ee5;&#x77e5;&#x9053;&#x6240;&#x6709;&#x7684;cpu0&#x6240;&#x79c1;&#x6709;&#x7684;SGI&#x548c;PPI&#x4e2d;&#x65ad;&#x5c31;&#x662f;&#x7531;cpu0&#x6765;&#x6267;&#x884c;&#x7684;&#xff0c;
    </p>
    <p>
      &#x90a3;&#x4e48;Processor targets register&#x91cc;&#x9762;&#x8bb0;&#x5f55;&#x7684;&#x6570;&#x503c;&#x8fd8;&#x6709;&#x4ec0;&#x4e48;&#x610f;&#x4e49;&#x5462;&#xff1f;&#x5b9e;&#x9645;&#x4e0a;&#x6b64;&#x65f6;&#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x91cc;&#x9762;&#x8bb0;&#x5f55;&#x7684;&#x6570;&#x503c;&#x6807;&#x6ce8;&#x7684;
    </p>
    <p>
      &#x662f;cpu interface&#x7684;&#x7f16;&#x53f7;&#xff0c;&#x6240;&#x4ee5;32&#x4e2a;&#x4e2d;&#x65ad;&#x5bf9;&#x5e94;&#x7684;Processor targets register&#x91cc;&#x9762;&#x7684;&#x7f16;&#x53f7;&#x5e94;&#x8be5;&#x90fd;&#x662f;&#x4e00;&#x6837;&#x7684;&#xff0c;
    </p>
    <p>
      &#x5047;&#x8bbe;&#x8bfb;&#x53d6;&#x51fa;&#x6765;&#x7684;&#x8be5;&#x7f16;&#x53f7;&#x5373;mask&#x7684;&#x503c;&#x662f;0b0001000,&#x90a3;&#x4e48;&#x53ef;&#x4ee5;&#x65ad;&#x5b9a;cpu0&#x8ddf;cpu interface4&#x662f;&#x786c;&#x4ef6;&#x4e0a;&#x8fde;&#x63a5;&#x5728;&#x4e00;&#x8d77;&#x7684;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      &#x7efc;&#x4e0a;&#x6240;&#x8ff0;&#xff0c;gic_get_cpumask&#x5b9e;&#x9645;&#x4e0a;&#x662f;&#x8bfb;&#x53d6;&#x51fa;&#x542f;&#x52a8;cpu&#x548c;cpu interface&#x7684;&#x8fde;&#x63a5;&#x60c5;&#x51b5;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527321412209" ID="ID_1430618805" MODIFIED="1527321530610">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      cpumask |= cpumask &lt;&lt; 8;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      cpumask |= cpumask &lt;&lt; 16;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      for (i = 32; i &lt; gic_irqs; i += 4)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;writel_relaxed(cpumask, base + GIC_DIST_TARGET + i * 4 / 4);
    </p>
    <p>
      
    </p>
    <p>
      &#x8fd9;&#x91cc;&#x662f;&#x5c06;&#x8bfb;&#x53d6;&#x51fa;&#x6765;&#x7684;8bit cpu mask&#x590d;&#x5236;&#x5230;32bit&#x7a7a;&#x95f4;&#x91cc;&#x9762;&#xff0c;&#x5373;&#x4e00;&#x4e2a;32bit&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x53ef;&#x4ee5;&#x5bf9;4&#x4e2a;&#x4e2d;&#x65ad;&#x8bbe;&#x7f6e;&#x8def;&#x7531;&#x7684;cpu interface&#x7f16;&#x53f7;&#x3002;
    </p>
    <p>
      &#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x770b;&#x5230;&#x8fd9;&#x91cc;&#x662f;&#x5c06;&#x5269;&#x4e0b;&#x7684;&#x4e2d;&#x65ad;&#x5373;SPI&#x4e2d;&#x65ad;&#x90fd;&#x8def;&#x7531;&#x5230;&#x4e86;cpumask&#x5bf9;&#x5e94;&#x7684;cpu interface&#x4e0a;&#x4e86;&#xff0c;&#x5373;&#x7edf;&#x7edf;&#x7531;boot cpu&#x6765;&#x5904;&#x7406;&#x6240;&#x6709;&#x7684;
    </p>
    <p>
      spi&#x4e2d;&#x65ad;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527321611922" ID="ID_510714027" MODIFIED="1527321630722">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gic_dist_config(base, gic_irqs, NULL);
    </p>
    <p>
      &#x8bbe;&#x7f6e;&#x5176;&#x4ed6;&#x7684;&#x4e00;&#x4e9b;&#x5bc4;&#x5b58;&#x5668;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527321643266" ID="ID_670796891" MODIFIED="1527321674515">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      writel_relaxed(GICD_ENABLE, base + GIC_DIST_CTRL);
    </p>
    <p>
      &#x4f7f;&#x80fd;ppi&#x4e2d;&#x65ad;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1527321709914" FOLDED="true" ID="ID_800627600" MODIFIED="1560958795012" TEXT="static void gic_cpu_init(struct gic_chip_data *gic)">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1527329794455" ID="ID_1310958094" MODIFIED="1527329822271">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      cpu = smp_processor_id();
    </p>
    <p>
      &#x83b7;&#x53d6;&#x903b;&#x8f91;cpu id&#x53f7;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527329840486" ID="ID_1119770045" MODIFIED="1527330052652">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      cpu_mask = gic_get_cpumask(gic);
    </p>
    <p>
      gic_cpu_map[cpu] = cpu_mask;
    </p>
    <p>
      &#x83b7;&#x53d6;cpu mask&#xff0c; &#x5e76;&#x5c06;&#x8be5;mask&#x5b58;&#x653e;&#x5230;&#x67e5;&#x627e;&#x8868;&#x5bf9;&#x5e94;&#x4e8e;&#x8be5;cpu&#x7684;&#x8868;&#x9879;&#x5f53;&#x4e2d;&#x53bb;&#x3002;
    </p>
    <p>
      &#x901a;&#x8fc7;cpu mask&#x6765;&#x63a7;&#x5236;&#x4e2d;&#x65ad;&#x662f;&#x5426;&#x9001;&#x8fbe;&#x672c;cpu
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527330065250" ID="ID_1657643379" MODIFIED="1527330104835">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; NR_GIC_CPU_IF; i++)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (i != cpu)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gic_cpu_map[i] &amp;= ~cpu_mask;
    </p>
    <p>
      
    </p>
    <p>
      &#x6e05;&#x7406;&#x67e5;&#x627e;&#x8868;&#x5f53;&#x4e2d;&#x5176;&#x4ed6;&#x7684;entry&#x91cc;&#x9762;&#x4ee3;&#x8868;&#x672c;cpu&#x7684;&#x90a3;&#x4e2a;bit
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527330196088" ID="ID_655663746" MODIFIED="1527330199252" TEXT="gic_cpu_config(dist_base, NULL);"/>
<node CREATED="1527330218176" ID="ID_1914538682" MODIFIED="1527330442910">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      writel_relaxed(GICC_INT_PRI_THRESHOLD, base + GIC_CPU_PRIMASK);
    </p>
    <p>
      #define GICC_INT_PRI_THRESHOLD&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;0xf0
    </p>
    <p>
      &#x8fd9;&#x91cc;&#x662f;&#x8bbe;&#x7f6e;cpu interface&#x7684;&#x4e2d;&#x65ad;&#x4f18;&#x5148;&#x7ea7;mask, &#x4ece;distributor&#x9001;&#x8fbe;&#x7684;&#x4e2d;&#x65ad;&#x4f18;&#x5148;&#x7ea7;
    </p>
    <p>
      &#x5fc5;&#x987b;&#x5927;&#x4e8e;&#x8be5;mask&#x6240;&#x8868;&#x793a;&#x7684;&#x4f18;&#x5148;&#x7ea7;&#x4e4b;&#x540e;&#x624d;&#x53ef;&#x4ee5;&#x9001;&#x8fbe;cpu.
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527330621995" ID="ID_1500562771" MODIFIED="1527330797331">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gic_cpu_if_up(gic);
    </p>
    <p>
      &#x5e94;&#x8be5;&#x662f;&#x4f7f;&#x80fd;&#x5f53;&#x524d;&#x7684;cpu interface
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1527330804826" ID="ID_271099707" MODIFIED="1527330814418" TEXT="gic_pm_init(gic)">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
</node>
</node>
</node>
<node CREATED="1527044477702" ID="ID_1484160488" MODIFIED="1527044576457">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (parent) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq = irq_of_parse_and_map(node, 0);
    </p>
    <p>
      ---------------&gt;&#xa0;&#xa0;&#xa0;&#x89e3;&#x6790;second GIC&#x7684;interrupts&#x5c5e;&#x6027;&#xff0c;&#x5e76;&#x8fdb;&#x884c;mapping&#xff0c;&#x8fd4;&#x56de;IRQ number&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gic_cascade_irq(gic_cnt, irq);&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      }
    </p>
    <p>
      &#x5904;&#x7406;interrupt&#x7ea7;&#x8054;&#x7684;&#x60c5;&#x51b5;&#xff0c;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1527438533422" FOLDED="true" ID="ID_479532865" MODIFIED="1565876751058">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gpio&#x63a7;&#x5236;&#x5668;&#x9a71;&#x52a8;&#x5206;&#x6790;&#xff0c;&#x7531;&#x4e8e;&#x63a7;&#x5236;&#x5668;&#x91cc;&#x9762;&#x4e5f;&#x6709;&#x5173;&#x4e8e;&#x4e2d;&#x65ad;&#x7684;&#x90e8;&#x5206;&#xff0c;
    </p>
    <p>
      &#x5b66;&#x4e60;&#x4e00;&#x4e0b;&#x53ef;&#x4ee5;&#x6df1;&#x5165;&#x4e86;&#x89e3;&#x4e2d;&#x65ad;&#x7684;&#x8fc7;&#x7a0b;&#xff0c;&#x4ee3;&#x7801;&#x4f4d;&#x7f6e;:
    </p>
    <p>
      drivers/pinctrl/samsung/pinctrl-samsung.c
    </p>
    <p>
      drivers/pinctrl/samsung/pinctrl-exynos.c
    </p>
    <p>
      
    </p>
    <p>
      &#x6211;&#x4eec;&#x5206;&#x6790;&#x7684;&#x662f;&#x5e73;&#x53f0;&#x8bbe;&#x5907;&#x5bf9;&#x5e94;&#x7684;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#xff0c;&#x8be5;&#x8bbe;&#x5907;&#x7684;&#x8bbe;&#x5907;&#x8282;&#x70b9;&#x63cf;&#x8ff0;&#x5982;&#x4e0b;:
    </p>
    <p>
      pinctrl@11000000 {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;compatible = "samsung,exynos4x12-pinctrl";
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;reg = &lt;0x11000000 0x1000&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;interrupts = &lt;0x0 0x2e 0x0&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;........
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<node CREATED="1527439322940" FOLDED="true" ID="ID_869037579" MODIFIED="1565876748970">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9996;&#x5148;&#x5206;&#x6790;&#x4e00;&#x4e0b;pinctrl&#x5bf9;&#x5e94;&#x7684;platform device&#x6240;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      &#x5e73;&#x53f0;&#x9a71;&#x52a8;&#x91cc;&#x9762;&#x7684;probe&#x51fd;&#x6570;
    </p>
    <p>
      <b>static int samsung_pinctrl_probe(struct platform_device *pdev)</b>
    </p>
    <p>
      &#x6ce8;&#x610f;&#x8fd9;&#x91cc;&#x6211;&#x4eec;&#x53ea;&#x5206;&#x6790;&#x8ddf;&#x4e2d;&#x65ad;&#x6709;&#x5173;&#x7684;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<node CREATED="1527439592814" ID="ID_551831422" MODIFIED="1527439622047">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct samsung_pinctrl_drv_data *drvdata;
    </p>
    <p>
      drvdata = devm_kzalloc(dev, sizeof(*drvdata), GFP_KERNEL);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527439646806" ID="ID_576968772" MODIFIED="1527439656095">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ctrl = samsung_pinctrl_get_soc_data(drvdata, pdev);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527439704950" ID="ID_909468321" MODIFIED="1527439714903">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      ret = samsung_gpiolib_register(pdev, drvdata);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1527438056185" FOLDED="true" ID="ID_1287158666" MODIFIED="1560959129799" TEXT="exynos4412-tiny4412.dts">
<node CREATED="1527438077753" FOLDED="true" ID="ID_570890239" MODIFIED="1560958784125" TEXT="exynos4412.dtsi">
<node CREATED="1527438133984" FOLDED="true" ID="ID_526516202" MODIFIED="1560958783173" TEXT="exynos4x12.dtsi">
<node CREATED="1527438181616" ID="ID_1955911794" MODIFIED="1527438184657" TEXT="exynos4.dtsi"/>
<node CREATED="1527438194447" ID="ID_343176907" MODIFIED="1527438197549" TEXT="exynos4x12-pinctrl.dtsi"/>
<node CREATED="1527438206776" ID="ID_1382222382" MODIFIED="1527438209750" TEXT="exynos4-cpu-thermal.dtsi"/>
</node>
</node>
<node CREATED="1527438095857" ID="ID_1757561546" MODIFIED="1527438098879" TEXT="dt-bindings/gpio/gpio.h"/>
</node>
</node>
<node CREATED="1526311734080" FOLDED="true" ID="ID_1777200731" MODIFIED="1574904001188">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font size="4">ARM GIC PL390 document&#x5b66;&#x4e60;</font></i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526311797465" FOLDED="true" ID="ID_1605100955" MODIFIED="1560958780317" TEXT="1.&#x7b80;&#x4ecb;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1526311868529" ID="ID_780249209" MODIFIED="1526312058044">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x901a;&#x8fc7;amba&#x534f;&#x8bae;&#x8fde;&#x63a5;&#x5230;soc&#x7684;&#x9ad8;&#x901f;&#x5916;&#x56f4;&#x8bbe;&#x5907;&#xff0c;&#x76ee;&#x524d;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x4e24;&#x79cd;&#x9ad8;&#x901f;&#x603b;&#x7ebf;&#x534f;&#x8bae;
    </p>
    <p>
      &#x6302;&#x63a5;&#x5230;&#x603b;&#x7ebf;&#x4e0a;&#x9762;&#x3002;
    </p>
    <p>
      1.&#x901a;&#x8fc7;AHB-Lite slave interfaces
    </p>
    <p>
      &#x8fd9;&#x79cd;&#x5b9e;&#x73b0;&#x65b9;&#x6cd5;&#x53ea;&#x80fd;&#x62e5;&#x6709;&#x4e00;&#x4e2a;cpu interface
    </p>
    <p>
      2.&#x901a;&#x8fc7;AXI slave interfaces
    </p>
    <p>
      &#x8fd9;&#x79cd;&#x5b9e;&#x73b0;&#x65b9;&#x5f0f;&#x652f;&#x6301;&#x5b89;&#x5168;&#x6269;&#x5c55;&#xff0c;&#x5e76;&#x4e14;&#x53ef;&#x4ee5;&#x652f;&#x6301;&#x591a;&#x8fbe;8&#x4e2a;cpu interface
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526312670779" ID="ID_689562653" MODIFIED="1526312876254">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      GIC&#x7684;&#x4e00;&#x4e9b;&#x7279;&#x6027;:
    </p>
    <p>
      1.&#x652f;&#x6301;&#x4e09;&#x79cd;&#x4e2d;&#x65ad;&#x7c7b;&#x578b;
    </p>
    <p>
      SGI&#xff0c; PPI&#xff0c; SPI
    </p>
    <p>
      2. &#x53ef;&#x7f16;&#x7a0b;&#x7684;&#x4e2d;&#x65ad;&#x7279;&#x6027;
    </p>
    <p>
      &#x4e2d;&#x65ad;&#x7684;&#x5b89;&#x5168;&#x72b6;&#x6001;
    </p>
    <p>
      &#x4e2d;&#x65ad;&#x7684;&#x4f18;&#x5148;&#x7ea7;
    </p>
    <p>
      &#x4f7f;&#x80fd;&#x6216;&#x8005;&#x7981;&#x6b62;&#x4f7f;&#x7528;&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x63a5;&#x6536;&#x4e2d;&#x65ad;&#x7684;&#x5904;&#x7406;&#x5668;
    </p>
    <p>
      3.&#x9ad8;&#x7ea7;&#x5b89;&#x5168;&#x7279;&#x6027;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526357252969" FOLDED="true" ID="ID_1171567380" MODIFIED="1560958781517" TEXT="2.&#x529f;&#x80fd;&#x6982;&#x89c8;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1526357276015" FOLDED="true" ID="ID_1386936933" MODIFIED="1560958778525">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="3">&#x603b;&#x4f53;&#x6846;&#x67b6;&#x56fe;</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1558360235300" ID="ID_1276319105" MODIFIED="1558360248994">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/Gic-function-diagram.png"/>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526372519154" FOLDED="true" ID="ID_1802439443" MODIFIED="1560958775125" TEXT="AMBA Slave Interface">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1526372572310" ID="ID_651246390" MODIFIED="1526372732657">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7528;&#x4e8e;&#x8bbf;&#x95ee;gic&#x5bc4;&#x5b58;&#x5668;&#xff0c;&#x8bbe;&#x7f6e;&#x7cfb;&#x7edf;&#x914d;&#x7f6e;&#x53c2;&#x6570;&#x548c;&#x83b7;&#x53d6;&#x72b6;&#x6001;&#x4fe1;&#x606f;
    </p>
    <p>
      &#x8be5;&#x63a5;&#x53e3;&#x6709;&#x4e24;&#x79cd;&#x901a;&#x4fe1;&#x65b9;&#x5f0f;&#xff0c;&#x4e00;&#x79cd;&#x662f;axi&#xff0c;&#x4e00;&#x79cd;&#x662f;ahb-lite
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526372902531" FOLDED="true" ID="ID_23560721" MODIFIED="1560958773965" TEXT="Distributer">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1526372983259" ID="ID_1860259410" MODIFIED="1526373025764">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x63a5;&#x6536;&#x4e2d;&#x65ad;&#xff0c;&#x5e76;&#x5c06;&#x4f18;&#x5148;&#x7ea7;&#x6700;&#x9ad8;&#x7684;&#x4e2d;&#x65ad;&#x5206;&#x53d1;&#x7ed9;&#x5bf9;&#x5e94;&#x7684;cpu interface
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526397084886" FOLDED="true" ID="ID_333414137" MODIFIED="1560958770337">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/gic-distributer.png"/>
  </body>
</html></richcontent>
<node CREATED="1526397180654" ID="ID_731831615" MODIFIED="1526397310561">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;multiprocessor&#x6a21;&#x5f0f;&#x7684;&#x914d;&#x7f6e;&#x4e0b;&#x9762;&#xff0c;distributer&#x53ef;&#x4ee5;&#x4e3a;&#x6bcf;&#x4e2a;cpu interface
    </p>
    <p>
      &#x63d0;&#x4f9b;&#x591a;&#x8fbe;16&#x4e2a;ppi,&#xa0;&#xa0;distributer&#x53ef;&#x4ee5;&#x63d0;&#x4f9b;&#x591a;&#x8fbe;998&#x4e2a;spi,&#x5e76;&#x4e14;&#x53ef;&#x4ee5;&#x4e3a;&#x6bcf;&#x4e2a;spi
    </p>
    <p>
      &#x914d;&#x7f6e;&#x5176;&#x8def;&#x7531;&#x5230;&#x7684;cpu interface
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526615573270" ID="ID_1205892195" MODIFIED="1526615760713">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <img src="lddpic/interrupt-manipulation.png"/>
      
    </p>
    <p>
      
    </p>
    <p>
      interrupt manipulation&#x7684;&#x4f5c;&#x7528;&#x5c31;&#x662f;
    </p>
    <p>
      1.&#x63d0;&#x4f9b;registering &#x6216;&#x8005;synchronizing&#x4e2d;&#x65ad;&#x7684;&#x9009;&#x9879;&#xff0c; &#x5f53;&#x6211;&#x4eec;&#x8bbe;&#x7f6e;&#x540c;&#x6b65;&#x4e2d;&#x65ad;&#x7684;&#x9009;&#x9879;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4e2d;&#x65ad;&#x662f;&#x53ef;&#x4ee5;&#x88ab;&#x5ef6;&#x8fdf;
    </p>
    <p>
      &#x4e24;&#x4e2a;gclk&#x5468;&#x671f;&#x7684;(&#x8fd9;&#x6837;&#x7684;&#x76ee;&#x7684;&#x662f;&#x4e3a;&#x4e86;&#x7b49;&#x5f85;&#x591a;&#x4e2a;&#x4e2d;&#x65ad;&#x7684;&#x5230;&#x6765;&#xff1f;)
    </p>
    <p>
      2.Edge-detect&#x53ef;&#x4ee5;&#x68c0;&#x6d4b;&#x5230;&#x8bbe;&#x7f6e;&#x6210;pulse&#x89e6;&#x53d1;&#x65b9;&#x5f0f;&#x7684;&#x4e2d;&#x65ad;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1526627905295" FOLDED="true" ID="ID_1874590970" MODIFIED="1560958765281" TEXT="CPU Interface">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1526627943662" ID="ID_1631327292" MODIFIED="1526628312481">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      cpu interface&#x5305;&#x542b;&#x4e00;&#x4e2a;&#x53ef;&#x7f16;&#x7a0b;&#x7684;&#x4e2d;&#x65ad;&#x4f18;&#x5148;&#x7ea7;&#x7684;&#x63a9;&#x7801;&#xff0c;&#x5e76;&#x4e14;&#x5b83;&#x53ea;&#x63a5;&#x53d7;&#x4f18;&#x5148;&#x7ea7;&#x9ad8;&#x4e8e;&#x5982;&#x4e0b;&#x6761;&#x4ef6;&#x7684;
    </p>
    <p>
      pending&#x72b6;&#x6001;&#x7684;&#x4e2d;&#x65ad;&#xff1b;
    </p>
    <p>
      1.&#x6bd4;&#x4e2d;&#x65ad;&#x4f18;&#x5148;&#x7ea7;&#x63a9;&#x7801;&#x9ad8;
    </p>
    <p>
      2.&#x6bd4;&#x5f53;&#x524d;&#x5904;&#x7406;&#x5668;&#x5904;&#x7406;&#x7684;&#x4e2d;&#x65ad;&#x7684;&#x4f18;&#x5148;&#x7ea7;&#x9ad8;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526628395685" FOLDED="true" ID="ID_1930749033" MODIFIED="1560958764388" TEXT="clock and reset">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1526628423621" ID="ID_1006220311" MODIFIED="1526628478576">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      gic&#x53ea;&#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x4e2a;&#x5355;&#x72ec;&#x7684;&#x65f6;&#x949f;&#x8f93;&#x5165;gclk,
    </p>
    <p>
      gic&#x53ea;&#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x4e2a;&#x5355;&#x72ec;&#x7684;reset&#x63a5;&#x53e3;gresetn
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526629089742" FOLDED="true" ID="ID_1361435166" MODIFIED="1560958763270">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">enable and match signals</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526629182525" ID="ID_385909891" MODIFIED="1526629362467">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5728;gic&#x63d0;&#x4f9b;&#x4e24;&#x4e2a;&#x6216;&#x8005;&#x66f4;&#x591a;&#x7684;cpu interface&#x7684;&#x524d;&#x63d0;&#x4e4b;&#x4e0b;&#xff0c;gic </b>
    </p>
    <p>
      <b>&#x4f1a;&#x63d0;&#x4f9b;&#x5982;&#x4e0b;&#x7684;&#x4fe1;&#x53f7;&#x7ed9;&#x7cfb;&#x7edf;:</b>
    </p>
    <p>
      
    </p>
    <p>
      enable_d&lt;n&gt;[D_ID_WIDTH&#x2013;1:0]
    </p>
    <p>
      match_d&lt;n&gt;[D_ID_WIDTH&#x2013;1:0]&#xa0;&#xa0;D_ID_WIDTH&#x8868;&#x793a;distributer&#x7684;axi id&#x7684;&#x4fe1;&#x53f7;&#x5bbd;&#x5ea6;
    </p>
    <p>
      enable_c&lt;n&gt;[C_ID_WIDTH&#x2013;1:0]
    </p>
    <p>
      match_c&lt;n&gt;[C_ID_WIDTH&#x2013;1:0]. C_ID_WIDTH&#x8868;&#x793a;&#x8bbf;&#x95ee;cpu interface&#x7684;axi id&#x4fe1;&#x53f7;&#x7684;&#x5bbd;&#x5ea6;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526629466450" ID="ID_1630401184" MODIFIED="1535292133436">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      enable&#x4fe1;&#x53f7;&#x5c31;&#x50cf;&#x63a9;&#x7801;&#x4e00;&#x6837;&#x7528;&#x4e8e;&#x7b5b;&#x9009;axi id&#x7684;&#x4fe1;&#x53f7;&#xff0c;&#x540c;&#x65f6;&#x5c06;&#x7b5b;&#x9009;&#x4e4b;&#x540e;&#x7684;&#x4fe1;&#x53f7;&#x8ddf;
    </p>
    <p>
      match&#x4fe1;&#x53f7;&#x8fdb;&#x884c;&#x6bd4;&#x5bf9;&#xff0c;&#x5982;&#x679c;&#x662f;&#x76f8;&#x540c;&#x7684;&#x5219;&#x53ef;&#x4ee5;&#x8fdb;&#x884c;&#x8fdb;&#x4e00;&#x6b65;&#x7684;&#x64cd;&#x4f5c;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x52a8;&#x4f5c;&#xff0c;&#x5426;&#x5219;&#x8be5;
    </p>
    <p>
      &#x5de5;&#x4f5c;&#x662f;&#x88ab;&#x7981;&#x6b62;&#x7684;&#x3002;<font size="4" color="#e80f0f"><b>&#x7528;&#x4e8e;&#x63d0;&#x4f9b;&#x5bf9;banked registers&#x7684;&#x64cd;&#x4f5c;</b></font>
    </p>
    <p>
      For the Distributor, it provides access to the banked registers for a CPU Interface when:
    </p>
    <p>
      (arid_d &amp; enable_d&lt;n&gt;) == match_d&lt;n&gt;
    </p>
    <p>
      (awid_d &amp; enable_d&lt;n&gt;) == match_d&lt;n&gt;
    </p>
    <p>
      
    </p>
    <p>
      The GIC provides access to a CPU Interface and its registers when:
    </p>
    <p>
      (arid_c &amp; enable_c&lt;n&gt;) == match_c&lt;n&gt;
    </p>
    <p>
      (awid_c &amp; enable_c&lt;n&gt;) == match_c&lt;n&gt;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526699287581" FOLDED="true" ID="ID_1524947136" MODIFIED="1560958761672" TEXT="Implementation-defined behavior">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1526699828788" ID="ID_144043599" MODIFIED="1526699894814">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#e20d0d">cpu interface&#x7684;&#x6570;&#x91cf;</font></b>
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x914d;&#x7f6e;&#x7684;&#x6570;&#x91cf;&#x662f;&#x4e00;&#x5230;&#x516b;&#x4e2a;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526699915891" ID="ID_1697339201" MODIFIED="1526700838582">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#e00202">&#x4e2d;&#x65ad;&#x8f93;&#x5165;&#x7684;&#x6570;&#x91cf;</font></b>
    </p>
    <p>
      SGI: &#x6bcf;&#x4e2a;cpu interface&#x7684;sgi&#x7684;&#x6570;&#x91cf;&#x662f;16&#x4e2a;&#xff0c;&#x6bcf;&#x4e2a;&#x4e2d;&#x65ad;&#x88ab;&#x8d4b;&#x4e88;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;id&#x53f7;&#xff0c;&#x5728;NTID[15:0]
    </p>
    <p>
      PPI&#xff1a; &#x6bcf;&#x4e2a;cpu interface&#x53ef;&#x4ee5;&#x62e5;&#x6709;0&#x5230;16&#x4e2a;ppi&#x4e2d;&#x65ad;&#xff0c;distributor&#x4fdd;&#x8bc1;&#x4ece;ppi_c&lt;n&gt;[15:0]&#x63a5;&#x6536;&#x5230;&#x7684;&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x53ea;&#x4f1a;&#x63d0;&#x4ea4;&#x7ed9;&#x5bf9;&#x5e94;&#x7684;cpu interface n
    </p>
    <p>
      SPI: &#x53ef;&#x4ee5;&#x914d;&#x7f6e;GIC&#x652f;&#x6301;&#x591a;&#x8fbe;988&#x4e2a;spi, &#x4e2d;&#x65ad;&#x53f7;&#x5bf9;&#x5e94;&#x5b58;&#x653e;&#x5728;INTID[1019:32]
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526717916244" ID="ID_1728228800" MODIFIED="1526718173175">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#e20909">Legacy Interrupt</font></b>
    </p>
    <p>
      &#x6bcf;&#x4e00;&#x4e2a;&#x5904;&#x7406;&#x5668;&#x7684;&#x6838;&#x5fc3;&#x53ef;&#x4ee5;&#x914d;&#x7f6e;&#x591a;&#x8fbe;2&#x4e2a;legacy&#x7684;&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x5f53;GIC&#x88ab;&#x914d;&#x7f6e;&#x6210;&#x652f;&#x6301;secure state&#x7684;&#x65f6;&#x5019;&#xff0c;&#x53ef;&#x4ee5;&#x652f;&#x6301;legacy_nirq_c&lt;n&gt;
    </p>
    <p>
      &#x5f53;GIC&#x88ab;&#x914d;&#x7f6e;&#x6210;&#x652f;&#x6301;&#x5b89;&#x5168;&#x6269;&#x5c55;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x53ef;&#x4ee5;&#x652f;&#x6301;legacy_nfiq_c&lt;n&gt; &#x548c; legacy_nirq_c&lt;n&gt;
    </p>
    <p>
      
    </p>
    <p>
      legacy interrupt&#x53ef;&#x4ee5;&#x88ab;&#x770b;&#x6210;&#x662f;&#x652f;&#x6301;&#x8001;&#x7684;arm&#x6838;&#x5fc3;&#x7684;&#x4e00;&#x79cd;&#x5411;&#x524d;&#x7684;&#x517c;&#x5bb9;&#x65b9;&#x5f0f;&#xff0c;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526718194980" ID="ID_1376461523" MODIFIED="1526718331794">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#d40606"><b>&#x53ef;&#x7f16;&#x7a0b;&#x7684;PPI&#x7684;&#x89e6;&#x53d1;&#x6a21;&#x5f0f;</b></font>
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x901a;&#x8fc7;Interrupt Configuration Register&#x6765;&#x914d;&#x7f6e;&#x89e6;&#x53d1;&#x7684;&#x6a21;&#x5f0f;&#xff0c;&#x76ee;&#x524d;&#x652f;&#x6301;&#x7684;&#x4e24;&#x79cd;&#x89e6;&#x53d1;&#x6a21;&#x5f0f;&#x5982;&#x4e0b;:
    </p>
    <p>
      1.&#x7535;&#x5e73;&#x89e6;&#x53d1;&#x65b9;&#x5f0f;&#xff0c;&#x9ad8;&#x7535;&#x5e73;&#x6709;&#x6548;
    </p>
    <p>
      2.pulse&#x89e6;&#x53d1;&#x65b9;&#x5f0f;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526719080863" ID="ID_1832984930" MODIFIED="1526719155614">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#c90909"><b>Lockable SPI (LSPI) &#x652f;&#x6301;</b></font>
    </p>
    <p>
      he LSPI field in the Interrupt Controller Type Register defines which INTIDs are LSPIs.
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526719216294" ID="ID_1260715380" MODIFIED="1526719274510">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#e71010"><b>&#x4e2d;&#x65ad;&#x4f18;&#x5148;&#x7ea7;&#x4e2a;&#x6570;&#x7684;&#x914d;&#x7f6e;</b></font>
    </p>
    <p>
      GIC&#x652f;&#x6301;&#x7684;&#x4e2d;&#x65ad;&#x4f18;&#x5148;&#x7ea7;&#x7684;&#x4e2a;&#x6570;&#x662f;&#x53ef;&#x914d;&#x7f6e;&#x7684;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526719531858" ID="ID_498072125" MODIFIED="1526719669210">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#d40e0e">&#x66f4;&#x65b0;Priority Level Register&#x5bf9;&#x4e8e;Active interrupts&#x7684;&#x5f71;&#x54cd;</font></b>
    </p>
    <p>
      &#x5f53;&#x4f60;&#x66f4;&#x65b0;Active&#x72b6;&#x6001;&#x7684;&#x4e2d;&#x65ad;&#x6216;&#x8005;&#x662f;Active-and-pending&#x72b6;&#x6001;&#x7684;&#x4e2d;&#x65ad;&#x7684;&#x4f18;&#x5148;&#x7ea7;&#x6c34;&#x5e73;&#x7684;&#x65f6;&#x5019;&#xff0c;
    </p>
    <p>
      gic&#x4f1a;&#x7acb;&#x523b;&#x5bf9;active&#x72b6;&#x6001;&#x7684;&#x4e2d;&#x65ad;&#x4f7f;&#x7528;&#x65b0;&#x7684;&#x4f18;&#x5148;&#x7ea7;&#x6807;&#x51c6;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526720109382" ID="ID_44683789" MODIFIED="1526720275213">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#c60c0c"><b>&#x76ee;&#x6807;&#x662f;&#x9488;&#x5bf9;&#x591a;&#x4e2a;&#x5904;&#x7406;&#x5668;&#x6838;&#x5fc3;&#x7684;spi&#x7684;&#x4ef2;&#x88c1;&#x5904;&#x7406;</b></font>
    </p>
    <p>
      &#x5f53;&#x67d0;&#x4e2a;spi&#x88ab;&#x8bbe;&#x7f6e;&#x6210;&#x53ef;&#x4ee5;&#x5411;&#x591a;&#x4e2a;&#x6838;&#x5fc3;&#x901a;&#x77e5;&#x4e2d;&#x65ad;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x591a;&#x4e2a;&#x5904;&#x7406;&#x5668;&#x7684;&#x6838;&#x5fc3;&#x662f;&#x540c;&#x65f6;&#x63a5;&#x6536;&#x5230;&#x4e2d;&#x65ad;&#x4fe1;&#x53f7;&#x7684;&#xff0c;
    </p>
    <p>
      &#x4f46;&#x662f;&#x53ea;&#x6709;&#x7b2c;&#x4e00;&#x4e2a;&#x8bfb;&#x53d6;Interrupt Acknowledge Register&#x7684;&#x5904;&#x7406;&#x5668;&#x6838;&#x5fc3;&#x624d;&#x7b97;&#x56de;&#x5e94;&#x8be5;&#x4e2d;&#x65ad;&#xff0c;&#x5176;&#x4ed6;&#x7684;&#x6838;&#x5fc3;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x8ba4;&#x4e3a;&#x662f;&#x63a5;&#x6536;&#x5230;&#x4e86;&#x865a;&#x5047;&#x4e2d;&#x65ad;&#x54cd;&#x5e94;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526779139156" ID="ID_1441698282" MODIFIED="1526779243332">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#e11111"><b>Binary Point Register&#x5bc4;&#x5b58;&#x5668;&#x53ef;&#x4ee5;&#x652f;&#x6301;&#x7684;&#x6700;&#x5c0f;&#x7684;&#x503c;</b></font>
    </p>
    <p>
      &#x652f;&#x6301;&#x7684;&#x6700;&#x5c0f;&#x7684;&#x503c;&#x4f9d;&#x8d56;&#x4e8e;GIC&#x652f;&#x6301;&#x7684;&#x4e2d;&#x65ad;&#x4f18;&#x5148;&#x7ea7;&#x7684;&#x7ea7;&#x522b;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1526779936296" FOLDED="true" ID="ID_861937120" MODIFIED="1560958820691">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3.&#x7f16;&#x7a0b;&#x6a21;&#x578b;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526782100712" FOLDED="true" ID="ID_1523046238" MODIFIED="1560958760292" TEXT="&#x5173;&#x4e8e;&#x7f16;&#x7a0b;&#x6a21;&#x578b;&#x7684;&#x7b80;&#x4ecb;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1526782119183" ID="ID_1327192633" MODIFIED="1526782530159">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#c50505">GIC&#x4f1a;&#x63d0;&#x4f9b;&#x5982;&#x4e0b;&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x6620;&#x5c04;</font></b>
    </p>
    <p>
      Distributor &#x5bc4;&#x5b58;&#x5668;&#x6620;&#x5c04;
    </p>
    <p>
      CPU Interface&#x5bc4;&#x5b58;&#x5668;&#x6620;&#x5c04;
    </p>
    <p>
      GIC&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x57fa;&#x5730;&#x5740;&#x662f;&#x4e0d;&#x56fa;&#x5b9a;&#x7684;&#xff0c;&#x4f9d;&#x8d56;&#x4e8e;&#x5177;&#x4f53;&#x7684;&#x786c;&#x4ef6;&#x5b9e;&#x73b0;&#xff0c;&#x4f46;&#x662f;&#x6bcf;&#x4e2a;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x504f;&#x79fb;&#x5730;&#x5740;&#x662f;&#x56fa;&#x5b9a;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1550415219973" ID="ID_1576819551" MODIFIED="1550415254672">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>4. GIC&#x5bf9;&#x4e8e;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x7684;&#x6d41;&#x7a0b;</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526871429025" FOLDED="true" ID="ID_936881367" MODIFIED="1561559143092">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#ba1010"><i>Linux&#x7684;&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x4e4b;&#x4e00;</i></font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526871986809" FOLDED="true" ID="ID_367134578" MODIFIED="1560958756637">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/linux&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x8f6f;&#x4ef6;&#x6846;&#x56fe;.gif"/>
  </body>
</html></richcontent>
<node CREATED="1526872042160" ID="ID_1473971379" MODIFIED="1526872119921">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x901a;&#x7528;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x6a21;&#x5757;&#x662f;&#x786c;&#x4ef6;&#x65e0;&#x5173;&#x7684;&#x6a21;&#x5757;&#xff0c;&#x7528;&#x4e8e;&#x62bd;&#x8c61;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x5f53;&#x4e2d;&#x7684;&#x4e00;&#x4e9b;&#x76f8;&#x540c;&#x7684;&#x52a8;&#x4f5c;&#x3002;
    </p>
    <p>
      &#x666e;&#x901a;&#x5916;&#x8bbe;&#x7684;&#x9a71;&#x52a8;&#x4e5f;&#x4f1a;&#x8c03;&#x7528;&#x901a;&#x7528;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x6a21;&#x5757;&#x7684;api&#x6765;&#x5b9e;&#x73b0;&#x81ea;&#x5df1;&#x7684;&#x9a71;&#x52a8;&#x903b;&#x8f91;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1526872438251" FOLDED="true" ID="ID_1923881028" MODIFIED="1560958753621">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#bc0606"><b><i>Linux&#x7684;&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x4e4b;&#x4e8c; IRQ Domain&#x4ecb;&#x7ecd;</i></b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526873852955" ID="ID_957535091" MODIFIED="1526874519125">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#1117ed" size="4"><i>interrupt controller&#x4f7f;&#x7528;HW interrupt ID &#x6765;&#x6807;&#x8bc6;&#x4e00;&#x4e2a;&#x786c;&#x4ef6;&#x4e2d;&#x65ad;&#xff0c; </i></font>
    </p>
    <p>
      <font color="#1117ed" size="4"><i>&#x800c;&#x5bf9;&#x4e8e;cpu&#x6216;&#x8005;&#x9a71;&#x52a8;&#x6765;&#x8bf4;&#x662f;&#x901a;&#x8fc7;IRQ number&#x6765;&#x8868;&#x793a;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#x7684;&#xff0c;&#x662f;&#x4e00;&#x4e2a;&#x865a;&#x62df;&#x7684;&#x4e2d;&#x65ad;&#x53f7;&#x3002; </i></font>
    </p>
    <p>
      <font color="#1117ed" size="4"><i>linux kernel&#x7684;&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x9700;&#x8981;&#x5c06;HW interrupt ID&#x6620;&#x5c04;&#x6210;IRQ number </i></font>
    </p>
    <p>
      
    </p>
    <p>
      <b>&#x968f;&#x7740;linux&#x5185;&#x6838;&#x7684;&#x53d1;&#x5c55;&#xff0c;&#x5c06;interrupt controller&#x62bd;&#x8c61;&#x6210;irqchip&#x8fd9;&#x4e2a;&#x6982;&#x5ff5;&#x8d8a;&#x6765;&#x8d8a;&#x6d41;&#x884c;&#xff0c;&#x8bbe;&#x7f6e;gpio controller </b>
    </p>
    <p>
      <b>&#x4e5f;&#x53ef;&#x4ee5;&#x88ab;&#x770b;&#x6210;&#x662f;&#x4e00;&#x4e2a;interrupt controller chip.</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526874935181" FOLDED="true" ID="ID_746299273" MODIFIED="1560958752549">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#1c33f3">IRQ Domain&#x7684;&#x4ecb;&#x7ecd;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526874993677" FOLDED="true" ID="ID_712069025" MODIFIED="1560958751432">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#df1414">1.&#x63a5;&#x53e3;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1526875023603" FOLDED="true" ID="ID_83612066" MODIFIED="1560958748037">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5411;&#x7cfb;&#x7edf;&#x6ce8;&#x518c;irq domain, &#x6839;&#x636e;hw irq id&#x548c;irq number&#x4e4b;&#x95f4;&#x7684;&#x6620;&#x5c04;&#x65b9;&#x5f0f;&#xff0c;
    </p>
    <p>
      &#x6211;&#x4eec;&#x6709;&#x5982;&#x4e0b;&#x7684;&#x4e09;&#x79cd;&#x6ce8;&#x518c;&#x7684;&#x63a5;&#x53e3;
    </p>
  </body>
</html></richcontent>
<node CREATED="1461078817177" ID="ID_1215070585" MODIFIED="1461489293154">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1<b>.&#x7ebf;&#x6027;&#x6620;&#x5c04;</b>
    </p>
    <p>
      interrupt controller&#x5728;&#x5bf9;hw interrupt id&#x8fdb;&#x884c;&#x7f16;&#x7801;&#x7684;&#x65f6;&#x5019;&#x8981;&#x6ee1;&#x8db3;interrupt id&#x4e0d;&#x80fd;&#x8fc7;&#x5927;
    </p>
    <p>
      struct irq_domain *irq_domain_add_linear(struct device_node *of_node,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int size, &#x8be5;domain&#x652f;&#x6301;&#x7684;&#x4e2d;&#x65ad;&#x6570;&#x91cf;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct irq_domain_ops *ops,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *host_data)
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="12"/>
</node>
<node CREATED="1461079062063" ID="ID_1550690554" MODIFIED="1461489476816">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.<b>radix tree&#x6620;&#x5c04;</b>
    </p>
    <p>
      struct irq_domain *irq_domain_add_tree(struct device_node *of_node,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct irq_domain_ops *ops,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *host_data)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1461506726966" ID="ID_350720392" MODIFIED="1461506894016">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.<b>no map&#x7c7b;&#x578b;</b>
    </p>
    <p>
      &#x6709;&#x4e9b;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x529f;&#x80fd;&#x5f88;&#x5f3a;&#x5927;&#xff0c;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x5bc4;&#x5b58;&#x5668;&#x6765;
    </p>
    <p>
      &#x914d;&#x7f6e;hw irq,&#x6240;&#x4ee5;&#x6211;&#x4eec;&#x76f4;&#x63a5;&#x5c06;irq number&#x5199;&#x5165;&#x5bc4;&#x5b58;&#x5668;&#x91cc;&#x9762;
    </p>
    <p>
      &#x5c31;&#x53ef;&#x4ee5;&#x4e86;&#xff0c;hw irq&#x5c31;&#x662f;irq number
    </p>
    <p>
      <b>static inline struct irq_domain *irq_domain_add_nomap(struct device_node *of_node, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int max_irq, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct irq_domain_ops *ops, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *host_data)</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1526974571434" FOLDED="true" ID="ID_1189599923" MODIFIED="1560958746672">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x521b;&#x5efa;&#x6620;&#x5c04;</b>&#xff0c;&#x5411;&#x7cfb;&#x7edf;&#x6dfb;&#x52a0;&#x5b8c;irq domain&#x4e4b;&#x540e;&#xff0c;&#x8fd8;&#x9700;&#x8981;&#x5efa;&#x7acb;database&#xff0c;
    </p>
    <p>
      &#x8be5;database&#x7684;&#x4f5c;&#x7528;&#x5c31;&#x662f;&#x8d1f;&#x8d23;&#x4ece;hw interrupt id&#x5411;irq number&#x5efa;&#x7acb;&#x6620;&#x5c04;
    </p>
  </body>
</html></richcontent>
<node CREATED="1526974762134" ID="ID_193006535" MODIFIED="1526977256410">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      unsigned int irq_create_mapping(struct irq_domain *domain,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t hwirq)
    </p>
    <p>
      
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x5efa;&#x7acb;&#x6620;&#x5c04;&#x7684;&#x65f6;&#x5019;&#x5fc5;&#x987b;&#x63d0;&#x4f9b;hw irq id&#xff0c;&#x8fd9;&#x610f;&#x5473;&#x7740;&#x9a71;&#x52a8;&#x77e5;&#x9053;&#x81ea;&#x5df1;&#x4f7f;&#x7528;&#x7684;hw id,
    </p>
    <p>
      &#x4f46;&#x662f;&#x4e00;&#x822c;&#x60c5;&#x51b5;&#x4e0b;&#x9a71;&#x52a8;&#x5bf9;&#x81ea;&#x5df1;&#x4f7f;&#x7528;&#x7684;hw interrupt id&#x662f;&#x4e00;&#x65e0;&#x6240;&#x77e5;&#x7684;&#xff0c;&#x4e0d;&#x8fc7;&#x6709;&#x4e9b;&#x573a;&#x666f;&#x662f;&#x6bd4;&#x8f83;&#x7279;&#x6b8a;&#x7684;&#xff0c;
    </p>
    <p>
      &#x6bd4;&#x5982;gpio&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x5b83;&#x7684;hw interrupt id&#x548c;gpio&#x6709;&#x4e00;&#x5b9a;&#x7684;&#x8054;&#x7cfb;&#xff0c;&#x77e5;&#x9053;&#x4e86;gpio&#x53f7;&#x4e5f;&#x5c31;&#x662f;&#x77e5;&#x9053;&#x4e86;
    </p>
    <p>
      hw interrupt id.
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526977386596" ID="ID_1267015906" MODIFIED="1526977451968">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int <b>irq_create_strict_mappings(</b>struct irq_domain *domain, unsigned int irq_base,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t hwirq_base, int count<b>)</b>
    </p>
    <p>
      
    </p>
    <p>
      &#x7528;&#x6765;&#x4e3a;&#x4e00;&#x7ec4;hw interrupt id&#x5efa;&#x7acb;&#x6620;&#x5c04;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526978750289" ID="ID_229272481" MODIFIED="1526979009354">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      unsigned int irq_create_of_mapping(struct of_phandle_args *irq_data)
    </p>
    <p>
      &#x5229;&#x7528;device tree&#x8fdb;&#x884c;&#x6620;&#x5c04;&#x5173;&#x7cfb;&#x7684;&#x5efa;&#x7acb;
    </p>
    <p>
      
    </p>
    <p>
      &#x901a;&#x5e38;&#x8be5;&#x51fd;&#x6570;&#x4f1a;&#x5728;unsigned int irq_of_parse_and_map(struct device_node *dev, int index)&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x88ab;&#x8c03;&#x7528;&#xff0c;&#x800c;irq_of_parse_and_map&#x7ecf;&#x5e38;&#x51fa;&#x73b0;&#x5728;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x91cc;&#x9762;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1526979207872" ID="ID_1859068798" MODIFIED="1526979234424">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      unsigned int irq_create_direct_mapping(struct irq_domain *domain)
    </p>
    <p>
      
    </p>
    <p>
      &#x7528;&#x4e8e;no map&#x7c7b;&#x578b;&#x7684;irq domain
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1457969498354" FOLDED="true" ID="ID_480363006" MODIFIED="1560958744383">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#333300" size="4">irq domain&#x7684;&#x6982;&#x5ff5;&#x548c;&#x5176;callback&#x51fd;&#x6570;</font></b><font color="#006666" size="4">&#xa0; </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">struct irq_domain { </font><b><font color="#ff0033" size="3">/*&#x5185;&#x6838;&#x7248;&#x672c;4.4.8*/</font></b>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">struct list_head link;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const char *name;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct irq_domain_ops *ops; </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">void *host_data;&#xa0;&#xa0;&#xa0;&#xa0;<b>&#x79c1;&#x6709;&#x6570;&#x636e;&#xff0c;&#x5bf9;&#x4e8e;gic&#x6765;&#x8bf4;&#x8be5;&#x6210;&#x5458;&#x5f80;&#x5f80;&#x6307;&#x5411;struct gic_chip_data</b> </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">unsigned int flags;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct fwnode_handle *fwnode; </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">&#xa0;enum irq_domain_bus_token bus_token;&#xa0;&#xa0;&#xa0;&#xa0;struct irq_domain_chip_generic *gc; </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">#ifdef&#xa0;&#xa0;CONFIG_IRQ_DOMAIN_HIERARCHY </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">struct irq_domain *parent; </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">#endif </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">/* reverse map data. The linear map gets appended to the irq_domain */ </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">irq_hw_number_t hwirq_max; </font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">unsigned int revmap_direct_max_irq; <b>&#x76f4;&#x63a5;&#x6620;&#x5c04;&#x65b9;&#x5f0f;&#x4e2d;&#x6700;&#x5927;&#x7684;hwirq&#x503c;</b></font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">unsigned int revmap_size;<b>&#xa0;&#x7ebf;&#x6027;&#x6620;&#x5c04;&#x8868;&#x7684;&#x5927;&#x5c0f;</b></font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">struct radix_tree_root revmap_tree; <b>radix&#x6811;</b></font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">&#xa0;unsigned int linear_revmap[];<b>&#xa0;hwirq-&gt;virq&#x7684;&#x6620;&#x5c04;&#x8868;&#x683c;</b></font>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; text-indent: 0px; line-height: 20px; margin-left: 0px; white-space: normal; text-align: left; letter-spacing: normal; padding-right: 0px; margin-top: 0px; text-transform: none">
      <font size="3">};</font>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="12"/>
<node CREATED="1461078537489" ID="ID_358095483" MODIFIED="1549435347181">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">struct irq_domain_ops</font></b><font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">&#xa0;{</font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">int (*<b>match</b>)(struct irq_domain *d, struct device_node *node);&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">int (*<b>map</b>)(struct irq_domain *d, unsigned int virq, irq_hw_number_t hw);&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">void (*<b>unmap</b>)(struct irq_domain *d, unsigned int virq);&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">int (*<b>xlate</b>)(struct irq_domain *d, struct device_node *node,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">const u32 *intspec, unsigned int intsize,&#xa0;&#xa0;unsigned long *out_hwirq, </font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">unsigned int *out_type);&#xa0; </font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">}; </font>
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif">1.xlate&#x51fd;&#x6570;&#x7528;&#x4e8e;&#x5c06;device tree&#x91cc;&#x9762;&#x7684;&#x6307;&#x5b9a;&#x4e2a;&#x6570;(intsize)&#x7684;&#x4e2d;&#x65ad;&#x5c5e;&#x6027; </font>
    </p>
    <p>
      (intspec)&#x7ffb;&#x8bd1;&#x6210;hw irq(out_hwirq)&#x548c;&#x5176;&#x5bf9;&#x5e94;&#x7684;trigger&#x5c5e;&#x6027;(out_type)
    </p>
    <p>
      2.match&#x51fd;&#x6570;&#x7528;&#x4e8e;&#x5224;&#x65ad;&#x4f20;&#x5165;&#x7684;&#x4ee3;&#x8868;interrupt controller&#x7684;node&#x8282;&#x70b9;&#x662f;&#x5426;
    </p>
    <p>
      &#x8ddf;&#x5f53;&#x524d;&#x7684;irq_domain&#x5339;&#x914d;
    </p>
    <p>
      3.map&#x51fd;&#x6570;&#x662f;&#x5728;&#x7528;&#x4e8e;&#x66f4;&#x65b0;&#x6216;&#x8005;&#x521b;&#x5efa;hw interrupt id&#x548c;irq number&#x5173;&#x7cfb;&#x7684;
    </p>
    <p>
      &#x65f6;&#x5019;&#x88ab;&#x8c03;&#x7528;&#x3002;
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
</node>
<node CREATED="1461509588742" ID="ID_577602559" MODIFIED="1461509613093" TEXT="&#x6240;&#x6709;&#x7684;irq_domain&#x90fd;&#x88ab;&#x6302;&#x5165;&#x5230;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x7684;&#x94fe;&#x8868;&#x5f53;&#x4e2d;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
</node>
<node CREATED="1462698069365" ID="ID_587962475" MODIFIED="1462698122230">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      86 struct irq_domain {<b><font color="#ff3300">/*&#x5185;&#x6838;&#x7248;&#x672c;3.10*/</font></b>
    </p>
    <p>
      &#xa0;87&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct list_head link;
    </p>
    <p>
      &#xa0;89&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* type of reverse mapping_technique */
    </p>
    <p>
      &#xa0;90&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int revmap_type;
    </p>
    <p>
      &#xa0;91&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;union {
    </p>
    <p>
      &#xa0;92&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct {
    </p>
    <p>
      &#xa0;93&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int size;
    </p>
    <p>
      &#xa0;94&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int first_irq;
    </p>
    <p>
      &#xa0;95&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t first_hwirq;
    </p>
    <p>
      &#xa0;96&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;} legacy;
    </p>
    <p>
      &#xa0;97&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct {
    </p>
    <p>
      &#xa0;98&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int size;
    </p>
    <p>
      &#xa0;99&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int *revmap;
    </p>
    <p>
      100&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;} linear;
    </p>
    <p>
      101&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct {
    </p>
    <p>
      102&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int max_irq;
    </p>
    <p>
      103&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;} nomap;
    </p>
    <p>
      104&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct radix_tree_root tree;
    </p>
    <p>
      105&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;} revmap_data;
    </p>
    <p>
      106&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct irq_domain_ops *ops;
    </p>
    <p>
      107&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *host_data;
    </p>
    <p>
      108&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t inval_irq;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1461511040984" FOLDED="true" ID="ID_1591423950" MODIFIED="1560958741150">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#eb1414">2. Mapping DB&#x7684;&#x5efa;&#x7acb;</font>&#xa0;</b>
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x5728;&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#x4f1a;&#x5efa;&#x7acb;hw interrupt id
    </p>
    <p>
      &#x548c;irq number&#x4e4b;&#x95f4;&#x7684;&#x6620;&#x5c04;&#x5173;&#x7cfb;&#x6570;&#x636e;&#x5e93;
    </p>
  </body>
</html></richcontent>
<node CREATED="1461511653565" ID="ID_1188693622" MODIFIED="1527041515804">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.dts&#x6587;&#x4ef6;&#x7528;&#x6765;&#x63cf;&#x8ff0;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;interrupt controller&#x4ee5;&#x53ca;&#x5916;&#x8bbe;&#x7684;IRQ&#x7684;&#x62d3;&#x6251;&#x7ed3;&#x6784;&#xff0c;&#x7cfb;&#x7edf;&#x542f;&#x52a8;&#x7684;&#x65f6;&#x5019;&#x7531;bootloader
    </p>
    <p>
      &#x4f20;&#x9012;&#x7ed9;kernel
    </p>
    <p>
      2.device tree&#x521d;&#x59cb;&#x5316;&#xff0c;&#x5f62;&#x6210;&#x7cfb;&#x7edf;&#x5185;&#x6240;&#x6709;&#x7684;device node&#x7684;&#x6811;&#x72b6;&#x7ed3;&#x6784;
    </p>
    <p>
      3.&#x5728;machine driver&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#x4f1a;&#x8c03;&#x7528;of_irq_init,&#x5728;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x4f1a;&#x626b;&#x63cf;&#x6240;&#x6709;&#x7684;
    </p>
    <p>
      interrupt controller&#x8282;&#x70b9;&#xff0c;&#x8c03;&#x7528;controller&#x7684;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#xff0c;&#x5e76;&#x8c03;&#x7528;&#x63a5;&#x53e3;&#x521b;&#x5efa;irq_domain
    </p>
    <p>
      4.&#x6709;&#x4e9b;interrupt controller&#x4f1a;&#x5728;&#x5176;driver&#x521d;&#x59cb;&#x5316;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x521b;&#x5efa;&#x6620;&#x5c04;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1462610954252" FOLDED="true" ID="ID_1070434901" MODIFIED="1560958739838">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5177;&#x4f53;&#x4ee3;&#x7801;&#x5206;&#x6790;&#xff1a;&#x5728;interrupt controller&#x521d;&#x59cb;&#x5316;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d; </b>
    </p>
    <p>
      <b>&#x6ce8;&#x518c;irq_domain &#x4ee5;GIC&#x4e3a;&#x4f8b;&#x5b50;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1462675000594" FOLDED="true" ID="ID_1354714296" MODIFIED="1560958736710" TEXT="GIC&#x7b80;&#x5355;&#x5b66;&#x4e60;">
<node CREATED="1462675030820" ID="ID_826488054" MODIFIED="1462675273901">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.GIC&#x53ef;&#x4ee5;&#x7528;&#x4e8e;&#x5355;&#x6838;&#x6216;&#x8005;&#x591a;&#x6838;&#x7684;&#x7cfb;&#x7edf;&#xff0c;&#x603b;&#x5171;&#x6709;&#x4e09;&#x79cd;&#x4e2d;&#x65ad;&#x7c7b;&#x578b;
    </p>
    <p>
      SGI&#x8f6f;&#x4e2d;&#x65ad;&#xff0c;&#x6bcf;&#x4e2a;&#x6838;&#x90fd;&#x6709;&#xff0c;&#x7528;&#x4e8e;&#x591a;&#x6838;&#x4e4b;&#x95f4;&#x901a;&#x4fe1;
    </p>
    <p>
      PPI&#x79c1;&#x6709;&#x8bbe;&#x5907;&#x4e2d;&#x65ad;&#xff0c;&#x6bcf;&#x4e2a;&#x6838;&#x90fd;&#x6709;
    </p>
    <p>
      SPI&#x5171;&#x4eab;&#x8bbe;&#x5907;&#x4e2d;&#x65ad;&#xff0c;&#x5404;&#x4e2a;&#x6838;&#x5171;&#x4eab;&#x7684;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1462675603647" FOLDED="true" ID="ID_587960211" MODIFIED="1560958738358" TEXT="&#x4ee3;&#x7801;&#x5206;&#x6790;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1462692053004" FOLDED="true" ID="ID_411478953" MODIFIED="1560958734966">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#cc0000"><i>&#x5177;&#x4f53;&#x7684;GIC&#x4ee3;&#x7801;&#x5728; </i></font></b>
    </p>
    <p>
      <b><font color="#cc0000"><i>gic_of_init-&gt;gic_init_base&#x51fd;&#x6570;&#x5f53;&#x4e2d; </i></font></b>
    </p>
    <p>
      <font color="#000033">struct gic_chip_data { </font>
    </p>
    <p>
      <font color="#000033">&#xa0;44&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void __iomem&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*dist_base; </font>
    </p>
    <p>
      <font color="#000033">&#xa0;45&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct redist_region&#xa0;&#xa0;&#xa0;&#xa0;*redist_regions; </font>
    </p>
    <p>
      <font color="#000033">&#xa0;46&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct rdists&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;rdists; </font>
    </p>
    <p>
      <font color="#000033">&#xa0;47&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct irq_domain&#xa0;&#xa0;&#xa0;*domain; </font>
    </p>
    <p>
      <font color="#000033">&#xa0;48&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u64&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;redist_stride; </font>
    </p>
    <p>
      <font color="#000033">&#xa0;49&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u32&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;nr_redist_regions; </font>
    </p>
    <p>
      <font color="#000033">&#xa0;50&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_nr; </font>
    </p>
    <p>
      <font color="#000033">&#xa0;51 };</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1462700795234" ID="ID_941106088" MODIFIED="1462700904458">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5728;gic_init_base&#x51fd;&#x6570;&#x5f53;&#x4e2d;,&#x51fd;&#x6570;&#x6700;&#x7ec8;&#x4f1a;&#x8c03;&#x7528;&#x5230; </b>
    </p>
    <p>
      <b>irq_domain_add_legacy&#x51fd;&#x6570;&#xff0c;&#x5728;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d; </b>
    </p>
    <p>
      <b>&#x521b;&#x5efa;&#x4e86;&#x56fa;&#x5b9a;&#x7684;&#x6620;&#x5c04;&#x5173;&#x7cfb;&#x4e86;&#x3002;&#x8fd9;&#x662f;&#x5728;3.10&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;&#x4ee3;&#x7801; </b>
    </p>
    <p>
      <b>&#x672c;&#x8d28;&#x4e0a;&#x6765;&#x8bf4;&#x6ca1;&#x6709;&#x53d1;&#x6325;&#x51fa;device tree&#x7684;&#x5a01;&#x529b;</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1462714065291" FOLDED="true" ID="ID_1870903878" MODIFIED="1560958733646">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.<b>&#x5728;&#x5404;&#x4e2a;&#x786c;&#x4ef6;&#x5916;&#x8bbe;&#x7684;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x521d;&#x59cb;&#x5316;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#xff0c; </b>
    </p>
    <p>
      <b>&#x521b;&#x5efa;hw interrupt id&#x548c;irq number&#x4e4b;&#x95f4;&#x7684;&#x5173;&#x7cfb;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1462714168262" ID="ID_1993256268" MODIFIED="1462718138187">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>irq_of_parse_and_map&#x8c03;&#x7528;irq_create_of_mapping</b>
    </p>
    <p>
      &#x51fd;&#x6570;&#x8fdb;&#x884c;&#x6620;&#x5c04;&#xff1a;
    </p>
    <p>
      <b>irq_create_of_mapping</b>&#x51fd;&#x6570;&#x5206;&#x6790;&#xff1a;
    </p>
    <p>
      struct of_phandle_args {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct device_node *np;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int args_count;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;uint32_t args[MAX_PHANDLE_ARGS];
    </p>
    <p>
      };
    </p>
    <p>
      1.&#x8be5;&#x51fd;&#x6570;&#x9996;&#x5148;&#x5efa;&#x7acb;irq_domain&#x7ed3;&#x6784;&#x4f53;
    </p>
    <p>
      2.&#x901a;&#x8fc7;xlate&#x51fd;&#x6570;&#x6765;&#x89e3;&#x6790;device node&#x8fd4;&#x56de;hw interrupt id&#x548c;&#x89e6;&#x53d1;&#x7684;&#x65b9;&#x5f0f;
    </p>
    <p>
      3.&#x8c03;&#x7528;irq_create_mapping&#x521b;&#x5efa;hw interrupt id&#x548c;irq number&#x4e4b;&#x95f4;&#x7684;&#x6620;&#x5c04;&#x5173;&#x7cfb;
    </p>
    <p>
      irq_create_mapping&#x6700;&#x540e;&#x8c03;&#x7528;irq_domain_associate_many&#x51fd;&#x6570;&#x6765;&#x5b8c;&#x6210;&#x6700;&#x540e;&#x7684;&#x6620;&#x5c04;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1462718666577" ID="ID_841861986" MODIFIED="1462720104048">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3.&#x5c06;hw interrupt id&#x8f6c;&#x53d8;&#x6210;irq number&#x7684;&#x8fc7;&#x7a0b; </b>
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; margin-left: 0px; line-height: 20px; text-indent: 0px; text-align: left; white-space: normal; padding-right: 0px; letter-spacing: normal; background-color: rgb(255, 255, 255); margin-top: 0px; text-transform: none">
      1&#xff09;&#x9996;&#x5148;&#x627e;&#x5230;root interrupt controller&#x5bf9;&#x5e94;&#x7684;irq domain&#x3002;
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; margin-left: 0px; line-height: 20px; text-indent: 0px; text-align: left; white-space: normal; padding-right: 0px; letter-spacing: normal; background-color: rgb(255, 255, 255); margin-top: 0px; text-transform: none">
      &#xff08;2&#xff09;&#x6839;&#x636e;HW &#x5bc4;&#x5b58;&#x5668;&#x4fe1;&#x606f;&#x548c;irq domain&#x4fe1;&#x606f;&#x83b7;&#x53d6;HW interrupt ID
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; margin-left: 0px; line-height: 20px; text-indent: 0px; text-align: left; white-space: normal; padding-right: 0px; letter-spacing: normal; background-color: rgb(255, 255, 255); margin-top: 0px; text-transform: none">
      &#xff08;3&#xff09;&#x8c03;&#x7528;irq_find_mapping&#x627e;&#x5230;HW interrupt ID&#x5bf9;&#x5e94;&#x7684;irq number
    </p>
    <p style="font-size: 13px; padding-bottom: 15px; color: rgb(50, 50, 50); font-style: normal; margin-right: 0px; font-weight: normal; margin-bottom: 0px; padding-left: 0px; font-family: Arial, Helvetica, sans-serif; font-variant: normal; word-spacing: 0px; padding-top: 0px; margin-left: 0px; line-height: 20px; text-indent: 0px; text-align: left; white-space: normal; padding-right: 0px; letter-spacing: normal; background-color: rgb(255, 255, 255); margin-top: 0px; text-transform: none">
      &#xff08;4&#xff09;&#x8c03;&#x7528;handle_IRQ&#xff08;&#x5bf9;&#x4e8e;ARM&#x5e73;&#x53f0;&#xff09;&#x6765;&#x5904;&#x7406;&#x8be5;irq number
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1549436130563" FOLDED="true" ID="ID_1537632362" MODIFIED="1565876756945">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#e91212" size="4">Linux&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x4e4b;&#x56db; IRQ number&#x548c;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;</font></b>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="16"/>
<node CREATED="1558838291263" FOLDED="true" ID="ID_1734363091" MODIFIED="1565876672778" TEXT="&#x57fa;&#x672c;&#x6982;&#x5ff5;">
<node CREATED="1558838312730" ID="ID_1746416894" MODIFIED="1561559132152" TEXT="1.&#x901a;&#x7528;&#x4e2d;&#x65ad;&#x7684;&#x4ee3;&#x7801;&#x5904;&#x7406;&#x793a;&#x610f;&#x56fe;">
<node CREATED="1558838581639" FOLDED="true" ID="ID_1367877213" MODIFIED="1560958722254">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/&#x901a;&#x7528;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x793a;&#x610f;&#x56fe;.gif"/>
  </body>
</html></richcontent>
<node CREATED="1558838752295" ID="ID_294330468" MODIFIED="1558838935975">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;linux&#x5185;&#x6838;&#x5f53;&#x4e2d;&#xff0c;&#x6bcf;&#x4e00;&#x4e2a;&#x5916;&#x8bbe;&#x7684;&#x4e2d;&#x65ad;&#x90fd;&#x4f1a;&#x4f7f;&#x7528;&#x7ed3;&#x6784;&#x4f53;irq_desc&#x6765;&#x8fdb;&#x884c;&#x63cf;&#x8ff0;&#xff0c;
    </p>
    <p>
      &#x5305;&#x62ec;&#x8be5;&#x5916;&#x8bbe;&#x7684;virq&#x548c;&#x5bf9;&#x5e94;&#x7684;hw irq number&#x90fd;&#x4fdd;&#x5b58;&#x5728;&#x8be5;irq_desc&#x5f53;&#x4e2d;&#xff0c;
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x6709;&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x5e93;&#x4fdd;&#x5b58;&#x7740;irq_desc
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ec8f12" DESTINATION="ID_644120596" ENDARROW="None" ENDINCLINATION="-523;0;" ID="Arrow_ID_239927436" STARTARROW="None" STARTINCLINATION="6749;0;"/>
</node>
<node CREATED="1558849074483" ID="ID_157924479" MODIFIED="1558857912302">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5f53;&#x4e2d;&#x65ad;&#x6765;&#x4e34;&#x7684;&#x65f6;&#x5019;&#x786c;&#x4ef6;&#x5c06;&#x4e2d;&#x65ad;&#x4fe1;&#x53f7;&#x7ffb;&#x8bd1;&#x6210;hw irq number&#xff0c;&#x7136;&#x540e;
    </p>
    <p>
      &#x901a;&#x8fc7;irq domain &#x5c06;hw irq number&#x7ffb;&#x8bd1;&#x6210;virq number,&#x901a;&#x8fc7;
    </p>
    <p>
      virq number&#x53ef;&#x4ee5;&#x5728;&#x7cfb;&#x7edf;&#x7684;&#x6570;&#x636e;&#x5e93;&#x5f53;&#x4e2d;&#x627e;&#x5230;irq desc&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x6700;&#x7ec8;&#x8c03;&#x7528;&#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;
    </p>
    <p>
      &#x7684;high level&#x8fdb;&#x884c;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#xff0c;&#x5373;&#x8c03;&#x7528;irq_desc&#x91cc;&#x9762;&#x7684;handle_irq&#x6210;&#x5458;&#x53d8;&#x91cf;
    </p>
    <p>
      
    </p>
    <p>
      high level irq event handler&#x4e3b;&#x8981;&#x505a;&#x5982;&#x4e0b;&#x7684;&#x4e24;&#x4ef6;&#x4e8b;&#x60c5;&#xff1a;
    </p>
    <ol>
      <li>
        &#x8c03;&#x7528;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x7684;irq chip&#x8fdb;&#x884c;mask ack&#x7b49;callback&#x51fd;&#x6570;&#xff0c;&#x8fdb;&#x884c;interrupt flow&#x63a7;&#x5236;
      </li>
      <li>
        &#x8c03;&#x7528;&#x8be5;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x4e2d;action list&#x91cc;&#x9762;&#x7684;specific handler&#x8fdb;&#x884c;&#xff0c;&#x8be5;&#x6b65;&#x9aa4;&#x4e0d;&#x4e00;&#x5b9a;&#x4f1a;&#x6267;&#x884c;&#xff0c;&#x662f;&#x8ddf;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x5f53;&#x524d;&#x7684;&#x72b6;&#x6001;&#x76f8;&#x5173;&#x7684;
      </li>
    </ol>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1558857627297" FOLDED="true" ID="ID_93846258" MODIFIED="1560958719696" TEXT="2.&#x4e2d;&#x65ad;&#x7684;&#x6253;&#x5f00;&#x548c;&#x5173;&#x95ed;">
<node CREATED="1558857725752" ID="ID_5886079" MODIFIED="1558857844402">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e2d;&#x65ad;&#x7684;&#x6253;&#x5f00;&#x548c;&#x5173;&#x95ed;&#x6709;&#x4e24;&#x79cd;&#xff0c;&#x4e00;&#x79cd;&#x662f;&#x5173;&#x95ed;local cpu&#x7684;&#x4e2d;&#x65ad;&#xff0c;
    </p>
    <p>
      &#x53e6;&#x4e00;&#x79cd;&#x662f;&#x5173;&#x95ed;&#x67d0;&#x4e2a;IRQ number&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x66f4;&#x51c6;&#x786e;&#x7684;&#x672f;&#x8bed;&#x662f;mask&#x6216;&#x8005;
    </p>
    <p>
      unmask&#x67d0;&#x4e2a;&#x4e2d;&#x65ad;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1558858298265" FOLDED="true" ID="ID_618173238" MODIFIED="1560958720690">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3. IRQ Number
    </p>
  </body>
</html></richcontent>
<node CREATED="1558858317737" ID="ID_425826248" MODIFIED="1558858443064">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4ece;irq number&#x6620;&#x5c04;&#x5230;irq_desc&#x6709;&#x4e24;&#x79cd;&#x65b9;&#x6cd5;&#xff0c;&#x4e00;&#x79cd;&#x662f;&#x91c7;&#x7528;&#x9759;&#x6001;&#x8868;&#x683c;&#x7684;&#x65b9;&#x6cd5;&#xff0c;
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif" size="13px">struct irq_desc irq_desc[NR_IRQS] __cacheline_aligned_in_smp = {&#xa0;<br align="left" style="letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; background-color: rgb(239, 239, 239)"/>&#xa0;&#xa0;&#xa0; [0 ... NR_IRQS-1] = {&#xa0;<br align="left" style="letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; background-color: rgb(239, 239, 239)"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;.handle_irq&#xa0;&#xa0;&#xa0;&#xa0;= handle_bad_irq,&#xa0;<br align="left" style="letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; background-color: rgb(239, 239, 239)"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; .depth&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= 1,&#xa0;<br align="left" style="letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; background-color: rgb(239, 239, 239)"/>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; .lock&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= __RAW_SPIN_LOCK_UNLOCKED(irq_desc-&gt;lock),&#xa0;<br align="left" style="letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; background-color: rgb(239, 239, 239)"/>&#xa0;&#xa0;&#xa0; }&#xa0;<br align="left" style="letter-spacing: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; background-color: rgb(239, 239, 239)"/>};</font>
    </p>
    <p>
      &#x53e6;&#x4e00;&#x4e2d;&#x662f;&#x91c7;&#x7528;radix tree&#x7684;&#x65b9;&#x6cd5;&#xff0c;&#x751f;&#x6210;&#x4e00;&#x4e2a;irq_desc&#x7ed3;&#x6784;&#x4f53;&#x5c31;&#x5c06;&#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x63d2;&#x5165;&#x5230;radix tree
    </p>
    <p>
      &#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1558858641903" FOLDED="true" ID="ID_371132443" MODIFIED="1565876669963" TEXT="&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x6570;&#x636e;&#x7ed3;&#x6784;">
<node CREATED="1558859417555" ID="ID_607233017" MODIFIED="1558859582312">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x5f53;&#x4e2d;&#x5305;&#x542b;&#x5e95;&#x5c42;irq chip&#x76f8;&#x5173;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff0c;linux&#x5185;&#x6838;&#x5c06;&#x8fd9;&#x4e9b;
    </p>
    <p>
      &#x6570;&#x636e;&#x7ed3;&#x6784;&#x7ec4;&#x7ec7;&#x8d77;&#x6765;&#xff0c;&#x5f62;&#x6210;&#x4e86;irq_data&#x6570;&#x636e;&#x7ed3;&#x6784;&#x4f53;&#x3002;
    </p>
    <p>
      struct irq_data {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;u32&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;mask;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;TODO
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;IRQ number
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;hwirq;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;HW interrupt ID
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;node;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;NUMA node index
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;state_use_accessors;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x5e95;&#x5c42;&#x72b6;&#x6001;&#xff0c;&#x53c2;&#x8003;IRQD_xxxx
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct irq_chip&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*chip;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x5bf9;&#x5e94;&#x7684;irq chip&#x6570;&#x636e;&#x7ed3;&#x6784;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct irq_domain&#xa0;&#xa0;&#xa0;&#xa0;*domain;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x8be5;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x5bf9;&#x5e94;&#x7684;irq domain&#x6570;&#x636e;&#x7ed3;&#x6784;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*handler_data;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x548c;&#x5916;&#x8bbe;specific handler&#x76f8;&#x5173;&#x7684;&#x79c1;&#x6709;&#x6570;&#x636e;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*chip_data;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x548c;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x76f8;&#x5173;&#x7684;&#x79c1;&#x6709;&#x6570;&#x636e;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct msi_desc&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*msi_desc;&#xa0;&#xa0;&#xa0;&#x8ddf;msi&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad;&#x76f8;&#x5173;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;cpumask_var_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;affinity;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#xff0d;&#x548c;irq affinity&#x76f8;&#x5173;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558859630068" FOLDED="true" ID="ID_410834686" MODIFIED="1560958716574" TEXT="irq_chip&#x76f8;&#x5173;&#x7684;&#x6210;&#x5458;&#x63cf;&#x8ff0;">
<arrowlink COLOR="#eb4c30" DESTINATION="ID_564855156" ENDARROW="None" ENDINCLINATION="-375;154;" ID="Arrow_ID_524632377" STARTARROW="None" STARTINCLINATION="8221;0;"/>
<node CREATED="1558861015971" ID="ID_608266754" MODIFIED="1558861078901">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      unsigned int&#xa0;&#xa0;&#xa0;&#xa0;(*irq_startup)(struct irq_data *data)
    </p>
    <p>
      start up&#x6307;&#x5b9a;&#x7684;irq domain&#x4e0a;&#x7684;hw irq number, &#x5982;&#x679c;&#x6ca1;&#x6709;&#x6307;&#x5b9a;&#xff0c;&#x9ed8;&#x8ba4;
    </p>
    <p>
      &#x4f1a;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;enable&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558861125257" ID="ID_1628490479" MODIFIED="1558861201529">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_shutdown)(struct irq_data *data)
    </p>
    <p>
      
    </p>
    <p>
      shutdown &#x6307;&#x5b9a;&#x7684;irq domain&#x4e0a;&#x7684;hw irq number, &#x5982;&#x679c;&#x6ca1;&#x6709;&#x6307;&#x5b9a;&#xff0c;
    </p>
    <p>
      &#x9ed8;&#x8ba4;&#x662f;&#x8bbe;&#x7f6e;&#x6210;disable&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558861374556" ID="ID_6733814" MODIFIED="1558861421774">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void&#xa0;&#xa0;&#xa0;(*irq_enable)(struct irq_data *data)
    </p>
    <p>
      enable&#x6307;&#x5b9a;&#x7684;irq domain&#x4e0a;&#x7684;hw interrupt id, &#x5982;&#x679c;&#x6ca1;&#x6709;&#x6307;&#x5b9a;&#xff0c;
    </p>
    <p>
      &#x5219;&#x6a21;&#x5f0f;&#x662f;&#x4f7f;&#x7528;unmask&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558861501290" ID="ID_106239529" MODIFIED="1558861638939">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_disable)(struct irq_data *data)
    </p>
    <p>
      
    </p>
    <p>
      disable &#x6307;&#x5b9a;&#x7684;irq_domain&#x4e0a;&#x7684;hw interrupt id
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558861673048" ID="ID_1471637970" MODIFIED="1558861709842">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_ack)(struct irq_data *data)
    </p>
    <p>
      &#x548c;&#x5177;&#x4f53;&#x7684;&#x786c;&#x4ef6;&#x76f8;&#x5173;&#xff0c;&#x6709;&#x4e9b;&#x786c;&#x4ef6;&#x5fc5;&#x987b;&#x5728;&#x6267;&#x884c;ack&#x4e4b;&#x540e;&#x624d;&#x4f1a;&#x63a5;&#x53d7;&#x65b0;&#x7684;&#x4e2d;&#x65ad;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558862159082" ID="ID_1290971485" MODIFIED="1558862287220">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void&#xa0;&#xa0;&#xa0;(*irq_mask)(struct irq_data *data)
    </p>
    <p>
      
    </p>
    <p>
      mask&#x6307;&#x5b9a;&#x7684;irq domain&#x4e0a;&#x7684;hw irq number
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558862311697" ID="ID_1038078030" MODIFIED="1558862389905">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void&#xa0;&#xa0;&#xa0;(*irq_mask_ack) (struct irq_data *data)
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558863528472" ID="ID_412016766" MODIFIED="1558863533980" TEXT="void        (*irq_unmask)(struct irq_data *data)"/>
<node CREATED="1558863569264" ID="ID_218987260" MODIFIED="1558863621851">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      void&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_eoi)(struct irq_data *data)
    </p>
    <p>
      
    </p>
    <p>
      &#x60f3;GIC&#x5c31;&#x63d0;&#x4f9b;&#x4e86;&#x8fd9;&#x6837;&#x7684;&#x63a5;&#x53e3;&#xff0c;&#x8ba9;cpu&#x901a;&#x77e5;interrupt controller,
    </p>
    <p>
      &#x5b83;&#x5df2;&#x7ecf;&#x5904;&#x7406;&#x5b8c;&#x4e86;&#x8be5;&#x4e2d;&#x65ad;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1559141262549" ID="ID_1121818160" MODIFIED="1559141303133">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_set_affinity)(struct irq_data *data, const struct cpumask *dest, bool force)
    </p>
    <p>
      &#x5728;smp&#x67b6;&#x6784;&#x5f53;&#x4e2d;&#xff0c;&#x901a;&#x8fc7;&#x8be5;&#x51fd;&#x6570;&#x8bbe;&#x7f6e;cpu affinity
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1559141331714" ID="ID_97704789" MODIFIED="1559141385625">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_retrigger)(struct irq_data *data)
    </p>
    <p>
      &#x91cd;&#x65b0;&#x89e6;&#x53d1;&#x4e2d;&#x65ad;&#xff0c;&#x4e00;&#x822c;&#x4f7f;&#x7528;&#x5728;&#x4e2d;&#x65ad;&#x4e22;&#x5931;&#x7684;&#x573a;&#x666f;&#x4e0b;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x786c;&#x4ef6;&#x65e0;&#x6cd5;&#x8fdb;&#x884c;regrigger&#xff0c;&#x90a3;&#x4e48;&#x5c31;&#x7531;&#x8f6f;&#x4ef6;&#x6267;&#x884c;&#x89e6;&#x53d1;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1559141446813" ID="ID_26804742" MODIFIED="1559141475206">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_set_type)(struct irq_data *data, unsigned int flow_type)
    </p>
    <p>
      &#x914d;&#x7f6e;hw interrupt id&#x7684;&#x4e2d;&#x65ad;&#x89e6;&#x53d1;&#x65b9;&#x5f0f;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1559141502779" ID="ID_560334940" MODIFIED="1559141532332">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*irq_set_wake)(struct irq_data *data, unsigned int on)
    </p>
    <p>
      &#x7535;&#x6e90;&#x7ba1;&#x7406;&#x76f8;&#x5173;&#xff0c;&#x914d;&#x7f6e;&#x4e2d;&#x65ad;&#x5524;&#x9192;&#x6e90;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1559141838606" FOLDED="true" ID="ID_871072455" MODIFIED="1560958712702">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#xff0c;&#x4f7f;&#x7528;struct irq_desc&#x7ed3;&#x6784;&#x4f53;&#x6765;&#x63cf;&#x8ff0;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;
    </p>
    <p>
      
    </p>
    <p>
      struct irq_desc {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct irq_common_data&#xa0;&#xa0;irq_common_data;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct irq_data&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_data;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int __percpu&#xa0;&#xa0;&#xa0;*kstat_irqs;&#xa0;&#xa0;&#xa0;irq&#x7684;&#x7edf;&#x8ba1;&#x4fe1;&#x606f;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;irq_flow_handler_t&#xa0;&#xa0;handle_irq;&#xa0;&#xa0;&#xa0;&#xa0;-------------------------- &#xff08;1)
    </p>
    <p>
      #ifdef CONFIG_IRQ_PREFLOW_FASTEOI
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;irq_preflow_handler_t&#xa0;&#xa0;&#xa0;preflow_handler;
    </p>
    <p>
      #endif
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct irqaction&#xa0;&#xa0;&#xa0;&#xa0;*action;&#xa0;&#xa0;&#xa0;&#xa0;/* IRQ action list */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;status_use_accessors;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;core_internal_state__do_not_mess_with_it;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;depth;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* nested irq disables */&#xa0; &#x901a;&#x8fc7;enable/disable&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#x53ef;&#x4ee5;&#x4fdd;&#x62a4;&#x4e34;&#x754c;&#x533a;&#x8d44;&#x6e90;&#xff0c;&#x8fd9;&#x91cc;&#x8bb0;&#x5f55;enable/disable
    </p>
    <p>
      &#x7684;&#x6df1;&#x5ea6;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;wake_depth; /* nested wake enables */
    </p>
    <p>
      &#x8ddf;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x5f53;&#x4e2d;&#x7684;wake_up source&#x76f8;&#x5173;&#xff0c;enable/disable wake up&#x7684;&#x6df1;&#x5ea6;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;<b><font color="#1c43d7">unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_count;&#xa0;&#xa0;/* For detecting broken IRQs */ </font></b>
    </p>
    <p>
      <b><font color="#1c43d7">&#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;last_unhandled; /* Aging timer for unhandled count */ </font></b>
    </p>
    <p>
      <b><font color="#1c43d7">&#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irqs_unhandled;</font></b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;atomic_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;threads_handled;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;threads_handled_last;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;raw_spinlock_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;lock;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct cpumask&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*percpu_enabled;
    </p>
    <p>
      #ifdef CONFIG_SMP
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const struct cpumask&#xa0;&#xa0;&#xa0;&#xa0;*affinity_hint;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct irq_affinity_notify *affinity_notify;
    </p>
    <p>
      #ifdef CONFIG_GENERIC_PENDING_IRQ
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;cpumask_var_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;pending_mask;
    </p>
    <p>
      #endif
    </p>
    <p>
      #endif
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;threads_oneshot;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;atomic_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;threads_active;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;wait_queue_head_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;wait_for_threads;
    </p>
    <p>
      #ifdef CONFIG_PM_SLEEP
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;nr_actions;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;no_suspend_depth;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cond_suspend_depth;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;force_resume_depth;
    </p>
    <p>
      #endif
    </p>
    <p>
      #ifdef CONFIG_PROC_FS
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct proc_dir_entry&#xa0;&#xa0;&#xa0;*dir;
    </p>
    <p>
      #endif
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;parent_irq;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct module&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*owner;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*name;
    </p>
    <p>
      } ____cacheline_internodealigned_in_smp;
    </p>
  </body>
</html></richcontent>
<node CREATED="1559142051447" ID="ID_1243709452" MODIFIED="1559142557004">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#xff08;1&#xff09;handle_irq&#xff0c;&#x5185;&#x6838;&#x91cc;&#x9762;&#x7684;&#x6ce8;&#x91ca;&#x662f;highlevel irq-events handler&#xff0c;
    </p>
    <p>
      &#x662f;&#x5bf9;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x8fc7;&#x7a0b;&#x7684;&#x4e00;&#x4e2a;&#x62bd;&#x8c61;&#xff0c;&#x800c;irqaction&#x91cc;&#x9762;&#x7684;&#x662f;specific handler&#xff0c;&#x7528;&#x6765;
    </p>
    <p>
      &#x5904;&#x7406;&#x5177;&#x4f53;&#x7684;&#x4e8b;&#x52a1;&#x6bd4;&#x5982;&#x4e00;&#x4e2a;&#x6309;&#x952e;&#x4e2d;&#x65ad;
    </p>
    <p>
      highlevel handler&#x6839;&#x636e;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x7c7b;&#x578b;&#x548c;&#x4e2d;&#x65ad;&#x89e6;&#x53d1;&#x7684;&#x7c7b;&#x578b;&#xff0c;&#x53ef;&#x4ee5;&#x5206;&#x6210;&#x4e00;&#x4e0b;&#x51e0;&#x7c7b;
    </p>
    <p>
      (a)&#x5904;&#x7406;&#x7535;&#x5e73;&#x89e6;&#x53d1;&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad; handle_level_irq
    </p>
    <p>
      (b)&#x5904;&#x7406;&#x8fb9;&#x6cbf;&#x89e6;&#x53d1;&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad; handle_edge_irq
    </p>
    <p>
      (c)&#x5904;&#x7406;&#x7b80;&#x5355;&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad; handle_simple_irq
    </p>
    <p>
      (d)&#x5904;&#x7406;EOI&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad; handle_fasteoi_irq
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#ab16e5" DESTINATION="ID_1554333839" ENDARROW="None" ENDINCLINATION="-1732;163;" ID="Arrow_ID_471294536" STARTARROW="None" STARTINCLINATION="7478;0;"/>
</node>
<node CREATED="1559143716711" ID="ID_986877760" MODIFIED="1559143828066">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6807;&#x84dd;&#x8272;&#x5b57;&#x4f53;&#x7684;&#x6210;&#x5458;&#x53d8;&#x91cf;&#x662f;&#x7528;&#x4e8e;&#x5904;&#x7406;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x672a;&#x88ab;&#x5904;&#x7406;&#x7684;&#x4e2d;&#x65ad;&#x7684;&#xff0c;
    </p>
    <p>
      &#x5f53;&#x8be5;&#x4e2d;&#x65ad;&#x6ca1;&#x6709;&#x88ab;&#x5904;&#x7406;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x7cfb;&#x7edf;&#x53ef;&#x4ee5;&#x542f;&#x52a8;scan&#x673a;&#x5236;&#xff0c;&#x8ba9;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;
    </p>
    <p>
      interrupt handler&#x6765;&#x8ba4;&#x9886;&#x8be5;&#x4e2d;&#x65ad;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1560670338366" ID="ID_1757935763" MODIFIED="1560670387751">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      percpu_enable&#x53d8;&#x91cf;&#x7528;&#x4e8e;&#x63cf;&#x8ff0;&#x67d0;&#x4e2a;&#x4e2d;&#x65ad;&#x5728;&#x5404;&#x4e2a;cpu&#x4e0a;
    </p>
    <p>
      &#x662f;&#x5426;&#x88ab;enable
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1560670751409" ID="ID_1212481823" MODIFIED="1560670811163">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      threads_one
    </p>
    <p>
      threads_active
    </p>
    <p>
      wait_for_threads
    </p>
    <p>
      &#x8ddf;&#x4e2d;&#x65ad;&#x7ebf;&#x7a0b;&#x5316;&#x6709;&#x5173;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1560682485793" FOLDED="true" ID="ID_1795941704" MODIFIED="1565876677450">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4">&#x521d;&#x59cb;&#x5316;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;----&#x76f8;&#x5173;&#x7684;&#x63a5;&#x53e3;</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1560682572733" ID="ID_1563712592" MODIFIED="1560682595007">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9759;&#x6001;&#x5b9a;&#x4e49;&#x7684;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x521d;&#x59cb;&#x5316;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1560682605421" FOLDED="true" ID="ID_759922053" MODIFIED="1560958709898">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f7f;&#x7528;Radix Tree&#x7684;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x7684;&#x521d;&#x59cb;&#x5316;
    </p>
  </body>
</html></richcontent>
<node CREATED="1560682657827" FOLDED="true" ID="ID_1092478820" MODIFIED="1560958708969">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;<b>start_kernel</b>&#x51fd;&#x6570;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x8c03;&#x7528;&#x4e86; <b>early_irq_init()</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1560683011073" ID="ID_697586635" MODIFIED="1560683382974">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int __init early_irq_init(void)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int i, initcnt, node = first_online_node;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct irq_desc *desc;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;init_irq_default_affinity();
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* Let arch update nr_irqs and return the nr of preallocated irqs */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;initcnt = arch_probe_nr_irqs();&#xa0;&#xa0; <b>&#x83b7;&#x53d6;&#x7cfb;&#x7edf;&#x9700;&#x8981;&#x9884;&#x5148;&#x5206;&#x914d;&#x7684;irq desc&#x7684;&#x6570;&#x91cf;</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;printk(KERN_INFO "NR_IRQS:%d nr_irqs:%d %d\n", NR_IRQS, nr_irqs, initcnt);
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (WARN_ON(nr_irqs &gt; IRQ_BITMAP_BITS))
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;nr_irqs = IRQ_BITMAP_BITS;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (WARN_ON(initcnt &gt; IRQ_BITMAP_BITS))
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;initcnt = IRQ_BITMAP_BITS;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (initcnt &gt; nr_irqs)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;nr_irqs = initcnt;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; <b>nr_irqs&#x662f;&#x5f53;&#x524d;&#x7cfb;&#x7edf;&#x6700;&#x5927;&#x7684;irq number&#x503c;</b>
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;for (i = 0; i &lt; initcnt; i++) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;desc = alloc_desc(i, node, NULL);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;set_bit(i, allocated_irqs);&#xa0; <b>&#x8bbe;&#x7f6e;&#x5df2;&#x7ecf;&#x5206;&#x914d;&#x7684;&#x6807;&#x5fd7;&#x4f4d;</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_insert_desc(i, desc);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;}&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return arch_early_irq_init();
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1547050126236" FOLDED="true" ID="ID_1190946216" MODIFIED="1574903973490">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#de1515" size="4"><i>Linux&#x7684;&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x4e4b;&#x4e09; ARM&#x5904;&#x7406;&#x4e2d;&#x65ad;&#x7684;&#x8fc7;&#x7a0b;</i></font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1548558428276" FOLDED="true" ID="ID_290437339" MODIFIED="1574903968857">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#1112f3">&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x7684;&#x51c6;&#x5907;&#x8fc7;&#x7a0b;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1548558709580" ID="ID_906118989" MODIFIED="1548560416784">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x4e2d;&#x65ad;&#x6a21;&#x5f0f;&#x7684;&#x6808;&#x7684;&#x51c6;&#x5907;</b>
    </p>
    <p>
      &#x5bf9;&#x4e8e;irq, abt, und&#x4e09;&#x79cd;&#x6a21;&#x5f0f;&#x6765;&#x8bf4;&#xff0c;&#x5f53;&#x7cfb;&#x7edf;&#x53d1;&#x751f;&#x76f8;&#x5e94;&#x7684;&#x5f02;&#x5e38;&#x8fdb;&#x5165;&#x8fd9;&#x4e09;&#x79cd;&#x6a21;&#x5f0f;&#x5f53;&#x4e2d;&#x7684;&#x4e00;&#x79cd;&#x6a21;&#x5f0f;&#x7684;&#x65f6;&#x5019;&#xff0c;
    </p>
    <p>
      &#x4f1a;&#x6709;&#x4e00;&#x4e2a;&#x5bf9;&#x5e94;&#x7684;&#x6808;&#x7a7a;&#x95f4;&#x8fdb;&#x884c;&#x76f8;&#x5173;&#x7684;&#x5904;&#x7406;&#xff0c;&#x7136;&#x540e;&#x624d;&#x5207;&#x5165;&#x5230;svc&#x6a21;&#x5f0f;&#x8fdb;&#x884c;&#x540e;&#x7eed;&#x7684;&#x5904;&#x7406;&#xff0c;&#x8fd9;&#x4e09;&#x79cd;&#x6a21;&#x5f0f;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      &#x6808;&#x7a7a;&#x95f4;&#x90fd;&#x6bd4;&#x8f83;&#x5c0f;&#xff0c;&#x53ea;&#x6709;12&#x4e2a;&#x5b57;&#x8282;
    </p>
    <p>
      struct stack {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;u32 irq[3];
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;u32 abt[3];
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;u32 und[3];
    </p>
    <p>
      } ____cacheline_aligned;
    </p>
    <p>
      
    </p>
    <p>
      static struct stack stacks[NR_CPUS];
    </p>
    <p>
      
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f1a;&#x8c03;&#x7528;cpu_init&#x51fd;&#x6570;&#x8fdb;&#x884c;&#x8fd9;&#x4e09;&#x79cd;&#x6a21;&#x5f0f;&#x7684;&#x6808;&#x7684;&#x8bbe;&#x7f6e;&#xff0c;
    </p>
    <p>
      void notrace cpu_init(void)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int cpu = smp_processor_id();
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct stack *stk = &amp;stacks[cpu];
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__asm__ (
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"msr&#xa0;&#xa0;&#xa0;&#xa0;cpsr_c, %1\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"add&#xa0;&#xa0;&#xa0;&#xa0;r14, %0, %2\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"mov&#xa0;&#xa0;&#xa0;&#xa0;sp, r14\n\t"&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x914d;&#x7f6e;irq mode&#x7684;stack&#x6307;&#x9488;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"msr&#xa0;&#xa0;&#xa0;&#xa0;cpsr_c, %3\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"add&#xa0;&#xa0;&#xa0;&#xa0;r14, %0, %4\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"mov&#xa0;&#xa0;&#xa0;&#xa0;sp, r14\n\t"&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x914d;&#x7f6e;abt mode&#x7684;stack&#x6307;&#x9488;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"msr&#xa0;&#xa0;&#xa0;&#xa0;cpsr_c, %5\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"add&#xa0;&#xa0;&#xa0;&#xa0;r14, %0, %6\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"mov&#xa0;&#xa0;&#xa0;&#xa0;sp, r14\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"msr&#xa0;&#xa0;&#xa0;&#xa0;cpsr_c, %7\n\t"&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;-----&gt; linux4.4.40 &#x5185;&#x6838;&#x589e;&#x52a0;&#x4e86;FIQ&#x7684;&#x6808;&#x7a7a;&#x95f4;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"add&#xa0;&#xa0;&#xa0;&#xa0;r14, %0, %8\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"mov&#xa0;&#xa0;&#xa0;&#xa0;sp, r14\n\t"
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;"msr&#xa0;&#xa0;&#xa0;&#xa0;cpsr_c, %9"&#xa0;&#xa0;----&gt; &#x8fd9;&#x662f;&#x5207;&#x6362;&#x5230;&#x4e86;svc&#x6a21;&#x5f0f;&#x4e86;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;: "r" (stk),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;PLC (PSR_F_BIT | PSR_I_BIT | IRQ_MODE),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"I" (offsetof(struct stack, irq[0])),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;PLC (PSR_F_BIT | PSR_I_BIT | ABT_MODE),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"I" (offsetof(struct stack, abt[0])),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;PLC (PSR_F_BIT | PSR_I_BIT | UND_MODE),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"I" (offsetof(struct stack, und[0])),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;PLC (PSR_F_BIT | PSR_I_BIT | FIQ_MODE),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;"I" (offsetof(struct stack, fiq[0])),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;PLC (PSR_F_BIT | PSR_I_BIT | SVC_MODE)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;: "r14");&#xa0;&#xa0;&#xa0;&#x2014;&#x2014;&gt; &#x8fd9;&#x91cc;&#x7684;r14&#x8868;&#x793a;&#x5728;&#x6c47;&#x7f16;&#x4ee3;&#x7801;&#x5f53;&#x4e2d;&#x4fee;&#x6539;&#x4e86;r14&#x7684;&#x503c;&#x4e86;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1548561986659" ID="ID_1050884558" MODIFIED="1548773669427">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      svc&#x6a21;&#x5f0f;&#x7684;&#x6808;&#x7684;&#x51c6;&#x5907;
    </p>
    <p>
      
    </p>
    <p>
      &#x5bf9;&#x4e8e;linux&#x7cfb;&#x7edf;&#x6765;&#x8bf4;&#xff0c;&#x53ef;&#x4ee5;&#x628a;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;&#x8fdb;&#x7a0b;&#x5206;&#x4e3a;&#x4e24;&#x7c7b;&#xff0c;
    </p>
    <p>
      &#x4e00;&#x79cd;&#x662f;pid&#x7b49;&#x4e8e;0&#x7684;&#x8fdb;&#x7a0b;&#xff0c;&#x4e5f;&#x53eb;&#x505a;swapper&#x8fdb;&#x7a0b;&#x6216;&#x8005;idle&#x8fdb;&#x7a0b;&#x3002;
    </p>
    <p>
      &#x53e6;&#x4e00;&#x79cd;&#x8fdb;&#x7a0b;&#x662f;&#x7531;0&#x8fdb;&#x7a0b;&#x6d3e;&#x751f;&#x51fa;&#x6765;&#x7684;&#x5176;&#x4ed6;&#x8fdb;&#x7a0b;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      idle&#x8fdb;&#x7a0b;&#x7684;&#x6808;&#x7a7a;&#x95f4;&#x662f;&#x9759;&#x6001;&#x5206;&#x914d;&#x7684;&#xff0c;&#x800c;&#x5176;&#x4ed6;&#x7684;&#x8fdb;&#x7a0b;&#x5219;&#x662f;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x5728;&#x521b;&#x5efa;&#x8fdb;&#x7a0b;&#x7684;&#x65f6;&#x5019;&#x52a8;&#x6001;&#x5206;&#x914d;&#x7684;&#x3002;
    </p>
    <p>
      &#x9759;&#x6001;&#x5b9a;&#x4e49;&#x7684;&#x5185;&#x6838;&#x6808;&#x5982;&#x4e0b;&#xff1a;
    </p>
    <p>
      union thread_union init_thread_union __init_task_data =
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;{ INIT_THREAD_INFO(init_task) };
    </p>
    <p>
      
    </p>
    <p>
      union thread_union {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct thread_info thread_info;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long stack[THREAD_SIZE/sizeof(long)];
    </p>
    <p>
      };
    </p>
    <p>
      &#x53ef;&#x89c1;&#x8be5;&#x9759;&#x6001;&#x6808;&#x7684;&#x5730;&#x6bb5;&#x5730;&#x5740;&#x7a7a;&#x95f4;&#x4fdd;&#x5b58;&#x7684;&#x662f;thread_info&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x9ad8;&#x7aef;&#x7a7a;&#x95f4;&#x662f;&#x6808;&#x7a7a;&#x95f4;&#x5730;&#x5740;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      &#x52a8;&#x6001;&#x7684;&#x5185;&#x6838;&#x6808;&#x5206;&#x914d;:
    </p>
    <p>
      static struct task_struct *dup_task_struct(struct task_struct *orig)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;......
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ti = alloc_thread_info_node(tsk, node);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (!ti)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;goto free_tsk;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;......
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1548939582644" ID="ID_695772541" MODIFIED="1548939623896">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#e30303">&#x5f02;&#x5e38;&#x5411;&#x91cf;&#x8868;&#x7684;&#x51c6;&#x5907;&#xff0c;&#x89c1;&#x4e0a;&#x6587;</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1548558459036" FOLDED="true" ID="ID_1841169593" MODIFIED="1560958703339">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#2114ee">&#x4e2d;&#x65ad;&#x53d1;&#x751f;&#x7684;&#x65f6;&#x5019;&#x7684;&#x786c;&#x4ef6;&#x884c;&#x4e3a;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1548941518519" ID="ID_1734250436" MODIFIED="1548941557024">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5bf9;&#x4e8e;&#x786c;&#x4ef6;&#x884c;&#x4e3a;&#xff0c;&#x539f;&#x6587;&#x8bf4;&#x5f97;&#x6bd4;&#x8f83;&#x7b80;&#x6d01;&#x900f;&#x5f7b;&#xff0c;
    </p>
    <p>
      &#x5efa;&#x8bae;&#x53c2;&#x8003;&#x94fe;&#x63a5; http://www.wowotech.net/irq_subsystem/irq_handler.html
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1548558500003" FOLDED="true" ID="ID_498035786" MODIFIED="1574903965596">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#1429e8">&#x4e2d;&#x65ad;&#x8fdb;&#x5165;&#x8fc7;&#x7a0b;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1548948173176" ID="ID_677439937" MODIFIED="1548948294693" TEXT="&#x7b2c;&#x4e00;&#x90e8;&#x5206;: interrupt dispatcher">
<arrowlink COLOR="#e01717" DESTINATION="ID_944323132" ENDARROW="None" ENDINCLINATION="2187;0;" ID="Arrow_ID_1021296289" STARTARROW="None" STARTINCLINATION="3180;0;"/>
</node>
<node CREATED="1548948306053" FOLDED="true" ID="ID_347173300" MODIFIED="1560958700334">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5f53;&#x4f4d;&#x4e8e;&#x4e2d;&#x65ad;&#x5411;&#x91cf;&#x90e8;&#x5206;&#x7684;&#x4ee3;&#x7801;&#x8d70;&#x5b8c;&#x4e4b;&#x540e;&#xff0c;&#x4f1a;&#x6839;&#x636e;&#x53d1;&#x751f;&#x4e2d;&#x65ad;&#x4e4b;&#x524d;&#x7684;&#x7cfb;&#x7edf;&#x6a21;&#x5f0f;&#xff0c;
    </p>
    <p>
      &#x5373;usr&#x6a21;&#x5f0f;&#x6216;&#x8005;&#x662f;&#x5185;&#x6838;&#x6a21;&#x5f0f;&#xff0c;&#x8fdb;&#x4e00;&#x6b65;&#x5230;&#x4ee3;&#x7801;&#x5206;&#x652f;__irq_usr&#x6216;&#x8005;&#x662f;__irq_svc&#x91cc;&#x9762;&#x8fdb;&#x884c;&#x5904;&#x7406;
    </p>
  </body>
</html></richcontent>
<node CREATED="1548948421554" FOLDED="true" ID="ID_36356347" MODIFIED="1560958699156">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5982;&#x679c;&#x53d1;&#x751f;&#x4e2d;&#x65ad;&#x4e4b;&#x524d;&#xff0c;&#x7cfb;&#x7edf;&#x662f;&#x5904;&#x4e8e;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#xff0c;&#x90a3;&#x4e48;&#x4f1a;&#x8d70;&#x5982;&#x4e0b;&#x7684;&#x4ee3;&#x7801;:
    </p>
    <p>
      
    </p>
    <p>
      __irq_usr:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;usr_entry
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;kuser_cmpxchg_check
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;irq_handler
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;get_thread_info tsk
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;mov why, #0
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;b&#xa0;&#xa0;&#xa0;ret_to_user_from_irq
    </p>
  </body>
</html></richcontent>
<node CREATED="1549261047740" ID="ID_952819675" MODIFIED="1549420637618">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>irq_handler&#x7684;&#x5b9a;&#x4e49;</b>
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.macro&#xa0;&#xa0;irq_handler
    </p>
    <p>
      #ifdef CONFIG_MULTI_IRQ_HANDLER
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ldr r1, =handle_arch_irq
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;mov r0, sp
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;badr&#xa0;&#xa0;&#xa0;&#xa0;lr, 9997f
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ldr pc, [r1]
    </p>
    <p>
      #else
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;arch_irq_handler_default
    </p>
    <p>
      #endif
    </p>
    <p>
      9997:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.endm
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#1511ec" DESTINATION="ID_735150460" ENDARROW="Default" ENDINCLINATION="2126;0;" ID="Arrow_ID_594282455" STARTARROW="None" STARTINCLINATION="512;0;"/>
</node>
</node>
<node CREATED="1548948536119" ID="ID_1590391485" MODIFIED="1548948608048">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5982;&#x679c;&#x53d1;&#x751f;&#x4e2d;&#x65ad;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x7cfb;&#x7edf;&#x662f;&#x8fd0;&#x884c;&#x5728;&#x5185;&#x6838;&#x72b6;&#x6001;&#x4e0b;&#x7684;&#xff0c;&#x90a3;&#x4e48;
    </p>
    <p>
      &#x8fdb;&#x5165;&#x5982;&#x4e0b;&#x7684;&#x4ee3;&#x7801;&#x8fdb;&#x884c;&#x5904;&#x7406;:
    </p>
    <p>
      
    </p>
    <p>
      __irq_svc:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;svc_entry
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;irq_handler
    </p>
    <p>
      
    </p>
    <p>
      #ifdef CONFIG_PREEMPT
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;get_thread_info tsk
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ldr r8, [tsk, #TI_PREEMPT]&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ get preempt count
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ldr r0, [tsk, #TI_FLAGS]&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ get flags
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;teq r8, #0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ if preempt count != 0
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;movne&#xa0;&#xa0;&#xa0;r0, #0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ force flags to 0
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;tst r0, #_TIF_NEED_RESCHED
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;blne&#xa0;&#xa0;&#xa0;&#xa0;svc_preempt
    </p>
    <p>
      #endif
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;svc_exit r5, irq = 1&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;@ return from exception
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1548558524434" ID="ID_1729985866" MODIFIED="1548558550260">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#1911de">&#x4e2d;&#x65ad;&#x9000;&#x51fa;&#x8fc7;&#x7a0b;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1475917220585" FOLDED="true" ID="ID_1364440222" MODIFIED="1504664635275" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#dd0606" size="4"><b>&#x7b2c;&#x5341;&#x7ae0;&#xff1a;PCI&#x8bbe;&#x5907;&#x9a71;&#x52a8;</b></font>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1475917339823" FOLDED="true" ID="ID_526840807" MODIFIED="1499823215079">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>1.&#x5730;&#x5740;&#x7a7a;&#x95f4;</b>
    </p>
    <p>
      cpu&#x548c;pci&#x8bbe;&#x5907;&#x9700;&#x8981;&#x8bbf;&#x95ee;&#x5728;&#x4ed6;&#x4eec;&#x4e4b;&#x95f4;&#x5171;&#x4eab;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#xff0c;
    </p>
    <p>
      &#x8be5;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#x53ef;&#x4ee5;&#x88ab;&#x9a71;&#x52a8;&#x7528;&#x6765;&#x63a7;&#x5236;&#x8bbe;&#x5907;&#x548c;&#x5171;&#x4eab;&#x4fe1;&#x606f;&#x3002;
    </p>
    <p>
      &#x5178;&#x578b;&#x5730;&#xff0c;&#x5171;&#x4eab;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#x5f53;&#x4e2d;&#x5305;&#x62ec;&#x8bbe;&#x5907;&#x7684;&#x72b6;&#x6001;&#x548c;&#x63a7;&#x5236;&#x5bc4;&#x5b58;&#x5668;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1475917500080" ID="ID_1497565921" MODIFIED="1475917853969">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7cfb;&#x7edf;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#x7684;&#x4e00;&#x90e8;&#x5206;&#x53ef;&#x4ee5;&#x88ab;&#x662f;&#x7528;&#x6765;&#x5f53;&#x4f5c;&#x5171;&#x4eab;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#xff0c;
    </p>
    <p>
      &#x4f46;&#x662f;&#x7531;&#x4e8e;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;&#x7ec4;&#x4ef6;&#x5bf9;&#x7cfb;&#x7edf;&#x5185;&#x5b58;&#x7684;&#x8bbf;&#x95ee;&#x662f;&#x4e92;&#x65a5;&#x7684;&#xff0c;&#x6240;&#x4ee5;&#x4efb;&#x7531;
    </p>
    <p>
      pci&#x8bbe;&#x5907;&#x6765;&#x8bbf;&#x95ee;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#x65e0;&#x7591;&#x4f1a;&#x62d6;&#x6162;&#x6574;&#x4e2a;&#x7cfb;&#x7edf;&#x7684;&#x901f;&#x5ea6;&#x3002;&#x540c;&#x65f6;&#x5bf9;&#x8bbe;&#x5907;&#x7684;
    </p>
    <p>
      &#x8bbf;&#x95ee;&#x4e0d;&#x52a0;&#x63a7;&#x5236;&#x4e5f;&#x662f;&#x5f88;&#x5371;&#x9669;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1475917858032" FOLDED="true" ID="ID_484567526" MODIFIED="1499823213024">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6bcf;&#x4e2a;&#x8bbe;&#x5907;&#x90fd;&#x6709;&#x81ea;&#x5df1;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#xff0c;cpu&#x53ef;&#x4ee5;&#x8bbf;&#x95ee;&#x8bbe;&#x5907;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#xff0c;
    </p>
    <p>
      &#x4f46;&#x662f;&#x8bbe;&#x5907;&#x5982;&#x679c;&#x9700;&#x8981;&#x8bbf;&#x95ee;&#x7cfb;&#x7edf;&#x7684;&#x5185;&#x5b58;&#xff0c;&#x5219;&#x9700;&#x8981;&#x901a;&#x8fc7;DMA&#x901a;&#x9053;&#x6765;&#x8fdb;&#x884c;
    </p>
    <p>
      &#x63a7;&#x5236;&#xff0c;&#x4ee5;&#x9632;&#x6b62;&#x8bbf;&#x95ee;&#x5931;&#x63a7;&#x3002;PCI&#x8bbe;&#x5907;&#x62e5;&#x6709;&#x4e09;&#x79cd;&#x5730;&#x5740;&#x7a7a;&#x95f4;:
    </p>
    <p>
      <b>PCI I/O, PCI Memory and PCI Configuration space </b>
    </p>
    <p>
      &#x9664;&#x4e86;&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x4e4b;&#x5916;&#xff0c;&#x5176;&#x4ed6;&#x7684;&#x4e24;&#x4e2a;&#x7a7a;&#x95f4;&#x5bf9;&#x540c;&#x4e00;&#x4e2a;bus&#x4e0a;&#x7684;&#x6240;&#x6709;&#x8bbe;&#x5907;&#x6765;&#x8bf4;
    </p>
    <p>
      &#x90fd;&#x662f;&#x5171;&#x4eab;&#x7684;,&#x8bbe;&#x5907;&#x4e0a;&#x7684;&#x56fa;&#x4ef6;&#x5728;&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#x4f1a;&#x5c06;&#x4e0a;&#x9762;&#x7684;&#x7a7a;&#x95f4;&#x6620;&#x5c04;&#x5230;&#x4e0d;&#x540c;&#x7684;
    </p>
    <p>
      &#x533a;&#x57df;&#xff0c;&#x8be5;&#x533a;&#x57df;&#x7684;&#x5730;&#x5740;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x8bfb;&#x53d6;&#x5230;,&#x9a71;&#x52a8;&#x4e0d;&#x80fd;&#x64c5;&#x81ea;
    </p>
    <p>
      &#x4fee;&#x6539;I/O&#x548c;memory&#x7684;&#x6620;&#x5c04;&#x5730;&#x5740;
    </p>
  </body>
</html></richcontent>
<node CREATED="1476075855094" ID="ID_811225544" MODIFIED="1478659574606">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      configuration space
    </p>
    <p>
      &#x5305;&#x62ec;256&#x4e2a;&#x5b57;&#x8282;&#xff0c;&#x524d;64&#x5b57;&#x8282;&#x662f;spec&#x89c4;&#x5b9a;&#x7684;&#x4fe1;&#x606f;&#xff0c;
    </p>
    <p>
      &#x540e;192&#x5b57;&#x8282;&#x7531;&#x5177;&#x4f53;&#x7684;&#x5382;&#x5bb6;&#x8fdb;&#x884c;&#x5b9a;&#x4e49;
    </p>
    <p>
      &#x5bf9;&#x4e8e;pcie&#x5219;&#x6709;&#x591a;&#x8fbe;4K&#x7684;&#x914d;&#x7f6e;&#x7a7a;&#x95f4;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476076198862" ID="ID_1404319290" MODIFIED="1476076280975">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      I/O space
    </p>
    <p>
      &#x5141;&#x8bb8;&#x5916;&#x8bbe;&#x6620;&#x5c04;&#x5230;&#x8be5;&#x7a7a;&#x95f4;&#xff0c;&#x6839;&#x636e;spec&#x7684;&#x89c4;&#x5b9a;
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x7533;&#x8bf7;4B&#x5230;2GB&#x7684;&#x7a7a;&#x95f4;&#xff0c;&#x5728;x86&#x5e73;&#x53f0;&#x4e0b;&#xff0c;
    </p>
    <p>
      &#x7531;&#x4e8e;isa&#x7684;&#x5f71;&#x54cd;&#xff0c;&#x6700;&#x5927;&#x53ef;&#x4ee5;&#x7533;&#x8bf7;256B&#x7684;&#x7a7a;&#x95f4;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476076876725" ID="ID_1939065717" MODIFIED="1476076945590">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      memory space
    </p>
    <p>
      &#x901a;&#x7528;&#x7684;&#x5730;&#x5740;&#x7a7a;&#x95f4;&#xff0c;pci spec&#x5efa;&#x8bae;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x4f7f;&#x7528;
    </p>
    <p>
      memory space&#xff0c;&#x5373;&#x4f7f;&#x8be5;&#x8bbe;&#x5907;&#x662f;&#x4e00;&#x4e2a;&#x5916;&#x56f4;&#x7684;&#x8bbe;&#x5907;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1478656416974" ID="ID_1315769906" MODIFIED="1478660551748">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5728;linux&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;&#x5bfb;&#x5740;</b>:
    </p>
    <p>
      &#x6709;domain, bus number, device number, function number&#x7684;&#x56db;&#x79cd;&#x6982;&#x5ff5;
    </p>
    <p>
      &#x6bcf;&#x4e2a;domain&#x53ef;&#x4ee5;&#x5305;&#x542b;256&#x4e2a;bus
    </p>
    <p>
      &#x6bcf;&#x4e2a;bus&#x53ef;&#x4ee5;&#x5305;&#x542b;32&#x4e2a;device
    </p>
    <p>
      &#x6bcf;&#x4e2a;device&#x53ef;&#x4ee5;&#x5305;&#x542b;&#x6700;&#x591a;8&#x4e2a;function
    </p>
    <p>
      &#x6240;&#x4ee5;&#x6bcf;&#x4e2a;function&#x53ef;&#x4ee5;&#x901a;&#x8fc7;16bit&#x7684;&#x6570;&#x636e;&#x88ab;&#x8868;&#x793a;&#x51fa;&#x6765;
    </p>
    <p>
      &#x5728;linux&#x5f53;&#x4e2d;&#x6211;&#x4eec;&#x4e0d;&#x5fc5;&#x53bb;&#x5904;&#x7406;&#x8fd9;&#x4e9b;&#x4e8c;&#x8fdb;&#x5236;&#x7684;&#x5730;&#x5740;&#x6570;&#x636e;&#xff0c;&#x8fd9;&#x4e9b;&#x6570;&#x636e;&#x90fd;&#x88ab;&#x5c01;&#x88c5;&#x5230;&#x4e86;
    </p>
    <p>
      &#x7ed3;&#x6784;&#x4f53;pci_dev&#x5f53;&#x4e2d;&#x4e86;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      <i><b>/proc/bus/pci/devices&#x76f4;&#x63a5;&#x73b0;&#x5b9e;pci&#x8bbe;&#x5907;&#x7684;16bit&#x7684;&#x5730;&#x5740; </b></i>
    </p>
    <p>
      <i><b>/proc/bus/pci/*/*. &#x662f;&#x4e8c;&#x8fdb;&#x5236;&#x7684;&#x6587;&#x4ef6;&#xff0c;&#x53ef;&#x4ee5;&#x76f4;&#x63a5;&#x73b0;&#x5b9e;pci&#x8bbe;&#x5907;&#x7684;&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x7684;&#x5185;&#x5bb9; </b></i>
    </p>
    <p>
      <i><b>&#x547d;&#x4ee4;lspci&#x53ef;&#x4ee5;&#x663e;&#x793a;bus, device, function&#x4e09;&#x4e2a;&#x57df;</b></i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1476064923956" FOLDED="true" ID="ID_895397883" MODIFIED="1499823220730">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>2.pci&#x914d;&#x7f6e;&#x5934;&#x6570;&#x636e;&#x7ed3;&#x6784;</b></i>
    </p>
    <p>
      &#x5728;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;&#x6bcf;&#x4e2a;pci&#x8bbe;&#x5907;&#xff0c;&#x5728;&#x5176;pci&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x5f53;&#x4e2d;&#x90fd;&#x6709;
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x914d;&#x7f6e;&#x6570;&#x636e;&#x7ed3;&#x6784;
    </p>
    <p>
      pci&#x914d;&#x7f6e;&#x5934;&#x6570;&#x636e;&#x5141;&#x8bb8;&#x7cfb;&#x7edf;&#x6765;&#x8bc6;&#x522b;&#x548c;&#x63a7;&#x5236;&#x8bbe;&#x5907;&#xff0c;&#x8be5;&#x5934;&#x6570;&#x636e;
    </p>
    <p>
      &#x7684;&#x4f4d;&#x7f6e;&#x51b3;&#x5b9a;&#x4e8e;&#x5f53;&#x524d;pci&#x8bbe;&#x5907;&#x7684;&#x62d3;&#x6251;&#x7ed3;&#x6784;
    </p>
  </body>
</html></richcontent>
<node CREATED="1476084476349" ID="ID_877510566" MODIFIED="1476084563723">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x65e0;&#x8bba;pci&#x8bbe;&#x5907;&#x6216;&#x8005;pci bridge&#x5728;&#x54ea;&#x4e2a;&#x4f4d;&#x7f6e;&#xff0c;
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x90fd;&#x4f1a;&#x901a;&#x8fc7;pci&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x7684;&#x5934;&#x6570;&#x636e;&#x91cc;&#x9762;&#x7684;&#x72b6;&#x6001;&#x548c;
    </p>
    <p>
      &#x914d;&#x7f6e;&#x5bc4;&#x5b58;&#x5668;&#x627e;&#x5230;&#x5e76;&#x4e14;&#x914d;&#x7f6e;&#x5b83;&#x4eec;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476084637541" ID="ID_334517731" MODIFIED="1476085111004">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6bcf;&#x4e2a;pci slot&#x7684;pci configuration&#x7a7a;&#x95f4;&#x90fd;&#x8ddf;&#x6bcf;&#x4e2a;pci slot&#x7684;
    </p>
    <p>
      &#x4f4d;&#x7f6e;&#x76f8;&#x5173;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476085116493" FOLDED="true" ID="ID_1780813473" MODIFIED="1499823218955">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/pci-config-header.gif"/>
  </body>
</html></richcontent>
<node CREATED="1476085227238" ID="ID_1684699517" MODIFIED="1476085360537">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Base Address Register</b>
    </p>
    <p>
      &#x7528;&#x4e8e;&#x51b3;&#x5b9a;&#x548c;&#x5206;&#x914d;PCI I/O&#x548c;PCI memory&#x7a7a;&#x95f4;&#x7684;&#x7c7b;&#x578b;&#xff0c;
    </p>
    <p>
      &#x5927;&#x5c0f;&#x548c;&#x4f4d;&#x7f6e;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476086071390" ID="ID_1814326406" MODIFIED="1476086359318">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Interrupt Pin </b>
    </p>
    <p>
      pci card&#x4e0a;&#x9762;&#x7684;&#x56db;&#x4e2a;&#x7269;&#x7406;&#x7684;&#x4e2d;&#x65ad;&#x5f15;&#x811a;&#x4f1a;&#x5c06;&#x4e2d;&#x65ad;&#x4fe1;&#x53f7;&#x4ece;
    </p>
    <p>
      card&#x9012;&#x9001;&#x5230;pci bus&#x4e0a;&#x9762;&#x53bb;&#x3002;&#x6807;&#x51c6;&#x4f1a;&#x5c06;&#x8fd9;&#x56db;&#x4e2a;&#x5f15;&#x811a;&#x5206;&#x522b;
    </p>
    <p>
      &#x6807;&#x6ce8;&#x6210;A&#xff0c;B&#xff0c;C&#xff0c;D
    </p>
    <p>
      &#x901a;&#x5e38;&#x8bbe;&#x5907;&#x4f1a;&#x5728;&#x7269;&#x7406;&#x4e0a;&#x5c06;&#x4e2d;&#x65ad;&#x4fe1;&#x53f7;&#x7ebf;&#x8fde;&#x63a5;&#x5230;A&#xff0c;B&#xff0c;C&#xff0c;D&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x7684;&#x4e00;&#x4e2a;&#x5f15;&#x811a;&#x4e0a;&#x9762;&#x53bb;&#xff0c;&#x56e0;&#x6b64;&#x8be5;&#x5b57;&#x6bb5;&#x5c31;&#x662f;&#x7528;&#x6765;&#x6807;&#x6ce8;&#x4f7f;&#x7528;&#x4e86;&#x54ea;&#x4e2a;
    </p>
    <p>
      &#x5f15;&#x811a;&#x7684;&#x3002;&#x8fd9;&#x6837;&#x4fbf;&#x4e8e;&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;&#x5904;&#x7406;&#x8bbe;&#x5907;&#x7684;&#x4e2d;&#x65ad;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476086666791" ID="ID_1786185514" MODIFIED="1476086739066">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Interrupt Line</b>
    </p>
    <p>
      &#x8be5;&#x5b57;&#x6bb5;&#x7684;&#x6570;&#x5b57;&#x53ef;&#x4ee5;&#x5e2e;&#x52a9;&#x4e2d;&#x65ad;&#x5b50;&#x7cfb;&#x7edf;
    </p>
    <p>
      &#x6b63;&#x786e;&#x5730;&#x627e;&#x5230;&#x5bf9;&#x5e94;&#x7684;&#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x6ce8;&#x518c;&#x7684;
    </p>
    <p>
      &#x4e2d;&#x65ad;&#x5904;&#x7406;&#x4ee3;&#x7801;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1495434174987" ID="ID_108542342" MODIFIED="1495434195691">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/pci-type00-configuration-header-250-370.png"/>
  </body>
</html></richcontent>
<node CREATED="1495439460698" ID="ID_95804250" MODIFIED="1495439635387">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e50e0e"><b><i>&#x7cfb;&#x7edf;&#x5982;&#x4f55;&#x5224;&#x5b9a;pci&#x8bbe;&#x5907;&#x6620;&#x5c04;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#x7684;&#x5927;&#x5c0f;:</i></b></font>
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x4f1a;&#x9996;&#x5148;&#x5411;base address register&#x5199;&#x5165;&#x5168;1,
    </p>
    <p>
      &#x7136;&#x540e;&#x518d;&#x4ece;base address register&#x5f53;&#x4e2d;&#x8bfb;&#x53d6;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x503c;&#xff0c;
    </p>
    <p>
      &#x6839;&#x636e;mask&#x8fc7;&#x540e;&#x7684;0bit&#x7684;&#x6570;&#x91cf;&#x5c31;&#x53ef;&#x4ee5;&#x5224;&#x5b9a;&#x5269;&#x4e0b;&#x7684;1&#x7684;&#x6570;&#x91cf;&#xff0c;
    </p>
    <p>
      &#x4ece;&#x800c;&#x53ef;&#x4ee5;&#x65ad;&#x5b9a;&#x8bbe;&#x5907;&#x7684;&#x5185;&#x5b58;&#x7a7a;&#x95f4;&#x7684;&#x5927;&#x5c0f;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1476077041382" FOLDED="true" ID="ID_1538495126" MODIFIED="1491197843246">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>3.pci&#x547d;&#x4ee4;</b></i>
    </p>
    <p>
      pci&#x5141;&#x8bb8;&#x4f7f;&#x7528;4bit&#x957f;&#x7684;16&#x79cd;&#x547d;&#x4ee4;
    </p>
    <p>
      Configuration commands
    </p>
    <p>
      Memory commands
    </p>
    <p>
      I/O commands
    </p>
    <p>
      Special-purpose commands
    </p>
  </body>
</html></richcontent>
<node CREATED="1476083865171" ID="ID_1274036977" MODIFIED="1476083882517">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/pci-commands.png"/>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1476078253343" FOLDED="true" ID="ID_1619791911" MODIFIED="1491197844693">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>4. transaction control&#x4e8b;&#x52a1;&#x63a7;&#x5236;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1476078342143" ID="ID_790681988" MODIFIED="1476078795567">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>target signals</b>
    </p>
    <p>
      TRDY#&#xa0;&#xa0;&#xa0;&#x5f53;target&#x51c6;&#x5907;&#x597d;&#x9996;&#x53d1;&#x6570;&#x636e;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x901a;&#x8fc7;&#x8be5;&#x4fe1;&#x53f7;&#x544a;&#x77e5;init&#x7aef;
    </p>
    <p>
      STOP#&#xa0;&#xa0;&#xa0;target&#x544a;&#x77e5;&#x51c6;&#x5907;&#x7ed3;&#x675f;&#x5f53;&#x524d;&#x7684;&#x4e8b;&#x52a1;
    </p>
    <p>
      DEVSEL# &#x6bcf;&#x4e2a;target&#x90fd;&#x6709;&#x80fd;&#x529b;&#x5bf9;&#x5f53;&#x524d;&#x4e8b;&#x52a1;&#x7684;&#x5730;&#x5740;&#x8fdb;&#x884c;&#x89e3;&#x7801;&#xff0c;&#x5f53;&#x8be5;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;target&#x53d1;&#x73b0;&#x8be5;&#x5730;&#x5740;&#x4e0e;&#x81ea;&#x5df1;&#x7684;&#x5730;&#x5740;&#x5339;&#x914d;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5c31;&#x4f1a;&#x53d1;&#x51fa;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;devsel&#x4fe1;&#x53f7;&#x58f0;&#x660e;&#x81ea;&#x5df1;&#x5339;&#x914d;&#x8be5;&#x4e8b;&#x52a1;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476078803776" ID="ID_766448862" MODIFIED="1476078969926">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Initiator Signals</b>
    </p>
    <p>
      FRAME# &#x8868;&#x793a;&#x4e00;&#x4e2a;&#x4e8b;&#x52a1;&#x7684;&#x5f00;&#x59cb;&#x548c;&#x7ed3;&#x675f;
    </p>
    <p>
      IRDY#&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;initiator&#x8868;&#x793a;&#x51c6;&#x5907;&#x597d;&#x53d1;&#x9001;&#x6570;&#x636e;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476079239872" ID="ID_982798397" MODIFIED="1476079446096">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>configuration signal</b>
    </p>
    <p>
      IDSEL ------&gt; &#x7528;&#x4e8e;&#x9009;&#x62e9;&#x9700;&#x8981;&#x8fdb;&#x884c;&#x914d;&#x7f6e;&#x7684;&#x8bbe;&#x5907;&#xff0c;
    </p>
    <p>
      &#x6bcf;&#x4e2a;targer&#x5bf9;&#x5e94;&#x4e00;&#x4e2a;&#x72ec;&#x7279;&#x7684;IDSEL
    </p>
    <p>
      &#x5141;&#x8bb8;&#x4e3b;&#x673a;&#x5728;pci&#x8bbe;&#x5907;&#x77e5;&#x9053;&#x81ea;&#x5df1;&#x5bf9;&#x5e94;&#x7684;&#x5730;&#x5740;&#x4e4b;&#x524d;
    </p>
    <p>
      &#x5bf9;pci&#x8bbe;&#x5907;&#x8fdb;&#x884c;&#x914d;&#x7f6e;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476079492991" ID="ID_464595908" MODIFIED="1476080346090">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>address and data signals </b>
    </p>
    <p>
      <font color="#d90202">AD[31:0]</font>&#xa0;&#xa0;&#xa0;&#xa0;32&#x4f4d;&#x7684;&#x5730;&#x5740;&#x6216;&#x8005;&#x6570;&#x636e;&#x603b;&#x7ebf;
    </p>
    <p>
      PCI&#x662f;&#x5c0f;&#x5c3e;&#x6570;&#x683c;&#x5f0f;&#x7684;
    </p>
    <p>
      <font color="#f20909">C/BE#[3:0]</font>&#xa0;4bit&#x7684;&#x547d;&#x4ee4;&#x6216;&#x8005;&#x6570;&#x636e;&#x4f7f;&#x80fd;&#x603b;&#x7ebf;
    </p>
    <p>
      &#x5728;&#x5bfb;&#x5740;&#x9636;&#x6bb5;&#x5b9a;&#x4e49;PCI&#x547d;&#x4ee4;&#xff0c;&#x5728;&#x6570;&#x636e;&#x4f20;&#x8f93;&#x9636;&#x6bb5;&#x53ef;&#x4ee5;&#x4f7f;&#x80fd;
    </p>
    <p>
      &#x4ee5;&#x5b57;&#x8282;&#x4e3a;&#x5355;&#x4f4d;&#x7684;&#x6570;&#x636e;&#x4f20;&#x8f93;&#xff0c;&#x6bd4;&#x5982;C/BE#[0]&#x53ef;&#x4ee5;&#x4f7f;&#x80fd;
    </p>
    <p>
      AD[7:0]&#x7684;&#x6570;&#x636e;&#x4f20;&#x8f93;
    </p>
    <p>
      PAR&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x7528;&#x4e8e;&#x5bf9;AD&#x548c;C/BE&#x5b8c;&#x6210;&#x5947;&#x5076;&#x6821;&#x9a8c;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476080647298" ID="ID_343179433" MODIFIED="1476080819500">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>arbitration signals</b>
    </p>
    <p>
      REQ#&#xa0;&#xa0;&#x7528;&#x4e8e;initiator&#x6765;&#x7533;&#x8bf7;bus&#x7684;&#x6240;&#x6709;&#x6743;
    </p>
    <p>
      GNT#&#xa0;&#xa0;&#x7531;system arbiter&#x5c06;bus&#x7684;&#x6240;&#x6709;&#x6743;
    </p>
    <p>
      &#x8d4b;&#x4e88;initiator
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1478661053173" FOLDED="true" ID="ID_1422883878" MODIFIED="1494859598487">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>5.&#x9a71;&#x52a8;&#x6570;&#x636e;&#x7ed3;&#x6784;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1478661079011" ID="ID_1972694558" MODIFIED="1478661443793">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7ed3;&#x6784;&#x4f53;pci_device_id&#x7528;&#x6765;&#x5b9a;&#x4e49;&#x9a71;&#x52a8;&#x652f;&#x6301;&#x7684;&#x4e0d;&#x540c;&#x7684;pci&#x7684;&#x8bbe;&#x5907;
    </p>
    <p>
      struct pci_device_id {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;__u32 vendor, device;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Vendor and device ID or PCI_ANY_ID*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;__u32 subvendor, subdevice; /* Subsystem ID's or PCI_ANY_ID */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;__u32 class, class_mask;&#xa0;&#xa0;&#xa0;&#xa0;/* (class,subclass,prog-if) triplet */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;kernel_ulong_t driver_data; /* Data private to the driver */
    </p>
    <p>
      };
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1478661448993" ID="ID_1136090978" MODIFIED="1478662339458">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      PCI_DEVICE(vendor, device)
    </p>
    <p>
      PCI_DEVICE_CLASS(device_class, device_class_mask)
    </p>
    <p>
      pci_device_id&#x9700;&#x8981;&#x88ab;&#x66b4;&#x9732;&#x5230;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#xff0c;&#x7528;&#x4e8e;&#x652f;&#x6301;&#x70ed;&#x63d2;&#x62d4;&#x4ee5;&#x53ca;&#x8ba9;
    </p>
    <p>
      &#x6a21;&#x5757;&#x52a0;&#x8f7d;&#x7cfb;&#x7edf;&#x4e86;&#x89e3;&#x793e;&#x9ebc;&#x6a23;&#x7684;&#x8bbe;&#x5907;&#x9700;&#x8981;&#x54ea;&#x79cd;&#x9a71;&#x52a8;&#x6a21;&#x5757;&#xff0c;&#x8fd9;&#x4e2a;&#x5de5;&#x4f5c;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;
    </p>
    <p>
      &#x5b8f;&#x5b9a;&#x4e49;MODULE_DEVICE_TABLE&#x6765;&#x5b8c;&#x6210;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1478662346404" ID="ID_139620219" MODIFIED="1478668304234">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct pci_driver&#x7528;&#x4e8e;&#x5b9a;&#x4e49;&#x4e00;&#x4e2a;pci&#x7684;&#x9a71;&#x52a8;
    </p>
    <p>
      pci_register_driver&#x7528;&#x4e8e;&#x6ce8;&#x518c;&#x4e00;&#x4e2a;pci&#x7684;&#x9a71;&#x52a8;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1483014305053" ID="ID_919029293" MODIFIED="1483017766706">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      PCI&#x63d0;&#x4f9b;&#x4e86;&#x4e09;&#x79cd;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x7528;&#x6765;&#x63cf;&#x8ff0;pci&#x63a7;&#x5236;&#x5668;&#xff0c;
    </p>
    <p>
      pci&#x8bbe;&#x5907;&#x548c;pci&#x603b;&#x7ebf;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1482889542718" FOLDED="true" ID="ID_758317088" MODIFIED="1499823232034">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>6.PCI&#x8bbe;&#x5907;&#x7535;&#x6e90;&#x7ba1;&#x7406;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1483369053195" ID="ID_1527967498" MODIFIED="1483369327980">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x76ee;&#x6807;:&#x5141;&#x8bb8;pci &#x9a71;&#x52a8;&#x53ef;&#x4ee5;&#x4f7f;&#x7528;I/O&#x8fd0;&#x884c;&#x65f6;&#x7535;&#x6e90;&#x7ba1;&#x7406;
    </p>
    <p>
      
    </p>
    <p>
      1.&#x8fd0;&#x884c;&#x65f6;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x6846;&#x67b6;&#x5728;kernel&#x4e2d;&#x5df2;&#x7ecf;&#x5b58;&#x5728;&#x4e86;&#xff0c;pci&#x9a71;&#x52a8;&#x5e94;&#x8be5;&#x4f7f;&#x7528;&#x8be5;&#x6846;&#x67b6;
    </p>
    <p>
      2.&#x8fd0;&#x884c;&#x65f6;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x6846;&#x67b6;&#x7684;&#x9700;&#x6c42;&#xff1a;
    </p>
    <p>
      a.subsystem(pci bus type)&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x5fc5;&#x987b;&#x88ab;&#x5b9e;&#x73b0;
    </p>
    <p>
      -&gt;runtime_suspend(dev)
    </p>
    <p>
      -&gt;runtime_resume(dev)
    </p>
    <p>
      -&gt;runtime_idle(dev)
    </p>
    <p>
      b.wakeup &#x4fe1;&#x53f7;(remote wakeup)&#x5fc5;&#x987b;&#x53ef;&#x4ee5;&#x5de5;&#x4f5c;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1483369347304" FOLDED="true" ID="ID_230257088" MODIFIED="1499823223954">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pci&#x8bbe;&#x5907;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#xff1a;
    </p>
    <p>
      D0&#xa0;&#xa0;&#x7535;&#x91cf;&#x5145;&#x8db3;&#x72b6;&#x6001;
    </p>
    <p>
      D1&#xa0;&#xa0;&#x4f4e;&#x7535;&#x72b6;&#x6001;&#xff0c;&#x8be5;&#x72b6;&#x6001;&#x53ef;&#x9009;&#xff0c;&#x9000;&#x51fa;&#x8be5;&#x72b6;&#x6001;&#x4f7f;&#x7528;&#x7684;&#x65f6;&#x95f4;&#x662f;&#x6700;&#x77ed;&#x7684;
    </p>
    <p>
      D2&#xa0;&#xa0;&#x4f4e;&#x7535;&#x72b6;&#x6001;&#xff0c; &#x8be5;&#x72b6;&#x6001;&#x53ef;&#x9009;&#xff0c;&#x4ece;&#x8be5;&#x72b6;&#x6001;&#x6062;&#x590d;&#x5927;&#x6982;&#x9700;&#x8981;200&#x5fae;&#x79d2;
    </p>
    <p>
      D3(hot)&#xa0;&#xa0;&#x4f4e;&#x7535;&#x72b6;&#x6001;&#xff0c;&#x9700;&#x8981;10ms&#x7684;&#x6062;&#x590d;&#x65f6;&#x95f4;&#xff0c;&#x8be5;&#x72b6;&#x6001;&#x4e0b;&#x8f6f;&#x4ef6;&#x4ecd;&#x7136;&#x53ef;&#x4ee5;&#x8bbf;&#x95ee;
    </p>
    <p>
      D3(cold) &#x7535;&#x6e90;&#x5173;&#x95ed;&#xff0c;&#x9700;&#x8981;10ms&#x6216;&#x8005;&#x4ee5;&#x4e0a;&#x7684;&#x6062;&#x590d;&#x65f6;&#x95f4;
    </p>
  </body>
</html></richcontent>
<node CREATED="1483370160208" ID="ID_164095894" MODIFIED="1483372768557">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8bbe;&#x5907;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#x6240;&#x5bf9;&#x5e94;&#x7684;ACPI&#x7684;&#x51fd;&#x6570;
    </p>
    <p>
      _PSn&#xa0;&#xa0;&#x5c06;&#x8bbe;&#x5907;&#x7f6e;&#x6210;&#x7535;&#x6e90;Dn&#x7684;&#x72b6;&#x6001;
    </p>
    <p>
      _PSC&#xa0;&#xa0;&#x8bc4;&#x4f30;&#x5f53;&#x524d;&#x7684;&#x8bbe;&#x5907;&#x72b6;&#x6001;
    </p>
    <p>
      _PRn &#x8fd4;&#x56de;&#x5728;Dn&#x72b6;&#x6001;&#x4e0b;&#x7684;&#x8bbe;&#x5907;&#x7535;&#x6e90;&#x8d44;&#x6e90;
    </p>
    <p>
      _DSW &#x4f7f;&#x80fd;&#x6216;&#x8005;&#x7981;&#x6b62;&#x8bbe;&#x5907;&#x7684;wake function
    </p>
    <p>
      _PRW &#x8fd4;&#x56de;wake&#x72b6;&#x6001;&#x4e0b;&#x7684;&#x7535;&#x6e90;&#x8d44;&#x6e90;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1483369583343" ID="ID_825347306" MODIFIED="1483369808999">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      PCI BUS&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;
    </p>
    <p>
      B0 &#x6b63;&#x5e38;&#x7684;&#x5de5;&#x4f5c;&#x72b6;&#x6001;
    </p>
    <p>
      B1 VCC&#x6b63;&#x5e38;&#x4f9b;&#x7535;&#xff0c;&#x6ca1;&#x6709;&#x4e86;&#x4e8b;&#x52a1;&#x5904;&#x7406;&#xff0c;&#x6c38;&#x4e45;&#x7a7a;&#x95f2;&#x7684;&#x72b6;&#x6001;
    </p>
    <p>
      B2 VCC&#x6b63;&#x5e38;&#x4f9b;&#x7535;&#xff0c;&#x4f46;&#x662f;&#x65f6;&#x949f;&#x5df2;&#x7ecf;&#x505c;&#x6b62;
    </p>
    <p>
      B3 &#x6ca1;&#x6709;VCC&#x6ca1;&#x6709;&#x65f6;&#x949f;&#xff0c;&#x60f3;&#x8981;&#x6062;&#x590d;&#x5fc5;&#x987b;&#x901a;&#x8fc7;RST&#x5f15;&#x811a;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1483369813652" FOLDED="true" ID="ID_1687834763" MODIFIED="1499823228308">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5524;&#x9192;&#x4fe1;&#x53f7;----Power Management Event(PME)
    </p>
    <p>
      1.&#x5e26;&#x5916;&#x4fe1;&#x53f7;
    </p>
    <p>
      PME&#x4fe1;&#x53f7;&#x4f1a;&#x76f4;&#x63a5;&#x5230;&#x8fbe;PCI&#x5b50;&#x7cfb;&#x7edf;&#x7684;&#x6838;&#x5fc3;&#x5904;&#x7406;&#x903b;&#x8f91;
    </p>
    <p>
      &#x53ef;&#x80fd;&#x4f1a;&#x88ab;bridge&#x8fdb;&#x884c;&#x8def;&#x7531;&#x64cd;&#x4f5c;
    </p>
    <p>
      &#x9700;&#x8981;&#x5e73;&#x53f0;&#x7684;&#x652f;&#x6301;(ACPI BIOS)
    </p>
    <p>
      2. &#x5e26;&#x5185;&#x4fe1;&#x53f7;
    </p>
    <p>
      &#x7531;root ports&#x901a;&#x8fc7;&#x4e2d;&#x65ad;&#x4ea7;&#x751f;&#x4fe1;&#x53f7;
    </p>
    <p>
      &#x4f34;&#x968f;&#x7740;&#x672c;&#x5730;PCIE&#x7684;&#x70ed;&#x63d2;&#x62d4;
    </p>
    <p>
      ACPI BIOS&#x53ef;&#x80fd;&#x4e0d;&#x5141;&#x8bb8;&#x6211;&#x4eec;&#x76f4;&#x63a5;&#x4f7f;&#x7528;&#x8fd9;&#x79cd;&#x5e26;&#x5185;&#x4fe1;&#x53f7;
    </p>
  </body>
</html></richcontent>
<node CREATED="1483373478600" FOLDED="true" ID="ID_1498799813" MODIFIED="1499823226556">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x57fa;&#x4e8e;ACPI&#x7684;&#x5524;&#x9192;&#x4fe1;&#x53f7;
    </p>
    <p>
      &#x6bcf;&#x4e00;&#x4e2a;&#x5177;&#x6709;&#x5524;&#x9192;&#x80fd;&#x529b;&#x7684;&#x8bbe;&#x5907;&#x90fd;&#x6709;&#x4e00;&#x4e2a;&#x4e13;&#x7528;&#x7684;GPE(general purpose event)
    </p>
    <p>
      &#x4f5c;&#x4e3a;&#x5524;&#x9192;&#x4fe1;&#x53f7;&#xff0c;_PRW&#x8fd4;&#x56de;&#x8be5;GPE&#x7684;&#x53f7;
    </p>
    <p>
      1.&#x8bbe;&#x5907;&#x7684;&#x5524;&#x9192;&#x4fe1;&#x53f7;(&#x5982;PME)&#x4f1a;&#x76f4;&#x63a5;&#x8fdb;&#x5165;&#x6838;&#x5fc3;&#x7684;&#x903b;&#x8f91;&#x5904;&#x7406;
    </p>
    <p>
      2.&#x6838;&#x5fc3;&#x903b;&#x8f91;&#x4f1a;&#x6fc0;&#x6d3b;&#x8bbe;&#x5907;&#x7684;GPE
    </p>
    <p>
      3.GPE&#x4f7f;&#x5f97;SCI&#x88ab;&#x4ea7;&#x751f;
    </p>
    <p>
      4.SCI&#x4e2d;&#x65ad;&#x903b;&#x8f91;&#x4f1a;&#x8c03;&#x7528;GPE&#x7684;&#x63a7;&#x5236;&#x65b9;&#x6cd5;
    </p>
    <p>
      5.GPE&#x63a7;&#x5236;&#x65b9;&#x6cd5;&#x4f1a;&#x8c03;&#x5ea6;&#x9488;&#x5bf9;&#x8be5;&#x8bbe;&#x5907;&#x7684;&#x7cfb;&#x7edf;&#x901a;&#x77e5;
    </p>
  </body>
</html></richcontent>
<node CREATED="1487158732472" ID="ID_1542584975" MODIFIED="1487159659812">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>ACPI&#x662f;&#x5982;&#x4f55;&#x5b9e;&#x73b0;GPE&#x7684;</b>
    </p>
    <p>
      <font color="#e70c0c">http://queue.acm.org/blogposting.cfm?id=18977</font>
    </p>
    <p>
      1.&#x4e00;&#x4e2a;ACPI&#x8868;&#x6307;&#x5411;&#x4e86;&#x4e00;&#x4e2a;&#x5df2;&#x7ecf;&#x5b9a;&#x4e49;&#x597d;&#x7684;&#x7cfb;&#x7edf;&#x7684;&#x8d44;&#x6e90;&#x533a;&#x57df;(&#x901a;&#x5e38;&#x662f;
    </p>
    <p>
      &#x4e00;&#x5757;&#x5185;&#x5b58;&#x533a;&#x57df;)&#x3002;&#x5f53;&#x786c;&#x4ef6;&#x53d1;&#x8d77;&#x4e86;&#x4e00;&#x4e2a;ACPI&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x5185;&#x6838;&#x4f1a;&#x901a;&#x8fc7;&#x8fd9;&#x4e2a;&#x8868;
    </p>
    <p>
      &#x6765;&#x67e5;&#x627e;&#x90a3;&#x4e2a;GPE&#x7684;&#x6807;&#x5fd7;&#x88ab;&#x8bbe;&#x7f6e;&#x4e86;&#x3002;
    </p>
    <p>
      2.&#x5927;&#x90e8;&#x5206;&#x7684;GPEs&#x90fd;&#x901a;&#x8fc7;ACPI table&#x91cc;&#x9762;&#x7684;&#x53eb;&#x505a;_Lxx&#x6216;&#x8005;_Exx&#x65b9;&#x6cd5;
    </p>
    <p>
      &#x5b9e;&#x73b0;&#x4e86;&#x3002;xx&#x662f;GPE&#x7684;16&#x8fdb;&#x5236;&#x7684;&#x7f16;&#x53f7;&#xff0c;L&#x6216;&#x8005;E&#x6807;&#x5fd7;&#x8be5;GPE&#x662f;&#x901a;&#x8fc7;&#x8fb9;&#x6cbf;&#x89e6;&#x53d1;&#x8fd8;&#x662f;
    </p>
    <p>
      &#x7535;&#x5e73;&#x89e6;&#x53d1;&#x3002;&#x5982;&#x679c;&#x4e00;&#x4e2a;ACPI&#x4e2d;&#x65ad;&#x88ab;&#x89e6;&#x53d1;&#xff0c;&#x5e76;&#x4e14;&#x7f16;&#x53f7;&#x4e3a;0X1D&#x7684;GPE&#x7684;&#x6807;&#x5fd7;
    </p>
    <p>
      &#x88ab;&#x7f6e;&#x4f4d;&#xff0c;&#x90a3;&#x4e48;ACPI&#x5c31;&#x4f1a;&#x67e5;&#x627e;_L1D&#x6216;&#x8005;_L1E&#x65b9;&#x6cd5;&#x3002;&#x8fd9;&#x4e9b;&#x65b9;&#x6cd5;&#x7684;&#x6267;&#x884c;&#x7ed3;&#x679c;&#x5b8c;&#x5168;&#x53d6;&#x51b3;
    </p>
    <p>
      &#x4e8e;&#x56fa;&#x4ef6;&#x3002;
    </p>
    <p>
      3.GPE&#x662f;&#x5982;&#x4f55;&#x88ab;&#x89e6;&#x53d1;&#x7684;&#xff1f;&#x901a;&#x5e38;&#x4e00;&#x4e2a;GPIO&#x662f;&#x88ab;&#x6620;&#x5c04;&#x5230;&#x4e00;&#x4e2a;GPE&#x7684;&#xff0c;&#x5f53;&#x4e00;&#x4e2a;GPIO&#x5f15;&#x811a;
    </p>
    <p>
      &#x88ab;&#x6fc0;&#x6d3b;&#xff0c;&#x5bf9;&#x5e94;&#x7684;GPE&#x4e5f;&#x4f1a;&#x88ab;&#x89e6;&#x53d1;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1483373947773" FOLDED="true" ID="ID_1006498594" MODIFIED="1491197853461">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      PCI native&#x548c;&#x57fa;&#x4e8e;ACPI&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;
    </p>
    <p>
      1.&#x8bbe;&#x5907;&#x8fdb;&#x5165;&#x4f4e;&#x529f;&#x8017;&#x72b6;&#x6001;
    </p>
    <p>
      &#x7531;pci_finish_runtime_suspend()&#x5b9e;&#x73b0;&#xff0c;&#x8be5;&#x51fd;&#x6570;&#x901a;&#x8fc7;
    </p>
    <p>
      pci_pm_runtime_suspend()&#x8c03;&#x7528;&#x3002;
    </p>
    <p>
      1 Choose state to put the device into (use ACPI to get information).
    </p>
    <p>
      2 Program the device to signal wakeup (PME).
    </p>
    <p>
      3 Set up the device&#x2019;s power resources for signaling wakeup, execute
    </p>
    <p>
      _DSW for it and enable its &#x201c;wakeup&#x201d; GPE.
    </p>
    <p>
      4 Program the device to go into a (PCI) low-power state (e.g. D3 hot ).
    </p>
    <p>
      5 Execute _PSn for the device (the ACPI target state should match the
    </p>
    <p>
      PCI target state).
    </p>
    <p>
      6 Turn off the device&#x2019;s power resources unnecessary for wakeup.
    </p>
    <p>
      
    </p>
    <p>
      2.&#x5c06;&#x8bbe;&#x5907;&#x8f6c;&#x6362;&#x5230;&#x5168;&#x529f;&#x7387;&#x72b6;&#x6001;
    </p>
    <p>
      &#x7531;pci_pm_runtime_resume()&#x51fd;&#x6570;&#x5b9e;&#x73b0;
    </p>
  </body>
</html></richcontent>
<node CREATED="1487140897111" ID="ID_1617528955" MODIFIED="1487142369601">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>power/pci.txt&#x6587;&#x6863;&#x9605;&#x8bfb;</b>
    </p>
    <p>
      1.PCI&#x8bbe;&#x5907;&#x53ef;&#x80fd;&#x4f1a;&#x901a;&#x8fc7;&#x4e24;&#x79cd;&#x65b9;&#x5f0f;&#x88ab;&#x8bbe;&#x7f6e;&#x5230;&#x4f4e;&#x529f;&#x8017;&#x7684;&#x72b6;&#x6001;&#xff0c;
    </p>
    <p>
      &#x4e00;&#x79cd;&#x662f;&#x901a;&#x8fc7;&#x5229;&#x7528; PCI Bus Power Management Interface Specification&#x6587;&#x6863;&#x4ecb;&#x7ecd;&#x7684;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x7684;&#x529f;&#x80fd;&#xff0c; &#x53e6;&#x4e00;&#x79cd;&#x662f;&#x901a;&#x8fc7;&#x5e73;&#x53f0;&#x56fa;&#x4ef6;&#x7684;&#x5e2e;&#x52a9;&#x6bd4;&#x5982;ACPI BIOS
    </p>
    <p>
      &#x7b2c;&#x4e00;&#x79cd;&#x65b9;&#x6cd5;&#x88ab;&#x79f0;&#x4e4b;&#x4e3a;native PCI power management&#xff0c;&#x8bbe;&#x5907;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#x662f;&#x901a;&#x8fc7;&#x5411;&#x8be5;&#x8bbe;&#x5907;&#x7684;
    </p>
    <p>
      &#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x5f53;&#x4e2d;&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x5199;&#x5165;&#x6765;&#x5b8c;&#x6210;&#x7684;&#x3002;
    </p>
    <p>
      &#x7b2c;&#x4e8c;&#x79cd;&#x65b9;&#x6cd5;&#x9700;&#x8981;&#x5e73;&#x53f0;&#x7684;&#x56fa;&#x4ef6;&#x7ed9;&#x5185;&#x6838;&#x63d0;&#x4f9b;&#x76f8;&#x5e94;&#x7684;&#x65b9;&#x6cd5;&#x6765;&#x4fee;&#x6539;&#x8bbe;&#x5907;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      2. &#x652f;&#x6301;native PCI PM&#x7684;&#x8bbe;&#x5907;&#x901a;&#x5e38;&#x53ef;&#x4ee5;&#x4ea7;&#x751f;&#x4e00;&#x4e9b;&#x4e8b;&#x4ef6;&#xff0c;&#x79f0;&#x4e3a;Power Management Events (PMEs)&#x6765;
    </p>
    <p>
      &#x544a;&#x77e5;&#x7cfb;&#x7edf;&#x5916;&#x754c;&#x53d1;&#x751f;&#x4e86;&#x4e00;&#x4e9b;&#x4e8b;&#x4ef6;&#x3002;PCI Bus Power Management Interface Specification&#x5e76;&#x6ca1;&#x6709;&#x5b9a;&#x4e49;&#x4efb;&#x4f55;
    </p>
    <p>
      &#x65b9;&#x6cd5;&#x6765;&#x5c06;PME&#x4ece;&#x8bbe;&#x5907;&#x9012;&#x9001;&#x5230;CPU&#x548c;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x5185;&#x6838;&#x3002;&#x901a;&#x5e38;&#x8ba4;&#x4e3a;&#x8be5;&#x9012;&#x9001;&#x7684;&#x4efb;&#x52a1;&#x662f;&#x7531;&#x5e73;&#x53f0;&#x7684;&#x56fa;&#x4ef6;&#x6765;&#x5b8c;&#x6210;&#x7684;&#xff0c;
    </p>
    <p>
      &#x6240;&#x4ee5;&#x5373;&#x4f7f;&#x8bbe;&#x5907;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;&#x53ef;&#x4ee5;&#x4ea7;&#x751f;PMEs, &#x6211;&#x4eec;&#x4ecd;&#x7136;&#x9700;&#x8981;&#x56fa;&#x4ef6;&#x6765;&#x5c06;&#x8be5;PMEs&#x9012;&#x9001;&#x7ed9;CPU(&#x6bd4;&#x5982;&#x901a;&#x8fc7;&#x4e2d;&#x65ad;&#x7684;&#x65b9;&#x5f0f;)
    </p>
    <p>
      
    </p>
    <p>
      3.&#x5982;&#x679c;&#x7531;&#x5e73;&#x53f0;&#x56fa;&#x4ef6;&#x63d0;&#x4f9b;&#x7684;&#x65b9;&#x6cd5;&#x53ef;&#x4ee5;&#x4fee;&#x6539;&#x8bbe;&#x5907;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#xff0c;&#x90a3;&#x4e48;&#x5e73;&#x53f0;&#x4e5f;&#x4f1a;&#x63d0;&#x4f9b;&#x4e00;&#x4e9b;&#x65b9;&#x6cd5;&#x6765;&#x4f7f;&#x8bbe;&#x5907;&#x53ef;&#x4ee5;&#x4ea7;&#x751f;
    </p>
    <p>
      wakeup &#x4fe1;&#x53f7;&#x3002;&#x5728;&#x8fd9;&#x79cd;&#x72b6;&#x6001;&#x4e0b;&#xff0c;&#x6211;&#x4eec;&#x53ea;&#x9700;&#x8981;&#x4f7f;&#x7528;native PCI PM&#x673a;&#x5236;&#x6765;&#x8bbe;&#x5907;&#x8bbe;&#x5907;&#x53ef;&#x4ee5;&#x4ea7;&#x751f;PME
    </p>
  </body>
</html></richcontent>
<node CREATED="1487141875329" ID="ID_358667522" MODIFIED="1487142356178">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Native PCI Power Management</b>
    </p>
    <p>
      PCI Bus Power Management Interface Specification&#x5728;PCI2.1&#x548c;PCI2.2&#x671f;&#x95f4;
    </p>
    <p>
      &#x88ab;&#x5f15;&#x8fdb;&#x3002;
    </p>
    <p>
      &#x5bf9;&#x4e8e;&#x4f20;&#x7edf;&#x7684;&#x8bbe;&#x5907;&#x6765;&#x8bf4;&#x5b9e;&#x73b0;PCI PM Spec&#x91cc;&#x9762;&#x8bf4;&#x7684;&#x529f;&#x80fd;&#x662f;&#x53ef;&#x9009;&#x7684;&#xff0c;&#x4f46;&#x662f;&#x5bf9;&#x4e8e;PCIe&#x8bbe;&#x5907;&#x6765;&#x8bf4;
    </p>
    <p>
      &#x8fd9;&#x662f;&#x5f3a;&#x5236;&#x9700;&#x8981;&#x5b9e;&#x73b0;&#x7684;&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x652f;&#x6301;PCI&#x7535;&#x6e90;&#x7ba1;&#x7406;&#xff0c;&#x90a3;&#x4e48;&#x5728;&#x5b83;&#x7684;&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x91cc;&#x9762;&#x6709;8&#x5b57;&#x8282;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x80fd;&#x529b;&#x533a;&#x57df;&#x3002;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x57df;&#x88ab;&#x7528;&#x6765;&#x63cf;&#x8ff0;&#x548c;&#x4f7f;&#x7528;native PCI power management&#x89c4;&#x5b9a;&#x7684;&#x4e00;&#x4e9b;feature.
    </p>
    <p>
      PCI&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x6587;&#x6863;&#x4e3a;&#x8bbe;&#x5907;&#x5b9a;&#x4e49;&#x4e86;&#x56db;&#x4e2a;&#x7535;&#x6e90;&#x72b6;&#x6001;D0-D3, &#x4e3a;&#x603b;&#x7ebf;&#x5b9a;&#x4e49;&#x4e86;&#x56db;&#x4e2a;&#x7535;&#x6e90;&#x72b6;&#x6001;B0-B3
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1487142358856" ID="ID_689596597" MODIFIED="1487143977797">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.ACPI Device Power Management</b>
    </p>
    <p>
      ACPI BIOS&#x4f1a;&#x63d0;&#x4f9b;&#x4e00;&#x4e9b;&#x7279;&#x6b8a;&#x7684;&#x65b9;&#x6cd5;&#xff0c;&#x88ab;&#x79f0;&#x4e3a;"control method"
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x65b9;&#x6cd5;&#x4f1a;&#x88ab;kernel&#x8c03;&#x7528;&#xff0c;&#x6bd4;&#x5982;kernel&#x4f1a;&#x8c03;&#x7528;&#x4e00;&#x4e2a;&#x65b9;&#x6cd5;&#x5c06;&#x67d0;&#x4e2a;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x8fdb;&#x5165;&#x5230;&#x4f4e;&#x529f;&#x8017;&#x72b6;&#x6001;&#x3002;
    </p>
    <p>
      ACPI control methods&#x53ef;&#x4ee5;&#x88ab;&#x5212;&#x5206;&#x6210;global control methods&#x548c;
    </p>
    <p>
      &#x8ddf;&#x67d0;&#x4e2a;&#x8bbe;&#x5907;&#x5177;&#x4f53;&#x76f8;&#x5173;&#x7684;device control methods&#x3002;
    </p>
    <p>
      &#x5bf9;&#x4e8e;&#x6bcf;&#x4e00;&#x4e2d;&#x8bbe;&#x5907;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#xff0c;&#x5fc5;&#x987b;&#x6709;&#x4e00;&#x7cfb;&#x5217;&#x7684;&#x7535;&#x6e90;&#x8d44;&#x6e90;&#x4e5f;&#x88ab;&#x653e;&#x7f6e;&#x5230;&#x90a3;&#x4e2a;
    </p>
    <p>
      &#x7535;&#x6e90;&#x72b6;&#x6001;&#x3002;&#x8fd9;&#x4e9b;&#x7535;&#x6e90;&#x8d44;&#x6e90;&#x7531;&#x8fd9;&#x4e9b;&#x7535;&#x6e90;&#x8d44;&#x6e90;&#x7684;&#x63a7;&#x5236;&#x65b9;&#x6cd5;&#x6765;&#x8fdb;&#x884c;&#x63a7;&#x5236;&#xff0c;_ON&#x548c;_OFF&#x3002;
    </p>
    <p>
      &#x4e3a;&#x4e86;&#x5c06;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x653e;&#x7f6e;&#x5230;&#x4e00;&#x4e2a;&#x7535;&#x6e90;&#x72b6;&#x6001;Dx&#x4e0b;&#xff0c;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x5fc5;&#x987b;&#x505a;&#x5982;&#x4e0b;&#x7684;&#x4e8b;&#x60c5;:
    </p>
    <p>
      1) &#x4f7f;&#x80fd;&#x5728;&#x67d0;&#x4e2a;&#x7535;&#x6e90;&#x72b6;&#x6001;&#x4e4b;&#x4e0b;&#xff0c;&#x8be5;&#x8bbe;&#x5907;&#x6240;&#x9700;&#x8981;&#x7684;&#x6240;&#x6709;&#x7684;&#x7535;&#x6e90;&#x8d44;&#x6e90;&#x3002;
    </p>
    <p>
      2) &#x6267;&#x884c;&#x4e3a;&#x8be5;&#x8bbe;&#x5907;&#x5b9a;&#x4e49;&#x597d;&#x7684;_PSx&#x65b9;&#x6cd5;&#xff0c; &#x5982;&#x679c;&#x8be5;&#x8bbe;&#x5907;&#x88ab;&#x8981;&#x6c42;&#x4f5c;&#x4e3a;wakeup source&#xff0c;
    </p>
    <p>
      &#x90a3;&#x4e48;&#x5728;&#x6267;&#x884c;_PSx&#x65b9;&#x6cd5;&#x4e4b;&#x524d;&#x9700;&#x8981;&#x6267;&#x884c;_DSW&#x65b9;&#x6cd5;(&#x6216;&#x8005;_PSW&#x65b9;&#x6cd5;)
    </p>
    <p>
      
    </p>
    <p>
      ACPI&#x5b9a;&#x4e49;&#x4e86;&#x7cfb;&#x7edf;&#x7684;&#x4f11;&#x7720;&#x72b6;&#x6001;&#x7b49;&#x7ea7;S1,S2,S3,S4,&#x5b9a;&#x4e49;&#x4e86;&#x7cfb;&#x7edf;&#x7684;&#x5de5;&#x4f5c;&#x72b6;&#x6001;&#x7b49;&#x7ea7;&#x4e3a;S0
    </p>
    <p>
      &#x901a;&#x5e38;&#x610f;&#x4e49;&#x4e0a;&#x6765;&#x8bf4;&#x7cfb;&#x7edf;&#x7684;&#x4f11;&#x7720;&#x72b6;&#x6001;&#x5b9a;&#x4e49;&#x4e86;&#x8bbe;&#x5907;&#x7684;&#x6700;&#x9ad8;&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#xff0c;kernel&#x901a;&#x8fc7;&#x6267;&#x884c;&#x8bbe;&#x5907;&#x7684;
    </p>
    <p>
      _SxD&#x65b9;&#x6cd5;&#x53ef;&#x4ee5;&#x83b7;&#x53d6;&#x5230;&#x8fd9;&#x4e9b;&#x4fe1;&#x606f;&#x3002;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x901a;&#x8fc7;&#x8bbe;&#x5907;&#x7684;_PRW&#x65b9;&#x6cd5;&#x53ef;&#x4ee5;&#x5f97;&#x77e5;&#xff0c;&#x5982;&#x679c;&#x9700;&#x8981;&#x8ba9;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x4ea7;&#x751f;wakeup&#x4fe1;&#x53f7;&#xff0c;&#x9700;&#x8981;&#x63d0;&#x4f9b;&#x54ea;&#x4e9b;&#x7535;&#x6e90;&#x8d44;&#x6e90;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1494859609559" FOLDED="true" ID="ID_369708121" MODIFIED="1499823273316" TEXT="7.MSI">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1494859628365" FOLDED="true" ID="ID_874745442" MODIFIED="1499823236740">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6587;&#x6863;MSI-HOWTO.txt&#x9605;&#x8bfb;
    </p>
  </body>
</html></richcontent>
<node CREATED="1494859648434" ID="ID_1775807022" MODIFIED="1494859974010">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x4ec0;&#x4e48;&#x662f;MSIs
    </p>
    <p>
      Message Signaled Interrupt,&#x8bbe;&#x5907;&#x5f80;&#x4e00;&#x4e2a;&#x7279;&#x6b8a;&#x7684;&#x5730;&#x5740;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x8fdb;&#x884c;&#x5199;&#x64cd;&#x4f5c;&#xff0c;&#x4ece;&#x800c;&#x5411;cpu&#x89e6;&#x53d1;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#x3002;MSI&#x7684;&#x6982;&#x5ff5;&#x662f;&#x5728;pci2.2
    </p>
    <p>
      &#x5f53;&#x4e2d;&#x5f15;&#x5165;&#x7684;&#xff0c;&#x5728;pci3.0&#x5f53;&#x4e2d;&#x8fdb;&#x884c;&#x4e86;&#x5f3a;&#x5316;&#xff0c;&#x6bcf;&#x4e2a;MSI&#x4e2d;&#x65ad;&#x53ef;&#x4ee5;&#x88ab;&#x5355;&#x72ec;mask
    </p>
    <p>
      MSI-X&#x5219;&#x5141;&#x8bb8;&#x5355;&#x72ec;&#x7684;&#x8bbe;&#x5907;&#x6bd4;MSI&#x652f;&#x6301;&#x66f4;&#x591a;&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x4e14;&#x6bcf;&#x4e2a;&#x4e2d;&#x65ad;&#x90fd;&#x53ef;&#x4ee5;&#x88ab;
    </p>
    <p>
      &#x72ec;&#x7acb;&#x914d;&#x7f6e;&#x3002;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x53ef;&#x80fd;&#x540c;&#x65f6;&#x652f;&#x6301;MSI&#x548c;MSI-X&#xff0c;&#x4f46;&#x662f;&#x540c;&#x65f6;&#x53ea;&#x80fd;&#x4f7f;&#x80fd;&#x4e00;&#x4e2a;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494859979814" ID="ID_1530366310" MODIFIED="1494860859819">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x4f7f;&#x7528;MSI&#x7684;&#x7406;&#x7531;
    </p>
    <p>
      &#x7b2c;&#x4e00; &#x4f20;&#x7edf;&#x7684;&#x4f7f;&#x7528;pin&#x811a;&#x7684;&#x4e2d;&#x65ad;&#x65b9;&#x5f0f;&#xff0c;&#x5f80;&#x5f80;&#x662f;&#x591a;&#x4e2a;&#x8bbe;&#x5907;&#x5171;&#x4eab;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x6837;&#x4f7f;&#x5f97;&#x4e2d;&#x65ad;&#x89e6;&#x53d1;&#x7684;&#x65f6;&#x5019;&#x5185;&#x6838;&#x9700;&#x8981;&#x904d;&#x5386;&#x6240;&#x6709;&#x7684;&#x6ce8;&#x518c;&#x7684;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x964d;&#x4f4e;&#x7684;&#x7cfb;&#x7edf;&#x7684;&#x6027;&#x80fd;&#xff0c;&#x800c;MSI&#x4e2d;&#x65ad;&#x662f;&#x4e0d;&#x5171;&#x4eab;&#x7684;&#xff0c;&#x56e0;&#x6b64;&#x907f;&#x514d;&#x4e86;&#x8fd9;&#x4e2a;&#x95ee;&#x9898;&#x3002;
    </p>
    <p>
      &#x7b2c;&#x4e8c; &#x4f7f;&#x7528;&#x57fa;&#x4e8e;pin&#x811a;&#x7684;&#x4e2d;&#x65ad;&#x65b9;&#x5f0f;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x6709;&#x53ef;&#x80fd;&#x5728;&#x4e2d;&#x65ad;&#x89e6;&#x53d1;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x6570;&#x636e;&#x8fd8;
    </p>
    <p>
      &#x6ca1;&#x6709;&#x4f20;&#x9001;&#x5230;&#x5185;&#x5b58;&#x5f53;&#x4e2d;&#xff0c;&#x800c;MSI&#x5728;&#x5199;&#x5165;&#x7684;&#x65f6;&#x5019;&#x662f;&#x4fdd;&#x8bc1;&#x5728;&#x6570;&#x636e;&#x4f20;&#x8f93;&#x5b8c;&#x6210;&#x4e4b;&#x540e;&#x7684;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x6837;&#x786e;&#x4fdd;&#x5728;&#x4e2d;&#x65ad;&#x89e6;&#x53d1;&#x7684;&#x65f6;&#x5019;&#x6570;&#x636e;&#x7684;&#x786e;&#x5b9a;&#x6027;&#x3002;
    </p>
    <p>
      &#x7b2c;&#x4e09; &#x7531;&#x4e8e;&#x8bbe;&#x5907;&#x53ea;&#x652f;&#x6301;&#x4e00;&#x4e2a;pin&#x811a;&#x65b9;&#x5f0f;&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x90a3;&#x4e48;&#x9488;&#x5bf9;&#x5177;&#x6709;&#x591a;&#x4e2a;function&#x7684;&#x8bbe;&#x5907;&#xff0c;
    </p>
    <p>
      &#x5728;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x5f53;&#x4e2d;&#x8fd8;&#x9700;&#x8981;&#x8be2;&#x95ee;&#x8bbe;&#x5907;&#x53d1;&#x751f;&#x4e86;&#x4ec0;&#x4e48;&#x4e8b;&#x4ef6;&#x3002;&#x800c;MSI&#x7531;&#x4e8e;&#x53ef;&#x4ee5;&#x652f;&#x6301;&#x591a;&#x4e2a;&#x4e2d;&#x65ad;&#xff0c;
    </p>
    <p>
      &#x90a3;&#x4e48;&#x9488;&#x5bf9;&#x4e0d;&#x540c;&#x7684;&#x76ee;&#x7684;&#x53ef;&#x4ee5;&#x5206;&#x914d;&#x4e0d;&#x540c;&#x7684;&#x4e2d;&#x65ad;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494861903893" FOLDED="true" ID="ID_27798513" MODIFIED="1499823235260" TEXT="3.&#x5982;&#x4f55;&#x4f7f;&#x7528;MSI">
<node CREATED="1494861919238" ID="ID_1323151256" MODIFIED="1494862032820">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e3a;&#x4e86;&#x652f;&#x6301;MSI&#x548c;MSI-X,&#x5185;&#x6838;&#x5fc5;&#x987b;&#x914d;&#x7f6e;CONFIG_PCI_MSI&#xff0c;
    </p>
    <p>
      &#x5bf9;&#x4e8e;x86&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#xff0c;&#x4e5f;&#x540c;&#x65f6;&#x8981;&#x914d;&#x7f6e;X86_UP_APIC&#x548c;SMP&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494862037281" ID="ID_1234878553" MODIFIED="1494894737389">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5927;&#x591a;&#x6570;&#x7684;&#x5de5;&#x4f5c;&#x90fd;&#x5728;pci&#x5c42;&#x7684;&#x9a71;&#x52a8;&#x91cc;&#x9762;&#x505a;&#x5b8c;&#x4e86;&#xff0c;&#x5fc5;&#x987b;&#x5411;pci
    </p>
    <p>
      &#x5c42;&#x8bf7;&#x6c42;&#x4e3a;&#x8be5;&#x8bbe;&#x5907;&#x8bbe;&#x7f6e;MSI&#x529f;&#x80fd;&#x3002;
    </p>
    <p>
      int pci_enable_msi(struct pci_dev *dev)
    </p>
    <p>
      &#x5bf9;&#x8be5;&#x51fd;&#x6570;&#x7684;&#x4e00;&#x6b21;&#x6210;&#x529f;&#x8c03;&#x7528;&#x4f1a;&#x5206;&#x914d;&#x4e00;&#x4e2a;msi&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x8bbe;&#x5907;&#x4f1a;&#x4ece;
    </p>
    <p>
      &#x57fa;&#x4e8e;pin&#x811a;&#x7684;&#x4e2d;&#x65ad;&#x65b9;&#x5f0f;&#x8f6c;&#x6362;&#x6210;&#x57fa;&#x4e8e;msi&#x7684;&#x4e2d;&#x65ad;&#x65b9;&#x5f0f;&#xff0c;dev-&gt;irq
    </p>
    <p>
      &#x4f1a;&#x88ab;&#x8d4b;&#x503c;&#x4e3a;&#x57fa;&#x4e8e;msi&#x7684;&#x4e2d;&#x65ad;&#x53f7;&#x3002;&#x8be5;&#x51fd;&#x6570;&#x5e94;&#x8be5;&#x5728;request_irq()&#x4e4b;&#x524d;
    </p>
    <p>
      &#x88ab;&#x8c03;&#x7528;&#xff0c;&#x56e0;&#x4e3a;&#x9012;&#x9001;msi&#x4e2d;&#x65ad;&#x7684;&#x4e2d;&#x65ad;&#x5411;&#x91cf;&#x8ddf;&#x57fa;&#x4e8e;pin&#x811a;&#x7684;&#x4e2d;&#x65ad;&#x5411;&#x91cf;&#x662f;&#x4e0d;&#x540c;&#x7684;&#x3002;
    </p>
    <p>
      int pci_enable_msi_range(struct pci_dev *dev, int minvec, int maxvec)
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x5141;&#x8bb8;&#x9a71;&#x52a8;&#x7533;&#x8bf7;&#x5728;minvec&#x548c;maxvec&#x4e4b;&#x95f4;&#x7684;&#x591a;&#x4e2a;msi&#x4e2d;&#x65ad;&#xff0c;
    </p>
    <p>
      dev-&gt;irq&#x4f1a;&#x88ab;&#x8d4b;&#x503c;&#x6210;&#x7533;&#x8bf7;&#x7684;&#x4e2d;&#x65ad;&#x5f53;&#x4e2d;&#x7684;&#x6700;&#x5c0f;&#x7684;&#x4e2d;&#x65ad;&#x503c;&#xff0c;&#x6700;&#x7406;&#x60f3;&#x7684;&#x60c5;&#x51b5;&#x662f;
    </p>
    <p>
      &#x9a71;&#x52a8;&#x53ef;&#x4ee5;&#x7533;&#x8bf7;&#x60f3;&#x8981;&#x7684;&#x6570;&#x76ee;&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x4f46;&#x662f;&#x6709;&#x5f88;&#x591a;&#x539f;&#x56e0;&#x5e73;&#x53f0;&#x4e0d;&#x80fd;&#x6ee1;&#x8db3;&#x8fd9;&#x6837;&#x7684;&#x8981;&#x6c42;&#x3002;
    </p>
    <p>
      int pci_enable_msi_exact(struct pci_dev *dev, int nvec)
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x4f1a;&#x5206;&#x914d;&#x7cbe;&#x786e;&#x6570;&#x91cf;&#x7684;msi&#x4e2d;&#x65ad;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1495440466350" FOLDED="true" ID="ID_1099884249" MODIFIED="1499823269246" TEXT="PCI SpecV3&#x9605;&#x8bfb;">
<node CREATED="1495440486725" FOLDED="true" ID="ID_1104675689" MODIFIED="1499823265288">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#0c6e41"><b><i>&#x7b2c;&#x516d;&#x7ae0; &#x7b2c;&#x516b;&#x8282; Message Signaled Interrupts</i></b></font>
    </p>
    <p>
      msi&#x662f;&#x4e00;&#x4e2a;&#x53ef;&#x9009;&#x7684;feature&#xff0c;&#x7528;&#x6765;&#x5411;&#x7cfb;&#x7edf;&#x6307;&#x5b9a;&#x7684;&#x5730;&#x5740;&#x5199;&#x5165;&#x7cfb;&#x7edf;&#x6307;&#x5b9a;
    </p>
    <p>
      &#x7684;&#x6570;&#x503c;&#x6765;&#x8bf7;&#x6c42;&#x7cfb;&#x7edf;&#x670d;&#x52a1;(&#x4f7f;&#x7528;PCI DWORD&#x5185;&#x5b58;&#x5199;&#x5165;&#x4e8b;&#x52a1;)&#x3002;&#x7cfb;&#x7edf;&#x8f6f;&#x4ef6;&#x5728;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x914d;&#x7f6e;&#x671f;&#x95f4;&#x4f1a;&#x521d;&#x59cb;&#x5316;&#x6d88;&#x606f;&#x7684;&#x5730;&#x5740;&#x548c;&#x6d88;&#x606f;&#x7684;&#x5185;&#x5bb9;(&#x79f0;&#x4e3a;vector)&#xff0c;&#x7ed9;&#x6bcf;&#x4e2a;msi
    </p>
    <p>
      &#x4f7f;&#x80fd;&#x7684;function&#x5206;&#x914d;&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x591a;&#x4e2a;vector&#x3002;
    </p>
    <p>
      MSI-X&#x5728;MSI&#x529f;&#x80fd;&#x7684;&#x57fa;&#x7840;&#x4e0a;&#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x4e2a;&#x5206;&#x9694;&#x7684;&#x53ef;&#x9009;&#x7684;&#x529f;&#x80fd;&#x6269;&#x5c55;&#x3002;&#x76f8;&#x6bd4;&#x4e8e;MSI,
    </p>
    <p>
      MSI-X&#x652f;&#x6301;&#x66f4;&#x5927;&#x6570;&#x91cf;&#x7684;vector&#x3002;MSI&#x548c;MSI-X&#x90fd;&#x652f;&#x6301;&#x9488;&#x5bf9;&#x5355;&#x4e2a;&#x7684;vector&#x7684;&#x63a9;&#x7801;&#x3002;
    </p>
    <p>
      &#x4f46;&#x662f;&#x9488;&#x5bf9;&#x5355;&#x4e2a;vector&#x7684;&#x63a9;&#x7801;&#x529f;&#x80fd;&#xff0c;&#x5bf9;&#x4e8e;MSI&#x662f;&#x53ef;&#x9009;&#x7684;&#xff0c;&#x4f46;&#x662f;&#x5bf9;&#x4e8e;MSI-X&#x5219;&#x662f;
    </p>
    <p>
      &#x6807;&#x51c6;&#x7684;&#x3002;MSI-X&#x540c;&#x65f6;&#x8fd8;&#x652f;&#x6301;function&#x7ea7;&#x522b;&#x7684;&#x63a9;&#x7801;bit&#x4f4d;&#xff0c;&#x5982;&#x679c;&#x8be5;&#x4f4d;&#x88ab;&#x7f6e;&#x4f4d;&#xff0c;&#x90a3;&#x4e48;
    </p>
    <p>
      &#x8ddf;&#x8be5;function&#x6709;&#x5173;&#x7684;vector&#x90fd;&#x4f1a;&#x88ab;mask&#x3002;per-vector&#x63a9;&#x7801;&#x64cd;&#x4f5c;&#x662f;&#x901a;&#x8fc7;&#x6bcf;&#x4e2a;vector
    </p>
    <p>
      &#x4e0a;&#x9762;&#x7684;Masking&#x548c;Pending &#x6bd4;&#x7279;&#x5bf9;&#x6765;&#x5b9e;&#x73b0;&#x7684;&#xff0c;&#x6216;&#x8005;&#x662f;&#x901a;&#x8fc7;MSI-X table&#x76ee;&#x5f55;&#x5b9e;&#x73b0;&#x3002;
    </p>
    <p>
      &#x5f53;&#x4e00;&#x4e2a;vector&#x88ab;mask&#x4e4b;&#x540e;&#xff0c;&#x5bf9;&#x5e94;&#x7684;&#x51fd;&#x6570;&#x88ab;&#x7981;&#x6b62;&#x53d1;&#x9001;&#x6d88;&#x606f;&#xff0c;&#x5e76;&#x4e14;function&#x5fc5;&#x987b;&#x8bbe;&#x7f6e;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      Pending&#x4f4d;&#x3002;
    </p>
    <p>
      &#x4e3a;&#x4e86;&#x4fdd;&#x8bc1;&#x8f6f;&#x4ef6;&#x7684;&#x5411;&#x540e;&#x517c;&#x5bb9;&#x6027;&#xff0c;MSI&#x548c;MSI-X&#x4f7f;&#x7528;&#x7684;&#x662f;&#x4e0d;&#x540c;&#x7684;capability&#x7ed3;&#x6784;&#x4f53;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1495504823576" FOLDED="true" ID="ID_1412144308" MODIFIED="1499823245025" TEXT="msi&#x7684;&#x56db;&#x79cd;capability&#x7ed3;&#x6784;&#x4f53;">
<node CREATED="1495504839808" FOLDED="true" ID="ID_1455773481" MODIFIED="1499823243331">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/msi-capability-structure-400-500.png"/>
  </body>
</html></richcontent>
<node CREATED="1495505326023" ID="ID_426850666" MODIFIED="1495507330540">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Message Control&#x5b57;&#x6bb5;&#x5bc4;&#x5b58;&#x5668;&#x89e3;&#x6790;:
    </p>
    <p>
      &#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x63d0;&#x4f9b;&#x9488;&#x5bf9;msi&#x7684;&#x7cfb;&#x7edf;&#x8303;&#x56f4;&#x5185;&#x7684;&#x63a7;&#x5236;&#x3002;reset&#x4e4b;&#x540e;&#xff0c;msi&#x662f;&#x88ab;
    </p>
    <p>
      &#x7981;&#x6b62;&#x4f7f;&#x7528;&#x7684;&#xff0c;&#x5982;&#x679c;msi&#x548c;msi-x&#x90fd;&#x88ab;&#x7981;&#x6b62;&#x4f7f;&#x7528;&#xff0c;&#x90a3;&#x4e48;&#x8bbe;&#x5907;&#x4f1a;&#x901a;&#x8fc7;INTx#
    </p>
    <p>
      &#x6765;&#x7533;&#x8bf7;&#x670d;&#x52a1;&#x3002;&#x7cfb;&#x7edf;&#x8f6f;&#x4ef6;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x4f7f;&#x80fd;&#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x7684;bit0&#x6765;&#x4f7f;&#x80fd;msi&#x529f;&#x80fd;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1495516653300" FOLDED="true" ID="ID_229750767" MODIFIED="1499823250079" TEXT="msi-x&#x7684;capability&#x7ed3;&#x6784;">
<node CREATED="1495516737292" ID="ID_1164454062" MODIFIED="1495517196559">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <img src="lddpic/msi-x-capability.png"/>
      
    </p>
    <p>
      msi-x capability&#x7ed3;&#x6784;&#x4f53;&#x5185;&#x90e8;&#x542b;&#x6709;&#x6307;&#x5411;msi-x table&#x548c;msi-x Pending Bit Array
    </p>
    <p>
      &#x7ed3;&#x6784;&#x4f53;&#x7684;&#x6307;&#x9488;&#xff0c;table&#x548c;pba&#x7ed3;&#x6784;&#x4f53;&#x90fd;&#x9a7b;&#x7559;&#x5728;&#x7cfb;&#x7edf;&#x7684;&#x5185;&#x5b58;&#x5f53;&#x4e2d;&#x3002;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x7ed3;&#x6784;&#x4f53;&#x90fd;&#x662f;&#x901a;&#x8fc7;Base Address Register&#x6620;&#x5c04;&#x5230;&#x5185;&#x5b58;&#x5f53;&#x4e2d;&#x53bb;&#x7684;&#x3002;capability
    </p>
    <p>
      &#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#x7684;BIR&#x5b57;&#x6bb5;&#x7528;&#x6765;&#x6307;&#x793a;&#x4f7f;&#x7528;&#x7684;&#x662f;&#x54ea;&#x4e2a;BAR,&#x800c;offset&#x5b57;&#x6bb5;&#x5219;&#x7528;&#x6765;&#x6307;&#x793a;&#x76f8;&#x5bf9;
    </p>
    <p>
      &#x4e8e;bar&#x7684;&#x504f;&#x79fb;&#x91cf;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1495516838611" ID="ID_140695277" MODIFIED="1495516846403">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/msi-x-table.png"/>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1495517819002" FOLDED="true" ID="ID_960622371" MODIFIED="1499823259433">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#d51111">msi&#x548c;msi-x&#x7684;&#x64cd;&#x4f5c;</font></i></b>
    </p>
    <p>
      &#x5728;&#x914d;&#x7f6e;&#x9636;&#x6bb5;&#xff0c;&#x7cfb;&#x7edf;&#x4f1a;&#x626b;&#x63cf;&#x8be5;function&#x5bf9;&#x5e94;&#x7684;capability&#x5217;&#x8868;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;msi&#x5bf9;&#x5e94;&#x7684;id&#x88ab;&#x5bfb;&#x627e;&#x5230;&#xff0c;&#x90a3;&#x4e48;&#x8bf4;&#x660e;&#x8be5;function&#x5b9e;&#x73b0;&#x7684;&#x662f;msi,
    </p>
    <p>
      &#x5982;&#x679c;msi-x&#x5bf9;&#x5e94;&#x7684;id&#x88ab;&#x5bfb;&#x627e;&#x5230;&#xff0c;&#x90a3;&#x4e48;&#x8bf4;&#x660e;&#x8be5;function&#x5b9e;&#x73b0;&#x7684;&#x662f;msi-x,
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x5f53;&#x4e2d;&#x7ed9;&#x5b9a;&#x7684;function&#x88ab;&#x5141;&#x8bb8;&#x5b9e;&#x73b0;msi&#xff0c; msi-x&#x6216;&#x8005;&#x662f;&#x4e24;&#x8005;&#x90fd;&#x5b9e;&#x73b0;&#x3002;
    </p>
    <p>
      &#x7cfb;&#x7edf;&#x8f6f;&#x4ef6;&#x72ec;&#x7acb;&#x5730;&#x7ba1;&#x7406;&#x8fd9;&#x4e9b;&#x4e2d;&#x65ad;&#x673a;&#x5236;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1495519378479" ID="ID_658508934" MODIFIED="1495521124717">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x5bf9;&#x4e8e;&#x6bcf;&#x4e00;&#x4e2a;&#x5c06;&#x8981;&#x88ab;&#x4f7f;&#x7528;&#x7684;MSI-X table entry,
    </p>
    <p>
      &#x8f6f;&#x4ef6;&#x4f1a;&#x586b;&#x5145;Message Address &#x57df;&#xff0c;Message Upper Address&#x57df;&#xff0c;
    </p>
    <p>
      Message Data&#x57df;&#x548c;Vector Control&#x57df;&#xff0c;&#x5f53;&#x67d0;&#x4e2a;entry&#x6ca1;&#x6709;&#x88ab;mask&#x7684;
    </p>
    <p>
      &#x65f6;&#x5019;&#xff0c;&#x8f6f;&#x4ef6;&#x662f;&#x4e0d;&#x80fd;&#x4fee;&#x6539;&#x5b83;&#x7684;address&#x548c;data&#x57df;&#x7684;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1495521129659" ID="ID_173807990" MODIFIED="1495522487258">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.&#x53d1;&#x9001;&#x6d88;&#x606f;</b>
    </p>
    <p>
      &#x4e00;&#x65e6;MSI&#x6216;&#x8005;MSI-X&#x88ab;&#x4f7f;&#x80fd;&#xff0c;&#x5e76;&#x4e14;&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x591a;&#x4e2a;vector&#x5904;&#x4e8e;unmask&#x7684;&#x72b6;&#x6001;&#xff0c;
    </p>
    <p>
      &#x8be5;function&#x88ab;&#x5141;&#x8bb8;&#x53d1;&#x9001;&#x6d88;&#x606f;&#x3002;&#x4e3a;&#x4e86;&#x53d1;&#x9001;&#x6d88;&#x606f;&#xff0c;&#x8be5;function&#x4f1a;&#x8fdb;&#x884c;&#x4e00;&#x4e2a;DWORD&#x5185;&#x5b58;
    </p>
    <p>
      &#x5199;&#x7684;&#x4e8b;&#x52a1;&#xff0c;&#x5728;&#x5408;&#x9002;&#x7684;&#x5730;&#x5740;&#x4e0a;&#x5199;&#x5165;&#x5408;&#x9002;&#x7684;data&#x3002;&#x8be5;DWORD&#x7684;&#x4e24;&#x4e2a;&#x9ad8;&#x5b57;&#x8282;&#x662f;MSI Message Data
    </p>
    <p>
      &#x5f53;&#x4e2d;&#x7684;&#x6570;&#x636e;&#xff0c;DWORD&#x91cc;&#x9762;&#x7684;&#x4f4e;&#x4f4d;&#x7f6e;&#x7684;&#x4e24;&#x4e2a;&#x5b57;&#x8282;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;0&#x3002;&#x5bf9;&#x4e8e;MSI,&#x5982;&#x679c;Multiple Message Enable
    </p>
    <p>
      &#x4e0d;&#x662f;0, &#x90a3;&#x4e48;&#x8be5;function&#x88ab;&#x5141;&#x8bb8;&#x4fee;&#x6539;message data&#x7684;&#x5730;&#x4f4d;bit&#xff0c;&#x7528;&#x4e8e;&#x4ea7;&#x751f;&#x591a;&#x4e2a;vectors&#x3002;
    </p>
    <p>
      &#x6bd4;&#x5982;&#xff0c;&#x5982;&#x679c;Multiple Message Enable&#x57df;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;010,&#x90a3;&#x4e48;function&#x88ab;&#x5141;&#x8bb8;&#x53bb;&#x4fee;&#x6539;message data
    </p>
    <p>
      &#x7684;bit1&#x548c;bit 0&#x7684;&#x4f4d;&#x7f6e;&#x6765;&#x4ea7;&#x751f;&#x6700;&#x591a;4&#x4e2a;vector&#x3002;&#x5982;&#x679c;Multiple Message Enable&#x57df;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;
    </p>
    <p>
      &#x4e86;"000",&#x90a3;&#x4e48;function&#x5c31;&#x4e0d;&#x5141;&#x8bb8;&#x4fee;&#x6539;message data&#x3002;
    </p>
    <p>
      &#x5bf9;&#x4e8e;MSI-X, MSI-X table&#x9488;&#x5bf9;&#x6bcf;&#x4e2a;&#x5206;&#x914d;&#x7684;vector&#x81f3;&#x5c11;&#x5305;&#x542b;&#x4e00;&#x4e2a;entry&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1495522499190" FOLDED="true" ID="ID_1098871003" MODIFIED="1499823257405">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3.Per-vector masking and function masking</b>
    </p>
    <p>
      &#x5bf9;&#x4e8e;MSI&#x548c;MSI-X&#x6765;&#x8bf4;&#xff0c;&#x5f53;&#x4e00;&#x4e2a;vector&#x88ab;mask&#x4e4b;&#x540e;&#xff0c;
    </p>
    <p>
      function&#x88ab;&#x7981;&#x6b62;&#x53d1;&#x9001;&#x76f8;&#x5173;&#x7684;&#x6d88;&#x606f;&#x5e76;&#x4e14;function&#x9700;&#x8981;
    </p>
    <p>
      &#x8bbe;&#x7f6e;&#x76f8;&#x5173;&#x7684;Pending&#x4f4d;&#x3002;&#x5f53;&#x8f6f;&#x4ef6;unmask&#x4e00;&#x4e2a;vector&#x5e76;&#x4e14;
    </p>
    <p>
      &#x8ddf;&#x4ed6;&#x76f8;&#x5173;&#x7684;pending&#x4f4d;&#x8fd8;&#x5904;&#x4e8e;&#x88ab;&#x7f6e;&#x4f4d;&#x7684;&#x9636;&#x6bb5;&#xff0c;&#x90a3;&#x4e48;function&#x5fc5;&#x987b;
    </p>
    <p>
      &#x88ab;&#x8c03;&#x5ea6;&#x8d77;&#x6765;&#x53d1;&#x9001;&#x76f8;&#x5173;&#x7684;&#x6d88;&#x606f;&#x5e76;&#x4e14;&#x6e05;&#x9664;&#x76f8;&#x5173;&#x7684;pending&#x4f4d;&#x3002;&#x6e05;&#x9664;
    </p>
    <p>
      msi-x function mask&#x4f4d;&#x53ef;&#x80fd;&#x4f1a;&#x5bfc;&#x81f4;&#x5f88;&#x591a;&#x7684;&#x6d88;&#x606f;&#x9700;&#x8981;&#x88ab;&#x53d1;&#x9001;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      If a masked vector has its Pending bit set, and the associated underlying interrupt events are
    </p>
    <p>
      somehow satisfied (usually by software though the exact manner is function-specific), the
    </p>
    <p>
      function must clear the Pending bit, to avoid sending a spurious interrupt message later
    </p>
    <p>
      when software unmasks the vector. However, if a subsequent interrupt event occurs while
    </p>
    <p>
      the vector is still masked, the function must again set the Pending bit.
    </p>
    <p>
      &#x4e0a;&#x9762;&#x8fd9;&#x6bb5;&#x8bdd;&#x7684;&#x610f;&#x601d;&#x662f;&#x8bf4;&#xff0c;&#x5f53;&#x67d0;&#x4e2a;vector&#x5df2;&#x7ecf;&#x88ab;mask&#x5e76;&#x4e14;pending&#x4f4d;&#x5df2;&#x7ecf;&#x88ab;&#x7f6e;&#x4f4d;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5982;&#x679c;&#x8fd9;&#x4e2a;&#x65f6;&#x5019;&#x5e95;&#x5c42;&#x7684;&#x4e2d;&#x65ad;&#x53d1;&#x751f;&#x4e86;&#xff0c;&#x90a3;&#x4e48;
    </p>
    <p>
      function&#x5e94;&#x8be5;&#x53bb;clear&#x76f8;&#x5e94;&#x7684;pending&#x4f4d;&#xff0c;&#x8fd9;&#x6837;&#x53ef;&#x4ee5;&#x907f;&#x514d;&#x540e;&#x9762;unmask&#x7684;&#x65f6;&#x5019;&#x53d1;&#x9001;&#x4f2a;&#x4e2d;&#x65ad;&#x6d88;&#x606f;&#x3002;&#x5982;&#x679c;&#x540e;&#x9762;&#x8fd8;&#x6709;&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x53d1;&#x751f;&#xff0c;&#x90a3;&#x4e48;&#x8be5;pending&#x4f4d;&#x5e94;&#x8be5;&#x88ab;&#x91cd;&#x65b0;&#x7f6e;&#x4f4d;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1495525192083" ID="ID_1171505862" MODIFIED="1495525451763">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8f6f;&#x4ef6;&#x53ef;&#x4ee5;&#x5141;&#x8bb8;&#x6c38;&#x4e45;&#x5730;mask&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x66f4;&#x591a;&#x4e2a;&#x7684;vector,
    </p>
    <p>
      &#x5e76;&#x4e14;&#x4e25;&#x683c;&#x5730;&#x57fa;&#x4e8e;polling&#x5b83;&#x4eec;&#x5bf9;&#x5e94;&#x7684;pending&#x6bd4;&#x7279;&#x4f4d;&#x6765;&#x670d;&#x52a1;&#x5b83;&#x4eec;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      &#x4e2d;&#x65ad;&#x4e8b;&#x4ef6;&#x3002;function&#x5fc5;&#x987b;&#x652f;&#x6301;&#x8fd9;&#x79cd;clear&#x548c;set pending&#x6bd4;&#x7279;&#x7684;&#x5f62;&#x5f0f;&#x6765;
    </p>
    <p>
      &#x652f;&#x6301;"polling"&#x6a21;&#x5f0f;&#x3002;&#x5bf9;&#x4e8e;msi-x&#xff0c; function&#x88ab;&#x5141;&#x8bb8;&#x7f13;&#x5b58;msi-x table entry
    </p>
    <p>
      &#x6240;&#x5bf9;&#x5e94;&#x7684;address&#x548c;data value&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1495532007059" FOLDED="true" ID="ID_283497554" MODIFIED="1499823267583" TEXT="msi, me, pmic&#x4e4b;&#x95f4;&#x7684;&#x5173;&#x7cfb;&#xff1f;">
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1495532047035" ID="ID_1319582696" MODIFIED="1495532087606">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Beginning in 2005, Intel began including Active Management Technology in Ethernet controllers.
    </p>
    <p>
      This system is effectively a firewall and a tool used for provisioning laptops and desktops in a corporate environment.
    </p>
    <p>
      In 2008, a new coprocessor &#x2014; the Management Engine &#x2014; was added.
    </p>
    <p>
      This management engine is a processor connected to every peripheral in a system.
    </p>
    <p>
      The ME has complete access to all of a computer&#x2019;s memory, network connections,
    </p>
    <p>
      and every peripheral connected to a computer.
    </p>
    <p>
      The ME runs when the computer is hibernating and can intercept TCP/IP traffic.
    </p>
    <p>
      Management Engine can be used to boot a computer over a network, install a new OS,
    </p>
    <p>
      and can disable a PC if it fails to check into a server at some predetermined interval.
    </p>
    <p>
      From a security standpoint, if you own the Management Engine,
    </p>
    <p>
      you own the computer and all data contained within.
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1495035769598" FOLDED="true" ID="ID_1112106546" MODIFIED="1495532043484">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e21919"><b><i>PCI Bus Power Management Interface Specification</i></b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1495036577063" ID="ID_588981932" MODIFIED="1495036600532" TEXT="&#x7b2c;&#x4e8c;&#x7ae0; PCI &#x7535;&#x6e90;&#x7ba1;&#x7406;&#x6982;&#x89c8;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1495036603670" FOLDED="true" ID="ID_969591285" MODIFIED="1495071768819">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pci&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;
    </p>
    <p>
      &#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7684;&#x72b6;&#x6001;&#x88ab;&#x5b9a;&#x4e49;&#x6210;&#x4e86;&#x5404;&#x79cd;&#x4e0d;&#x540c;&#x7684;&#x7701;&#x7535;&#x5c42;&#x6b21;&#x3002;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#x662f;
    </p>
    <p>
      &#x7531;&#x4e00;&#x4e2a;&#x72b6;&#x6001;&#x53f7;&#x6765;&#x8868;&#x793a;&#x7684;&#x3002;&#x5728;&#x672c;&#x6587;&#x6863;&#x4e2d;pci bus&#x548c;pci function&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;
    </p>
    <p>
      &#x72b6;&#x6001;&#x5c06;&#x4f1a;&#x88ab;&#x5b9a;&#x4e49;&#xff0c;&#x8bf4;&#x660e;&#x548c;&#x8ba8;&#x8bba;&#x3002;&#x5bf9;&#x4e8e;pci bus&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#xff0c;&#x4f1a;&#x5e26;&#x6709;
    </p>
    <p>
      &#x4e00;&#x4e2a;B&#x7684;&#x524d;&#x7f00;&#xff0c;&#x5bf9;&#x4e8e;pci function&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#xff0c;&#x4f1a;&#x5e26;&#x6709;&#x4e00;&#x4e2a;D&#x7684;&#x524d;&#x7f00;&#x3002;
    </p>
    <p>
      &#x968f;&#x7740;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#x53f7;&#x7684;&#x63d0;&#x5347;&#xff0c;&#x7535;&#x6e90;&#x8282;&#x7701;&#x7684;&#x5e45;&#x5ea6;&#x5c31;&#x8d8a;&#x5927;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1495037089332" ID="ID_1219463230" MODIFIED="1495037131328">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.pci function &#x7535;&#x6e90;&#x72b6;&#x6001;
    </p>
    <p>
      pci function&#x6709;&#x56db;&#x4e2a;&#x7535;&#x6e90;&#x72b6;&#x6001;&#xff0c;&#x5206;&#x522b;&#x662f;D0-D3
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1495037140575" ID="ID_1262549390" MODIFIED="1495037433086">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.bus&#x7535;&#x6e90;&#x72b6;&#x6001;
    </p>
    <p>
      bus&#x7684;&#x7535;&#x6e90;&#x72b6;&#x6001;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x67d0;&#x4e2a;&#x65f6;&#x95f4;&#x70b9;&#x8be5;bus&#x7684;&#x67d0;&#x4e9b;&#x5c5e;&#x6027;&#x6765;&#x786e;&#x5b9a;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x4e9b;&#x5c5e;&#x6027;&#x5305;&#x62ec;&#x662f;&#x5426;&#x4f9b;&#x7535;&#xff0c;&#x65f6;&#x949f;&#x7684;&#x901f;&#x5ea6;&#x4ee5;&#x53ca;&#x54ea;&#x4e9b;bus&#x7684;&#x6d3b;&#x52a8;&#x662f;&#x88ab;&#x5141;&#x8bb8;&#x7684;&#x3002;
    </p>
    <p>
      &#x5b9a;&#x4e49;&#x4e86;B0-B3&#x56db;&#x4e2a;&#x72b6;&#x6001;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1495037439175" ID="ID_1411888674" MODIFIED="1495037539183">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      pci express link&#x7535;&#x6e90;&#x72b6;&#x6001;
    </p>
    <p>
      &#x5b9a;&#x4e49;&#x5728;PCI Express Base Specification&#x6587;&#x6863;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1495037558325" ID="ID_877500997" MODIFIED="1495039007869">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e40f0f">Device-Class Specification</font>
    </p>
    <p>
      &#x8be5;specification&#x4e3a;pci bus&#x548c;pci component&#x6807;&#x51c6;&#x5316;&#x4e86;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7684;&#x786c;&#x4ef6;&#x63a5;&#x53e3;&#x3002;
    </p>
    <p>
      &#x7136;&#x800c;&#xff0c;&#x5728;&#x76f8;&#x540c;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#x4e4b;&#x4e0b;&#xff0c;&#x96b6;&#x5c5e;&#x4e8e;&#x4e0d;&#x540c;&#x7684;device class&#x4e0b;&#x9762;&#x7684;pci function
    </p>
    <p>
      &#x7684;&#x884c;&#x4e3a;&#x8868;&#x73b0;&#x5927;&#x4e0d;&#x76f8;&#x540c;&#x3002;&#x8fd9;&#x5c31;&#x662f;Device-Class&#x5177;&#x4f53;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7b56;&#x7565;&#x7684;&#x6982;&#x5ff5;&#x3002;&#x4f8b;&#x5982;&#xff0c;
    </p>
    <p>
      &#x5728;&#x4e00;&#x4e2a;&#x7ed9;&#x5b9a;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#x4e0b;&#x9762;&#xff0c;audio subsystem&#x652f;&#x6301;&#x7684;capabilities&#x5217;&#x8868;&#x8ddf;&#x5728;&#x76f8;&#x540c;&#x7535;&#x6e90;
    </p>
    <p>
      &#x7ba1;&#x7406;&#x72b6;&#x6001;&#x4e0b;&#x5de5;&#x4f5c;&#x7684;&#x663e;&#x5361;&#x63a7;&#x5236;&#x5668;&#x7684;capabilities&#x5217;&#x8868;&#x5c31;&#x662f;&#x4e0d;&#x540c;&#x7684;&#x3002;
    </p>
    <p>
      &#x867d;&#x7136;Device-Class&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x6587;&#x6863;&#x4e0d;&#x5728;&#x672c;&#x6587;&#x6863;&#x7684;&#x8bf4;&#x660e;&#x8303;&#x56f4;&#x4e4b;&#x5185;&#xff0c;&#x4f46;&#x662f;&#x4e3a;&#x4e86;&#x5411;&#x8bfb;&#x8005;&#x8bf4;&#x660e;&#x4ed6;&#x4eec;&#x8ddf;
    </p>
    <p>
      &#x672c;&#x6587;&#x6863;&#x5f53;&#x4e2d;&#x8bf4;&#x660e;&#x7684;&#x63a5;&#x53e3;&#x7684;&#x91cd;&#x8981;&#x5173;&#x7cfb;&#xff0c;&#x672c;&#x6587;&#x6863;&#x4ecd;&#x7136;&#x5728;&#x8fd9;&#x4e2a;&#x5730;&#x65b9;&#x4ecb;&#x7ecd;&#x5b83;&#x4eec;&#x3002;
    </p>
    <p>
      &#x6bcf;&#x4e00;&#x7c7b;&#x8bbe;&#x5907;&#x5fc5;&#x987b;&#x62e5;&#x6709;&#x5b83;&#x4eec;&#x81ea;&#x5df1;&#x7684;&#x4e00;&#x7c7b;&#x5177;&#x4f53;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7b56;&#x7565;&#x96c6;&#x5408;&#x6765;&#x5b9a;&#x4e49;&#x5b83;&#x4eec;&#x81ea;&#x5df1;&#x7684;&#x884c;&#x4e3a;&#x3002;&#x4e3a;&#x4e86;
    </p>
    <p>
      &#x5b8c;&#x5168;&#x878d;&#x5408;&#x8fdb;&#x5165;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#xff0c;&#x8fd9;&#x4e9b;class-specific&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7b56;&#x7565;&#x5fc5;&#x987b;&#x88ab;&#x6807;&#x51c6;&#x5316;&#x3002;
    </p>
    <p>
      &#x6bcf;&#x4e00;&#x4e2a;&#x5927;&#x7c7b;&#x7684;&#x8bbe;&#x5907;&#x7c7b;&#x578b;&#x5fc5;&#x987b;&#x6709;&#x4e00;&#x4e2a;&#x5bf9;&#x5e94;&#x7684;Device-Class&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x6587;&#x6863;&#x6765;&#x65e0;&#x7f1d;&#x5730;&#x5c06;&#x8bbe;&#x5907;&#x878d;&#x5408;&#x5230;
    </p>
    <p>
      &#x7535;&#x6e90;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x3002;
    </p>
    <p>
      Device-Class&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x6587;&#x6863;&#x5c06;&#x4f1a;&#x901a;&#x5e38;&#x5730;&#x8986;&#x76d6;&#x4e0b;&#x9762;&#x7684;&#x51e0;&#x4e2a;&#x9886;&#x57df;&#xff1a;
    </p>
    <p>
      1.&#x6bcf;&#x4e00;&#x4e2a;class&#x4e0b;&#x9762;&#x7684;function&#x5e94;&#x8be5;&#x4e3a;&#x6bcf;&#x4e00;&#x4e2a;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x72b6;&#x6001;&#x6709;&#x4e00;&#x4e2a;&#x5b9a;&#x4e49;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1495071773061" FOLDED="true" ID="ID_1373757780" MODIFIED="1495532042603">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x7b2c;&#x4e09;&#x7ae0; PCI&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x63a5;&#x53e3;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1495071921165" ID="ID_1558182725" MODIFIED="1495073783569">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6982;&#x8ff0;
    </p>
    <p>
      &#x56db;&#x4e2a;&#x57fa;&#x672c;&#x7684;&#x88ab;&#x5b9a;&#x4e49;&#x7684;&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7684;&#x64cd;&#x4f5c;&#x662f;:
    </p>
    <p>
      Capabilities Reporting, Power Status Reporting, Setting Power State, System Wakeup
    </p>
    <p>
      &#x672c;&#x7ae0;&#x63cf;&#x8ff0;&#x7528;&#x4e8e;&#x7528;&#x4e8e;&#x8fd9;&#x4e9b;&#x64cd;&#x4f5c;&#x7684;&#x4f4d;&#x4e8e;pci&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x5f53;&#x4e2d;&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x7684;&#x683c;&#x5f0f;&#x3002;
    </p>
    <p>
      &#x4f4d;&#x4e8e;pci&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x5f53;&#x4e2d;&#x7684;"&#x72b6;&#x6001;&#x548c;&#x80fd;&#x529b;&#x6307;&#x9488;&#x57df;"(Status and Capabilities Pointer (Cap_ptr))
    </p>
    <p>
      &#x7528;&#x4e8e;&#x6307;&#x793a;&#x5728;&#x6807;&#x51c6;&#x7684;&#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x5934;&#x90e8;&#x5f53;&#x4e2d;pci&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x7684;feature&#x51fa;&#x73b0;&#x7684;&#x4f4d;&#x7f6e;&#x3002;
    </p>
    <p>
      &#x8f6f;&#x4ef6;&#x5fc5;&#x987b;&#x8981;&#x6709;&#x4e00;&#x4e2a;&#x6807;&#x51c6;&#x7684;&#x65b9;&#x6cd5;&#x6765;&#x786e;&#x5b9a;&#x662f;&#x5426;&#x4e00;&#x4e2a;&#x5177;&#x4f53;&#x7684;&#x529f;&#x80fd;&#x6309;&#x7167;&#x7b26;&#x5408;&#x672c;&#x6587;&#x6863;&#x89c4;&#x5b9a;&#x7684;&#x65b9;&#x5f0f;&#x88ab;&#x8bbe;&#x8ba1;&#x51fa;&#x6765;&#x3002;
    </p>
    <p>
      PCI Status register&#x5f53;&#x4e2d;&#x6709;&#x4e00;&#x4e2a;bit&#x53ef;&#x4ee5;&#x7528;&#x4e8e;&#x786e;&#x5b9a;Capabilities List&#x662f;&#x5426;&#x5b58;&#x5728;&#x4ee5;&#x53ca;&#x4f4d;&#x4e8e;&#x6807;&#x51c6;&#x7684;PCI
    </p>
    <p>
      &#x914d;&#x7f6e;&#x7a7a;&#x95f4;&#x5934;&#x90e8;&#x5f53;&#x4e2d;&#x7684;&#x4e00;&#x4e2a;&#x5b57;&#x8282;&#x6765;&#x6307;&#x5411;&#x989d;&#x5916;&#x5b9a;&#x4e49;&#x7684;capabilities&#x94fe;&#x8868;&#x3002;&#x8f6f;&#x4ef6;&#x53ef;&#x4ee5;&#x904d;&#x5386;&#x8be5;&#x94fe;&#x8868;&#x6765;&#x4e3a;pci
    </p>
    <p>
      &#x7535;&#x6e90;&#x7ba1;&#x7406;&#x5bfb;&#x627e;&#x5408;&#x9002;&#x7684;ID(Cap_ID=01h), &#x5982;&#x679c;Capabilities List&#x4e0d;&#x5b58;&#x5728;&#xff08;Capabilities bit in the Status register = 0&#xff09;
    </p>
    <p>
      &#x6216;&#x8005;&#x5217;&#x8868;&#x5f53;&#x4e2d;&#x4e0d;&#x5b58;&#x5728;&#x5408;&#x9002;&#x7684;ID&#x7684;&#x9879;&#xff0c;&#x90a3;&#x4e48;&#x8be5;device&#x7684;funciton&#x5c31;&#x4e0d;&#x652f;&#x6301;&#x672c;&#x6587;&#x6863;&#x6240;&#x63cf;&#x8ff0;&#x7684;
    </p>
    <p>
      PCI power management interface&#x3002;&#x90a3;&#x4e48;&#x64cd;&#x4f5c;&#x7cfb;&#x7edf;&#x5c31;&#x4f1a;&#x5047;&#x8bbe;&#x8bbe;&#x5907;&#x53ea;&#x652f;&#x6301;D0&#x548c;D3cold&#x72b6;&#x6001;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1495073012754" ID="ID_1748768152" MODIFIED="1495073021976">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/pci&#x7535;&#x6e90;&#x7ba1;&#x7406;&#x914d;&#x7f6e;&#x7a7a;&#x95f4;400-300.png"/>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1495073790250" ID="ID_1742238010" MODIFIED="1495074202552">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Capabilities List Data Structure
    </p>
    <p>
      pci&#x72b6;&#x6001;&#x5bc4;&#x5b58;&#x5668;(&#x504f;&#x79fb;&#x91cf;06h)&#x5f53;&#x4e2d;&#x7684;Capabilities&#x4f4d;&#x7528;&#x6765;&#x6307;&#x793a;
    </p>
    <p>
      &#x662f;&#x5426;subject function&#x5b9e;&#x73b0;&#x4e86;&#x6269;&#x5c55;&#x529f;&#x80fd;&#x7684;&#x94fe;&#x8868;&#x3002;&#x5177;&#x4f53;&#x6765;&#x8bf4;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x8be5;&#x5bc4;&#x5b58;&#x5668;&#x5f53;&#x4e2d;&#x7684;bit4&#x88ab;&#x7f6e;&#x4f4d;&#xff0c;&#x90a3;&#x4e48;Cap_Ptr&#x5c31;&#x4f1a;&#x6307;&#x5411;
    </p>
    <p>
      &#x6269;&#x5c55;&#x94fe;&#x8868;&#x7684;&#x7b2c;&#x4e00;&#x4e2a;item&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1495074209210" ID="ID_1594488447" MODIFIED="1495074251773">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/pci-status-register-400-300.png"/>
  </body>
</html></richcontent>
</node>
<node CREATED="1495074878827" ID="ID_1914205489" MODIFIED="1495074885250">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/capabilities-linked-list-400-300.png"/>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1476668428013" FOLDED="true" ID="ID_791715704" MODIFIED="1593400417848" POSITION="right" TEXT="HDMI&#x8bbe;&#x5907;&#x9a71;&#x52a8;">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1476668469784" ID="ID_960888638" MODIFIED="1476858086791">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>1.&#x8ddf;HDMI&#x7684;&#x6982;&#x5ff5;&#x76f8;&#x5173;&#x7684;&#x51e0;&#x4e2a;&#x672f;&#x8bed;</b>
    </p>
    <p>
      <b>HDCP</b>: HDCP&#x7684;&#x5168;&#x79f0;&#x662f;High-bandwidthDigital Content Protection
    </p>
    <p>
      <b>DDC</b>: DDC&#x662f;HDMI&#x7684;&#x4e24;&#x4e2a;IIC&#x5f15;&#x811a;&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#x5728;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x662f;&#x5b9e;&#x73b0;&#x6210;&#x4e24;&#x4e2a;i2c&#x7684;&#x9a71;&#x52a8;&#xff0c;
    </p>
    <p>
      &#x8be5;&#x9a71;&#x52a8;&#x7684;&#x4f5c;&#x7528;&#x662f;&#x5b9e;&#x73b0;HDCP&#x5728;CPU&#x548c;&#x73b0;&#x5b9e;&#x8bbe;&#x5907;&#x4e4b;&#x95f4;&#x7684;&#x4ea4;&#x6362;&#xff0c;&#x4ee5;&#x53ca;&#x5b9e;&#x73b0;EDID(&#x5305;&#x542b;&#x663e;&#x793a;&#x8bbe;&#x5907;&#x7684;
    </p>
    <p>
      &#x76f8;&#x5173;&#x53c2;&#x6570;)
    </p>
    <p>
      <b>HPD</b>: hot plugdetection,&#x4e3a;&#x70ed;&#x63d2;&#x62d4;&#x800c;&#x5b9e;&#x73b0;&#xff0c;&#x5f53;&#x53d1;&#x9001;&#x7aef;&#x63d2;&#x5165;&#x63a5;&#x6536;&#x7aef;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x63a5;&#x6536;&#x7aef;&#x4f1a;&#x56de;&#x5e94;HPD
    </p>
    <p>
      &#x4fe1;&#x53f7;&#x7ed9;&#x53d1;&#x9001;&#x7aef;&#xff0c;&#x53d1;&#x9001;&#x7aef;&#x63a5;&#x7740;&#x542f;&#x52a8;DDC&#x901a;&#x9053;&#xff0c;&#x8bfb;&#x53d6;&#x63a5;&#x6536;&#x7aef;&#x7684;EDID&#x4fe1;&#x606f;&#xff0c;&#x7136;&#x540e;&#x8fdb;&#x884c;HDCP&#x7684;&#x4ea4;&#x4e92;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x53cc;&#x65b9;&#x9a8c;&#x8bc1;&#x901a;&#x8fc7;&#xff0c;&#x5219;&#x89c6;&#x9891;&#xff0c;&#x97f3;&#x9891;&#x4f1a;&#x6b63;&#x5e38;&#x5de5;&#x4f5c;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1476672214427" ID="ID_1858032503" MODIFIED="1476672224167">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="hdmi/hdmi-whole.jpeg"/>
  </body>
</html></richcontent>
</node>
<node CREATED="1476672392539" ID="ID_670259868" MODIFIED="1476673591883">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6807;&#x51c6;&#x7684;type A HDMI&#x63a5;&#x53e3;&#x6709;19&#x4e2a;&#x5f15;&#x811a;&#xff0c;&#x53e6;&#x5916;&#x6709;&#x4e00;&#x79cd;Type B&#x7c7b;&#x578b;&#x7684;&#x63a5;&#x53e3;&#x88ab;&#x5b9a;&#x4e49;&#x51fa;&#x6765;&#xff0c;&#x4f46;&#x662f;&#x5e76;&#x6ca1;&#x6709;&#x88ab;
    </p>
    <p>
      &#x5e7f;&#x6cdb;&#x5730;&#x652f;&#x6301;&#x3002;
    </p>
    <p>
      TMDS Data2+ TMDS Data2 Shield TMDS Data2&#x2013;
    </p>
    <p>
      TMDS Data1+ TMDS Data1 Shield TMDS Data1&#x2013;
    </p>
    <p>
      TMDS Data0+ TMDS Data0 Shield TMDS Data0&#x2013;
    </p>
    <p>
      TMDS Clock+&#xa0; TMDS Clock Shield&#xa0;&#xa0;TMDS Clock&#x2013;
    </p>
    <p>
      TMDS Data5+ TMDS Data5 Shield TMDS Data5-
    </p>
    <p>
      TMDS Data4+ TMDS Data4 Shield TMDS Data4-
    </p>
    <p>
      TMDS Data3+ TMDS Data3 Shield TMDS Data3-
    </p>
    <p>
      CEC
    </p>
    <p>
      SCL SDA
    </p>
    <p>
      DDC/CEC Ground
    </p>
    <p>
      +5V Power
    </p>
    <p>
      Hot Plug Detect
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476858086792" ID="ID_1304078752" MODIFIED="1476858192085">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6839;&#x636e;&#x5f53;&#x524d;&#x5bf9;8890&#x7684;spec&#x7684;&#x89e3;&#x8bfb;&#xff0c;8890&#x91cc;&#x9762;&#x5e76;&#x6ca1;&#x6709;
    </p>
    <p>
      DDC&#x8bbe;&#x5907;&#xff0c;&#x4f46;&#x662f;&#x5728;AP&#x4fa7;&#x4fdd;&#x7559;&#x6709;&#x4e00;&#x4e2a;DDC&#x4e13;&#x7528;&#x7684;I2C
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1476671594978" ID="ID_962028331" MODIFIED="1476672209329">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2. s5pv210&#x7684;hdmi&#x9a71;&#x52a8;&#x7684;&#x5927;&#x6982;&#x7684;&#x6846;&#x67b6;
    </p>
    <p>
      &#x5728;linux 3.0.8&#x5f53;&#x4e2d;hdmi&#x662f;&#x4f5c;&#x4e3a;TV_OUT&#x7684;&#x4e00;&#x4e2a;&#x5b50;&#x7cfb;&#x7edf;
    </p>
    <p>
      &#x5f53;TV_OUT&#x88ab;&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#xff0c;hdmi&#x7684;&#x521d;&#x59cb;&#x5316;&#x51fd;&#x6570;&#x4f1a;&#x88ab;
    </p>
    <p>
      &#x8c03;&#x7528;&#x7684;&#x5e76;&#x4e14;&#x751f;&#x6210;&#x4e00;&#x4e2a;&#x7b26;&#x5408;V4L2&#x89c4;&#x8303;&#x7684;&#x8bbe;&#x5907;&#x3002;
    </p>
    <p>
      &#x800c;CEC HDCP DDC HPD&#x4f5c;&#x4e3a;HDMI&#x7684;&#x7ec4;&#x4ef6;&#xff0c;&#x4ed6;&#x4eec;&#x7684;&#x9a71;&#x52a8;&#x5b9e;&#x73b0;&#x5373;&#x4e3a;HDMI&#x9a71;&#x52a8;&#x7684;&#x5b9e;&#x73b0;&#x63d0;&#x4f9b;&#x51fd;&#x6570;&#x63a5;&#x53e3;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476675499214" ID="ID_1767615288" MODIFIED="1476944116031">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3.8890 spec&#x89e3;&#x8bfb;</b>
    </p>
    <p>
      HDMI PHY generates the pixel and TMDS clocks and HDMI 2.0 Tx link uses both these clocks. For a
    </p>
    <p>
      synchronous operation with DECON0 display interface 3, use the pixel clock from HDMI PHY
    </p>
    <p>
      as VCLK3 of DECON0
    </p>
    <p>
      &#x5728;&#x8fd0;&#x884c;DECON&#x548c;HDMI 2.0 TX link&#x4e4b;&#x524d;&#xff0c;&#x9700;&#x8981;&#x914d;&#x7f6e;HDMI PHY&#x7684;pixel clock&#x4e3a;&#x5408;&#x9002;&#x7684;&#x503c;
    </p>
  </body>
</html></richcontent>
<node CREATED="1476690424027" ID="ID_438387669" MODIFIED="1476692019619">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      SFR&#x7684;&#x8bbe;&#x7f6e;:
    </p>
    <p>
      &#x5728;&#x4f20;&#x8f93;audio&#x6216;&#x8005;video&#x7684;&#x6570;&#x636e;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x9700;&#x8981;&#x6211;&#x4eec;&#x8bbe;&#x7f6e;&#x597d;
    </p>
    <p>
      timing-related SFR&#x3002;&#x6bcf;&#x4e2a;SFR set&#x9700;&#x8981;&#x5404;&#x81ea;&#x7684;clock domain,
    </p>
    <p>
      &#x7531;&#x4e8e;&#x5404;&#x81ea;&#x7684;clock domain&#x7684;&#x4e0d;&#x540c;&#xff0c;&#x6240;&#x4ee5;&#x5728;&#x8bbf;&#x95ee;SFR set&#x7684;&#x65f6;&#x5019;
    </p>
    <p>
      &#x4f1a;&#x6709;&#x4e00;&#x4e9b;&#x4e0d;&#x540c;&#x7684;&#x9650;&#x5236;&#x3002;&#x4e0b;&#x9762;&#x662f;&#x4e00;&#x4e9b;&#x9650;&#x5236;:
    </p>
    <p>
      1.&#x4e0d;&#x7ba1;phy_ready&#x7684;&#x72b6;&#x6001;&#x662f;&#x5982;&#x4f55;&#xff0c;HDMI 2.0 Tx Link Core&#x548c;HDCP 2.2
    </p>
    <p>
      &#x7684;&#x5bc4;&#x5b58;&#x5668;&#x662f;&#x53ef;&#x4ee5;&#x8bbf;&#x95ee;&#x7684;&#x3002;
    </p>
    <p>
      2.&#x5728;phy_ready&#x88ab;&#x8bbe;&#x7f6e;&#x4e4b;&#x524d;&#xff0c;HDCP 1.4&#x7684;&#x5bc4;&#x5b58;&#x5668;&#x662f;&#x4e0d;&#x80fd;&#x8bbf;&#x95ee;&#x7684;&#x3002;
    </p>
    <p>
      3.&#x8bbf;&#x95ee;audio&#x5bc4;&#x5b58;&#x5668;&#x4f9d;&#x8d56;&#x4e8e;i_audio_clk
    </p>
    <p>
      4.&#x8bbf;&#x95ee;CEC&#x5bc4;&#x5b58;&#x5668;&#x4f9d;&#x8d56;&#x4e8e;i_cec_clk
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476692023701" ID="ID_396483176" MODIFIED="1476692443821">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      HDMI 2.0 Tx Link&#x63a5;&#x6536;CEA 861(&#x672a;&#x538b;&#x7f29;&#x6570;&#x5b57;&#x89c6;&#x9891;&#x6807;&#x51c6;)&#x89c6;&#x9891;&#x65f6;&#x5e8f;(video timing)
    </p>
    <p>
      HDMI 2.0 Tx Link&#x5728;&#x6bcf;&#x4e2a;pixel clock&#x5468;&#x671f;&#x91cc;&#x9762;&#x53ef;&#x4ee5;&#x63a5;&#x6536;&#x5230;2&#x4e2a;pixel
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476692447804" ID="ID_20467124" MODIFIED="1476693302444">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      HDMI 2.0 Tx Link&#x4f1a;&#x4ece;video generating IP (DECON)&#x91cc;&#x9762;
    </p>
    <p>
      &#x63a5;&#x6536;&#x5230;&#x5305;&#x4f7f;&#x80fd;&#x4fe1;&#x53f7;&#xff0c;&#x5f53;&#x5b83;&#x68c0;&#x6d4b;&#x5230;&#x4f7f;&#x80fd;&#x4fe1;&#x53f7;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5c31;&#x4f1a;&#x5f00;&#x59cb;&#x5bf9;
    </p>
    <p>
      &#x8f93;&#x5165;&#x7684;video data&#x8fdb;&#x884c;packeting&#x64cd;&#x4f5c;&#x3002;&#x6ce8;&#x610f;&#x4f7f;&#x80fd;&#x4fe1;&#x53f7;&#x4f1a;&#x5728;&#x89c6;&#x9891;
    </p>
    <p>
      &#x6570;&#x636e;&#x771f;&#x6b63;&#x4f20;&#x8f93;&#x4e4b;&#x524d;&#x7684;32&#x4e2a;pixel clock&#x8fdb;&#x884c;&#x89e6;&#x53d1;&#x52a8;&#x4f5c;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476693318949" ID="ID_1323432844" MODIFIED="1476704375928">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      HDMI 2.0 Tx Link&#x4f1a;&#x4ece;&#x7cfb;&#x7edf;PDMA(&#x53ef;&#x7f16;&#x7a0b;DMA)&#x5f53;&#x4e2d;&#x8bf7;&#x6c42;
    </p>
    <p>
      &#x548c;&#x83b7;&#x53d6;audio&#x6570;&#x636e;&#x3002;&#x4e3a;&#x4e86;&#x83b7;&#x53d6;audio&#x6570;&#x636e;&#x5305;&#x7684;&#x53d1;&#x9001;&#x65f6;&#x5e8f;&#xff0c;
    </p>
    <p>
      CMU in DISP0&#x4f1a;&#x63d0;&#x4f9b;audio&#x7684;&#x91c7;&#x6837;&#x9891;&#x7387;&#x7ed9;HDMI 2.0 Tx Link
    </p>
    <p>
      HDMI 2.0 Link&#x6709;2&#x4e2a;&#x5916;&#x90e8;&#x7684;&#x4fe1;&#x53f7;&#x6e90;&#xff0c;&#x7528;&#x4ee5;&#x83b7;&#x53d6;audio&#x7684;&#x91c7;&#x6837;&#x9891;&#x7387;
    </p>
    <p>
      &#x548c;audio&#x7684;&#x91c7;&#x6837;&#x6570;&#x636e;&#x3002;
    </p>
    <p>
      BLK_DISP0 CMU&#x4f1a;&#x4ea7;&#x751f;audio&#x7684;&#x91c7;&#x6837;&#x9891;&#x7387;&#xff0c;&#x6839;&#x636e;&#x91c7;&#x6837;&#x7387;&#x6765;&#x8bbe;&#x7f6e;&#x5185;&#x90e8;&#x7684;
    </p>
    <p>
      SFR&#x7684;M&#x548c;N&#x7684;&#x503c;&#xff0c;&#x540c;&#x65f6;&#x5728;HDMI_LINK&#x4fa7;&#x7684;SFR&#x5f53;&#x4e2d;&#x6211;&#x4eec;&#x4e5f;&#x9700;&#x8981;&#x8bbe;&#x7f6e;
    </p>
    <p>
      ACR_CTS&#x548c;ACR_N&#x7684;&#x503c;&#x3002;
    </p>
    <p>
      &#x4f7f;&#x7528;audio_req/ack&#x63a5;&#x53e3;&#x6765;&#x5411;HDMI_LINK&#x53d1;&#x9001;audio&#x6570;&#x636e;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476786800378" ID="ID_511529828" MODIFIED="1476842979181">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>DECON: Display and Enhancement Controller 0 </b>
    </p>
    <p>
      &#x529f;&#x80fd;:
    </p>
    <p>
      1.&#x5c06;&#x8f93;&#x5165;&#x7684;&#x56fe;&#x7247;&#x8fdb;&#x884c;&#x878d;&#x5408;
    </p>
    <p>
      2.&#x589e;&#x5f3a;&#x4ee5;&#x53ca;&#x538b;&#x7f29;&#x878d;&#x5408;&#x7684;&#x56fe;&#x7247;
    </p>
    <p>
      3.&#x4ea7;&#x751f;video&#x65f6;&#x8bb8;
    </p>
    <p>
      <i><font color="#e80a0a">&#x6839;&#x636e;spec4310&#x9875;&#x7684;&#x63cf;&#x8ff0;&#xff0c;DISPLAY&#x7684;&#x8f93;&#x51fa;&#x4e00;&#x5171;&#x6709;&#x4e09;&#x4e2a;&#x63a5;&#x53e3;&#xff0c; </font></i>
    </p>
    <p>
      <i><font color="#e80a0a">&#x5206;&#x522b;&#x662f;DECON_F, DECON_S, DECON_T </font></i>
    </p>
    <p>
      <i><font color="#e80a0a">&#x800c;DECON_T&#x662f;&#x8d1f;&#x8d23;&#x8f93;&#x51fa;&#x5230;HDMI&#x5f53;&#x4e2d;&#x7684;</font></i>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476944116036" FOLDED="true" ID="ID_32484619" MODIFIED="1486555599175">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>Display Subsystem</i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1476944142528" FOLDED="true" ID="ID_1445919811" MODIFIED="1486555598847">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x663e;&#x793a;&#x5668;&#x5206;&#x8fa8;&#x7387;&#x7684;&#x672f;&#x8bed;&#x79f0;&#x547c;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1476945174540" ID="ID_845492868" MODIFIED="1477027258667">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>High-Definition 16:9</i></b>
    </p>
    <p>
      nHD(640*360)
    </p>
    <p>
      qHD(960*540)
    </p>
    <p>
      HD(1280*720) &#x8be5;&#x5206;&#x8fa8;&#x7387;&#x7ecf;&#x5e38;&#x88ab;&#x79f0;&#x4e3a;720p,&#x5b57;&#x6bcd;p&#x5176;&#x5b9e;&#x4ee3;&#x8868;&#x7684;&#x662f;
    </p>
    <p>
      "progressive scan"&#xff08;&#x9010;&#x884c;&#x626b;&#x63cf;&#xff09;&#x4e5f;&#x88ab;&#x79f0;&#x4e3a;"noninterlaced scanning"
    </p>
    <p>
      &#x8be5;&#x672f;&#x8bed;&#x5bf9;&#x4e8e;&#x683c;&#x5f0f;&#x7684;&#x4f20;&#x8f93;&#x662f;&#x975e;&#x5e38;&#x91cd;&#x8981;&#x7684;&#x3002;
    </p>
    <p>
      FHD(1920*1080)
    </p>
    <p>
      QHD/WQHD(2569*1440
    </p>
    <p>
      UWQHD (3440x1440))
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476949848838" ID="ID_1545204517" MODIFIED="1476949852042">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1593323605679" FOLDED="true" ID="ID_891977020" MODIFIED="1594781615215" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" face="&#x534e;&#x6587;&#x6977;&#x4f53;">DVI &#25509;&#21475;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1593325431678" FOLDED="true" ID="ID_604949934" MODIFIED="1594781614126" TEXT="&#x63a5;&#x53e3;&#x5206;&#x7c7b;">
<node CREATED="1593325492175" ID="ID_782112214" MODIFIED="1593325518013">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/dvi&#x7684;&#x5404;&#x79cd;&#x63a5;&#x53e3;&#x5206;&#x7c7b;.PNG" />
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1477535464680" FOLDED="true" ID="ID_1619933124" MODIFIED="1494857712531" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>I2C&#x603b;&#x7ebf;&#x9a71;&#x52a8;&#x6846;&#x67b6;</b>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="14"/>
<node CREATED="1477535558438" FOLDED="true" ID="ID_756977671" MODIFIED="1494857711219">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="i2c/i2c&#x603b;&#x7ebf;&#x9a71;&#x52a8;&#x6846;&#x67b6;.jpg"/>
  </body>
</html></richcontent>
<node CREATED="1477539857560" FOLDED="true" ID="ID_1947968621" MODIFIED="1494857709611">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      linux&#x7684;i2c&#x7684;&#x9a71;&#x52a8;&#x6846;&#x67b6;&#x65b0;&#x65e7;&#x65b9;&#x5f0f;&#x662f;&#x5e76;&#x5b58;&#x7684;&#xff0c;
    </p>
    <p>
      &#x65e7;&#x7684;&#x65b9;&#x5f0f;&#x79f0;&#x4e3a;legacy&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x662f;&#x5728;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;&#x52a8;&#x6001;&#x521b;&#x5efa;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x65b0;&#x7684;&#x65b9;&#x5f0f;&#x79f0;&#x4e3a;new-style&#x7684;&#x65b9;&#x5f0f;&#xff0c;new-style
    </p>
    <p>
      &#x7684;&#x65b9;&#x5f0f;&#x662f;&#x9759;&#x6001;&#x5b9a;&#x4e49;&#x8bbe;&#x5907;&#x7684;&#x65b9;&#x5f0f;
    </p>
  </body>
</html></richcontent>
<node CREATED="1477540091348" FOLDED="true" ID="ID_336523858" MODIFIED="1494857708667">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x9759;&#x6001;&#x5b9a;&#x4e49;&#x8bbe;&#x5907;&#x7684;&#x65b9;&#x5f0f;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1477548903106" ID="ID_60979335" LINK="#ID_1052998927" MODIFIED="1478759318318">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>i2c&#x603b;&#x7ebf;&#x7684;&#x6ce8;&#x518c;:</b></i>
    </p>
    <p>
      &#x4ee5;&#x4e09;&#x661f;&#x4ee3;&#x7801;&#x4e3a;&#x4f8b;&#x5b50;&#xff0c;&#x603b;&#x7ebf;&#x6ce8;&#x518c;&#x7684;&#x65b9;&#x5f0f;&#x662f;&#x901a;&#x8fc7;device tree&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x5728;&#x5e73;&#x53f0;&#x9a71;&#x52a8;
    </p>
    <p>
      &#x5f53;&#x4e2d;&#x6ce8;&#x518c;i2c&#x7684;&#x9002;&#x914d;&#x5668;
    </p>
    <p>
      &#x7136;&#x540e;&#x5728;driver/i2c/busses&#x76ee;&#x5f55;&#x4e0b;&#x9762;&#x6709;&#x5bf9;&#x5e94;&#x7684;&#x603b;&#x7ebf;&#x9a71;&#x52a8;&#x521d;&#x59cb;&#x5316;&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x8be5;&#x521d;&#x59cb;&#x5316;&#x51fd;&#x6570;&#x901a;&#x8fc7;&#x5b8f;subsys_initcall&#x88ab;&#x5b9a;&#x4e49;&#x8c03;&#x7528;&#x3002;
    </p>
    <p>
      <b>ret = i2c_add_numbered_adapter(&amp;i2c-&gt;adap)</b>
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#b40101" DESTINATION="ID_1052998927" ENDARROW="Default" ENDINCLINATION="628;0;" ID="Arrow_ID_1164440357" STARTARROW="None" STARTINCLINATION="628;0;"/>
</node>
<node CREATED="1477639196881" ID="ID_26021854" MODIFIED="1477639220528">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i>struct resource { </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;resource_size_t start; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;resource_size_t end; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;const char *name; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;unsigned long flags; </i>
    </p>
    <p>
      <i>&#xa0;&#xa0;&#xa0;&#xa0;struct resource *parent, *sibling, *child; </i>
    </p>
    <p>
      <i>}</i>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1477535683384" ID="ID_696959423" MODIFIED="1477535789157">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>I2C&#x6838;&#x5fc3;</b>
    </p>
    <p>
      &#x4e3a;i2c&#x8bbe;&#x5907;&#x548c;i2c&#x7684;&#x9002;&#x914d;&#x5668;&#x63d0;&#x4f9b;&#x6ce8;&#x518c;&#x548c;&#x6ce8;&#x9500;&#x7684;&#x65b9;&#x6cd5;&#xff0c;&#x63d0;&#x4f9b;&#x4e86;algorithm&#x7684;&#x4e0a;&#x5c42;&#x5b9e;&#x73b0;&#xff0c;
    </p>
    <p>
      &#x63a2;&#x6d4b;&#x8bbe;&#x5907;&#xff0c;&#x68c0;&#x6d4b;&#x8bbe;&#x5907;&#x7684;&#x4ee3;&#x7801;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1477535857422" FOLDED="true" ID="ID_412001047" MODIFIED="1494857706819">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>I2C&#x603b;&#x7ebf;&#x9a71;&#x52a8;(i2c&#x9002;&#x914d;&#x5668;)</b>
    </p>
    <p>
      &#x603b;&#x7ebf;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;&#x5305;&#x542b;&#x9002;&#x914d;&#x5668;i2c_adapter
    </p>
    <p>
      i2c&#x9002;&#x914d;&#x5668;&#x7684;algorithm&#x6570;&#x636e;i2c_algorithm
    </p>
    <p>
      &#x63a7;&#x5236;I2c&#x9002;&#x914d;&#x5668;&#x4ea7;&#x751f;&#x901a;&#x4fe1;&#x4fe1;&#x53f7;&#x7684;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<node CREATED="1478506581239" ID="ID_1126092277" MODIFIED="1478507649079">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e00;&#x822c;&#x5c06;i2c_adapter&#x7ed3;&#x6784;&#x4f53;&#x653e;&#x7f6e;&#x5230;&#x4e00;&#x4e2a;&#x66f4;&#x5927;&#x7684;&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#xff0c;
    </p>
    <p>
      &#x66f4;&#x5927;&#x7684;&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x5f80;&#x5f80;&#x5305;&#x542b;&#x8be5;&#x9002;&#x914d;&#x5668;&#x7684;&#x6620;&#x5c04;&#x5730;&#x5740;&#xff0c;&#x65f6;&#x949f;&#xff0c;&#x4e2d;&#x65ad;&#x53f7;
    </p>
    <p>
      &#x7b49;&#x7b49;&#x4fe1;&#x606f;&#x3002;
    </p>
    <p>
      &#x7136;&#x540e;&#x8c03;&#x7528;platform_set_drvdata&#x51fd;&#x6570;&#xff0c;&#x5c06;&#x8be5;&#x66f4;&#x5927;&#x7684;&#x7ed3;&#x6784;&#x4f53;&#x653e;&#x5230;
    </p>
    <p>
      platform_dev-&gt;dev-&gt;drv_data&#x6307;&#x9488;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1478507869697" FOLDED="true" ID="ID_1052998927" MODIFIED="1494857705315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><b>int i2c_add_numbered_adapter(struct i2c_adapter *adap)</b></i>
    </p>
    <p>
      &#x6ce8;&#x518c;I2c&#x9002;&#x914d;&#x5668;
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x6839;&#x636e;adap-&gt;nr&#x7684;&#x6570;&#x503c;&#x6765;&#x5224;&#x65ad;&#x662f;&#x5426;&#x9700;&#x8981;&#x52a8;&#x6001;&#x5206;&#x914d;adap-&gt;nr
    </p>
    <p>
      &#x603b;&#x4e4b;&#xff0c;&#x8be5;&#x51fd;&#x6570;&#x6700;&#x540e;&#x90fd;&#x4f1a;&#x8c03;&#x7528;&#x51fd;&#x6570;
    </p>
    <p>
      static int <font color="#f31515">i2c_register_adapter</font>(struct i2c_adapter *adap)
    </p>
    <p>
      <i><b>adap-&gt;dev.bus = &amp;i2c_bus_type; </b></i>
    </p>
    <p>
      <i><b>adap-&gt;dev.type = &amp;i2c_adapter_type; </b></i>
    </p>
    <p>
      <i><b>res = device_register(&amp;adap-&gt;dev);</b></i>
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x6ce8;&#x518c;adapter&#x5bf9;&#x5e94;&#x7684;&#x8bbe;&#x5907;&#xff0c;&#x5e76;&#x4e14;&#x5c06;i2c&#x7684;&#x603b;&#x7ebf;&#x64cd;&#x4f5c;&#x7ed3;&#x6784;&#x4f53;&#x8d4b;&#x503c;&#x7ed9;&#x8be5;adapter
    </p>
    <p>
      &#x5728;i2c_register_adapter&#x51fd;&#x6570;&#x7684;&#x672b;&#x5c3e;&#x9636;&#x6bb5;&#xff0c;&#x4f1a;&#x505a;&#x51fa;&#x5982;&#x4e0b;&#x7684;&#x52a8;&#x4f5c;&#x6765;
    </p>
    <p>
      <font color="#ea0909">of_i2c_register_devices(adap);</font>------&gt;&#x6839;&#x636e;device tree&#x52a8;&#x6001;&#x751f;&#x6210;i2c_client
    </p>
    <p>
      acpi_i2c_register_devices(adap);
    </p>
    <p>
      acpi_i2c_install_space_handler(adap);
    </p>
    <p>
      if (adap-&gt;nr &lt; __i2c_first_dynamic_bus_num) -----&gt;&#x5224;&#x65ad;adap-&gt;nr&#x662f;&#x5426;&#x662f;&#x5b9e;&#x73b0;&#x8d4b;&#x503c;&#x597d;&#x7684;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;i2c_scan_static_board_info(adap);----&gt;&#x626b;&#x63cf;&#x5168;&#x5c40;&#x7684;dev info&#x94fe;&#x8868;,&#x6839;&#x636e;
    </p>
    <p>
      devinfo-&gt;busnum == adapter-&gt;nr&#x5339;&#x914d;&#x7136;&#x540e;&#x8c03;&#x7528;i2c_new_device&#x51fd;&#x6570;&#x751f;&#x6210;i2c_client&#x8bbe;&#x5907;
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#b40101" DESTINATION="ID_1052998927" ENDARROW="Default" ENDINCLINATION="628;0;" ID="Arrow_ID_1164440357" SOURCE="ID_60979335" STARTARROW="None" STARTINCLINATION="628;0;"/>
<node CREATED="1478756809063" ID="ID_62046011" MODIFIED="1478756951377">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      i2c_new_device&#x51fd;&#x6570;
    </p>
    <p>
      &#x5728;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x52a8;&#x6001;&#x751f;&#x6210;struct i2c_client&#xa0;&#xa0;&#xa0;*client&#xff0c;
    </p>
    <p>
      &#x7136;&#x540e;
    </p>
    <p>
      client-&gt;dev.parent = &amp;client-&gt;adapter-&gt;dev;
    </p>
    <p>
      client-&gt;dev.bus = &amp;i2c_bus_type;
    </p>
    <p>
      client-&gt;dev.type = &amp;i2c_client_type;
    </p>
    <p>
      client-&gt;dev.of_node = info-&gt;of_node;
    </p>
    <p>
      &#x6700;&#x540e;&#x6ce8;&#x518c;&#x8bbe;&#x5907;
    </p>
    <p>
      status = device_register(&amp;client-&gt;dev);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1477536290853" FOLDED="true" ID="ID_813056693" MODIFIED="1494857701580">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>i2c&#x8bbe;&#x5907;&#x9a71;&#x52a8;</b>
    </p>
    <p>
      &#x8fd9;&#x662f;&#x5bf9;I2c&#x786c;&#x4ef6;&#x4f53;&#x7cfb;&#x7ed3;&#x6784;&#x5f53;&#x4e2d;&#x8bbe;&#x5907;&#x7aef;&#x7684;&#x5b9e;&#x73b0;&#xff0c;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x9a71;&#x52a8;&#x4e3b;&#x8981;&#x4f1a;&#x5b9e;&#x73b0;ic_driver&#x548c;i2c_client&#x6570;&#x636e;&#x7ed3;&#x6784;
    </p>
    <p>
      &#x5177;&#x4f53;&#x7684;i2c&#x8bbe;&#x5907;&#x901a;&#x8fc7;&#x8c03;&#x7528;&#x4f4d;&#x4e8e;i2c_dev.c&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x7684;
    </p>
    <p>
      &#x63a5;&#x53e3;&#x5411;&#x7528;&#x6237;&#x5c42;&#x66b4;&#x9732;&#x81ea;&#x5df1;&#x7684;&#x8bbe;&#x5907;&#x8282;&#x70b9;&#x3002;
    </p>
  </body>
</html></richcontent>
<node CREATED="1477538329716" ID="ID_1150932034" MODIFIED="1477539236410">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      i2c_client&#x4ee3;&#x8868;&#x6302;&#x63a5;&#x5230;I2c&#x603b;&#x7ebf;&#x4e0a;&#x7684;&#x4e00;&#x4e2a;I2c&#x8bbe;&#x5907;
    </p>
    <p>
      struct i2c_client {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned short flags;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* div., see below&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned short addr;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* chip address - NOTE: 7bit&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* addresses are stored in the&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* _LOWER_ 7 bits&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;char name[I2C_NAME_SIZE];
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct i2c_adapter *adapter;&#xa0;&#xa0;&#xa0;&#xa0;/* the adapter we sit on&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct device dev;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* the device structure&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int irq;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* irq issued by device&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct list_head detected; /*&#x7528;&#x4e8e;&#x6302;&#x63a5;&#x5230;i2c&#x7684;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;*/
    </p>
    <p>
      #if IS_ENABLED(CONFIG_I2C_SLAVE)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;i2c_slave_cb_t slave_cb;&#xa0;&#xa0;&#xa0;&#xa0;/* callback for slave mode&#xa0;&#xa0;*/
    </p>
    <p>
      #endif
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1477539724769" ID="ID_1278084141" MODIFIED="1477539757560">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct i2c_algorithm {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* If an adapter algorithm can't do I2C-level access, set master_xfer
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;to NULL. If an adapter algorithm can do SMBus access, set
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;smbus_xfer. If set to NULL, the SMBus protocol is simulated
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;using common I2C messages */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* master_xfer should return the number of messages successfully
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;processed, or a negative value on error */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int (*master_xfer)(struct i2c_adapter *adap, struct i2c_msg *msgs,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;int num);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int (*smbus_xfer) (struct i2c_adapter *adap, u16 addr,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned short flags, char read_write,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;u8 command, int size, union i2c_smbus_data *data);
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/* To determine what the adapter supports */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;u32 (*functionality) (struct i2c_adapter *);
    </p>
    <p>
      
    </p>
    <p>
      #if IS_ENABLED(CONFIG_I2C_SLAVE)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int (*reg_slave)(struct i2c_client *client);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int (*unreg_slave)(struct i2c_client *client);
    </p>
    <p>
      #endif
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1478510896716" FOLDED="true" ID="ID_1531819648" MODIFIED="1494857700380">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x91c7;&#x7528;&#x9759;&#x6001;&#x7684;&#x65b9;&#x5f0f;&#x5b9a;&#x4e49;I2c&#x7684;&#x8bbe;&#x5907;
    </p>
  </body>
</html></richcontent>
<node CREATED="1478511216179" ID="ID_78075323" MODIFIED="1478512057371">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int&#xa0;&#xa0;__init&#xa0;&#xa0;&#xa0;i2c_register_board_info(int busnum,struct i2c_board_info const *info, unsigned len)
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x52a8;&#x6001;&#x751f;&#x6210;&#x4e00;&#x4e2a;struct i2c_devinfo&#x6307;&#x9488;&#xff0c;&#x7136;&#x540e;&#x5c06;&#x51fd;&#x6570;&#x4f20;&#x5165;&#x7684;board info&#x548c;busnum&#x653e;&#x5230;
    </p>
    <p>
      &#x8be5;devinfo&#x5f53;&#x4e2d;&#xff0c;&#x7136;&#x540e;&#x5411;&#x7cfb;&#x7edf;&#x5168;&#x5c40;&#x94fe;&#x8868;&#x5f53;&#x4e2d;&#x6dfb;&#x52a0;&#x8be5;devinfo
    </p>
    <p>
      list_add_tail(&amp;devinfo-&gt;list, &amp;__i2c_board_list);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1477537328834" ID="ID_1121533482" MODIFIED="1477538324805">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      SMbus
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1490085550298" FOLDED="true" ID="ID_1395933032" MODIFIED="1589521723196" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4">Device Tree</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1477562014348" FOLDED="true" ID="ID_737257459" MODIFIED="1589521719784">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e50a0a"><b><i>Device Tree&#x4ee3;&#x7801;&#x542f;&#x52a8;&#x5206;&#x6790; </i></b></font>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#110e15">https://0xax.gitbooks.io/linux-insides/content/Initialization/linux-initialization-4.html</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1477562530567" FOLDED="true" ID="ID_1185698741" MODIFIED="1589521656502">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>1.&#x5728;arm&#x7684;&#x6c47;&#x7f16;&#x90e8;&#x5206;&#x7684;&#x542f;&#x52a8;&#x4ee3;&#x7801;</b>&#x5f53;&#x4e2d;(arch/arm/kernel/head.S&#x548c;head_common.S)
    </p>
    <p>
      machine type id &#x88ab;&#x4fdd;&#x5b58;&#x5728;&#x53d8;&#x91cf;<b>__machine_arch_type</b>&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x6307;&#x5411;DTB&#x6216;&#x8005;atags&#x7684;&#x6307;&#x9488;&#x88ab;&#x4fdd;&#x5b58;&#x5728;&#x4e86;&#x53d8;&#x91cf; _<b>_atags_pointer</b>&#x4e2d;
    </p>
  </body>
</html></richcontent>
<node CREATED="1510281116295" FOLDED="true" ID="ID_1321144553" MODIFIED="1589521655503" TEXT="arm&#x6c47;&#x7f16;&#x542f;&#x52a8;&#x4ee3;&#x7801;head.S&#x5206;&#x6790;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1510281137672" ID="ID_792455536" MODIFIED="1526950026013">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x9996;&#x5148;&#x660e;&#x786e;&#x51e0;&#x4e2a;&#x8be5;&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x5b9a;&#x4e49;&#x7684;&#x51e0;&#x4e2a;&#x53d8;&#x91cf;&#x7684;&#x610f;&#x601d;:
    </p>
    <p>
      PAGE_OFFSET &#x8be5;&#x53d8;&#x91cf;&#x5b9a;&#x4e49;&#x7684;&#x662f;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;&#x5185;&#x5b58;&#x7684;&#x5927;&#x5c0f;&#xff0c;&#x5728;arm32&#x5f53;&#x4e2d;&#x5b9a;&#x4e49;&#x7684;&#x662f;3G,&#x5373;0xc0000000
    </p>
    <p>
      TEXT_OFFSET&#xa0;&#xa0;&#x5185;&#x6838;&#x89e3;&#x538b;&#x540e;&#x6240;&#x5904;&#x7684;&#x4f4d;&#x7f6e;&#xff0c;&#x5728;linux&#x91cc;&#x9762;&#x8bbe;&#x7f6e;&#x4e3a;0x8000,&#x6bd4;&#x5982;s3c2440&#x7684;&#x5185;&#x5b58;&#x7269;&#x7406;&#x8d77;&#x59cb;&#x5730;&#x5740;&#x662f;0x30000000
    </p>
    <p>
      &#x90a3;&#x4e48;&#x5185;&#x6838;&#x89e3;&#x538b;&#x4e4b;&#x540e;&#x6240;&#x5728;&#x7684;&#x5165;&#x53e3;&#x5730;&#x5740;&#x4f4d;&#x7f6e;&#x5c31;&#x662f;0x30008000&#x4e86;
    </p>
    <p>
      KERNEL_RAM_VADDR &#x5185;&#x6838;&#x5b9a;&#x4e49;&#x7684;&#x865a;&#x62df;&#x5730;&#x5740;&#x7684;&#x5165;&#x53e3;&#xff0c;&#x5373; PAGE_OFFSET + TEXT_OFFSET
    </p>
    <p>
      <font color="#bc0202">&#x76f8;&#x5e94;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x7528;KERNEL_RAM_PADDR&#x53d8;&#x91cf;&#x6307;&#x5b9a;,&#x5b9a;&#x4e49;&#x4e3a; </font>
    </p>
    <p>
      <font color="#bc0202">#define KERNEL_RAM_PADDR (PHYS_OFFSET+TXST_OFFSET) </font>
    </p>
    <p>
      <font color="#bc0202">//&#x5982;&#x5bf9;s3c2410&#xff0c;PHYS_OFFSET=0X30000000,&#x7269;&#x7406;&#x5730;&#x5740;&#x4e3a;0X30008000</font>
    </p>
    <p>
      swapper_pg_dir &#x5185;&#x6838;&#x521a;&#x8fd0;&#x884c;&#x7684;&#x65f6;&#x5019;&#x7684;&#x7b80;&#x6613;&#x7684;&#x521d;&#x59cb;&#x9875;&#x8868;&#x7684;&#x4f4d;&#x7f6e;&#xff0c;&#x5b9a;&#x4e49;&#x4e3a; KERNEL_RAM_VADDR - PG_DIR_SIZE
    </p>
    <p>
      PG_DIR_SIZE&#x4f1a;&#x6839;&#x636e;&#x662f;&#x5426;&#x5b9a;&#x4e49;&#x4e86;&#x5927;&#x5185;&#x5b58;&#x9875;&#x88ab;&#x5b9a;&#x4e49;&#x6210;0x5000&#x6216;&#x8005;0x4000<br/>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1510283664616" FOLDED="true" ID="ID_1255147973" MODIFIED="1589521652103">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>safe_svcmode_maskall r9</b>&#xa0;&#xa0;&#x8bbe;&#x7f6e;&#x5904;&#x7406;&#x5668;&#x8fdb;&#x5165;svc&#x6a21;&#x5f0f;&#xff0c;&#x5e76;&#x4e14;&#x7981;&#x6b62;normal&#x4e2d;&#x65ad;&#x548c;fast&#x4e2d;&#x65ad;
    </p>
    <p>
      <b>mrc p15, 0, r9, c0, c0</b>&#xa0;&#x4ece;&#x534f;&#x5904;&#x7406;&#x5668;&#x7684;c0&#x5bc4;&#x5b58;&#x5668;&#x5f53;&#x4e2d;&#x83b7;&#x53d6;process id
    </p>
    <p>
      31:24 Implementer 0x41
    </p>
    <p>
      23:20 Specification revision 0x1
    </p>
    <p>
      19:16 Architecture (ARMv4T) 0x2
    </p>
    <p>
      15:4 Part number 0x920
    </p>
    <p>
      3:0 Layout revision Revision
    </p>
    <p>
      <b>bl&#xa0;&#xa0;__lookup_processor_type</b>&#xa0;&#x4f7f;&#x7528;r9&#x91cc;&#x9762;&#x4fdd;&#x5b58;&#x7684;cpu id&#x4fe1;&#x606f;&#x53bb;&#x7cfb;&#x7edf;&#x94fe;&#x63a5;&#x597d;&#x7684;__proc_info&#x91cc;&#x9762;&#x67e5;&#x627e;
    </p>
    <p>
      &#x5bf9;&#x5e94;&#x7684;proc_info, r5&#x6700;&#x540e;&#x8fd4;&#x56de;&#x5bf9;&#x5e94;&#x7684;&#x5904;&#x7406;&#x5668;&#x7684;&#x7ed3;&#x6784;&#x4f53;struct proc_info_list&#x7684;&#x5730;&#x5740;
    </p>
    <p>
      <b>movs&#xa0;&#xa0;&#xa0;&#xa0;r10, r5</b>&#xa0;&#x5c06;proc_info&#x4fe1;&#x606f;&#x7684;&#x5730;&#x5740;&#x8d4b;&#x503c;&#x7ed9;r10
    </p>
    <p>
      struct proc_info_list {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cpu_val;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;cpu_mask;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__cpu_mm_mmu_flags; /* used by head.S */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__cpu_io_mmu_flags; /* used by head.S */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__cpu_flush;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* used by head.S */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*arch_name;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*elf_name;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;elf_hwcap;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;const char&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*cpu_name;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct processor&#xa0;&#xa0;&#xa0;&#xa0;*proc;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct cpu_tlb_fns&#xa0;&#xa0;*tlb;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct cpu_user_fns *user;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct cpu_cache_fns&#xa0;&#xa0;&#xa0;&#xa0;*cache;
    </p>
    <p>
      };
    </p>
    <p>
      <b>ldr r8, =PLAT_PHYS_OFFSET</b>
    </p>
    <p>
      <b>bl&#xa0;&#xa0;__vet_atags</b>&#xa0;&#x6682;&#x65f6;&#x4e0d;&#x5206;&#x6790;
    </p>
    <p>
      bl&#xa0;&#xa0;__create_page_tables
    </p>
  </body>
</html></richcontent>
<node CREATED="1510285114648" FOLDED="true" ID="ID_1835962005" MODIFIED="1589521649072">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      __create_page_tables:
    </p>
    <p>
      &#160;&#160;&#160; <b>pgtbl&#160;&#160;&#160;r4, r8&#160; </b>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; @ page table address r4&#36820;&#22238;&#29289;&#29702;&#39029;&#34920;&#30340;&#20301;&#32622;,&#20301;&#20110;&#20869;&#26680;&#20837;&#21475;&#22320;&#22336;&#20197;&#19979;16k&#22788;
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;/*&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* Clear the swapper page table
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;mov r0, r4
    </p>
    <p>
      &#160;&#160;&#160;&#160;mov r3, #0
    </p>
    <p>
      &#160;&#160;&#160;&#160;add r6, r0, #PG_DIR_SIZE&#160;&#160; <b>&#28165;&#31354;16k&#22823;&#23567;&#30340;&#39029;&#34920;</b>
    </p>
    <p>
      1:&#160;&#160;str r3, [r0], #4
    </p>
    <p>
      &#160;&#160;&#160;&#160;str r3, [r0], #4
    </p>
    <p>
      &#160;&#160;&#160;&#160;str r3, [r0], #4
    </p>
    <p>
      &#160;&#160;&#160;&#160;str r3, [r0], #4
    </p>
    <p>
      &#160;&#160;&#160;&#160;teq r0, r6
    </p>
    <p>
      &#160;&#160;&#160;&#160;bne 1b&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<b>&#28165;&#31354;&#39029;&#34920;</b>
    </p>
    <p>
      &#160;&#160;&#160;<b>&#160;ldr r7, [r10, #PROCINFO_MM_MMUFLAGS] </b>@ mm_mmuflags
    </p>
    <p>
      
    </p>
    <p>
      _<i><font color="#d10909">_arm920_proc_info: </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;0x41009200 </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;0xff00fff0 </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;PMD_TYPE_SECT | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_SECT_BUFFERABLE | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_SECT_CACHEABLE | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_BIT4 | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_SECT_AP_WRITE | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_SECT_AP_READ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;PMD_TYPE_SECT | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_BIT4 | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_SECT_AP_WRITE | \ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PMD_SECT_AP_READ </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;initfn&#160;&#160;__arm920_setup, __arm920_proc_info </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;cpu_arch_name </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;cpu_elf_name </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;HWCAP_SWP | HWCAP_HALF | HWCAP_THUMB </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;cpu_arm920_name </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;arm920_processor_functions </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;v4wbi_tlb_fns </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;v4wb_user_fns </font></i>
    </p>
    <p>
      <i><font color="#d10909">#ifndef CONFIG_CPU_DCACHE_WRITETHROUGH </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;arm920_cache_fns </font></i>
    </p>
    <p>
      <i><font color="#d10909">#else </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.long&#160;&#160;&#160;v4wt_cache_fns </font></i>
    </p>
    <p>
      <i><font color="#d10909">#endif </font></i>
    </p>
    <p>
      <i><font color="#d10909">&#160;&#160;&#160;&#160;.size&#160;&#160;&#160;__arm920_proc_info, . - __arm920_proc_info </font></i>
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;/*
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* Create identity mapping to cater for __enable_mmu.
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* This identity mapping will be removed by paging_init().
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;<b>adr r0, __turn_mmu_on_loc </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;ldmia&#160;&#160;&#160;r0, {r3, r5, r6} </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;sub r0, r0, r3&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@ virt-&gt;phys offset </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;add r5, r5, r0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@ phys __turn_mmu_on &#33719;&#24471;__turn_mmu_on&#30340;&#29289;&#29702;&#22320;&#22336; </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;add r6, r6, r0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@ phys __turn_mmu_on_end&#160; </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;mov r5, r5, lsr #SECTION_SHIFT&#160;&#160; <font color="#ff3300">&#21491;&#31227;20&#20301;&#65292;&#33719;&#21462;&#39640;12&#20301;&#30340;Table index</font></b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;mov r6, r6, lsr #SECTION_SHIFT&#160;&#160; <font color="#ff3300">&#21491;&#31227;20&#20301;&#65292;&#33719;&#21462;&#39640;12&#20301;&#30340;Table index</font></b>
    </p>
    <p>
      
    </p>
    <p>
      <b>1:&#160;&#160;orr r3, r7, r5, lsl #SECTION_SHIFT&#160;&#160;@ flags + kernel base <font color="#3333ff">&#26500;&#24314;&#31471;&#39029;&#34920;&#30340;&#39029;&#34920;&#39033;&#37324;&#38754;&#30340;&#20869;&#23481;</font>&#160; </b>
    </p>
    <p>
      <b>&#160;&#160;&#160; </b><i><font face="Aparajita" color="#ff0000">&#23558;r5&#24038;&#31227;20&#20301;&#65292;&#37027;&#20040;&#21407;&#20808;r5&#37324;&#38754;&#20445;&#23384;&#30340;&#29289;&#29702;&#22320;&#22336;&#30340;&#19968;&#37096;&#20998;&#23601;&#34987;&#25918;&#32622;&#21040;&#39029;&#34920;&#39033;&#37324;&#38754;&#20102;</font></i>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;str r3, [r4, r5, lsl #PMD_ORDER]&#160;&#160;&#160;&#160;@ identity mapping </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;</b><i><font face="Andalus" color="#3300ff">r4&#26159;&#39029;&#34920;&#22522;&#22320;&#22336;&#65292;PMD_ORDER&#26159;2&#65292;&#27599;&#20010;&#39029;&#34920;&#39033;&#21344;&#29992;4&#20010;&#23383;&#33410;&#65292;&#36825;&#37324;&#23601;&#26159;&#21033;&#29992;r5 table index&#23558;r3&#30340;&#39029;&#34920;&#20869;&#23481;&#25918;&#21040;&#23545;&#24212; </font></i>
    </p>
    <p>
      <i><font face="Andalus" color="#3300ff">&#160;&#160;&#160;&#30340;&#20869;&#23384;&#31354;&#38388;&#37324;&#38754;&#21435;&#20102;</font></i>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;cmp r5, r6 </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;addlo&#160;&#160;&#160;r5, r5, #1&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@ next section </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;blo 1b&#160; &#20026;mmu_on&#20989;&#25968;&#24314;&#31435;&#34394;&#25311;&#22320;&#22336;&#21040;&#29289;&#29702;&#22320;&#22336;&#30340;&#26144;&#23556;&#65292;&#27880;&#24847;&#36825;&#37324;&#30340;&#34394;&#25311;&#22320;&#22336;&#20854;&#23454;&#36319;&#29289;&#29702;&#22320;&#22336;&#26159;&#19968;&#26679;&#30340;&#65292;&#25152;&#20197;&#24314;&#31435;&#26144;&#23556;&#34920;&#30340;&#26102;&#20505;&#20570;&#20102;&#29305;&#27530;&#30340;&#22788;&#29702;</b>
    </p>
    <p>
      
    </p>
    <p>
      &#160;&#160;&#160;&#160;/*
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;* Map our RAM from the start to the end of the kernel .bss section.
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;*/
    </p>
    <p>
      &#160;&#160;&#160;&#160;<b>add r0, r4, #PAGE_OFFSET &gt;&gt; (SECTION_SHIFT - PMD_ORDER) </b>
    </p>
    <p>
      <b>PAGE_OFFSET&#26159;&#20869;&#26680;&#34394;&#25311;&#22320;&#22336;&#30340;&#36215;&#22987;&#22320;&#22336;&#37096;&#20998;&#65292;&#25152;&#20197;r0&#26159;&#20445;&#23384;&#35813;&#36215;&#22987;&#34394;&#25311;&#22320;&#22336;&#30340;&#39029;&#34920;&#39033;&#30340;&#29289;&#29702;&#22320;&#22336;</b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;ldr r6, =(_end - 1)&#160;&#160;_end&#20195;&#30721;&#23545;&#24212;&#30340;&#34394;&#25311;&#22320;&#22336;</b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;orr r3, r8, r7&#160;&#160; <font color="#ff3333">&#26500;&#24314;&#20869;&#26680;&#34394;&#25311;&#36215;&#22987;&#22320;&#22336;&#23545;&#24212;&#30340;&#29289;&#29702;&#22320;&#22336;&#39029;&#34920;&#39033;&#20869;&#23481;&#20445;&#23384;&#21040;r3</font>&#160; </b>
    </p>
    <p>
      <i><font color="#009900" face="Calibri" size="4">&#27492;&#26102;r2&#23384;&#25918;&#30340;&#26159;&#35774;&#22791;&#26641;&#38236;&#20687;&#30340;&#29289;&#29702;&#36215;&#22987;&#22320;&#22336;&#65292;r8&#26159;&#29289;&#29702;&#20869;&#23384;&#30340;&#36215;&#22987;&#22320;&#22336;&#65292;r9&#26159;&#20174;CP15&#30340;C0&#20013;&#35835;&#21040;&#30340;cpu id&#65292; </font></i>
    </p>
    <p>
      <i><font face="Calibri" color="#009900" size="4">r10&#26159;&#19982;&#35813;cpu id&#21305;&#37197;&#30340;proc_info_list&#30340;&#29289;&#29702;&#22320;&#22336; </font></i>
    </p>
    <p>
      <i><font face="Calibri" color="#009900" size="4">TQ2440: </font></i>
    </p>
    <p>
      <i><font face="Calibri" color="#009900" size="4">r8: 0x3000_0000&#65292;r9: 0x41129200 </font></i>
    </p>
    <p>
      <i><font face="Calibri" color="#009900" size="4">vexpress: </font></i>
    </p>
    <p>
      <i><font face="Calibri" color="#009900" size="4">r8: 0x6000_0000&#65292;r9: 0x414FC091</font></i>
    </p>
    <p>
      
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;add r6, r4, r6, lsr #(SECTION_SHIFT - PMD_ORDER) _end&#20195;&#30721;&#34394;&#25311;&#22320;&#22336;&#25152;&#23545;&#24212;&#30340;&#39029;&#34920;&#39033;&#30340;&#29289;&#29702;&#22320;&#22336;</b>
    </p>
    <p>
      <b>1:&#160;&#160;str r3, [r0], #1 &lt;&lt; PMD_ORDER </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;add r3, r3, #1 &lt;&lt; SECTION_SHIFT </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;cmp r0, r6 </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;bls 1b&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#20026;&#20869;&#26680;&#30340;&#38236;&#20687;&#24314;&#31435;&#34394;&#25311;&#22320;&#22336;&#21040;&#29289;&#29702;&#22320;&#22336;&#30340;&#26144;&#23556;&#34920;&#39033; </b>
    </p>
    <p>
      
    </p>
    <p>
      <b>/* </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;&#160;* Then map boot params address in r2 if specified. </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;&#160;* We map 2 sections in case the ATAGs/DTB crosses a section boundary. </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;&#160;*/ </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;mov r0, r2, lsr #SECTION_SHIFT </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;movs&#160;&#160;&#160;&#160;r0, r0, lsl #SECTION_SHIFT </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;subne&#160;&#160;&#160;r3, r0, r8 </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;addne&#160;&#160;&#160;r3, r3, #PAGE_OFFSET </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;addne&#160;&#160;&#160;r3, r4, r3, lsr #(SECTION_SHIFT - PMD_ORDER) </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;orrne&#160;&#160;&#160;r6, r7, r0 </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;strne&#160;&#160;&#160;r6, [r3], #1 &lt;&lt; PMD_ORDER </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;addne&#160;&#160;&#160;r6, r6, #1 &lt;&lt; SECTION_SHIFT </b>
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;strne&#160;&#160;&#160;r6, [r3]&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#20026;dts&#35774;&#22791;&#26641;&#38236;&#20687;&#20570;&#27573;&#24335;&#39029;&#34920;&#26144;&#23556; </b>
    </p>
    <p>
      
    </p>
    <p>
      <b>&#160;&#160;&#160;&#160;ret lr&#160;&#160;&#160; </b>
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
<node CREATED="1526951993336" ID="ID_1918552697" MODIFIED="1526952013823">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x53c2;&#x8003;&#x4e00;&#x4e0b;&#x7f51;&#x5740;http://www.eetop.cn/blog/html/92/23692-22737.html
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586754933870" ID="ID_1500578598" MODIFIED="1586754963290">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      https://www.cnblogs.com/pengdonglin137/p/7818922.html
    </p>
    <p>
      &#36825;&#20010;&#32593;&#22336;&#65292;&#24429;&#19996;&#26519;&#20889;&#24471;&#27604;&#36739;&#28165;&#26224;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1586755320986" ID="ID_1410012702" MODIFIED="1586755339257">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/&#x6bb5;&#x5f0f;&#x9875;&#x8868;&#x6620;&#x5c04;&#x8fc7;&#x7a0b;.png" />
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1477562929718" FOLDED="true" ID="ID_1744590774" MODIFIED="1589521711867">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.void __init setup_arch(char **cmdline_p)&#x51fd;&#x6570;&#x5206;&#x6790;</b>
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x662f;device tree&#x521d;&#x59cb;&#x5316;&#x4ee3;&#x7801;&#x7684;&#x603b;&#x7684;&#x5165;&#x53e3;&#x51fd;&#x6570;
    </p>
    <p>
      &#x7528;__init&#x4fee;&#x9970;&#x7684;&#x51fd;&#x6570;&#x8868;&#x660e;&#x662f;&#x5728;kernel&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#x88ab;&#x8c03;&#x7528;&#xff0c;&#x5f53;&#x521d;&#x59cb;&#x5316;
    </p>
    <p>
      &#x5b8c;&#x6210;&#x4e4b;&#x540e;&#x5185;&#x6838;&#x4f1a;&#x91ca;&#x653e;&#x6389;&#x8be5;&#x90e8;&#x5206;&#x7684;&#x4ee3;&#x7801;&#x7a7a;&#x95f4;
    </p>
    <p>
      #define __init&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__section(.init.text) __cold notrace
    </p>
  </body>
</html></richcontent>
<node CREATED="1477566851078" FOLDED="true" ID="ID_788490843" MODIFIED="1589521708900">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x8c03;&#x7528;
    </p>
    <p>
      mdesc = <b><i>setup_machine_fdt(__atags_pointer)</i></b>
    </p>
    <p>
      &#x51fd;&#x6570;&#xff0c;&#x627e;&#x5230;&#x6700;&#x5408;&#x9002;&#x7684;machine&#x63cf;&#x8ff0;&#x7b26;
    </p>
  </body>
</html></richcontent>
<node CREATED="1477571268884" FOLDED="true" ID="ID_692268297" MODIFIED="1589521707631">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      mdesc = of_flat_dt_match_machine(mdesc_best, arch_get_next_mach)
    </p>
    <p>
      &#x627e;&#x5230;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x5b9a;&#x4e49;&#x7684;&#x6700;&#x5339;&#x914d;&#x7684;machine_desc&#x7ed3;&#x6784;&#x4f53;&#xff0c;
    </p>
    <p>
      &#x6ce8;&#x610f;machine&#x662f;&#x6211;&#x4eec;&#x4e8b;&#x5148;&#x9759;&#x6001;&#x5b9a;&#x4e49;&#x7684;&#xff0c;&#x6bd4;&#x5982;&#x5bf9;&#x4e8e;&#x4e0b;&#x9762;&#x7684;&#x5b9a;&#x4e49;
    </p>
    <p>
      <b><i>DT_MACHINE_START</i></b>
    </p>
    <p>
      <b><i>.l2c_aux_val&#xa0;&#xa0;&#xa0;&#xa0;</i></b>
    </p>
    <p>
      <b><i>.l2c_aux_mask&#xa0;&#xa0;&#xa0;</i></b>
    </p>
    <p>
      <b><i>.smp&#xa0;</i></b>
    </p>
    <p>
      <b><i>.map_io</i></b>
    </p>
    <p>
      <b><i>.init_early</i></b>
    </p>
    <p>
      <b><i>.init_irq</i></b>
    </p>
    <p>
      <font color="#c80606"><b><i>.init_machine </i></b></font>
    </p>
    <p>
      <b><i>.init_late</i></b>
    </p>
    <p>
      <b><i>.dt_compat</i></b>
    </p>
    <p>
      <b><i>.restart</i></b>
    </p>
    <p>
      <b><i>.reserve&#xa0;</i></b>
    </p>
    <p>
      <b><i>.dt_fixup</i></b>
    </p>
    <p>
      <b><i>MACHINE_EN</i></b>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#e30707" DESTINATION="ID_692268297" ENDARROW="Default" ENDINCLINATION="450;0;" ID="Arrow_ID_1021825940" SOURCE="ID_464431570" STARTARROW="None" STARTINCLINATION="450;0;"/>
<node CREATED="1477633886966" FOLDED="true" ID="ID_116811326" MODIFIED="1589521704574">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5206;&#x6790;init_machine&#x51fd;&#x6570;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1477633925331" FOLDED="true" ID="ID_129454721" MODIFIED="1589521703391">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      init_machine&#x51fd;&#x6570;&#x4e00;&#x822c;&#x90fd;&#x4f1a;&#x8c03;&#x7528;&#x5230;
    </p>
    <p>
      of_platform_populate(NULL, of_default_bus_match_table, NULL, NULL)
    </p>
    <p>
      &#x51fd;&#x6570;
    </p>
    <p>
      &#x4e0b;&#x9762;&#x5206;&#x6790;<b><i>of_platform_populate</i></b>&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<node CREATED="1477634043546" FOLDED="true" ID="ID_916596600" MODIFIED="1589521700280">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x8be5;&#x51fd;&#x6570;&#x4ece;device tree&#x7684;&#x6839;&#x8282;&#x70b9;&#x5f00;&#x59cb;&#xff0c;&#x9010;&#x4e2a;&#x5206;&#x6790;&#x6bcf;&#x4e2a;device_node&#xff0c;
    </p>
    <p>
      &#x8c03;&#x7528;&#x51fd;&#x6570;of_platform_bus_create&#x5206;&#x6790;&#x8fd9;&#x4e9b;node
    </p>
    <p>
      2.of_platform_bus_create&#x51fd;&#x6570;&#x9996;&#x5148;&#x4f1a;&#x5206;&#x6790;&#x8be5;&#x8282;&#x70b9;&#x6709;&#x6ca1;&#x6709;compatible&#x5c5e;&#x6027;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x6ca1;&#x6709;&#x8be5;&#x5c5e;&#x6027;&#xff0c;&#x5219;&#x7acb;&#x523b;&#x8fd4;&#x56de;&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x6709;compatible&#x5c5e;&#x6027;&#xff0c;&#x5219;&#x4f1a;&#x5206;&#x6790;&#x8be5;&#x8282;&#x70b9;&#x7684;compatible&#x5c5e;&#x6027;&#x7684;&#x503c;&#x662f;&#x4e0d;&#x662f;
    </p>
    <p>
      "arm,primecell", &#x5982;&#x679c;&#x662f;&#x7684;&#x8bdd;&#x5c31;&#x8bf4;&#x660e;&#x662f;amba&#x7684;&#x8bbe;&#x5907;&#xff0c;&#x90a3;&#x4e48;&#x4f1a;&#x521b;&#x5efa;amba&#x8bbe;&#x5907;&#x5e76;
    </p>
    <p>
      &#x7acb;&#x5373;&#x8fd4;&#x56de;&#x3002;
    </p>
    <p>
      &#x7136;&#x540e;&#x8c03;&#x7528;&#x51fd;&#x6570;of_platform_device_create_pdata&#x6765;&#x521b;&#x5efa;platform_device&#x8bbe;&#x5907;&#xff0c;
    </p>
    <p>
      3.&#x5728;of_platform_device_create_pdata&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x4f1a;&#x8c03;&#x7528;
    </p>
    <p>
      of_device_alloc&#x51fd;&#x6570;&#x6765;&#x5206;&#x914d;platform_device&#x7ed3;&#x6784;&#x4f53;
    </p>
    <p>
      4.<font color="#da0808">&#x5728;of_device_alloc&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#xff0c;&#x4f1a;&#x8c03;&#x7528;of_address_to_resource&#x548c;of_irq_count </font>
    </p>
    <p>
      <font color="#da0808">&#x51fd;&#x6570;&#x6765;&#x5224;&#x65ad;io&#x548c;irq&#x7684;&#x8d44;&#x6e90;&#x6570;&#x76ee;&#xff0c;&#x7136;&#x540e;&#x8bbe;&#x7f6e; </font>
    </p>
    <p>
      <font color="#da0808">dev-&gt;num_resources = num_reg + num_irq </font>
    </p>
    <p>
      <font color="#da0808">dev-&gt;resource = res</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1478504550499" FOLDED="true" ID="ID_494599611" MODIFIED="1589521699001">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#0e4d1c"><i>of_device_alloc&#x51fd;&#x6570;&#x5206;&#x6790;:</i></font></b>
    </p>
    <p>
      
    </p>
    <p>
      1.while (of_address_to_resource(np, num_reg, &amp;temp_res) == 0)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;num_reg++;&#xa0;&#xa0;-----&gt; <font color="#db0707">num_reg&#x4ee3;&#x8868;reg&#x5c5e;&#x6027;&#x91cc;&#x9762;&#x6709;&#x51e0;&#x7ec4;&#x8d44;&#x6e90;</font>
    </p>
    <p>
      of_address_to_resource&#x51fd;&#x6570;&#x9996;&#x5148;&#x4f1a;&#x8c03;&#x7528;&#x51fd;&#x6570;
    </p>
    <p>
      addrp = of_get_address(dev, index, &amp;size, &amp;flags),&#x8be5;&#x51fd;&#x6570;&#x6839;&#x636e;&#x5b9a;&#x4e49;&#x7684;
    </p>
    <p>
      #address-cells = &lt;2&gt;;
    </p>
    <p>
      #size-cells = &lt;1&gt;;
    </p>
    <p>
      &#x6765;&#x51b3;&#x5b9a;reg&#x5c5e;&#x6027;&#x91cc;&#x9762;&#x7684;&#x8d77;&#x59cb;&#x5730;&#x5740;&#x548c;&#x5927;&#x5c0f;&#xff0c;<font color="#f01717">&#x6ce8;&#x610f;address-cells&#x548c;size-cells&#x662f;&#x7531;dev&#x7684;&#x7236;&#x8282;&#x70b9; </font>
    </p>
    <p>
      <font color="#f01717">&#x6765;&#x51b3;&#x5b9a;&#x7684;&#xff0c;&#x800c;&#x4e0d;&#x662f;&#x6839;&#x636e;&#x5f53;&#x524d;&#x8282;&#x70b9;&#x91cc;&#x9762;&#x7684;&#x5b9a;&#x4e49;&#x3002;</font>
    </p>
    <p>
      &#x6bd4;&#x5982;&#x5728;&#x8fd9;&#x91cc;&#x8868;&#x793a;&#x5730;&#x5740;&#x5b57;&#x6bb5;&#x662f;&#x4e00;&#x4e2a;64&#x4f4d;&#x7684;&#x6570;&#x636e;&#xff0c;&#x800c;&#x5730;&#x5740;&#x8303;&#x56f4;&#x662f;&#x7531;&#x4e00;&#x4e2a;32&#x4f4d;&#x7684;&#x6570;&#x636e;&#x8868;&#x793a;&#x7684;&#x3002;
    </p>
    <p>
      index&#x662f;&#x7528;&#x6765;&#x5339;&#x914d;reg&#x5c5e;&#x6027;&#x5f53;&#x4e2d;&#x7684;&#x7b2c;&#x51e0;&#x7ec4;&#x7684;&#xff0c;&#x5728;&#x8fd9;&#x91cc;&#x4e00;&#x7ec4;&#x7684;&#x6570;&#x636e;&#x662f;2+1=3&#x4e2a;&#x5b57;&#x6bb5;
    </p>
    <p>
      &#x7136;&#x540e;&#x8c03;&#x7528; __of_address_to_resource(dev, addrp, size, flags, name, r)&#x51fd;&#x6570;&#x8fd4;&#x56de;resource&#x7ed3;&#x6784;&#x4f53;
    </p>
    <p>
      
    </p>
    <p>
      2.num_irq = of_irq_count(np); &#x8ba1;&#x7b97;&#x6709;&#x51e0;&#x7ec4;&#x4e2d;&#x65ad;&#x8d44;&#x6e90;
    </p>
    <p>
      
    </p>
    <p>
      3. &#x6839;&#x636e;&#x4e0a;&#x9762;&#x5206;&#x6790;&#x5230;&#x7684;num_irq&#x548c;num_reg&#x7684;&#x6570;&#x91cf;&#x6765;&#x5206;&#x914d;resource&#x6570;&#x7ec4;&#x7ed9;res
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;res = kzalloc(sizeof(*res) * (num_irq + num_reg), GFP_KERNEL)
    </p>
    <p>
      
    </p>
    <p>
      4. &#x8c03;&#x7528;
    </p>
    <p>
      for (i = 0; i &lt; num_reg; i++, res++)&#xa0;&#xa0;&#x7528;&#x6765;&#x5c06;&#x5bc4;&#x5b58;&#x5668;&#x76f8;&#x5173;&#x7684;&#x4fe1;&#x606f;&#x4fdd;&#x5b58;&#x5230;res&#x6570;&#x7ec4;&#x91cc;&#x9762;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;rc = of_address_to_resource(np, i, res);
    </p>
    <p>
      
    </p>
    <p>
      5. <b>&#x5c06;&#x4e2d;&#x65ad;&#x8d44;&#x6e90;&#x4fe1;&#x606f;&#x4fdd;&#x5b58;&#x5230;res&#x6570;&#x7ec4;&#x91cc;&#x9762;</b>
    </p>
    <p>
      <b><font color="#2014e9">of_irq_to_resource_table(np, res, num_irq)&#xa0; &#x5728;&#x5206;&#x6790;irq&#x7684;&#x65f6;&#x5019;&#x5c31;&#x5df2;&#x7ecf;&#x5c06;hwirq&#x548c;virq&#x7684;&#x5173;&#x7cfb;&#x6620;&#x5c04;&#x597d;&#x5e76;&#x5b58;&#x50a8;&#x5728;irq domain&#x91cc;&#x9762; </font></b>
    </p>
    <p>
      &#x4e14;&#x5df2;&#x7ecf;&#x751f;&#x6210;&#x4e86;irq_desc
    </p>
    <p>
      &#x751f;&#x6210;reg&#x548c;irq&#x7684;&#x8d44;&#x6e90;resource&#xff0c;&#x653e;&#x7f6e;&#x5230;dev-&gt;resource&#x6307;&#x9488;&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
<node CREATED="1527390042697" FOLDED="true" ID="ID_562202546" MODIFIED="1589521695871">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>int of_irq_to_resource_table(struct device_node *dev, struct resource *res, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;int nr_irqs)</b>
    </p>
    <p>
      <b>{</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int i;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;for (i = 0; i &lt; nr_irqs; i++, res++)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (!of_irq_to_resource(dev, i, res))
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;break;
    </p>
    <p>
      
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return i;
    </p>
    <p>
      <b>}</b>
    </p>
    <p>
      
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x5c06;&#x5177;&#x4f53;&#x7684;&#x5904;&#x7406;&#x8fc7;&#x7a0b;&#x6559;&#x7ed9;of_irq_to_resource&#x51fd;&#x6570;&#x8fdb;&#x884c;&#x5904;&#x7406;&#xff0c;
    </p>
    <p>
      &#x4e0b;&#x9762;&#x770b;&#x4e00;&#x4e0b;&#x8be5;&#x51fd;&#x6570;&#x7684;&#x6267;&#x884c;&#x903b;&#x8f91;
    </p>
    <p>
      <b><font color="#df0808">int of_irq_to_resource(struct device_node *dev, int index, struct resource *r)</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527390446136" FOLDED="true" ID="ID_722230684" MODIFIED="1589521694718">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int irq = irq_of_parse_and_map(dev, index);
    </p>
    <p>
      
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x9488;&#x5bf9;&#x7b2c;index&#x4e2a;hw&#x4e2d;&#x65ad;&#xff0c;&#x5c06;&#x5176;&#x8f6c;&#x6362;&#x6210;virq&#x8fd4;&#x56de;&#xff0c;&#x4e5f;&#x5373;&#x5b8c;&#x6210;&#x4e86;
    </p>
    <p>
      &#x4e00;&#x6b21;&#x6620;&#x5c04;&#x7684;&#x8fc7;&#x7a0b;
    </p>
  </body>
</html></richcontent>
<node CREATED="1527391607313" ID="ID_1864739719" MODIFIED="1527391776777">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct of_phandle_args oirq;
    </p>
    <p>
      
    </p>
    <p>
      struct of_phandle_args {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct device_node *np;&#xa0;&#xa0;&#x7528;&#x4e8e;&#x5b58;&#x653e;&#x5904;&#x7406;&#x8be5;&#x4e2d;&#x65ad;&#x7684;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x8282;&#x70b9;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int args_count;&#xa0;&#xa0;&#x5c31;&#x662f;#interrupt-cells&#x7684;&#x503c;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;uint32_t args[MAX_PHANDLE_ARGS];&#xa0;&#xa0;&#x7528;&#x4e8e;&#x5b58;&#x653e;&#x5177;&#x4f53;&#x63cf;&#x8ff0;&#x67d0;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#x7684;&#x53c2;&#x6570;&#x7684;&#x503c;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527391798464" ID="ID_1413321011" MODIFIED="1527391803141" TEXT="of_irq_parse_one(dev, index, &amp;oirq)"/>
<node CREATED="1527391815264" FOLDED="true" ID="ID_670703921" MODIFIED="1589521689414">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_create_of_mapping(&amp;oirq);
    </p>
  </body>
</html></richcontent>
<node CREATED="1527391917863" ID="ID_1033440399" MODIFIED="1527391979600">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct irq_fwspec fwspec;
    </p>
    <p>
      of_phandle_args_to_fwspec(irq_data, &amp;fwspec);
    </p>
    <p>
      
    </p>
    <p>
      &#x5c06;irq_data&#xff0c;&#x5373;of_phandle_args&#x91cc;&#x9762;&#x7684;&#x53c2;&#x6570;&#x8f6c;&#x5b58;&#x5230;fwspec&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527392033982" FOLDED="true" ID="ID_1255997388" MODIFIED="1589521688199">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>return irq_create_fwspec_mapping(&amp;fwspec);</b>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#c30606">struct irq_fwspec { </font>
    </p>
    <p>
      <font color="#c30606">&#xa0;&#xa0;&#xa0;&#xa0;struct fwnode_handle *fwnode; </font>
    </p>
    <p>
      <font color="#c30606">&#xa0;&#xa0;&#xa0;&#xa0;int param_count; </font>
    </p>
    <p>
      <font color="#c30606">&#xa0;&#xa0;&#xa0;&#xa0;u32 param[IRQ_DOMAIN_IRQ_SPEC_PARAMS]; </font>
    </p>
    <p>
      <font color="#c30606">};</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527394085113" ID="ID_1580496762" MODIFIED="1527394244329">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (fwspec-&gt;fwnode)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;domain = irq_find_matching_fwnode(fwspec-&gt;fwnode, DOMAIN_BUS_ANY);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;else
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;domain = irq_default_domain;
    </p>
    <p>
      &#x5bfb;&#x627e;&#x5339;&#x914d;&#x7684;irq domain, &#x6211;&#x4eec;&#x77e5;&#x9053;&#x5728;gic&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#x6ce8;&#x518c;&#x4e86;irq domain
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#da1919" DESTINATION="ID_1021508160" ENDARROW="Default" ENDINCLINATION="2457;0;" ID="Arrow_ID_887632958" STARTARROW="None" STARTINCLINATION="-303;-86;"/>
</node>
<node CREATED="1527394539557" FOLDED="true" ID="ID_155513541" MODIFIED="1589521686999">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_domain_translate(domain, fwspec, &amp;hwirq, &amp;type)
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#2d0de3" DESTINATION="ID_1654939506" ENDARROW="None" ENDINCLINATION="-1557;-56;" ID="Arrow_ID_976223014" STARTARROW="None" STARTINCLINATION="-236;265;"/>
<node CREATED="1527394878758" ID="ID_451792578" MODIFIED="1527410964250">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      #ifdef CONFIG_IRQ_DOMAIN_HIERARCHY
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (d-&gt;ops-&gt;translate)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return d-&gt;ops-&gt;translate(d, fwspec, hwirq, type);
    </p>
    <p>
      #endif
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (d-&gt;ops-&gt;xlate)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return d-&gt;ops-&gt;xlate(d, to_of_node(fwspec-&gt;fwnode),
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;fwspec-&gt;param, fwspec-&gt;param_count,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;hwirq, type);
    </p>
    <p>
      &#x770b;&#x4e00;&#x4e0b;gic&#x5bf9;&#x5e94;&#x7684;irq domain&#x91cc;&#x9762;&#x7684;ops&#x7684;&#x5b9a;&#x4e49;:
    </p>
    <p>
      static const <b>struct irq_domain_ops gic_irq_domain_hierarchy_ops</b>&#xa0;=<b>&#xa0; {</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.translate = gic_irq_domain_translate,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.alloc = gic_irq_domain_alloc,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.free = irq_domain_free_irqs_top,
    </p>
    <p>
      <b>}; </b>
    </p>
    <p>
      
    </p>
    <p>
      <b><font color="#e40b0b">translate&#x7684;&#x76ee;&#x7684;&#x662f;&#x6839;&#x636e;&#x5177;&#x4f53;&#x7684;&#x5b9a;&#x4e49;&#x5c06;&#x67d0;&#x4e2a;device&#x5b9a;&#x4e49;&#x7684;&#x4e2d;&#x65ad;&#x7684;hw irq number&#x548c;&#x4e2d;&#x65ad;&#x7c7b;&#x578b;&#x7ed9;&#x7ffb;&#x8bd1;&#x51fa;&#x6765;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1527411125344" FOLDED="true" ID="ID_409779998" MODIFIED="1589521684785">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>if (irq_domain_is_hierarchy(domain)) {</b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/*
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* If we've already configured this interrupt,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* don't do it again, or hell will break loose.&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;virq = irq_find_mapping(domain, hwirq);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (virq)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return virq;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;virq = irq_domain_alloc_irqs(domain, 1, NUMA_NO_NODE, fwspec);&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (virq &lt;= 0)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return 0;
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;} else { </b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* Create mapping */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;virq = irq_create_mapping(domain, hwirq);&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (!virq)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return virq;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0; <b>}</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527411332728" ID="ID_697599536" MODIFIED="1527411413280">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      virq = irq_find_mapping(domain, hwirq);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (virq)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return virq;
    </p>
    <p>
      
    </p>
    <p>
      &#x5148;&#x662f;&#x5229;&#x7528;hwirq&#x4f5c;&#x4e3a;&#x7d22;&#x5f15;&#x5230;domain&#x7684;&#x7ebf;&#x6027;&#x6620;&#x5c04;&#x8868;&#x91cc;&#x9762;&#x67e5;&#x627e;&#x5bf9;&#x5e94;&#x7684;virq,
    </p>
    <p>
      &#x5982;&#x679c;&#x8fd4;&#x56de;&#x7684;&#x662f;0,&#x8bf4;&#x660e;&#x8be5;hwirq&#x6ca1;&#x6709;&#x505a;&#x8fc7;&#x6620;&#x5c04;&#xff0c;&#x7ee7;&#x7eed;&#x8fdb;&#x884c;&#x4e0b;&#x4e00;&#x6b65;&#x5904;&#x7406;&#xff0c;
    </p>
    <p>
      &#x5426;&#x5219;&#x5c31;&#x76f4;&#x63a5;&#x8fd4;&#x56de;&#x8be5;virq.
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527411431319" FOLDED="true" ID="ID_110680569" MODIFIED="1589521681345">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#dd0606">virq = irq_domain_alloc_irqs(domain, 1, NUMA_NO_NODE, fwspec);</font></b>
    </p>
    <p>
      
    </p>
    <p>
      <i><font color="#2912ed">static inline int irq_domain_alloc_irqs(struct irq_domain *domain, </font></i>
    </p>
    <p>
      <i><font color="#2912ed">&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int nr_irqs, int node, void *arg) </font></i>
    </p>
    <p>
      <i><font color="#2912ed">{&#xa0;&#xa0; </font></i>
    </p>
    <p>
      <i><font color="#2912ed">&#xa0;&#xa0;&#xa0;&#xa0;return __irq_domain_alloc_irqs(domain, -1, nr_irqs, node, </font></i><font color="#eb15da" size="4"><b>arg</b></font><i><font color="#2912ed">, false); </font></i>
    </p>
    <p>
      <i><font color="#2912ed">} </font></i>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#161b13"><b>int __irq_domain_alloc_irqs(struct irq_domain *domain, int irq_base, </b></font>
    </p>
    <p>
      <font color="#161b13"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int nr_irqs, int node, void *arg, </b></font>
    </p>
    <p>
      <font color="#161b13"><b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;bool realloc)</b></font>
    </p>
    <p>
      <b>&#x91cd;&#x70b9;&#x5206;&#x6790;&#x4e00;&#x4e0b;&#x51fd;&#x6570;__irq_domain_alloc_irqs</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527411965790" FOLDED="true" ID="ID_1301998201" MODIFIED="1589521680175">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>virq = irq_domain_alloc_descs(irq_base, nr_irqs, 0, node);</b>
    </p>
    <p>
      
    </p>
    <p>
      &#x770b;&#x4e00;&#x4e0b;&#x8be5;&#x51fd;&#x6570;&#x7684;&#x5b9a;&#x4e49;:
    </p>
    <p>
      static int irq_domain_alloc_descs(int virq, unsigned int cnt,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t hwirq, int node)
    </p>
    <p>
      &#x8fd9;&#x91cc;&#x4f20;&#x9012;&#x8fdb;&#x6765;&#x7684;&#x53c2;&#x6570;virq&#x662f;-1
    </p>
    <p>
      
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x9996;&#x5148;&#x8ba1;&#x7b97;&#x6c42;virq&#x9700;&#x8981;&#x7684;hint&#x503c;
    </p>
    <p>
      hint = hwirq % nr_irqs;&#xa0;&#xa0;&#x7531;&#x4e8e;&#x4f20;&#x9012;&#x8fdb;&#x6765;&#x7684;hwirq&#x662f;0,&#x6240;&#x4ee5;hint&#x503c;&#x4e5f;&#x662f;0
    </p>
    <p>
      &#x5176;&#x6b21;&#x8ba1;&#x7b97;virq&#x503c;&#xff1a; <b>virq = irq_alloc_descs_from(hint, cnt, node);</b>
    </p>
    <p>
      &#x6700;&#x540e;&#x8fd4;&#x56de;virq&#x503c;
    </p>
    <p>
      
    </p>
    <p>
      &#x770b;&#x770b;irq_alloc_descs_from&#x7684;&#x5b9a;&#x4e49;&#xff1a;
    </p>
    <p>
      #define irq_alloc_descs_from(from, cnt, node)&#xa0;&#xa0;irq_alloc_descs(-1, from, cnt, node)
    </p>
    <p>
      #define irq_alloc_descs(irq, from, cnt, node)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__irq_alloc_descs(irq, from, cnt, node, THIS_MODULE)
    </p>
    <p>
      
    </p>
    <p>
      <b>&#x4e0b;&#x9762;&#x5206;&#x6790;&#x4e00;&#x4e0b;&#x51fd;&#x6570; &#xa0;__irq_alloc_descs</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527425092605" ID="ID_473845698" MODIFIED="1527425224302">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      start = bitmap_find_next_zero_area(allocated_irqs, IRQ_BITMAP_BITS,&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;from, cnt, 0);
    </p>
    <p>
      
    </p>
    <p>
      &#x4ece;&#x5168;&#x5c40;&#x53d8;&#x91cf;allocated_irqs&#x91cc;&#x9762;&#x627e;&#x8fd8;&#x6ca1;&#x6709;&#x4f7f;&#x7528;&#x7684;&#x90a3;&#x4e2a;bit&#x6700;&#x4e3a;virq,&#x8fd4;&#x56de;&#x503c;&#x662f;start
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527425227723" FOLDED="true" ID="ID_731074720" MODIFIED="1589521678963">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      alloc_descs(start, cnt, node, owner)
    </p>
    <p>
      
    </p>
    <p>
      &#x5206;&#x914d;&#x4e00;&#x4e2a;irq_desc, &#x5206;&#x914d;&#x7684;virq&#x5373;start&#x503c;&#x4f1a;&#x653e;&#x7f6e;&#x5230;irq_desc&#x91cc;&#x9762;&#x7684;irq_data.irq&#x4e2d;
    </p>
  </body>
</html></richcontent>
<node CREATED="1527425370338" ID="ID_644120596" MODIFIED="1558838927574">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#d41717">desc = alloc_desc(start + i, node, owner); </font></b>
    </p>
    <p>
      <b><font color="#d41717">irq_insert_desc(start + i, desc);</font></b>
    </p>
    <p>
      
    </p>
    <p>
      irq_insert_desc&#x4f1a;&#x5c06;&#x65b0;&#x5206;&#x914d;&#x7684;irq_desc&#x63d2;&#x5165;&#x5230;radix tree&#x91cc;&#x9762;:
    </p>
    <p>
      static void irq_insert_desc(unsigned int irq, struct irq_desc *desc)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;radix_tree_insert(&amp;<b><font size="4" color="#171fef"><i>irq_desc_tree</i></font></b>, irq, desc);
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ec8f12" DESTINATION="ID_644120596" ENDARROW="None" ENDINCLINATION="-523;0;" ID="Arrow_ID_239927436" SOURCE="ID_294330468" STARTARROW="None" STARTINCLINATION="6749;0;"/>
</node>
</node>
</node>
<node CREATED="1527425863295" ID="ID_1276924023" MODIFIED="1527435209552">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>irq_domain_alloc_irq_data(domain, virq, nr_irqs) </b>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#eb1414">&#x6839;&#x636e;virq&#x83b7;&#x5f97;&#x5bf9;&#x5e94;&#x7684;irq_desc&#xff0c;&#x7136;&#x540e;&#x5c06;domain&#x8d4b;&#x503c;&#x7ed9;irq_desc-&gt;irq_data-&gt;domain</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527425892815" FOLDED="true" ID="ID_1125790496" MODIFIED="1589521676998">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i><font color="#2910f1">ret = irq_domain_alloc_irqs_recursive(domain, virq, nr_irqs, </font></i><font color="#ef20e8" size="4">arg</font><i><font color="#2910f1">); </font></i></b>
    </p>
    <p>
      
    </p>
    <p>
      <font color="#f31927">&#x8fd9;&#x4e2a;&#x51fd;&#x6570;&#x4f1a;&#x8c03;&#x7528;gic irq domain&#x7684;domain-&gt;ops-&gt;alloc&#xff0c;&#x5373;gic_irq_domain_alloc</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527436344554" FOLDED="true" ID="ID_1793058367" MODIFIED="1589521675967">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#ea0c0c">&#x5206;&#x6790;&#x4e00;&#x4e0b;&#x51fd;&#x6570;:</font></b>
    </p>
    <p>
      
    </p>
    <p>
      <b>static int gic_irq_domain_alloc(</b>struct irq_domain *domain, unsigned int virq,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned int nr_irqs, void *arg<b>)</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527436564363" ID="ID_1340403668" MODIFIED="1527436930108">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      unsigned int type = IRQ_TYPE_NONE;
    </p>
    <p>
      struct irq_fwspec *fwspec = arg;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527436955003" ID="ID_1654939506" MODIFIED="1558765881966">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>gic_irq_domain_translate(domain, fwspec, &amp;hwirq, &amp;type);</b>
    </p>
    <p>
      <font color="#e00e0e"><i>&#x8be5;&#x51fd;&#x6570;&#x5c31;&#x662f;&#x5229;&#x7528;fwspec&#x5373;&#x8bbe;&#x5907;&#x6811;&#x8282;&#x70b9;&#x7684;&#x4fe1;&#x606f;&#xff0c;&#x5c06;&#x5f53;&#x524d;&#x8bbe;&#x5907;&#x7684;hwirq&#x548c;&#x5bf9;&#x5e94; </i></font>
    </p>
    <p>
      <font color="#e00e0e"><i>&#x7684;&#x4e2d;&#x65ad;&#x7684;&#x51fa;&#x53d1;&#x65b9;&#x5f0f;&#x7ed9;&#x5206;&#x6790;&#x51fa;&#x6765;&#x3002;</i></font>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#2d0de3" DESTINATION="ID_1654939506" ENDARROW="None" ENDINCLINATION="-1557;-56;" ID="Arrow_ID_976223014" SOURCE="ID_155513541" STARTARROW="None" STARTINCLINATION="-236;265;"/>
</node>
<node CREATED="1527437196531" FOLDED="true" ID="ID_1554333839" MODIFIED="1589521673039">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      for (i = 0; i &lt; nr_irqs; i++)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;gic_irq_domain_map(domain, virq + i, hwirq + i);&#xa0;&#xa0; &#x8be5;&#x51fd;&#x6570;&#x7684;&#x5177;&#x4f53;&#x7ec6;&#x8282;&#x6709;&#x7a7a;&#x5206;&#x6790;&#xff0c;&#x4e3b;&#x8981;&#x505a;&#x5982;&#x4e0b;&#x5185;&#x5bb9;&#xff1a;
    </p>
    <p>
      
    </p>
    <p>
      &#x6839;&#x636e;virq&#x627e;&#x5230;&#x5bf9;&#x5e94;&#x7684;irq_desc&#xff0c;&#x5c06;hwirq&#x5b58;&#x653e;&#x5230;irq_desc&#x7684;irq_data.hwirq&#x4e2d;
    </p>
    <p>
      &#x5c06;irq chip&#x5b58;&#x653e;&#x5230;irq_desc&#x7684;irq_data.chip&#x4e2d;
    </p>
    <p>
      &#x5bf9;&#x4e8e;PPI&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad;&#xff08;hwirq&lt;32&#xff09;&#xff0c;&#x5c06;irq_desc&#x7684;handle_irq&#x8bbe;&#x7f6e;&#x4e3a;handle_percpu_devid_irq
    </p>
    <p>
      &#x5bf9;&#x4e8e;SPI&#x7c7b;&#x578b;&#x7684;&#x4e2d;&#x65ad;&#xff0c;&#x5c06;irq_desc&#x7684;handle_irq&#x8bbe;&#x7f6e;&#x4e3a;handle_fasteoi_irq
    </p>
    <p>
      
    </p>
    <p>
      <b>&#x51fd;&#x6570;&#x539f;&#x578b;&#xff1a;</b>
    </p>
    <p>
      static int gic_irq_domain_map(struct irq_domain *d, unsigned int irq,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t hw)
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#ab16e5" DESTINATION="ID_1554333839" ENDARROW="None" ENDINCLINATION="-1732;163;" ID="Arrow_ID_471294536" SOURCE="ID_1243709452" STARTARROW="None" STARTINCLINATION="7478;0;"/>
<node CREATED="1550935275559" ID="ID_564855156" MODIFIED="1558862093525">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4"><b>struct irq_chip *chip = &amp;gic_chip; </b></font>
    </p>
    <p>
      
    </p>
    <p>
      static struct irq_chip gic_chip = {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.name&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= "GIC",
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.irq_mask&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= gic_mask_irq,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.irq_unmask&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= gic_unmask_irq,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.irq_eoi&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= gic_eoi_irq,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.irq_set_type&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= gic_set_type,
    </p>
    <p>
      #ifdef CONFIG_SMP
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.irq_set_affinity&#xa0;&#xa0;&#xa0;= gic_set_affinity,
    </p>
    <p>
      #endif&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.irq_get_irqchip_state&#xa0;&#xa0;= gic_irq_get_irqchip_state,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.irq_set_irqchip_state&#xa0;&#xa0;= gic_irq_set_irqchip_state,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.flags&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= IRQCHIP_SET_TYPE_MASKED |
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;IRQCHIP_SKIP_SET_WAKE |
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;IRQCHIP_MASK_ON_SUSPEND,
    </p>
    <p>
      };
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      &#x83b7;&#x53d6;irq_chip
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#eb4c30" DESTINATION="ID_564855156" ENDARROW="None" ENDINCLINATION="-375;154;" ID="Arrow_ID_524632377" SOURCE="ID_410834686" STARTARROW="None" STARTINCLINATION="8221;0;"/>
</node>
<node CREATED="1550935363432" ID="ID_867725001" MODIFIED="1550935557918">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      if (static_key_true(&amp;<b><font color="#e91616">supports_deactivate</font></b>)) {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (d-&gt;host_data == (void *)&amp;gic_data[0])
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;chip = &amp;gic_eoimode1_chip;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;}&#xa0;
    </p>
    <p>
      
    </p>
    <p>
      supports_deactivate&#x5728;gic&#x7684;&#x521d;&#x59cb;&#x5316;&#x4ee3;&#x7801;&#x91cc;&#x9762;&#x4f1a;&#x88ab;&#x4fee;&#x6539;
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#3a1cf1" DESTINATION="ID_596485602" ENDARROW="None" ENDINCLINATION="5684;0;" ID="Arrow_ID_1382277748" STARTARROW="None" STARTINCLINATION="3111;0;"/>
</node>
<node CREATED="1550935961929" FOLDED="true" ID="ID_966206397" MODIFIED="1589521670589" TEXT="&#x5982;&#x679c;hw&#x5c0f;&#x4e8e;32,&#x505a;&#x5982;&#x4e0b;&#x7684;&#x5904;&#x7406;">
<node CREATED="1550936361415" ID="ID_1067300400" MODIFIED="1551002325191">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_set_percpu_devid(irq);
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x7684;&#x4f5c;&#x7528;&#xff1a;
    </p>
    <p>
      &#x5206;&#x914d;&#x8be5;irq&#x5bf9;&#x5e94;&#x7684;irq_desc&#x91cc;&#x9762;&#x7684;percpu_enable&#x6210;&#x5458;
    </p>
    <p>
      desc-&gt;percpu_enabled = kzalloc(sizeof(*desc-&gt;percpu_enabled), GFP_KERNEL);
    </p>
    <p>
      &#x5c06;&#x6807;&#x5fd7;&#x4f4d;
    </p>
    <p>
      IRQ_NOAUTOEN | IRQ_PER_CPU | IRQ_NOTHREAD | IRQ_NOPROBE | IRQ_PER_CPU_DEVID
    </p>
    <p>
      &#x8bbe;&#x7f6e;&#x7ed9;irq_desc&#x91cc;&#x9762;&#x7684;status_use_accessors
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1551013116139" FOLDED="true" ID="ID_238080196" MODIFIED="1589521669408">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_domain_set_info(d, irq, hw, chip, d-&gt;host_data,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;<b><font color="#e21515">&#xa0;handle_percpu_devid_irq</font></b>, NULL, NULL);
    </p>
    <p>
      
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x6709;&#x4e24;&#x79cd;&#x7248;&#x672c;&#xff0c;&#x5f53;&#x6709;gic&#x7ea7;&#x8054;&#x7684;&#x65f6;&#x5019;&#x662f;&#x4e00;&#x4e2a;&#x7248;&#x672c;&#xff0c;&#x5355;&#x4e2a;gic&#x7684;&#x65f6;&#x5019;&#x662f;&#x53e6;&#x4e00;&#x4e2a;&#x7248;&#x672c;
    </p>
    <p>
      &#x6211;&#x4eec;&#x770b;&#x4e00;&#x4e0b;&#x53ea;&#x6709;&#x5355;&#x4e2a;gic&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#x662f;&#x5982;&#x4f55;&#x5904;&#x7406;&#x7684;&#xff0c;&#x8be5;&#x51fd;&#x6570;&#x7684;&#x539f;&#x578b;&#x5982;&#x4e0b;&#x6240;&#x793a;
    </p>
    <p>
      
    </p>
    <p>
      <b>void irq_domain_set_info(</b>struct irq_domain *domain, unsigned int virq,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_hw_number_t hwirq, struct irq_chip *chip,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *chip_data, irq_flow_handler_t handler,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;void *handler_data, const char *handler_name<b>)</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1551013589318" ID="ID_1231840870" MODIFIED="1551013822395">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_domain_set_hwirq_and_chip(domain, virq, hwirq, chip, chip_data);
    </p>
    <p>
      
    </p>
    <p>
      &#x901a;&#x8fc7;virq&#x627e;&#x5230;irq_desc, &#x518d;&#x6839;&#x636e;irq_desc&#x627e;&#x5230;irq_data, &#x7136;&#x540e;&#x628a;hwirq&#xff0c; chip, chip_data&#x90fd;&#x8d4b;&#x503c;&#x7ed9;irq_data&#x91cc;&#x9762;&#x5bf9;&#x5e94;&#x7684;&#x53d8;&#x91cf;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1551014428097" ID="ID_111366751" MODIFIED="1558786846969">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      __irq_set_handler(virq, handler, 0, handler_name)
    </p>
    <p>
      
    </p>
    <p>
      &#x5c06;handler&#x53e5;&#x67c4;&#x8d4b;&#x503c;&#x7ed9;Irq_desc&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x7684;handle_irq&#x6210;&#x5458;&#x53d8;&#x91cf;
    </p>
    <p>
      
    </p>
    <p>
      &#x8bbe;&#x7f6e;&#x4e2d;&#x65ad;&#x6d41;&#x63a7;&#x5c42;&#x7684;&#x5904;&#x7406;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1551014772450" ID="ID_1740418740" MODIFIED="1551014795023">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_set_handler_data(virq, handler_data)
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1558766726173" ID="ID_47352372" MODIFIED="1558766735931">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_set_status_flags(irq, IRQ_NOAUTOEN)
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1550935994064" FOLDED="true" ID="ID_1863493860" MODIFIED="1589521671941" TEXT="&#x5982;&#x679c;hw&#x5927;&#x4e8e;&#x6216;&#x8005;&#x7b49;&#x4e8e;32,&#x505a;&#x5982;&#x4e0b;&#x7684;&#x5904;&#x7406;">
<node CREATED="1558766680832" ID="ID_1693166322" MODIFIED="1558786869064">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      irq_domain_set_info(d, irq, hw, chip, d-&gt;host_data,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;<b><font color="#df0808">handle_fasteoi_irq</font></b>, NULL, NULL);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1558766709789" ID="ID_387190899" MODIFIED="1558766712619" TEXT="irq_set_probe(irq)"/>
</node>
</node>
</node>
</node>
<node CREATED="1527425930857" ID="ID_1617007979" MODIFIED="1558787499116">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>for (i = 0; i &lt; nr_irqs; i++) </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;irq_domain_insert_irq(virq + i); </b>
    </p>
    <p>
      
    </p>
    <p>
      &#x5c06;hwirq&#x548c;virq&#x7684;&#x6620;&#x5c04;&#x5173;&#x7cfb;&#x5b58;&#x653e;&#x5230;irq_domain&#x5f53;&#x4e2d;&#xff0c;&#x8fd9;&#x6837;&#x5728;&#x9700;&#x8981;&#x7684;&#x65f6;&#x5019;&#x5c31;&#x53ef;&#x4ee5;
    </p>
    <p>
      &#x6839;&#x636e;virq&#x627e;&#x5230;hwirq
    </p>
    <p>
      
    </p>
    <p>
      &#x603b;&#x7684;&#x903b;&#x8f91;&#x662f;&#xff1a;&#x9996;&#x5148;&#x6839;&#x636e;virq&#x627e;&#x5230;hw irq number
    </p>
    <p>
      &#x5982;&#x679c;hwirq &lt; domain-&gt;revmap_size &#x90a3;&#x4e48;&#x5c06;&#x865a;&#x62df;&#x7684;irq number&#x8ddf;hw irq number&#x7684;&#x6620;&#x5c04;
    </p>
    <p>
      &#x5173;&#x7cfb;&#x653e;&#x7f6e;&#x5230;&#x7ebf;&#x6027;&#x8868;linear_revmap&#x91cc;&#x9762;
    </p>
    <p>
      &#x5426;&#x5219;&#x653e;&#x7f6e;&#x5230;revmap_tree&#x91cc;&#x9762;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1527390532583" ID="ID_38128940" MODIFIED="1527390569416">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5c06;&#x83b7;&#x53d6;&#x7684;virq&#x5c01;&#x88c5;&#x5230;resource&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;
    </p>
    <p>
      
    </p>
    <p>
      r-&gt;start = r-&gt;end = irq;
    </p>
    <p>
      r-&gt;flags = IORESOURCE_IRQ | irqd_get_trigger_type(irq_get_irq_data(irq));
    </p>
    <p>
      r-&gt;name = name ? name : of_node_full_name(dev);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1478500026300" ID="ID_952265035" MODIFIED="1478500107403">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct property{
    </p>
    <p>
      char&#xa0;&#xa0;&#xa0;&#xa0;*name;
    </p>
    <p>
      int length;
    </p>
    <p>
      void&#xa0;&#xa0;&#xa0;&#xa0;*value;
    </p>
    <p>
      struct property *next;
    </p>
    <p>
      unsigned long _flags;
    </p>
    <p>
      unsigned int unique_id;
    </p>
    <p>
      struct bin_attribute attr;
    </p>
    <p>
      }
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1477571737937" ID="ID_1179490711" MODIFIED="1477571937126">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.&#x8c03;&#x7528;&#x51fd;&#x6570;early_init_dt_scan_nodes() </b>
    </p>
    <p>
      &#x83b7;&#x53d6;chosen node&#x5f53;&#x4e2d;&#x5b9a;&#x4e49;&#x7684;boorargs, initrd&#x7b49;&#x5c5e;&#x6027;&#x7684;
    </p>
    <p>
      &#x503c;&#xff0c;&#x5e76;&#x5c06;&#x5176;&#x4fdd;&#x5b58;&#x5728;&#x5168;&#x5c40;&#x53d8;&#x91cf;boot_command_line,
    </p>
    <p>
      initrd_start, initrd_end&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1477572269455" ID="ID_34712258" MODIFIED="1477572294312">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.&#x8c03;&#x7528;unflatten_device_tree() </b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1477572744234" FOLDED="true" ID="ID_39425452" MODIFIED="1589521717189">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3.&#x5982;&#x4f55;&#x751f;&#x6210;platform_device&#xff1f; </b>
    </p>
    <p>
      <b>asmlinkage __visible void __init start_kernel(void)</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1477573129745" FOLDED="true" ID="ID_1218217887" MODIFIED="1589521716223">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x51fd;&#x6570;&#x7684;&#x672b;&#x5c3e;&#x8c03;&#x7528;&#x4e86;&#x51fd;&#x6570;rest_init(void)
    </p>
  </body>
</html></richcontent>
<node CREATED="1477573238345" ID="ID_464431570" MODIFIED="1477573759685">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5206;&#x6790;&#x4e00;&#x4e0b;&#x51fd;&#x6570;kernel_thread(kernel_init, NULL, CLONE_FS)
    </p>
    <p>
      kernel_init&#x51fd;&#x6570;&#x8c03;&#x7528;&#x4e86;kernel_init_freeable&#x51fd;&#x6570;,
    </p>
    <p>
      kernel_init_freeable&#x51fd;&#x6570;&#x8c03;&#x7528;&#x4e86;do_basic_setup&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      do_basic_setup&#x8c03;&#x7528;&#x4e86;&#x51fd;&#x6570;do_initcalls
    </p>
    <p>
      &#x9010;&#x4e2a;&#x8c03;&#x7528;static initcall_t *initcall_levels[]&#x4e2d;&#x5b9a;&#x4e49;&#x7684;&#x51fd;&#x6570;,
    </p>
    <p>
      &#x5728;&#x8fd9;&#x4e2a;&#x8fc7;&#x7a0b;&#x5f53;&#x4e2d;&#x6700;&#x7ec8;&#x8c03;&#x7528;&#x4e86;&#x51fd;&#x6570;static int __init customize_machine(void)
    </p>
    <p>
      static int __init customize_machine(void)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;/*&#xa0;&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* customizes platform devices, or adds new ones
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* On DT based machines, we fall back to populating the
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* machine from the device tree, if no callback is provided,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* otherwise we would always need an init_machine callback.
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;if (machine_desc-&gt;init_machine)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; <b>machine_desc-&gt;init_machine();</b>
    </p>
    <p>
      #ifdef CONFIG_OF
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;else
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;of_platform_populate(NULL, of_default_bus_match_table,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;NULL, NULL);
    </p>
    <p>
      #endif
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return 0;
    </p>
    <p>
      }
    </p>
    <p>
      &#x6700;&#x7ec8;&#x6211;&#x4eec;&#x8fd8;&#x662f;&#x8981;&#x770b;machine&#x63cf;&#x8ff0;&#x7b26;&#x5f53;&#x4e2d;&#x5b9a;&#x4e49;&#x7684;init_machine&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#e30707" DESTINATION="ID_692268297" ENDARROW="Default" ENDINCLINATION="450;0;" ID="Arrow_ID_1021825940" STARTARROW="None" STARTINCLINATION="450;0;"/>
</node>
</node>
</node>
</node>
<node CREATED="1477640364241" FOLDED="true" ID="ID_706701660" MODIFIED="1589521722152">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>Tips&#x5c0f;&#x77e5;&#x8bc6;</i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1477640390721" FOLDED="true" ID="ID_335979122" MODIFIED="1589521721069">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      bases.c&#x6587;&#x4ef6;&#x5f53;&#x4e2d;&#x7684;&#x51fd;&#x6570;
    </p>
    <p>
      int of_n_addr_cells(struct device_node *np)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const __be32 *ip;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;do {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (np-&gt;parent)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;np = np-&gt;parent;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;ip = of_get_property(np, "#address-cells", NULL);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;if (ip)
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return be32_to_cpup(ip);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;} while (np-&gt;parent);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;return OF_ROOT_NODE_ADDR_CELLS_DEFAULT;
    </p>
    <p>
      }
    </p>
    <p>
      &#x53ef;&#x89c1;&#x5bf9;&#x4e8e;#address-cells&#x7684;&#x5b9a;&#x4e49;&#x662f;&#x9876;&#x5c42;&#x7684;&#x8282;&#x70b9;&#x51b3;&#x5b9a;&#x7684;
    </p>
  </body>
</html></richcontent>
<node CREATED="1502940839909" ID="ID_1548033348" MODIFIED="1502940888359">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      The <b>#address-cells</b>&#xa0;property indicate how many cells (i.e 32 bits values)
    </p>
    <p>
      are needed to form the base address part in the reg property.
    </p>
    <p>
      The <b>#size-cells</b>&#xa0;is the same, for the size part of the reg property.
    </p>
    <p>
      The <b>ranges</b>&#xa0;property can describe an address translation between the child bus and the parent bus.
    </p>
    <p>
      When simply defined as ranges;,
    </p>
    <p>
      it means that the translation is an identity translation.
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1490085626105" FOLDED="true" ID="ID_136194061" MODIFIED="1526974310119" TEXT="&#x5185;&#x6838;&#x6587;&#x6863;interrupts.txt&#x9605;&#x8bfb;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1490086793556" ID="ID_700313303" MODIFIED="1490088085359">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x4e2d;&#x65ad;&#x5ba2;&#x6237;&#x8282;&#x70b9;
    </p>
    <p>
      &#x7528;&#x4e8e;&#x63cf;&#x8ff0;&#x53ef;&#x4ee5;&#x4ea7;&#x751f;&#x4e2d;&#x65ad;&#x7684;&#x8bbe;&#x5907;&#x8282;&#x70b9;&#x5fc5;&#x987b;&#x5305;&#x542b;&#x5c5e;&#x6027;"interrupts"&#x548c;&#x5c5e;&#x6027;"interrupts-extended"&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x4e0a;&#x9762;&#x4e24;&#x4e2a;&#x5c5e;&#x6027;&#x90fd;&#x51fa;&#x73b0;&#x4e86;&#xff0c;&#x90a3;&#x4e48;&#x5e94;&#x8be5;&#x4f18;&#x5148;&#x4f7f;&#x7528;interrupts-extended&#x5c5e;&#x6027;&#xff0c;&#x8fd9;&#x4e9b;&#x5c5e;&#x6027;&#x5305;&#x542b;
    </p>
    <p>
      &#x4e86;&#x4e00;&#x4e2a;&#x4e2d;&#x65ad;&#x8bf4;&#x660e;&#x7b26;&#x5217;&#x8868;&#x3002;&#x4e2d;&#x65ad;&#x8bf4;&#x660e;&#x7b26;&#x7684;&#x683c;&#x5f0f;&#x5e94;&#x8be5;&#x6839;&#x636e;&#x5177;&#x4f53;&#x7684;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x8fdb;&#x884c;&#x786e;&#x5b9a;&#x3002;
    </p>
    <p>
      &#x4e3e;&#x4f8b;&#x8bf4;&#x660e;:
    </p>
    <p>
      Example:
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;interrupt-parent = &lt;&amp;intc1&gt;;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;interrupts = &lt;5 0&gt;, &lt;6 0&gt;;
    </p>
    <p>
      interrupt-parent&#x7528;&#x4e8e;&#x6307;&#x5b9a;&#x8be5;&#x4e2d;&#x65ad;&#x6240;&#x8def;&#x7531;&#x5230;&#x7684;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#xff0c;&#x8be5;&#x5c5e;&#x6027;&#x5305;&#x542b;&#x4e86;&#x4e00;&#x4e2a;&#x6307;&#x5411;&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x63a7;&#x5236;&#x5668;&#x7684;&#x5f15;&#x7528;&#x3002;
    </p>
    <p>
      &#x5f53;&#x8bbe;&#x5907;&#x8282;&#x70b9;&#x7684;&#x4e2d;&#x65ad;&#x9700;&#x8981;&#x88ab;&#x8def;&#x7531;&#x5230;&#x4e0d;&#x540c;&#x7684;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x4e0a;&#x9762;&#xff0c;&#x90a3;&#x4e48;&#x5c31;&#x9700;&#x8981;&#x4f7f;&#x7528;&#x5c5e;&#x6027;interrupts-extended&#x3002;
    </p>
    <p>
      interrupts-extended = &lt;&amp;intc1 5 1&gt;, &lt;&amp;intc2 1 0&gt;;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1490088088985" FOLDED="true" ID="ID_1548402338" MODIFIED="1526974307475">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x8282;&#x70b9;
    </p>
    <p>
      &#x4e00;&#x4e2a;&#x8bbe;&#x5907;&#x53ef;&#x4ee5;&#x901a;&#x8fc7;&#x5c5e;&#x6027;"interrupt-controller"&#x88ab;&#x6307;&#x5b9a;&#x4e3a;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#xff0c;
    </p>
    <p>
      &#x5c5e;&#x6027;"#interrupt-cells"&#x7528;&#x4e8e;&#x8bf4;&#x660e;&#x6307;&#x5b9a;&#x4e00;&#x4e2a;&#x5355;&#x72ec;&#x7684;&#x4e2d;&#x65ad;&#x6240;&#x9700;&#x8981;&#x7684;cell&#x7684;&#x6570;&#x91cf;&#x3002;
    </p>
    <p>
      &#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;bindings&#x6587;&#x6863;&#x6709;&#x8d23;&#x4efb;&#x8bf4;&#x660e;&#x4e2d;&#x65ad;&#x63cf;&#x8ff0;&#x7b26;&#x7684;&#x957f;&#x5ea6;&#x548c;&#x683c;&#x5f0f;&#x3002;
    </p>
    <p>
      "#interrupt-cells"&#x5c5e;&#x6027;&#xff1a;
    </p>
    <p>
      1.&#x5982;&#x679c;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;1,&#x90a3;&#x4e48;&#x5355;&#x72ec;&#x7684;&#x4e00;&#x4e2a;cell&#x4ee3;&#x8868;&#x8be5;&#x4e2d;&#x65ad;&#x5728;&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x5f53;&#x4e2d;&#x7684;&#x7d22;&#x5f15;&#x53f7;
    </p>
    <p>
      2.&#x5982;&#x679c;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;2,&#x90a3;&#x4e48;&#x7b2c;&#x4e00;&#x4e2a;cell&#x4ee3;&#x8868;&#x4e2d;&#x65ad;&#x7684;&#x7d22;&#x5f15;&#xff0c;&#x7b2c;&#x4e8c;&#x4e2a;cell&#x4ee3;&#x8868;&#x89e6;&#x53d1;&#x7c7b;&#x578b;
    </p>
  </body>
</html></richcontent>
<node CREATED="1490090489545" ID="ID_1343084727" MODIFIED="1490093566226">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e00;&#x822c;&#x5730;&#x5bf9;&#x4e8e;&#x4f7f;&#x7528;arm gic&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#x7684;&#x82af;&#x7247;&#xff0c;&#x53c2;&#x8003;&#x6587;&#x6863;arm/gic.txt&#xff0c;
    </p>
    <p>
      GIC&#x53ef;&#x4ee5;&#x63d0;&#x4f9b;PPI&#xff0c; SPI&#xff0c;SGI&#x4e09;&#x79cd;&#x4e2d;&#x65ad;&#x7ed9;cpu.
    </p>
    <p>
      &#x5bf9;&#x4e8e;GIC&#x4e2d;&#x65ad;&#x63a7;&#x5236;&#x5668;&#xff0c;#interrupt-cells&#x901a;&#x5e38;&#x88ab;&#x8bbe;&#x7f6e;&#x6210;3
    </p>
    <p>
      &#x7b2c;&#x4e00;&#x4e2a;cell&#x4ee3;&#x8868;&#x4e2d;&#x65ad;&#x7c7b;&#x578b;&#xff0c;0&#x4ee3;&#x8868;SPI&#x4e2d;&#x65ad;&#xff0c;1&#x4ee3;&#x8868;PPI&#x4e2d;&#x65ad;
    </p>
    <p>
      &#x7b2c;&#x4e8c;&#x4e2a;cell&#x4ee3;&#x8868;&#x4e2d;&#x65ad;&#x53f7;&#xff0c;[0-987]SPI&#xff0c; [0-15]PPI
    </p>
    <p>
      &#x7b2c;&#x4e09;&#x4e2a;cell&#x4ee3;&#x8868;&#x89e6;&#x53d1;&#x7c7b;&#x578b;&#xff0c;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1486555663162" FOLDED="true" ID="ID_217587555" MODIFIED="1507898998356" POSITION="left" TEXT="SDIO&#x9a71;&#x52a8;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1486555676946" ID="ID_1961085868" MODIFIED="1486555688485" TEXT="sdio&#x6574;&#x4f53;&#x67b6;&#x6784;">
<node CREATED="1486557770538" ID="ID_278806248" MODIFIED="1486557779967" TEXT="1.sdio&#x4fe1;&#x53f7;&#x5b9a;&#x4e49;">
<node CREATED="1486557814898" ID="ID_1323346593" MODIFIED="1486557958763">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      sdio&#x5361;&#x7684;&#x7c7b;&#x578b;
    </p>
    <p>
      1.&#x5168;&#x901f;&#x5361;&#x6a21;&#x5f0f;&#x652f;&#x6301;spi, 1-data, 4-data&#x4f20;&#x8f93;&#x6a21;&#x5f0f;,
    </p>
    <p>
      &#x5168;&#x901f;&#x6a21;&#x5f0f;&#x7684;&#x6570;&#x636e;&#x4f20;&#x8f93;&#x901f;&#x7387;&#x53ef;&#x4ee5;&#x8d85;&#x8fc7;100Mb/s
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1507899001252" ID="ID_162542934" MODIFIED="1507899023880" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Regmap&#x6846;&#x67b6;</b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1493174169787" ID="ID_720737300" MODIFIED="1493174502890" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#157450">&#x7279;&#x522b;&#x7ae0;&#x8282;: Linux&#x5f53;&#x4e2d;&#x7684;&#x521d;&#x59cb;&#x5316;&#x5b8f;&#x5b9a;&#x4e49;</font>
    </p>
    <p>
      http://blog.chinaunix.net/uid-25445243-id-3971724.html
    </p>
  </body>
</html></richcontent>
<font BOLD="true" ITALIC="true" NAME="SansSerif" SIZE="14"/>
</node>
<node CREATED="1494669711417" FOLDED="true" ID="ID_1554517447" MODIFIED="1524644160784" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#eb1818">Linux&#x65f6;&#x95f4;&#x5b50;&#x7cfb;&#x7edf;</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1494667527509" FOLDED="true" ID="ID_1100995725" MODIFIED="1495432464905">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>hrtimer &#x9ad8;&#x7cbe;&#x5ea6;&#x5b9a;&#x65f6;&#x5668; </b>
    </p>
    <p>
      &#x53c2;&#x8003;&#x7f51;&#x7ad9;: http://blog.csdn.net/droidphone/article/details/8074892
    </p>
  </body>
</html></richcontent>
<node CREATED="1494667609929" ID="ID_1521296380" MODIFIED="1494667705553">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4e0e;&#x4f20;&#x7edf;&#x5b9a;&#x65f6;&#x5668;&#x4f7f;&#x7528;&#x65f6;&#x95f4;&#x8f6e;&#x7b97;&#x6cd5;&#x4e0d;&#x540c;&#xff0c;hrtimer&#x4f7f;&#x7528;&#x4e86;
    </p>
    <p>
      &#x7ea2;&#x9ed1;&#x6811;&#x7b97;&#x6cd5;&#x3002;hrtimer&#x53ef;&#x4ee5;&#x914d;&#x7f6e;&#x6210;&#x9ad8;&#x7cbe;&#x5ea6;&#x548c;&#x4f4e;&#x7cbe;&#x5ea6;&#x4e24;&#x79cd;&#x6a21;&#x5f0f;&#xff0c;
    </p>
    <p>
      &#x5728;&#x5355;cpu&#x548c;&#x591a;cpu&#x5f53;&#x4e2d;&#x7684;&#x5b9e;&#x73b0;&#x4e5f;&#x6709;&#x533a;&#x522b;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494670266219" FOLDED="true" ID="ID_8380978" MODIFIED="1495432461985">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#dd0909">1.hrtimer&#x6570;&#x636e;&#x7ed3;&#x6784;</font></i>
    </p>
    <p>
      <font color="#0f5bea">struct hrtimer {</font>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct timerqueue_node&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;node;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ktime_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;_softexpires;&#x7528;&#x4e8e;&#x8bb0;&#x5f55;&#x4e0a;&#x4e00;&#x6b21;&#x5b9a;&#x65f6;&#x5668;&#x7684;&#x5230;&#x671f;&#x65f6;&#x95f4;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;enum hrtimer_restart&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*function)(struct hrtimer *);
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct hrtimer_clock_base&#xa0;&#xa0;&#xa0;*base;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;state;
    </p>
    <p>
      #ifdef CONFIG_TIMER_STATS
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;start_pid;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;void&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*start_site;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;char&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;start_comm[16];
    </p>
    <p>
      #endif
    </p>
    <p>
      };&#xa0;
    </p>
    <p>
      &#x5b9a;&#x65f6;&#x5668;&#x4e00;&#x65e6;&#x5230;&#x671f;&#xff0c;function&#x5b57;&#x6bb5;&#x6307;&#x5b9a;&#x7684;&#x56de;&#x8c03;&#x51fd;&#x6570;&#x4f1a;&#x88ab;&#x8c03;&#x7528;&#x5230;&#x3002;&#x8be5;&#x51fd;&#x6570;&#x7684;&#x8fd4;&#x56de;&#x503c;
    </p>
    <p>
      &#x662f;&#x4e00;&#x4e2a;&#x679a;&#x4e3e;&#x503c;&#xff0c;&#x51b3;&#x5b9a;&#x4e86;&#x8be5;timer&#x662f;&#x5426;&#x9700;&#x8981;&#x88ab;&#x91cd;&#x65b0;&#x542f;&#x52a8;&#x3002;
    </p>
    <p>
      <font color="#1e37f5">enum hrtimer_restart {</font>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;HRTIMER_NORESTART,&#xa0;&#xa0;/* Timer is not restarted */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;HRTIMER_RESTART,&#xa0;&#xa0;&#xa0;&#xa0;/* Timer must be restarted */
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<node CREATED="1494670976199" ID="ID_1827337545" MODIFIED="1494671125728">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      hrtimer&#x7684;&#x5230;&#x671f;&#x65f6;&#x95f4;&#x53ef;&#x4ee5;&#x57fa;&#x4e8e;&#x4ee5;&#x4e0b;&#x51e0;&#x79cd;&#x65f6;&#x95f4;&#x7cfb;&#x7edf;:
    </p>
    <p>
      enum&#xa0;&#xa0;hrtimer_base_type {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;HRTIMER_BASE_MONOTONIC,&#x5355;&#x8c03;&#x9012;&#x589e;&#xff0c;&#x4e0d;&#x5305;&#x542b;&#x4f11;&#x7720;&#x7684;&#x65f6;&#x95f4;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;HRTIMER_BASE_REALTIME,&#x5899;&#x4e0a;&#x771f;&#x5b9e;&#x65f6;&#x95f4;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;HRTIMER_BASE_BOOTTIME,&#x5355;&#x8c03;&#x9012;&#x589e;&#xff0c;&#x5305;&#x542b;&#x4f11;&#x7720;&#x65f6;&#x95f4;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;HRTIMER_BASE_TAI,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;HRTIMER_MAX_CLOCK_BASES,
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1494686743040" FOLDED="true" ID="ID_1079195272" MODIFIED="1495432458016">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#f00f0f">2.struct hrtimer_cpu_base&#x6570;&#x636e;&#x7ed3;&#x6784;</font></i>
    </p>
    <p>
      &#x5904;&#x4e8e;&#x6548;&#x7387;&#x548c;&#x4e0a;&#x9501;&#x7684;&#x8003;&#x8651;&#xff0c;&#x6bcf;&#x4e2a;cpu&#x5355;&#x72ec;&#x7ba1;&#x7406;&#x81ea;&#x5df1;&#x7684;hrtimer,
    </p>
    <p>
      &#x4e8e;&#x662f;&#x4e13;&#x95e8;&#x5b9a;&#x4e49;&#x4e86;hrtimer_cpu_base
    </p>
    <p>
      struct hrtimer_cpu_base {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;raw_spinlock_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;lock;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;active_bases;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;clock_was_set;
    </p>
    <p>
      #ifdef CONFIG_HIGH_RES_TIMERS
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ktime_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;expires_next;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;hres_active;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;hang_detected;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;nr_events;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;nr_retries;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;nr_hangs;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ktime_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;max_hang_time;
    </p>
    <p>
      #endif
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct hrtimer_clock_base&#xa0;&#xa0;&#xa0;clock_base[HRTIMER_MAX_CLOCK_BASES];
    </p>
    <p>
      };
    </p>
    <p>
      <i><font color="#1f2ce1">clock_base&#x6570;&#x7ec4;&#x4e3a;&#x6bcf;&#x79cd;&#x65f6;&#x95f4;&#x57fa;&#x51c6;&#x7cfb;&#x7edf;&#x90fd;&#x5b9a;&#x4e49;&#x4e86;&#x4e00;&#x4e2a;hrtimer_clock_base</font></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1494688244278" ID="ID_1909412585" MODIFIED="1494688529324">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font color="#d41212">struct hrtimer_clock_base</font></i>&#xa0;{
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct hrtimer_cpu_base *cpu_base; &#x6307;&#x5411;&#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x6240;&#x5c5e;&#x7684;cpu
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;index;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;clockid_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;clockid;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;struct timerqueue_head&#xa0;&#xa0;active;&#x7ea2;&#x9ed1;&#x6811;&#xff0c;&#x5305;&#x542b;&#x6240;&#x6709;&#x7684;&#x4f7f;&#x7528;&#x8be5;&#x65f6;&#x95f4;&#x57fa;&#x51c6;&#x7cfb;&#x7edf;&#x7684;hrtimer
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ktime_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;resolution;&#x65f6;&#x949f;&#x7684;&#x5206;&#x8fa8;&#x7387;&#xff0c;&#x4ee5;&#x7eb3;&#x79d2;&#x4e3a;&#x5355;&#x4f4d;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ktime_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;(*get_time)(void);&#x83b7;&#x53d6;&#x5f53;&#x524d;&#x7684;&#x65f6;&#x949f;&#x65f6;&#x95f4;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ktime_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;softirq_time;&#x8fd0;&#x884c;hrtimer&#x961f;&#x5217;&#x65f6;&#x5019;&#x7684;&#x65f6;&#x95f4;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;ktime_t&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;offset;
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494690405349" ID="ID_755594550" MODIFIED="1494690422382">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/cpu-hrtimer-architecture.png"/>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1494690947559" FOLDED="true" ID="ID_1347025302" MODIFIED="1495432459762">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3.hrtimer&#x7684;&#x4f7f;&#x7528;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1494691046699" ID="ID_120987351" MODIFIED="1494691153882">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x6dfb;&#x52a0;&#x4e00;&#x4e2a;hrtimer
    </p>
    <p>
      void hrtimer_init(struct hrtimer *timer, clockid_t clock_id,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;enum hrtimer_mode mode)
    </p>
    <p>
      &#x8bbe;&#x5b9a;&#x4e00;&#x4e2a;&#x56de;&#x8c03;&#x51fd;&#x6570;
    </p>
    <p>
      timer.function = hrcallback
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494691158719" ID="ID_1402665906" MODIFIED="1494727337037">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.&#x6fc0;&#x6d3b;&#x5b9a;&#x65f6;&#x5668;
    </p>
    <p>
      &#x5982;&#x679c;&#x5b9a;&#x65f6;&#x5668;&#x65e0;&#x9700;&#x6307;&#x5b9a;&#x4e00;&#x4e2a;&#x5230;&#x671f;&#x8303;&#x56f4;&#xff0c;&#x5219;&#x53ef;&#x4ee5;&#x8c03;&#x7528;&#x4e0b;&#x9762;&#x7684;&#x51fd;&#x6570;
    </p>
    <p>
      int
    </p>
    <p>
      hrtimer_start(struct hrtimer *timer, ktime_t tim, const enum hrtimer_mode mode)
    </p>
    <p>
      &#x6307;&#x5b9a;&#x5b9a;&#x65f6;&#x5668;&#x7684;&#x5230;&#x671f;&#x8303;&#x56f4;
    </p>
    <p>
      int hrtimer_start_range_ns(struct hrtimer *timer, ktime_t tim,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned long delta_ns, const enum hrtimer_mode mode)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1494727396938" ID="ID_1227909215" MODIFIED="1494727414368">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x53d6;&#x6d88;&#x5b9a;&#x65f6;&#x5668;
    </p>
    <p>
      int hrtimer_cancel(struct hrtimer *timer)
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1499823373711" ID="ID_1846276696" MODIFIED="1499823514109" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#b71717"><b>Linux&#x65f6;&#x949f;&#x7ba1;&#x7406;&#x5b50;&#x7cfb;&#x7edf;</b></font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1507710894174" ID="ID_1625658650" MODIFIED="1597390453600" POSITION="right" TEXT="Linux&#x5185;&#x6838;&#x540c;&#x6b65;&#x673a;&#x5236;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1507710929974" FOLDED="true" ID="ID_1048425563" MODIFIED="1560958881140">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>&#x539f;&#x5b50;&#x64cd;&#x4f5c;</i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1507723394048" FOLDED="true" ID="ID_1926308032" MODIFIED="1560958879892" TEXT="arm&#x67b6;&#x6784;&#x5e95;&#x5c42;&#x652f;&#x6301;&#x7684;&#x673a;&#x5236;">
<node CREATED="1507723414808" ID="ID_1871632326" MODIFIED="1507723474890">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>armv6&#x53ca;&#x4ee5;&#x4e0a;&#x67b6;&#x6784;</b>
    </p>
    <p>
      <font color="#f00f0f">LDREX STREX &#x6307;&#x4ee4;</font><br/>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1507723508305" ID="ID_552965333" MODIFIED="1507723581338">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#140606">armv6&#x4ee5;&#x524d;&#x7684;&#x67b6;&#x6784;(&#x5373;&#x5355;cpu&#x6838;&#x5fc3;&#x7684;&#x67b6;&#x6784;)</font></b>
    </p>
    <p>
      &#x901a;&#x8fc7;&#x7981;&#x6b62;cpu&#x4e2d;&#x65ad;&#x6765;&#x5b9e;&#x73b0;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1560958888765" ID="ID_325903788" MODIFIED="1560958932807">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>spin_lock&#x548c;raw_spin_lock</b>
    </p>
    <p>
      &#x53ef;&#x4ee5;&#x53c2;&#x8003;&#x7f51;&#x7ad9;&#xff1a; https://blog.csdn.net/droidphone/article/details/7395983
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1597390461317" ID="ID_1928854544" MODIFIED="1597390487009">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman">RCU&#26426;&#21046;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1597390493532" ID="ID_1278696353" MODIFIED="1597390525810">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      RCU's CPU Stall Detector&#20171;&#32461;
    </p>
  </body>
</html></richcontent>
<node CREATED="1597394704318" ID="ID_1803389763" MODIFIED="1597394711299" TEXT="RCU Tunning">
<node CREATED="1597395022648" ID="ID_47845189" MODIFIED="1597396557623">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <pre>rcuupdate.rcu_cpu_stall_suppress</pre>
    <p>
      &#27169;&#22359;&#21442;&#25968;&#21487;&#20197;&#31105;&#29992;RCU CPU stall detector&#21151;&#33021;&#65292;&#35813;&#21151;&#33021;&#26159;&#29992;&#26469;&#26816;&#27979;&#37027;&#20123;&#36807;&#28193;&#25302;&#24310;
    </p>
    <p>
      RCU grace periods&#30340;&#26465;&#20214;&#30340;&#12290;&#35813;&#27169;&#22359;&#21442;&#25968;&#22312;&#40664;&#35748;&#29366;&#24577;&#19979;&#26159;&#21551;&#29992;detector&#21151;&#33021;&#30340;&#65292;
    </p>
    <p>
      &#20294;&#26159;&#25105;&#20204;&#36890;&#36807;boot-time&#21442;&#25968;&#25110;&#32773;sysfs&#30340;&#37197;&#32622;&#26469;&#20462;&#25913;&#35813;&#21442;&#25968;&#12290;
    </p>
    <p>
      detector&#23545;&#20110;&#36807;&#28193;&#25302;&#24310;&#30340;&#32452;&#25104;&#26465;&#20214;&#26159;&#30001;&#20197;&#19979;&#30340;&#37197;&#32622;&#26469;&#20849;&#21516;&#20915;&#23450;&#30340;&#65306;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1597391262326" ID="ID_1417197229" MODIFIED="1597391267356" TEXT="&#x57fa;&#x7840;&#x6982;&#x5ff5;&#x4ecb;&#x7ecd;">
<node CREATED="1597391271226" ID="ID_1403713094" MODIFIED="1597391293598">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#32593;&#32476;&#36164;&#28304;
    </p>
    <p>
      <a href="https://www.cnblogs.com/LoyenWang/p/12681494.html">https://www.cnblogs.com/LoyenWang/p/12681494.html</a>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1525417026735" ID="ID_1643189755" MODIFIED="1598767327128" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Linux&#20869;&#23384;&#31649;&#29702;&#23376;&#31995;&#32479;
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1525417048563" ID="ID_1100947911" MODIFIED="1587007675242">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="&#x6977;&#x4f53;" color="#3300ff" size="4">linux vm&#36816;&#34892;&#21442;&#25968;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1525417063873" FOLDED="true" ID="ID_1881762748" MODIFIED="1600061129513" TEXT="oom">
<node CREATED="1525417077331" ID="ID_1584542646" MODIFIED="1525417190248">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      panic_on_oom&#x53c2;&#x6570;
    </p>
    <p>
      
    </p>
    <p>
      &#x8be5;&#x53c2;&#x6570;&#x7528;&#x6765;&#x63a7;&#x5236;&#x5f53;kernel&#x9047;&#x5230;oom&#x7684;&#x65f6;&#x5019;&#x5982;&#x4f55;&#x5904;&#x7f6e;&#xff0c;
    </p>
    <p>
      &#x662f;&#x9009;&#x62e9;&#x76f4;&#x63a5;panic&#x8fd8;&#x662f;&#x542f;&#x52a8;oom_killer&#x6740;&#x6b7b;&#x76f8;&#x5173;&#x7684;&#x8fdb;&#x7a0b;&#x91ca;&#x653e;&#x5185;&#x5b58;&#x7a7a;&#x95f4;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1587007489431" FOLDED="true" ID="ID_1733779417" MODIFIED="1589521736296">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="&#x6977;&#x4f53;" color="#3300ff" size="4">android ion&#23376;&#31995;&#32479;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1587007506176" FOLDED="true" ID="ID_1986904575" MODIFIED="1589521735163" TEXT="ion debug&#x4fe1;&#x606f;&#x6253;&#x5370;">
<node CREATED="1587007516005" ID="ID_1438864923" MODIFIED="1587007549565">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      sdm845:/sys/kernel/debug/ion/heaps # cat system
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;client&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pid&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;size
    </p>
    <p>
      ----------------------------------------------------
    </p>
    <p>
      &#160;ndroid.systemui&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;1522&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4562944
    </p>
    <p>
      &#160;ndroid.settings&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;3310&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;25264128
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;61440
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;61440
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;8192
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;vppservice&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;998&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4194304
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;16384
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;16384
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;16384
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;245760
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;495616
    </p>
    <p>
      &#160;omx@1.0-service&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;1021&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;3141632
    </p>
    <p>
      &#160;audio@2.0-servi&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;667&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;&#160;surfaceflinger&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;724&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;61779968
    </p>
    <p>
      &#160;composer@2.1-se&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;675&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;51884032
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;voip_client&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;772&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;voc_cal&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;772&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4096
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;voip_client&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;772&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;8192
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;adsprpc-smd&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;1&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;4194304
    </p>
    <p>
      ----------------------------------------------------
    </p>
    <p>
      orphaned allocations (info is from last known client):
    </p>
    <p>
      ----------------------------------------------------
    </p>
    <p>
      &#160;&#160;total orphaned&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;total&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;71843840
    </p>
    <p>
      &#160;&#160;&#160;deferred free&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;0
    </p>
    <p>
      ----------------------------------------------------
    </p>
    <p>
      0 order 9 highmem pages in uncached pool = 0 total
    </p>
    <p>
      0 order 9 lowmem pages in uncached pool = 0 total
    </p>
    <p>
      0 order 4 highmem pages in uncached pool = 0 total
    </p>
    <p>
      65 order 4 lowmem pages in uncached pool = 4259840 total
    </p>
    <p>
      0 order 0 highmem pages in uncached pool = 0 total
    </p>
    <p>
      1 order 0 lowmem pages in uncached pool = 4096 total
    </p>
    <p>
      0 order 9 highmem pages in cached pool = 0 total
    </p>
    <p>
      17 order 9 lowmem pages in cached pool = 35651584 total
    </p>
    <p>
      0 order 4 highmem pages in cached pool = 0 total
    </p>
    <p>
      123 order 4 lowmem pages in cached pool = 8060928 total
    </p>
    <p>
      0 order 0 highmem pages in cached pool = 0 total
    </p>
    <p>
      35 order 0 lowmem pages in cached pool = 143360 total
    </p>
    <p>
      VMID 8: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;8: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 9: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;9: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 10: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;10: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 11: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;11: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 13: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;13: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 17: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;17: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 18: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;18: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 26: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;26: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 29: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;29: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 34: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;34: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 36: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;36: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 42: 0 order 9 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;42: 0 order 9 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 8: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;8: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 9: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;9: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 10: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;10: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 11: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;11: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 13: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;13: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 17: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;17: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 18: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;18: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 26: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;26: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 29: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;29: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 34: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;34: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 36: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;36: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 42: 0 order 4 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;42: 0 order 4 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 8: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;8: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 9: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;9: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 10: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;10: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 11: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;11: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 13: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;13: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 17: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;17: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 18: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;18: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 26: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;26: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 29: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;29: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 34: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;34: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 36: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;36: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      VMID 42: 0 order 0 highmem pages in secure pool = 0 total
    </p>
    <p>
      VMID&#160;&#160;42: 0 order 0 lowmem pages in secure pool = 0 total
    </p>
    <p>
      --------------------------------------------
    </p>
    <p>
      uncached pool = 4263936 cached pool = 43855872 secure pool = 0
    </p>
    <p>
      pool total (uncached + cached + secure) = 48119808
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1587007602044" ID="ID_1430846771" MODIFIED="1587007747264">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="&#x6977;&#x4f53;" color="#3300ff" size="4">&#39640;&#36890;IOMMU&#23376;&#31995;&#32479;&#23398;&#20064;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1583663541919" FOLDED="true" ID="ID_809884029" MODIFIED="1600061120444">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#f21111">&#20869;&#23384;&#31649;&#29702;&#23398;&#20064;&#35745;&#21010;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1583663906968" ID="ID_927808365" MODIFIED="1596874049441">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#f0212b" face="Times New Roman"><b>&#39029;&#34920;&#26144;&#23556;&#23398;&#20064;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1594681566849" ID="ID_37366410" MODIFIED="1596873979942" TEXT="&#x9ad8;&#x901f;&#x7f13;&#x5b58;&#x7684;&#x6982;&#x5ff5;">
<node CREATED="1594681587972" ID="ID_32969052" MODIFIED="1595287528187">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#39640;&#36895;&#32531;&#23384;&#30340;&#32467;&#26500;
    </p>
    <p>
      
    </p>
    <p>
      &#19968;&#20010;&#30452;&#25509;&#26144;&#23556;&#32531;&#23384;&#30001;&#33509;&#24178;&#30340;&#32531;&#23384;&#22359;(Cache Block&#25110;&#32773;&#26159;Cache Line)&#26500;&#25104;
    </p>
    <p>
      &#27599;&#20010;&#32531;&#23384;&#22359;&#20855;&#26377;&#36830;&#32493;&#20869;&#23384;&#22320;&#22336;&#30340;&#33509;&#24178;&#20010;&#23384;&#20648;&#21333;&#20803;
    </p>
    <p>
      
    </p>
    &#27599;&#20010;&#32531;&#23384;&#22359;&#26377;&#19968;&#20010;&#32034;&#24341;&#65288;Index&#65289;&#65292;&#23427;&#19968;&#33324;&#26159;&#20869;&#23384;&#22320;&#22336;&#30340;&#20302;&#31471;&#37096;&#20998;&#65292;&#20294;&#19981;&#21547;&#22359;&#20869;&#20559;&#31227;&#21644;&#23383;&#33410;&#20559;&#31227;&#25152;&#21344;&#30340;&#26368;&#20302;&#33509;&#24178;&#20301;&#12290;
  </body>
</html></richcontent>
<node CREATED="1595287649525" ID="ID_1544907370" MODIFIED="1595287660765">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/CPU&#x7f13;&#x5b58;_00&#x7f13;&#x5b58;&#x6bb5;&#x7ed3;&#x6784;.png" />
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1595374637841" ID="ID_490730118" MODIFIED="1596873986276" TEXT="&#x7ec4;&#x76f8;&#x8054;">
<node CREATED="1595662860930" ID="ID_167070104" MODIFIED="1595662871040">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/CPU&#x7f13;&#x5b58;_02_&#x7ec4;&#x5173;&#x8054;.png" />
  </body>
</html></richcontent>
</node>
<node CREATED="1595662878686" ID="ID_837421099" MODIFIED="1595662989785">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#e12626">&#32622;&#25442;&#31574;&#30053;</font></b>
    </p>
    <p>
      &#23545;&#20110;&#32452;&#30456;&#32852;&#32531;&#23384;&#65292;&#24403;&#19968;&#20010;&#32452;&#30340;&#32531;&#23384;&#22359;&#34987;&#20840;&#37096;&#21344;&#28385;&#20043;&#21518;&#65292;&#22914;&#26524;&#20877;&#27425;&#21457;&#29983;&#32531;&#23384;&#22833;&#25928;&#65292;
    </p>
    <p>
      &#23601;&#24517;&#39035;&#36873;&#25321;&#19968;&#20010;&#32531;&#23384;&#22359;&#26367;&#25442;&#25481;
    </p>
  </body>
</html></richcontent>
<node CREATED="1595663194594" ID="ID_1452631537" MODIFIED="1595663232593">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#26368;&#29702;&#24819;&#30340;&#26367;&#25442;&#31574;&#30053;&#65306;
    </p>
    <p>
      &#26367;&#25442;&#25481;&#36317;&#31163;&#19979;&#19968;&#27425;&#20351;&#29992;&#26368;&#20037;&#30340;&#20869;&#23384;&#22359;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1595663237938" ID="ID_17815911" MODIFIED="1595663281911">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      FIFO&#31574;&#30053;&#65306;
    </p>
    <p>
      &#26367;&#25442;&#25481;&#36827;&#20837;&#32452;&#20869;&#26102;&#38388;&#26368;&#38271;&#30340;&#20869;&#23384;&#22359;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1595663286426" ID="ID_401285146" MODIFIED="1595663400049">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      LRU &#26368;&#20037;&#26410;&#20351;&#29992;&#31639;&#27861;&#65306;
    </p>
    <p>
      &#36319;&#36394;&#21508;&#20010;&#32531;&#23384;&#22359;&#30340;&#20351;&#29992;&#24773;&#20917;&#65292;&#24182;&#32479;&#35745;&#20986;&#21738;&#20010;&#32531;&#23384;&#22359;&#26368;&#20037;&#26410;&#34987;&#20351;&#29992;
    </p>
    <p>
      &#23545;&#20110;2&#36335;&#20197;&#19978;&#30456;&#32852;&#65292;&#35813;&#31639;&#27861;&#30340;&#20195;&#20215;&#38750;&#24120;&#39640;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1595663440590" ID="ID_663430232" MODIFIED="1595663522414">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      NMRU &#38750;&#26368;&#36817;&#20351;&#29992;&#31639;&#27861;
    </p>
    <p>
      &#35813;&#31639;&#27861;&#20165;&#35760;&#24405;&#21738;&#19968;&#20010;&#32531;&#23384;&#22359;&#26159;&#26368;&#36817;&#34987;&#20351;&#29992;&#30340;&#65292;&#35813;&#31639;&#27861;&#23454;&#29616;&#36215;&#26469;&#27604;&#36739;&#31616;&#21333;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1595663531845" ID="ID_805040658" MODIFIED="1595663570892">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23436;&#20840;&#38543;&#21363;&#30340;&#26367;&#25442;&#31639;&#27861;&#65306;
    </p>
    <p>
      &#26377;&#27979;&#35797;&#34920;&#26126;&#65292;&#35813;&#26367;&#25442;&#31639;&#27861;&#30340;&#25928;&#33021;&#25509;&#36817;&#20110;LRU&#31639;&#27861;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1596935608932" ID="ID_1834691278" MODIFIED="1596935645826">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman">&#20889;&#31574;&#30053;&#20171;&#32461;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1596936362703" ID="ID_524138936" MODIFIED="1596936951212">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#23545;&#20110;&#35835;&#25805;&#20316;&#26469;&#35828;&#65292;&#22320;&#22336;&#26816;&#26597;&#21644;&#25968;&#25454;&#35835;&#21462;&#26159;&#21487;&#20197;&#24182;&#34892;&#36827;&#34892;&#30340;&#65292;
    </p>
    <p>
      &#20294;&#26159;&#23545;&#20110;&#20889;&#26469;&#35828;&#65292;&#36825;&#26679;&#30340;&#24182;&#34892;&#25805;&#20316;&#26159;&#19981;&#20801;&#35768;&#30340;&#65292;&#21482;&#26377;&#24403;&#26631;&#24535;&#20301;&#26377;&#25928;&#24182;&#19988;
    </p>
    <p>
      &#22320;&#22336;&#21629;&#20013;&#26102;&#25165;&#21487;&#20197;&#23545;&#22359;&#36827;&#34892;&#20462;&#25913;&#12290;&#21478;&#19968;&#20010;&#22797;&#26434;&#30340;&#24773;&#20917;&#26159;cpu&#24517;&#39035;&#32473;&#20986;&#20889;
    </p>
    <p>
      &#30340;&#23383;&#33410;&#25968;&#65292;&#24182;&#19988;&#21482;&#26377;&#22359;&#24403;&#20013;&#30340;&#36825;&#37096;&#20998;&#25165;&#21487;&#20197;&#34987;&#20462;&#25913;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1596937587846" ID="ID_414328892" MODIFIED="1596937646348">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman" color="#0a2df3">&#20889;&#30452;&#36798;(write through)</font>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1596937608177" ID="ID_1466151233" MODIFIED="1596937673830">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" face="Times New Roman" color="#1c16f4">&#20889;&#22238;&#27861;(write back)</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1583664009824" ID="ID_1057997317" MODIFIED="1596874069790">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman" color="#e61111">slab&#20869;&#23384;&#20998;&#37197;&#22120;&#23398;&#20064;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1583664027550" ID="ID_314974405" MODIFIED="1596874089378">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font face="Times New Roman" color="#e20d0d">&#20869;&#23384;&#26144;&#23556;&#23398;&#20064;</font></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1600061132753" ID="ID_1401851961" MODIFIED="1600061140794" TEXT="&#x53c2;&#x8003;&#x7f51;&#x7ad9;">
<node CREATED="1600061145204" ID="ID_1696865135" MODIFIED="1600061148144" TEXT="https://www.cnblogs.com/LoyenWang/"/>
</node>
</node>
<node CREATED="1563198810215" FOLDED="true" ID="ID_123490465" MODIFIED="1566110684947" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Linux&#x8fdb;&#x7a0b;&#x7ba1;&#x7406;&#x5b50;&#x7cfb;&#x7edf;</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1563198862775" FOLDED="true" ID="ID_826928968" MODIFIED="1566110682981">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7b2c;&#x4e00;&#x7ae0;&#xff1a; process identification
    </p>
    <p>
      <font color="#dd1212">linux kernel&#x5f53;&#x4e2d;&#x5982;&#x4f55;&#x6807;&#x8bc6;&#x4e00;&#x4e2a;&#x6216;&#x8005;&#x4e00;&#x7ec4;&#x8ddf;&#x8fdb;&#x7a0b;&#x76f8;&#x5173;&#x7684;&#x5b9e;&#x4f53;</font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1563199747087" ID="ID_142735290" MODIFIED="1563201994156">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x8fdb;&#x7a0b;ID&#x53f7;&#xff0c;posix&#x6807;&#x51c6;&#x4f7f;&#x7528;getpid&#x51fd;&#x6570;&#x83b7;&#x53d6;&#x8fdb;&#x7a0b;&#x7684;id&#x53f7;&#xff0c;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;&#x5b9e;&#x73b0;
    </p>
    <p>
      &#x4f4d;&#x4e8e;&#x6587;&#x4ef6; kernel/sys.c &#x5f53;&#x4e2d;
    </p>
    <p>
      SYSCALL_DEFINE0(getpid)
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;return task_tgid_vnr(current);
    </p>
    <p>
      }
    </p>
    <p>
      <font color="rgb(50, 50, 50)" face="Arial, Helvetica, sans-serif" size="13px">return current-&gt;tgid;</font>
    </p>
    <p>
      tgid&#x662f;thread group id, &#x4e5f;&#x5c31;&#x662f;&#x7ebf;&#x7a0b;&#x7ec4;id, &#x4e3a;&#x4e86;&#x5bf9;&#x5e94;posix&#x5f53;&#x4e2d;&#x591a;&#x7ebf;&#x7a0b;&#x7684;&#x6982;&#x5ff5;&#xff0c;linux&#x4f7f;&#x7528;&#x7ebf;&#x7a0b;&#x7ec4;id&#x6765;&#x4ee3;&#x8868;&#x4e00;&#x4e2a;
    </p>
    <p>
      &#x8fdb;&#x7a0b;id, &#x5bf9;&#x4e8e;linux kernel &#x6bcf;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x5206;&#x914d;&#x4e00;&#x4e2a;task_struct(&#x6bcf;&#x4e2a;task_struct&#x90fd;&#x6709;&#x81ea;&#x5df1;&#x7684;pid), &#x8fdb;&#x7a0b;&#x7ec4;&#x5f53;&#x4e2d;&#x7b2c;&#x4e00;&#x4e2a;
    </p>
    <p>
      &#x8fdb;&#x7a0b;&#x7684;tgid&#x7b49;&#x4e8e;pid, task_struct &#x5f53;&#x4e2d;&#x7684; group_leader&#x6210;&#x5458;&#x6307;&#x5411;&#x8fdb;&#x7a0b;&#x7ec4;&#x5f53;&#x4e2d;&#x7684;group leader
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1563202602097" ID="ID_1996602889" MODIFIED="1563202735890">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7ebf;&#x7a0b;id&#x53f7;
    </p>
    <p>
      &#x5728;linux kernel&#x5f53;&#x4e2d;&#xff0c;&#x6bcf;&#x4e00;&#x4e2a;&#x7ebf;&#x7a0b;&#x5206;&#x914d;&#x4e00;&#x4e2a;task_struct&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#x7684;
    </p>
    <p>
      pid&#x6210;&#x5458;&#x5c31;&#x662f;&#x7ebf;&#x7a0b;id,
    </p>
    <p>
      POSIX&#x4f7f;&#x7528;pthread_self&#x63a5;&#x53e3;&#x83b7;&#x53d6;&#x7ebf;&#x7a0b;id&#x53f7;&#xff0c;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;&#x5b9e;&#x73b0;&#x7c7b;&#x4f3c;&#x4e8e;
    </p>
    <p>
      current-&gt;pid
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1504507980067" FOLDED="true" ID="ID_1280172444" MODIFIED="1566110677271" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e40606">&#x7279;&#x522b;&#x7ae0;&#x8282;</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1504508011275" FOLDED="true" ID="ID_1976280137" MODIFIED="1527837306792" TEXT="&#x7f51;&#x7edc;&#x4e0a;&#x641c;&#x96c6;&#x7684;&#x535a;&#x5ba2;">
<node CREATED="1504508026131" ID="ID_20057698" MODIFIED="1504508033181">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      http://blog.yufeng.info/archives/category/linux_kb/page/2
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1505822974956" FOLDED="true" ID="ID_1958034353" MODIFIED="1527837303240" TEXT="&#x7f51;&#x7edc;&#x4e0a;&#x7684;&#x5f00;&#x6e90;&#x9879;&#x76ee;">
<node CREATED="1505822992572" ID="ID_165995557" MODIFIED="1505823062565">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Linux Easy Profiling&#x5b8b;&#x5b9d;&#x534e;&#x8001;&#x5e08;&#x6253;&#x9020;&#x7684;linux&#x6027;&#x80fd;&#x5206;&#x6790;&#x5de5;&#x5177;
    </p>
    <p>
      <font color="#e91212">http://www.linuxep.com</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1527837313409" FOLDED="true" ID="ID_1738693135" MODIFIED="1597390447776" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4"><b>Linux kernel&#x7684;&#x4e00;&#x4e9b;&#x53d8;&#x5316;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1527837344361" FOLDED="true" ID="ID_998841584" MODIFIED="1566110673339">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4ece;linux 4.1&#x7248;&#x672c;&#x4e4b;&#x540e;&#x5185;&#x6838;&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x7684;&#x63a5;&#x53e3; aio_read&#x548c;aio_write&#x5c31;&#x88ab;&#x53bb;&#x6389;&#x4e86;&#xff0c;
    </p>
    <p>
      &#x53d6;&#x800c;&#x4ee3;&#x4e4b;&#x7684;&#x662f;iov_iter interface, &#x6211;&#x4eec;&#x770b;&#x5230;&#x5728;struct file_operations&#x6709;&#x8fd9;&#x6837;&#x4e24;&#x4e2a;
    </p>
    <p>
      &#x51fd;&#x6570;&#x63a5;&#x53e3;
    </p>
    <p>
      ssize_t (*read_iter) (struct kiocb *, struct iov_iter *);
    </p>
    <p>
      ssize_t (*write_iter) (struct kiocb *, struct iov_iter *);
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#1326ee" DESTINATION="ID_998841584" ENDARROW="Default" ENDINCLINATION="-338;-106;" ID="Arrow_ID_1616113988" SOURCE="ID_920713861" STARTARROW="None" STARTINCLINATION="628;0;"/>
<node CREATED="1527843860675" ID="ID_750229072" MODIFIED="1527844138373">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      iov_iter&#x5e76;&#x4e0d;&#x662f;&#x4ec0;&#x4e48;&#x65b0;&#x9c9c;&#x7684;&#x6982;&#x5ff5;&#xff0c;&#x65e9;&#x5728;linux2.6.24&#x5185;&#x6838;&#x65f6;&#x671f;&#x5c31;&#x88ab;&#x52a0;&#x5165;&#x5230;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x4e86;&#x3002;
    </p>
    <p>
      &#x5728;3.19&#x7248;&#x672c;&#x5f53;&#x4e2d;&#xff0c;iov_iter&#x88ab;merge&#x5230;&#x4e86;&#x7f51;&#x7edc;&#x5b50;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527856981947" ID="ID_10198765" MODIFIED="1527860899321">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      iov_iter&#x7ed3;&#x6784;&#x4f53;&#x5b9e;&#x9645;&#x4e0a;&#x662f;&#x4e00;&#x4e2a;&#x8fed;&#x4ee3;&#x5668;&#xff0c;&#x7528;&#x6765;&#x904d;&#x5386;iovec&#x8fd9;&#x4e2a;&#x7ed3;&#x6784;&#x4f53;&#x7684;
    </p>
    <p>
      struct iovec
    </p>
    <p>
      {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;void __user *iov_base;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;__kernel_size_t iov_len;
    </p>
    <p>
      };
    </p>
    <p>
      &#x8fd9;&#x4e2a;&#x7ed3;&#x6784;&#x4f53;&#x5bf9;&#x5e94;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;iovec&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x5e76;&#x4e14;&#x7528;&#x5728;&#x5982;readv()&#x8fd9;&#x6837;&#x7684;&#x7cfb;&#x7edf;&#x8c03;&#x7528;&#x5f53;&#x4e2d;&#xff0c;
    </p>
    <p>
      &#x4e00;&#x4e2a;iovec&#x7ed3;&#x6784;&#x4f53;&#x63cf;&#x8ff0;&#x4e86;&#x5206;&#x5e03;&#x5728;&#x865a;&#x62df;&#x5185;&#x5b58;&#x548c;&#x7269;&#x7406;&#x5185;&#x5b58;&#x5f53;&#x4e2d;&#x7684;buffer&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      struct iov_iter {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;int type;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;size_t iov_offset;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;size_t count;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;const struct iovec *iov; /* SIMPLIFIED - see below */
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;unsigned long nr_segs;
    </p>
    <p>
      };
    </p>
    <p>
      type&#x5b57;&#x6bb5;&#x63cf;&#x8ff0;&#x8be5;iterator&#x662f;&#x5c5e;&#x4e8e;&#x8bfb;&#x8fd8;&#x662f;&#x5199;&#x7c7b;&#x578b;&#xff0c;&#x8bfb;&#x7684;&#x8bdd;&#x5c31;&#x662f;&#x4ece;iov_iter&#x5f80;&#x5916;&#x53d1;&#x9001;&#x6570;&#x636e;&#xff0c;
    </p>
    <p>
      &#x5199;&#x5c31;&#x662f;&#x4ece;&#x5916;&#x9762;&#x5f80;&#x8be5;iov_iter&#x91cc;&#x9762;&#x5b58;&#x50a8;&#x6570;&#x636e;&#x3002;
    </p>
    <p>
      iov_offset&#x8868;&#x793a;&#x7b2c;&#x4e00;&#x4e2a;iovec&#x6307;&#x9488;&#x91cc;&#x9762;&#x7684;&#x6570;&#x636e;&#x504f;&#x79fb;
    </p>
    <p>
      count&#x8868;&#x793a;&#x6240;&#x6709;&#x7684;&#x6570;&#x636e;&#x603b;&#x91cf;
    </p>
    <p>
      nr_segs &#x8868;&#x793a;&#x7531;iov&#x6307;&#x5411;&#x7684;&#x6570;&#x7ec4;&#x91cc;&#x9762;&#x7684;iovec&#x7684;&#x5143;&#x7d20;&#x4e2a;&#x6570;
    </p>
    <p>
      &#x6ce8;&#x610f;&#xff0c;&#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x7684;&#x5927;&#x90e8;&#x5206;&#x53d8;&#x91cf;&#x4f1a;&#x968f;&#x7740;&#x4ee3;&#x7801;&#x7684;&#x8fed;&#x4ee3;&#x800c;&#x88ab;&#x4fee;&#x6539;&#xff0c;&#x56e0;&#x4e3a;&#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x53ea;&#x662f;&#x6307;&#x5411;buffer&#x7684;&#x6e38;&#x6807;&#x6307;&#x9488;&#x800c;&#x5df2;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1527862189267" ID="ID_1287288842" MODIFIED="1527865876753">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;&#x4f7f;&#x7528;&#x4e4b;&#x524d;&#x5fc5;&#x987b;&#x521d;&#x59cb;&#x5316;iov_iter,&#x5305;&#x542b;iovec
    </p>
    <p>
      void iov_iter_init(struct iov_iter *i, int direction,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct iovec *iov, unsigned long nr_segs,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size_t count)
    </p>
    <p>
      
    </p>
    <p>
      &#x6570;&#x636e;&#x53ef;&#x4ee5;&#x5728;iterator&#x548c;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x4e4b;&#x95f4;&#x79fb;&#x52a8;
    </p>
    <p>
      size_t copy_to_iter(void *addr, size_t bytes, struct iov_iter *i);&#xa0;&#xa0;&#xa0; this is like copy to user
    </p>
    <p>
      size_t copy_from_iter(void *addr, size_t bytes, struct iov_iter *i);&#xa0;&#xa0;this is like copy from user
    </p>
    <p>
      
    </p>
    <p>
      &#x6570;&#x636e;&#x5728;&#x4e00;&#x4e2a;page&#x4e4b;&#x95f4;&#x8f6c;&#x79fb;
    </p>
    <p>
      size_t copy_page_to_iter(struct page *page, size_t offset, size_t bytes,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct iov_iter *i);
    </p>
    <p>
      size_t copy_page_from_iter(struct page *page, size_t offset, size_t bytes,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct iov_iter *i);
    </p>
    <p>
      
    </p>
    <p>
      &#x8fd0;&#x884c;&#x5728;&#x539f;&#x5b50;&#x4e0a;&#x4e0b;&#x6587;&#x5f53;&#x4e2d;&#x7684;&#x4ee3;&#x7801;&#x83b7;&#x53d6;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x6570;&#x636e;:
    </p>
    <p>
      
    </p>
    <p>
      size_t iov_iter_copy_from_user_atomic(struct page *page, struct iov_iter *i,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;unsigned long offset, size_t bytes);
    </p>
    <p>
      
    </p>
    <p>
      &#x5c06;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x7684;buffer&#x6620;&#x5c04;&#x5230;kernel
    </p>
    <p>
      ssize_t iov_iter_get_pages(struct iov_iter *i, struct page **pages,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size_t maxsize, unsigned maxpages, size_t *start);
    </p>
    <p>
      ssize_t iov_iter_get_pages_alloc(struct iov_iter *i, struct page ***pages,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size_t maxsize, size_t *start);
    </p>
    <p>
      &#x5728;&#x4e0d;&#x79fb;&#x52a8;&#x6570;&#x636e;&#x7684;&#x60c5;&#x51b5;&#x4e0b;&#x63a8;&#x8fdb;&#x8fed;&#x4ee3;&#x5668;
    </p>
    <p>
      void iov_iter_advance(struct iov_iter *i, size_t size);
    </p>
    <p>
      
    </p>
    <p>
      &#x6e05;&#x7a7a;&#x88ab;iterator&#x5f15;&#x7528;&#x7684;&#x6570;&#x636e;
    </p>
    <p>
      size_t iov_iter_zero(size_t bytes, struct iov_iter *i);
    </p>
    <p>
      
    </p>
    <p>
      &#x5e2e;&#x52a9;&#x51fd;&#x6570;
    </p>
    <p>
      size_t iov_iter_single_seg_count(const struct iov_iter *i);
    </p>
    <p>
      int iov_iter_npages(const struct iov_iter *i, int maxpages);
    </p>
    <p>
      size_t iov_length(const struct iovec *iov, unsigned long nr_segs);
    </p>
  </body>
</html></richcontent>
<node CREATED="1527907768449" ID="ID_772256437" MODIFIED="1527907857192">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      iov_iter_count()&#x9002;&#x7528;&#x4e8e;&#x6240;&#x6709;&#x7684;type&#xff0c;&#x800c;&#x4e14;&#x6267;&#x884c;&#x7684;&#x901f;&#x5ea6;&#x975e;&#x5e38;&#x5feb;
    </p>
    <p>
      &#x800c;iov_lengh&#x53ea;&#x662f;&#x9002;&#x7528;&#x4e8e;iovec
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1527905102388" ID="ID_1397777595" MODIFIED="1527906522591">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6211;&#x4eec;&#x770b;&#x5230;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x771f;&#x6b63;&#x7684;&#x5bf9;iov_iter&#x7684;&#x5b9a;&#x4e49;&#x662f;&#x8fd9;&#x6837;&#x7684;:
    </p>
    <p>
      struct iov_iter {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;int type;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;size_t iov_offset;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;size_t count;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;union {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct iovec *iov;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct kvec *kvec;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct bio_vec *bvec;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;};&#xa0;
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;unsigned long nr_segs;
    </p>
    <p>
      };
    </p>
    <p>
      &#x5982;&#x679c;type&#x91cc;&#x9762;&#x5305;&#x542b;&#x4e86;&#x63a9;&#x7801;ITER_BVEC&#xff0c;&#x5b9e;&#x9645;&#x4e0a;&#x8be5;iov_iter&#x4ee3;&#x8868;&#x7684;&#x662f;bio vec, &#x6b64;&#x65f6;&#x8be5;&#x7ed3;&#x6784;&#x4f53;&#x4ecd;&#x7136;&#x53ef;&#x4ee5;&#x987a;&#x5229;&#x5730;
    </p>
    <p>
      &#x88ab;&#x4e0a;&#x9762;&#x7684;&#x51fd;&#x6570;&#x4f7f;&#x7528;
    </p>
    <p>
      
    </p>
    <p>
      kvec&#x5b9e;&#x9645;&#x4e0a;&#x4ee3;&#x8868;&#x7684;&#x662f;&#x4f4d;&#x4e8e;&#x5185;&#x6838;&#x5f53;&#x4e2d;&#x7684;buffer, &#x8fd9;&#x4e2a;&#x65f6;&#x5019;iov_iter&#x521d;&#x59cb;&#x5316;&#x7684;&#x65b9;&#x6cd5;&#x5982;&#x4e0b;&#x6240;&#x793a;:
    </p>
    <p>
      
    </p>
    <p>
      void iov_iter_kvec(struct iov_iter *i, int direction,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct kvec *iov, unsigned long nr_segs,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;size_t count);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1510045832657" FOLDED="true" ID="ID_1482848038" MODIFIED="1510224664947" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#0d5edb"><b>Linux&#x9a71;&#x52a8;&#x5f53;&#x4e2d;&#x7684;&#x5185;&#x5b58;&#x64cd;&#x4f5c;&#x51fd;&#x6570;</b></font>
    </p>
  </body>
</html></richcontent>
<node CREATED="1510052035358" ID="ID_1184838772" MODIFIED="1510060438697">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      copy_to_user &#x548c; copy_from_user
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1509178884350" FOLDED="true" ID="ID_1507127288" MODIFIED="1512481022084" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#159945">Linux TTY&#x6846;&#x67b6;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1509178931892" FOLDED="true" ID="ID_747633960" MODIFIED="1510231180373">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <img src="lddpic/tty&#x8f6f;&#x4ef6;&#x6846;&#x67b6;.gif"/>
      
    </p>
    <p>
      <b><font color="#d21010">tty&#x8f6f;&#x4ef6;&#x6846;&#x67b6;&#x901a;&#x8fc7;tty core&#x5c4f;&#x853d;&#x6389;&#x4e00;&#x4e9b;&#x6280;&#x672f;&#x7ec6;&#x8282;&#xff0c;&#x5bf9;&#x4e0a;&#x4ee5;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x7684;&#x5f62;&#x5f0f;&#x5411;&#x5e94;&#x7528;&#x7a0b;&#x5e8f;&#x63d0;&#x4f9b;&#x7edf;&#x4e00;&#x7684;&#x5e94;&#x7528;&#x63a5;&#x53e3;&#xff0c;&#x5bf9;&#x4e0b;&#x901a;&#x8fc7;tty device &#x548c; tty driver </font></b>
    </p>
    <p>
      <b><font color="#d21010">&#x7684;&#x5f62;&#x5f0f;&#x63d0;&#x4f9b;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x7f16;&#x5199;&#x7684;&#x6846;&#x67b6;&#x3002;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1509179286597" ID="ID_1282767276" MODIFIED="1509179993576">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#0f39f2">tty core:</font></b>
    </p>
    <ol>
      <li>
        &#x4ee5;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x7684;&#x5f62;&#x5f0f;&#xff0c;&#x5411;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x63d0;&#x4f9b;&#x8bbf;&#x95ee;tty&#x8bbe;&#x5907;&#x7684;&#x63a5;&#x53e3;
      </li>
    </ol>
    <p>
      &#x8bbe;&#x5907;&#x53f7;(&#x4e3b;, &#x6b21;)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x5907;&#x6ce8;
    </p>
    <p>
      (5, 0)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/dev/tty&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#x63a7;&#x5236;&#x7ec8;&#x7aef;&#xff08;Controlling Terminal&#xff09;
    </p>
    <p>
      (5, 1)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/dev/console&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#x63a7;&#x5236;&#x53f0;&#x7ec8;&#x7aef;&#xff08;Console Terminal&#xff09;
    </p>
    <p>
      (4, 0)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/dev/vc/0 or /dev/tty0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x865a;&#x62df;&#x7ec8;&#x7aef;&#xff08;Virtual Terminal&#xff09;
    </p>
    <p>
      (4, 1)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/dev/vc/1 or /dev/tty1&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x540c;&#x4e0a;
    </p>
    <p>
      &#x2026;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x2026;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x2026;
    </p>
    <p>
      (x, x)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/dev/ttyS0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#x4e32;&#x53e3;&#x7ec8;&#x7aef;&#xff08;&#x540d;&#x79f0;&#x548c;&#x8bbe;&#x5907;&#x53f7;&#x7531;&#x9a71;&#x52a8;&#x81ea;&#x884c;&#x51b3;&#x5b9a;&#xff09;
    </p>
    <p>
      &#x2026;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x2026;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#x2026;
    </p>
    <p>
      (x, x)&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/dev/ttyUSB0&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;USB&#x8f6c;&#x4e32;&#x53e3;&#x7ec8;&#x7aef;
    </p>
    <p>
      
    </p>
    <p>
      2. &#x901a;&#x8fc7;tty_driver&#x6765;&#x62bd;&#x8c61;tty&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#xff0c;&#x5e76;&#x63d0;&#x4f9b;&#x76f8;&#x5e94;&#x7684;register&#x63a5;&#x53e3;&#xff0c;tty&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x7684;&#x7f16;&#x5199;&#xff0c;&#x7b80;&#x5316;&#x6210;&#x586b;&#x5145;&#x5e76;
    </p>
    <p>
      &#x6ce8;&#x518c;tty_driver&#x7ed3;&#x6784;&#x4f53;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      3.&#x4f7f;&#x7528;tty_struct &#x548c; tty_port&#x7b49;&#x6570;&#x636e;&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x6765;&#x62bd;&#x8c61;tty&#x8bbe;&#x5907;&#x7684;&#x7ec4;&#x4ef6;&#xff0c;&#x7528;&#x6765;&#x5b9e;&#x73b0;&#x786c;&#x4ef6;&#x65e0;&#x5173;&#x7684;&#x903b;&#x8f91;&#x3002;
    </p>
    <p>
      
    </p>
    <p>
      4.&#x62bd;&#x8c61;&#x51fa;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x7684;&#x4e1c;&#x897f;&#xff0c;&#x7528;&#x4e8e;&#x5728;&#x53d1;&#x9001;&#x6570;&#x636e;&#x4e4b;&#x524d;&#x548c;&#x63a5;&#x6536;&#x6570;&#x636e;&#x4e4b;&#x540e;&#x8fdb;&#x884c;&#x76f8;&#x5173;&#x7684;&#x6570;&#x636e;&#x7684;&#x5904;&#x7406;&#x5de5;&#x4f5c;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1509180024765" ID="ID_353636401" MODIFIED="1509180130705">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font color="#d51111">system console core&#x7684;&#x4f5c;&#x7528;&#xff1a;</font></b>
    </p>
    <p>
      1.&#x5411;&#x7cfb;&#x7edf;&#x63d0;&#x4f9b;&#x63a7;&#x5236;&#x53f0;&#x7ec8;&#x7aef;&#xff0c;&#x4ee5;&#x4fbf;&#x8ba9;&#x7528;&#x6237;&#x767b;&#x9646;&#x8fdb;&#x884c;&#x4ea4;&#x4e92;&#x64cd;&#x4f5c;
    </p>
    <p>
      2.&#x63d0;&#x4f9b;printk&#x529f;&#x80fd;&#xff0c;&#x4ee5;&#x4fbf;kernel&#x4ee3;&#x7801;&#x8fdb;&#x884c;&#x65e5;&#x5fd7;&#x7684;&#x8f93;&#x51fa;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1509180216215" ID="ID_339202514" MODIFIED="1509180308912">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="4" color="#1b25f1"><b>tty driver:</b></font>
    </p>
    <p>
      
    </p>
    <p>
      linux&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x4e3b;&#x8981;&#x6709;&#x4e24;&#x79cd;&#x7c7b;&#x578b;&#x7684;tty&#x9a71;&#x52a8;
    </p>
    <p>
      1&#xff09;&#x865a;&#x62df;&#x7ec8;&#x7aef;&#xff08;Virtual Terminal&#xff0c;VT&#xff09;&#x9a71;&#x52a8;&#xff0c;&#x4f4d;&#x4e8e;drivers/tty/vt&#x4e2d;&#xff0c;&#x8d1f;&#x8d23;&#x5b9e;&#x73b0;VT&#x6709;&#x5173;&#x7684;&#x529f;&#x80fd;
    </p>
    <p>
      2&#xff09;&#x4e32;&#x53e3;&#x7ec8;&#x7aef;&#x9a71;&#x52a8;&#xff0c;&#x4e5f;&#x5373;&#x6211;&#x4eec;&#x6240;&#x719f;&#x77e5;&#x7684;serial subsystem&#xff0c;&#x4f4d;&#x4e8e;drivers/tty/serial&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1509181645596" FOLDED="true" ID="ID_657277457" MODIFIED="1510231178301">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#e40f0f" size="4">tty framework&#x5f53;&#x4e2d;&#x7684;&#x4e00;&#x4e9b;&#x6982;&#x5ff5;</font>
    </p>
  </body>
</html></richcontent>
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1509181691257" ID="ID_1505944771" MODIFIED="1509183580315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#1c2ef4">console driver</font></b>
    </p>
    <p>
      Linux&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x53ef;&#x4ee5;&#x5b58;&#x5728;&#x591a;&#x4e2a;&#x79cd;&#x7c7b;&#x7684;&#x8bbe;&#x5907;&#xff0c;&#x5de5;&#x7a0b;&#x5e08;&#x4f1a;&#x4f7f;&#x7528;&#x5404;&#x79cd;tty driver&#x6765;&#x9a71;&#x52a8;&#x5b83;&#x4eec;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x6211;&#x4eec;&#x9700;&#x8981;&#x8ba9;&#x67d0;&#x4e9b;tty&#x8bbe;&#x5907;&#x4f5c;&#x4e3a;&#x63a7;&#x5236;&#x53f0;&#x7ec8;&#x7aef;&#xff0c;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x57fa;&#x4e8e;tty driver&#xff0c;&#x521b;&#x5efa;&#x5bf9;&#x5e94;&#x7684;console driver,
    </p>
    <p>
      &#x5e76;&#x6ce8;&#x518c;&#x7ed9;kernel. &#x5173;&#x4e8e;console driver, kernel&#x6709;&#x5982;&#x4e0b;&#x7684;&#x7b56;&#x7565;&#x3002;
    </p>
    <p>
      1) &#x53ef;&#x4ee5;&#x6ce8;&#x518c;&#x591a;&#x4e2a;console driver,&#x5e76;&#x6709;&#x9009;&#x62e9;&#x5730;&#x4f7f;&#x7528;
    </p>
    <p>
      2)&#x53ef;&#x4ee5;&#x5728;kernel&#x542f;&#x52a8;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x901a;&#x8fc7;&#x547d;&#x4ee4;&#x884c;&#x544a;&#x8bc9;kernel&#x4f7f;&#x7528;&#x54ea;&#x4e2a;&#x63a7;&#x5236;&#x53f0;&#x7ec8;&#x7aef;
    </p>
    <p>
      console=&#x201d;/dev/ttyS0&#x201d;, console=&#x201d;/dev/ttyUSB0&#x201d;
    </p>
    <p>
      3)&#x5bf9;&#x4e8e;kernel&#x7684;&#x65e5;&#x5fd7;&#x8f93;&#x51fa;&#x6765;&#x8bf4;&#xff0c;&#x53ef;&#x4ee5;&#x5728;&#x6240;&#x6709;&#x88ab;&#x9009;&#x62e9;&#x7684;&#x63a7;&#x5236;&#x7ec8;&#x7aef;&#x4e0a;&#x9762;&#x8fdb;&#x884c;
    </p>
    <p>
      4)&#x5bf9;&#x4e8e;&#x540e;&#x671f;&#x7684;&#x4eba;&#x673a;&#x4ea4;&#x4e92;&#x7684;&#x63a7;&#x5236;&#x53f0;&#x7ec8;&#x7aef;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#xff0c;&#x800c;&#x4e14;&#x662f;&#x6700;&#x540e;&#x6307;&#x5b9a;&#x7684;&#x90a3;&#x4e2a;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1509183592846" ID="ID_1333612914" MODIFIED="1509183714805">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x63a7;&#x5236;&#x53f0;&#x7ec8;&#x7aef;/dev/console</b>
    </p>
    <p>
      &#x5728;&#x4eba;&#x673a;&#x4ea4;&#x4e92;&#x7684;&#x9636;&#x6bb5;&#xff0c;&#x63a7;&#x5236;&#x7ec8;&#x7aef;&#x53ea;&#x6709;&#x4e00;&#x4e2a;&#xff0c;&#x4f46;&#x662f;init&#x8fdb;&#x7a0b;&#x5728;&#x521d;&#x59cb;&#x5316;&#x7684;&#x65f6;&#x5019;&#x53ea;&#x4f1a;&#x56fa;&#x5b9a;&#x5730;&#x6253;&#x5f00;/dev/console&#x8fd9;&#x4e2a;
    </p>
    <p>
      &#x8bbe;&#x5907;&#x8282;&#x70b9;&#xff0c;&#x800c;tty core&#x4f1a;&#x5904;&#x7406;/dev/console&#x548c;&#x5177;&#x4f53;&#x7684;&#x63a7;&#x5236;&#x53f0;&#x9a71;&#x52a8;&#x7684;&#x5bf9;&#x63a5;(&#x6bd4;&#x5982;/dev/ttyS0)
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1509251645624" FOLDED="true" ID="ID_1455978797" MODIFIED="1510231177085" TEXT="tty &#x9a71;&#x52a8;&#x4ee3;&#x7801;&#x5206;&#x6790;">
<node CREATED="1470710686973" FOLDED="true" ID="ID_1378656370" MODIFIED="1510231175677">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.&#x6570;&#x636e;&#x5728;&#x5404;&#x4e2a;&#x5c42;&#x4e4b;&#x95f4;&#x7684;&#x6d41;&#x52a8;
    </p>
    <p>
      HCI &lt;-------&gt; BCSP &lt;---------&gt;HCI_UART&lt;-------&gt;UART
    </p>
  </body>
</html></richcontent>
<node CREATED="1470711367958" FOLDED="true" ID="ID_65627731" MODIFIED="1510231170725">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.HCI_UART&#x5c42;&#x7684;&#x52a0;&#x5165;drivers/bluetooth/hci_ldisc.c
    </p>
    <p>
      static int __init hci_uart_init(void)&#x51fd;&#x6570;&#x8c03;&#x7528;&#x51fd;&#x6570;tty_register_ldisc&#x5411;tty&#x5c42;&#x6ce8;&#x518c;
    </p>
    <p>
      &#x4e86;&#x4e00;&#x4e2a;&#x65b0;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;static struct tty_ldisc_ops hci_uart_ldisc
    </p>
    <p>
      &#x7136;&#x540e;&#x8c03;&#x7528;bcsp_init()&#x51fd;&#x6570;&#x6ce8;&#x518c;bcsp&#x534f;&#x8bae;
    </p>
  </body>
</html></richcontent>
<node CREATED="1470713791512" ID="ID_1817323073" MODIFIED="1470713798158">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="bluetoothpic/bcsp.png"/>
  </body>
</html></richcontent>
</node>
<node CREATED="1470713867656" FOLDED="true" ID="ID_416731030" MODIFIED="1510231169118">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6ce8;&#x518c;&#x65b0;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5176;&#x5b9e;&#x662f;&#x5c06;&#x65b0;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x653e;&#x5230;&#x4e86;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x7684;&#x6570;&#x636e;tty_ldiscs&#x5f53;&#x4e2d;&#x4e86;
    </p>
    <p>
      tty_register_ldisc(N_HCI, &amp;hci_uart_ldisc);
    </p>
    <p>
      &#x6ce8;&#x518c;&#x4e86;ID&#x662f;N_HCI&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;
    </p>
    <p>
      &#x8be5;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x4f1a;&#x5728;&#x7528;&#x6237;&#x7a7a;&#x95f4;&#x88ab;&#x7528;&#x6237;&#x8bbe;&#x7f6e;&#x4e3a;&#x9ed8;&#x8ba4;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;
    </p>
    <p>
      int i = N_HCI;
    </p>
    <p>
      ioctl(uart_fd, TIOCSETD, &amp;i)
    </p>
  </body>
</html></richcontent>
<node CREATED="1470729526998" ID="ID_1037676945" MODIFIED="1471942299003">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6ce8;&#x518c;&#x4e86;&#x65b0;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x4e4b;&#x540e;&#xff0c;&#x5bf9;&#x5e94;&#x7684;&#x89c4;&#x7a0b;&#x7684;ops&#x4e2d;&#x7684;ioctl
    </p>
    <p>
      &#x4f1a;&#x88ab;&#x4e0a;&#x5c42;&#x5e94;&#x7528;&#x8c03;&#x7528;&#x5230;
    </p>
    <p>
      static struct tty_ldisc_ops hci_uart_ldisc;
    </p>
    <p>
      hci_uart_ldisc.ioctl&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= hci_uart_tty_ioctl
    </p>
    <p>
      &#x5f53;&#x4e0a;&#x5c42;&#x5e94;&#x7528;&#x4f20;&#x5165;&#x7684;&#x547d;&#x4ee4;&#x662f;HCIUARTSETPROTO&#x7684;&#x65f6;&#x5019;&#xff0c;&#x4f1a;&#x8c03;&#x7528;
    </p>
    <p>
      hci_uart_set_proto(hu, arg)&#x51fd;&#x6570;-----&gt;&#x6ce8;&#x518c;hci_dev
    </p>
    <p>
      <b>int hci_register_dev(struct hci_dev *hdev) </b>
    </p>
    <p>
      &#x5728;&#x8be5;&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x4f1a;&#x6ce8;&#x518c;hci&#x8bbe;&#x5907;&#xff0c;&#x5206;&#x914d;hci&#x8bbe;&#x5907;&#x7684;id,&#x521d;&#x59cb;&#x5316;workqueue&#x548c;req_workqueue
    </p>
    <p>
      &#x8fd9;&#x4e24;&#x4e2a;&#x5de5;&#x4f5c;&#x961f;&#x5217;&#x6307;&#x9488;&#xff0c;&#x6ce8;&#x518c;&#x4e86;rfkill
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1470732231154" ID="ID_104448579" MODIFIED="1471935074363">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      struct tty_struct
    </p>
    <p>
      struct hci_uart
    </p>
    <p>
      struct hci_dev
    </p>
    <p>
      <b><i>&#x901a;&#x8fc7;&#x6ce8;&#x518c;hci_dev&#xff0c;&#x5c31;&#x76f8;&#x5f53;&#x4e8e;&#x5c06;hci&#x5c42;&#x52a0;&#x5165;&#x8fdb;&#x6765;&#x4e86;</i></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1470713977280" ID="ID_166465272" MODIFIED="1470719639859">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6dfb;&#x52a0;&#x65b0;&#x7684;&#x534f;&#x8bae;&#x65e0;&#x975e;&#x5c31;&#x662f;&#x5728;&#x4e00;&#x4e2a;&#x534f;&#x8bae;&#x6570;&#x7ec4;&#x5f53;&#x4e2d;&#x6dfb;&#x52a0;&#x4e86;&#x4e00;&#x4e2a;&#x5143;&#x7d20;&#x800c;&#x5df2;
    </p>
    <p>
      static const struct hci_uart_proto *hup[HCI_UART_MAX_PROTO];
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1470725962971" ID="ID_1193357865" MODIFIED="1470725979538" TEXT="&#x6dfb;&#x52a0;uart H4&#x534f;&#x8bae;"/>
</node>
<node CREATED="1470726118756" FOLDED="true" ID="ID_49373898" MODIFIED="1510231174333">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.uart driver&#x6ce8;&#x518c;
    </p>
    <p>
      &#xa0;static int __init serial8250_init(void)
    </p>
  </body>
</html></richcontent>
<node CREATED="1470900086785" FOLDED="true" ID="ID_1645616441" MODIFIED="1510231168110">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      1.int serial8250_pnp_init(void)&#x6ce8;&#x518c;pnp_driver:
    </p>
    <p>
      &#xa0;&#xa0; <font color="#ec0202">serial_pnp_driver</font>
    </p>
    <p>
      &#x6bcf;&#x5f53;&#x6709;&#x65b0;&#x7684;pnp_device&#x6ce8;&#x518c;&#x5230;&#x7cfb;&#x7edf;&#x5f53;&#x4e2d;&#x7684;&#x65f6;&#x5019;&#xff0c;
    </p>
    <p>
      &#x5c31;&#x4f1a;&#x751f;&#x6210;&#x4e00;&#x4e2a;&#x65b0;&#x7684;uart_8250_port&#xff0c;
    </p>
    <p>
      &#x8be5;port&#x4f1a;&#x88ab;&#x653e;&#x7f6e;&#x5230;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x6570;&#x7ec4;serial8250_ports[]
    </p>
    <p>
      &#x5f53;&#x4e2d;&#xff0c;&#x53ef;&#x4ee5;&#x53c2;&#x770b;&#x753b;&#x7684;&#x56fe;
    </p>
  </body>
</html></richcontent>
<node CREATED="1470909168041" ID="ID_1518727172" MODIFIED="1482991554090">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;&#x51fd;&#x6570;serial8250_isa_init_ports&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x8bbe;&#x7f6e;serial8250_ports[i]-&gt;ops = &amp;univ8250_driver_ops
    </p>
    <p>
      univ8250_driver_ops.setup_irq&#x4e2d;&#x8c03;&#x7528;&#x51fd;&#x6570;
    </p>
    <p>
      serial_link_irq_chain(up)&#x8bbe;&#x7f6e;&#x6bcf;&#x4e2a;uart_port&#x7684;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#x51fd;&#x6570;
    </p>
    <p>
      serial8250_interrupt
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#0d1e90" DESTINATION="ID_1518727172" ENDARROW="Default" ENDINCLINATION="462;0;" ID="Arrow_ID_30914952" SOURCE="ID_1843496547" STARTARROW="None" STARTINCLINATION="110;-44;"/>
</node>
</node>
<node CREATED="1470984593266" FOLDED="true" ID="ID_1136518736" MODIFIED="1510231166070">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      2.serial8250_isa_init_ports
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x4f1a;&#x521d;&#x59cb;&#x5316;serial8250_ports&#x6570;&#x7ec4;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x7684;uart_port&#x4e2d;&#x7684;ops&#x4e3a;<b><i>serial8250_pops</i></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1472017907395" FOLDED="true" ID="ID_421280983" MODIFIED="1510231164366">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      static const struct uart_ops serial8250_pops = {
    </p>
    <p>
      .tx_empty&#xa0;&#xa0;&#xa0;= serial8250_tx_empty,
    </p>
    <p>
      .set_mctrl&#xa0;&#xa0;= serial8250_set_mctrl,
    </p>
    <p>
      .get_mctrl&#xa0;&#xa0;= serial8250_get_mctrl,
    </p>
    <p>
      .stop_tx&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_stop_tx,
    </p>
    <p>
      .start_tx&#xa0;&#xa0;&#xa0;= serial8250_start_tx,
    </p>
    <p>
      .throttle&#xa0;&#xa0;&#xa0;= serial8250_throttle,
    </p>
    <p>
      &#xa0;.unthrottle = serial8250_unthrottle,
    </p>
    <p>
      &#xa0;.stop_rx&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_stop_rx,
    </p>
    <p>
      &#xa0;.enable_ms&#xa0;&#xa0;= serial8250_enable_ms,
    </p>
    <p>
      &#xa0;.break_ctl&#xa0;&#xa0;= serial8250_break_ctl,
    </p>
    <p>
      .startup&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_startup,
    </p>
    <p>
      .shutdown&#xa0;&#xa0;&#xa0;= serial8250_shutdown,
    </p>
    <p>
      .set_termios&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_set_termios,
    </p>
    <p>
      .set_ldisc&#xa0;&#xa0;= serial8250_set_ldisc,
    </p>
    <p>
      .pm&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_pm,
    </p>
    <p>
      .type&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_type,
    </p>
    <p>
      .release_port&#xa0;&#xa0;&#xa0;= serial8250_release_port,
    </p>
    <p>
      .request_port&#xa0;&#xa0;&#xa0;= serial8250_request_port,
    </p>
    <p>
      .config_port&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_config_port,
    </p>
    <p>
      .verify_port&#xa0;&#xa0;&#xa0;&#xa0;= serial8250_verify_port,
    </p>
    <p>
      &#xa0;.poll_get_char = serial8250_get_poll_char,
    </p>
    <p>
      &#xa0;.poll_put_char = serial8250_put_poll_char,
    </p>
  </body>
</html></richcontent>
<node CREATED="1472031335994" FOLDED="true" ID="ID_1843496547" MODIFIED="1510231162942">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;uart_port-&gt;ops&#x7684;startup&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#x4f1a;&#x4f18;&#x5148;&#x8c03;&#x7528;uart_port-&gt;start_up&#x51fd;&#x6570;&#xff0c;
    </p>
    <p>
      &#x6b21;&#x4f18;&#x5148;&#x4f1a;&#x8c03;&#x7528;serial8250_do_startup&#x51fd;&#x6570;----&#x300b;
    </p>
    <p>
      &#x5728;serial8250_do_startup&#x4e2d;&#x9996;&#x5148;&#x4f1a;&#x5224;&#x65ad;uart_port&#x548c;&#x5176;&#x6240;&#x5728;&#x7684;uart_8250_port
    </p>
    <p>
      &#x7684;iotype&#x662f;&#x5426;&#x76f8;&#x540c;&#xff0c;&#x82e5;&#x662f;&#x4e0d;&#x76f8;&#x540c;&#xff0c;&#x5219;&#x901a;&#x8fc7;set_io_from_upio(port)&#x51fd;&#x6570;&#x8bbe;&#x7f6e;uart_port
    </p>
    <p>
      &#x7684;handle_irq&#x51fd;&#x6570;
    </p>
    <p>
      &#x901a;&#x8fc7;uart_port&#x6620;&#x5c04;&#x5230;struct uart_8250_port
    </p>
    <p>
      &#x7136;&#x540e;&#x8c03;&#x7528;&#x4e86;<b>uart_8250_port-&gt;ops.setup_irq(up)</b>&#x51fd;&#x6570;&#x7528;&#x4e8e;&#x8bbe;&#x7f6e;uart_port&#x7684;
    </p>
    <p>
      &#x4e2d;&#x65ad;&#x5904;&#x7406;&#x51fd;&#x6570;
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#0d1e90" DESTINATION="ID_1518727172" ENDARROW="Default" ENDINCLINATION="462;0;" ID="Arrow_ID_30914952" STARTARROW="None" STARTINCLINATION="110;-44;"/>
<node CREATED="1472103741854" ID="ID_381281961" MODIFIED="1472104050304">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      uart&#x7684;&#x4e2d;&#x65ad;&#x51fd;&#x6570;&#x63a5;&#x6536;&#x5230;&#x6570;&#x636e;&#x4e4b;&#x540e;&#xff0c;&#x4f1a;&#x901a;&#x8fc7;
    </p>
    <p>
      tty&#x5c42;&#x63a5;&#x53e3;&#x5c06;&#x6570;&#x636e;&#x4f20;&#x9012;&#x7ed9;tty&#x5c42;&#xff0c;&#x7136;&#x540e;tty&#x5c42;&#x4f1a;&#x628a;&#x6570;&#x636e;
    </p>
    <p>
      &#x4ea4;&#x7ed9;ldisc&#x5c42;<b>hci_uart_tty_receive</b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1474128013979" ID="ID_1820128502" MODIFIED="1482993008051">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x540c;&#x65f6;&#x4f1a;&#x5c06;old_serial_port&#x6570;&#x7ec4;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x5b9a;&#x4e49;&#x7684;uart_port&#x7684;&#x4e32;&#x53e3;&#x53c2;&#x6570;&#x8d4b;&#x503c;&#x7ed9;&#x5bf9;&#x5e94;&#x7684;
    </p>
    <p>
      uart_8250_port-&gt;port,
    </p>
    <p>
      &#x7136;&#x540e;&#x68c0;&#x67e5;<font color="#ea0909">serial8250_isa_config</font>&#x6307;&#x9488;&#x6709;&#x6ca1;&#x6709;&#x88ab;&#x8d4b;&#x503c;&#xff0c;
    </p>
    <p>
      &#x5982;&#x679c;&#x88ab;&#x8d4b;&#x503c;&#x4e86;&#xff0c;&#x5c31;&#x5bf9;&#x4e0a;&#x9762;&#x7684;port&#x8fdb;&#x884c;&#x64cd;&#x4f5c;(&#x53ef;&#x80fd;&#x662f;&#x4e3a;&#x4e86;
    </p>
    <p>
      &#x4fee;&#x590d;&#x67d0;&#x4e9b;&#x5e73;&#x53f0;&#x4e0b;&#x9762;&#x7684;&#x4e32;&#x53e3;&#x53c2;&#x6570;)
    </p>
    <p>
      serial8250_isa_config&#x4f1a;&#x5728;&#x5177;&#x4f53;&#x7684;soc&#x7684;&#x5e73;&#x53f0;&#x4ee3;&#x7801;&#x5f53;&#x4e2d;
    </p>
    <p>
      &#x88ab;&#x8d4b;&#x503c;&#x3002;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1472007183504" FOLDED="true" ID="ID_1551873706" MODIFIED="1510231160374">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      3.&#x8c03;&#x7528;int uart_register_driver(struct uart_driver *drv)&#x51fd;&#x6570;&#x901a;&#x8fc7;&#x4e00;&#x4e2a;uart_driver
    </p>
    <p>
      &#x751f;&#x6210;tty_driver,&#x5e76;&#x4e14;&#x6839;&#x636e;uart_driver&#x91cc;&#x9762;&#x7684;nr&#x53c2;&#x6570;&#x751f;&#x6210;tty_driver&#x91cc;&#x9762;&#x7684;tty_struct&#x548c;
    </p>
    <p>
      tty_port&#x6570;&#x7ec4;&#x6307;&#x9488;,
    </p>
    <p>
      &#x5e76;&#x8bbe;&#x7f6e;tty_driver&#x91cc;&#x9762;&#x7684;ops&#x53c2;&#x6570;&#x4e3a;uart_ops;
    </p>
    <p>
      drv-&gt;state = kzalloc(sizeof(struct uart_state) * drv-&gt;nr, GFP_KERNEL)&#x5206;&#x914d;tty_driver
    </p>
    <p>
      &#x91cc;&#x9762;&#x7684;state&#x6570;&#x7ec4;&#xff0c;<b>state&#x6307;&#x9488;&#x662f;&#x975e;&#x5e38;&#x91cd;&#x8981;&#x7684;&#x4e00;&#x4e2a;&#x6210;&#x5458;&#x53d8;&#x91cf; </b>
    </p>
    <p>
      <i><font color="#104b32">for (i = 0; i &lt; drv-&gt;nr; i++) { </font></i>
    </p>
    <p>
      <i><font color="#104b32">struct uart_state *state = drv-&gt;state + i; </font></i>
    </p>
    <p>
      <i><font color="#104b32">struct tty_port *port = &amp;state-&gt;port; </font></i>
    </p>
    <p>
      <i><font color="#104b32">tty_port_init(port); </font></i>
    </p>
    <p>
      <i><font color="#104b32">port-&gt;ops = &amp;uart_port_ops; </font></i>
    </p>
    <p>
      <i><font color="#104b32">}</font></i>
    </p>
    <p>
      <b>static const struct tty_port_operations uart_port_ops = { </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;.activate&#xa0;&#xa0;&#xa0;= uart_port_activate, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;.shutdown&#xa0;&#xa0;&#xa0;= uart_port_shutdown, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;.carrier_raised = uart_carrier_raised, </b>
    </p>
    <p>
      <b>&#xa0;&#xa0;&#xa0;&#xa0;.dtr_rts&#xa0;&#xa0;&#xa0;&#xa0;= uart_dtr_rts, </b>
    </p>
    <p>
      <b>};</b>
    </p>
    <p>
      
    </p>
    <p>
      
    </p>
    <p>
      <font color="#e50e0e">&#x6700;&#x540e;&#x8c03;&#x7528;&#x51fd;&#x6570;tty_register_driver&#x6ce8;&#x518c;tty_driver</font>
    </p>
    <p>
      <b><i>tty_driver&#x91cc;&#x9762;&#x7684;ops&#x4e2d;&#x7684;uart_open&#x51fd;&#x6570;&#x7531;tty_open&#x51fd;&#x6570;tty-&gt;ops-&gt;open </i></b>
    </p>
    <p>
      <b><i>&#x8c03;&#x7528;&#x8fdb;&#x6765;</i></b>
    </p>
  </body>
</html></richcontent>
<arrowlink COLOR="#d80606" DESTINATION="ID_1579064263" ENDARROW="Default" ENDINCLINATION="325;0;" ID="Arrow_ID_1375331762" STARTARROW="None" STARTINCLINATION="734;0;"/>
<node CREATED="1476436212960" ID="ID_19511930" MODIFIED="1484815918059">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5206;&#x6790;&#x4e00;&#x4e0b;static int uart_open(struct tty_struct *tty, struct file *filp)&#x51fd;&#x6570;</b>
    </p>
    <p>
      uart_open&#x662f;&#x88ab;&#x5c01;&#x88c5;&#x5230;static const struct tty_operations uart_ops&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#x7684;&#xff0c;&#x5728;&#x5177;&#x4f53;&#x7684;
    </p>
    <p>
      &#x4e32;&#x53e3;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;&#x6211;&#x4eec;&#x53ef;&#x4ee5;&#x5b9a;&#x4e49;&#x81ea;&#x5df1;&#x7684;uart_ops-&gt;open&#x51fd;&#x6570;&#xff0c;&#x8fd9;&#x91cc;&#x5206;&#x6790;&#x7684;uart_open&#x51fd;&#x6570;&#x4f4d;&#x4e8e;
    </p>
    <p>
      &#x6587;&#x4ef6; tty/serial/serial_core.c&#x5f53;&#x4e2d;
    </p>
    <p>
      uart_open&#x4f1a;&#x901a;&#x8fc7;<b>state&#x6307;&#x9488;</b>&#x8c03;&#x7528;&#x5230;uart_port&#xff0c;&#x4ece;&#x800c;&#x771f;&#x6b63;&#x542f;&#x52a8;&#x786c;&#x4ef6;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1482991816443" FOLDED="true" ID="ID_1686420308" MODIFIED="1510231157654">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x4f20;&#x9012;&#x8fdb;&#x53bb;&#x7684;uart_driver&#x6570;&#x636e;&#x7ed3;&#x6784;&#x6307;&#x9488;&#x662f;&#x5982;&#x4e0b;&#x7684;&#x7ed3;&#x6784;:
    </p>
    <p>
      <b><i>static struct uart_driver serial8250_reg</i></b>&#xa0;= {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.owner&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= THIS_MODULE,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.driver_name&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= "serial",
    </p>
    <p>
      &#xa0;&#xa0;&#xa0; <b><i>.dev_name&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= "ttyS",</i></b>
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.major&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= TTY_MAJOR,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.minor&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= 64,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.cons&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= SERIAL8250_CONSOLE,
    </p>
    <p>
      };
    </p>
    <p>
      <b>serial8250_reg.nr = UART_NR</b>
    </p>
    <p>
      &#x8fd9;&#x91cc;&#x5b9a;&#x4e49;&#x7684;&#x6700;&#x5927;&#x7684;&#x7aef;&#x53e3;&#x6570;&#x76ee;&#x662f;48
    </p>
  </body>
</html></richcontent>
<node CREATED="1482994566988" ID="ID_1328641476" MODIFIED="1482994822084">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5728;uart_driver&#x7ed3;&#x6784;&#x4f53;&#x5f53;&#x4e2d;&#x6709;&#x4e00;&#x4e2a;&#x6210;&#x5458;&#x53d8;&#x91cf;&#x53eb;&#x505a;struct uart_state&#xa0;&#xa0;&#xa0;*state
    </p>
    <p>
      &#x975e;&#x5e38;&#x91cd;&#x8981;&#xff0c; serial8250_reg&#x5f53;&#x4e2d;&#x7684;state&#x6307;&#x9488;&#x5f53;&#x4e2d;&#x7684;&#x6bcf;&#x4e2a;&#x6210;&#x5458;&#x4f1a;&#x901a;&#x8fc7;&#x51fd;&#x6570;
    </p>
    <p>
      serial8250_register_ports(&amp;serial8250_reg, &amp;serial8250_isa_devs-&gt;dev)
    </p>
    <p>
      &#x6765;&#x88ab;&#x521d;&#x59cb;&#x5316;&#x4e00;&#x6b21;&#x3002;
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x4f7f;&#x7528;&#x5982;&#x4e0b;&#x65b9;&#x6cd5;&#x5bf9;state&#x8fdb;&#x884c;&#x521d;&#x59cb;&#x5316;
    </p>
    <p>
      struct uart_8250_port *up = &amp;serial8250_ports[i]
    </p>
    <p>
      uart_add_one_port(drv, &amp;up-&gt;port)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1482994825296" ID="ID_1766623573" MODIFIED="1483013906995">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      int uart_add_one_port(struct uart_driver *drv, struct uart_port *uport)&#x51fd;&#x6570;&#x5206;&#x6790;
    </p>
    <p>
      a.
    </p>
    <p>
      state-&gt;uart_port = uport;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;
    </p>
    <p>
      uport-&gt;state = state
    </p>
    <p>
      &#x8fd9;&#x91cc;&#x662f;&#x5c06;uart_state&#x548c;uart_8250_port.port&#x8054;&#x7cfb;&#x5728;&#x4e86;&#x4e00;&#x8d77;
    </p>
    <p>
      b.
    </p>
    <p>
      &#x8c03;&#x7528;&#x51fd;&#x6570;uart_configure_port(drv, state, uport)
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1482993532770" ID="ID_662851558" MODIFIED="1509980659454">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font size="2"><b>static const struct tty_operations uart_ops </b>= { </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.open&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= uart_open, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.close&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= uart_close, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.write&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= uart_write, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.put_char&#xa0;&#xa0;&#xa0;= uart_put_char, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.flush_chars&#xa0;&#xa0;&#xa0;&#xa0;= uart_flush_chars, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.write_room = uart_write_room, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.chars_in_buffer= uart_chars_in_buffer, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.flush_buffer&#xa0;&#xa0;&#xa0;= uart_flush_buffer, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.ioctl&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= uart_ioctl, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.throttle&#xa0;&#xa0;&#xa0;= uart_throttle, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.unthrottle = uart_unthrottle, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.send_xchar = uart_send_xchar, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.set_termios&#xa0;&#xa0;&#xa0;&#xa0;= uart_set_termios, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.set_ldisc&#xa0;&#xa0;= uart_set_ldisc, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.stop&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= uart_stop, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.start&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= uart_start, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.hangup&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= uart_hangup, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.break_ctl&#xa0;&#xa0;= uart_break_ctl, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.wait_until_sent= uart_wait_until_sent, </font>
    </p>
    <p>
      <font size="2">#ifdef CONFIG_PROC_FS </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.proc_fops&#xa0;&#xa0;= &amp;uart_proc_fops, </font>
    </p>
    <p>
      <font size="2">#endif </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.tiocmget&#xa0;&#xa0;&#xa0;= uart_tiocmget, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.tiocmset&#xa0;&#xa0;&#xa0;= uart_tiocmset, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.get_icount = uart_get_icount, </font>
    </p>
    <p>
      <font size="2">#ifdef CONFIG_CONSOLE_POLL </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.poll_init&#xa0;&#xa0;= uart_poll_init, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.poll_get_char&#xa0;&#xa0;= uart_poll_get_char, </font>
    </p>
    <p>
      <font size="2">&#xa0;&#xa0;&#xa0;&#xa0;.poll_put_char&#xa0;&#xa0;= uart_poll_put_char, </font>
    </p>
    <p>
      <font size="2">#endif </font>
    </p>
    <p>
      <font size="2">};</font>
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1470990859384" ID="ID_184609849" MODIFIED="1470991053168">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>3</b>.<b><i>&#x6ce8;&#x518c;&#x4e86;&#x4e00;&#x4e2a;platform_driver serial8250_isa_driver</i></b>
    </p>
    <p>
      &#x5728;&#x8be5;driver&#x7684;probe&#x51fd;&#x6570;&#x5f53;&#x4e2d;&#xff0c;&#x901a;&#x8fc7;platform_device-&gt;device
    </p>
    <p>
      &#x5b58;&#x50a8;&#x7684;platform data&#x6765;&#x521d;&#x59cb;&#x5316;uart_8250_port&#x6570;&#x636e;&#xff0c;
    </p>
    <p>
      &#x540c;&#x65f6;&#x5c06;&#x8be5;uart_8250_port&#x6ce8;&#x518c;&#x5230;&#x6570;&#x7ec4;serial8250_ports&#x5f53;&#x4e2d;&#x53bb;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1472105965697" FOLDED="true" ID="ID_1722919533" MODIFIED="1510231151240" TEXT="H4&#x5c42;&#x7684;&#x63a5;&#x6536;">
<node CREATED="1472105981297" ID="ID_1046019682" MODIFIED="1472106084022">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>h4&#x5c42;&#x53ea;&#x8bc6;&#x522b;3&#x79cd;&#x5e27;&#x7c7b;&#x578b;</i></b>
    </p>
    <p>
      static const struct h4_recv_pkt h4_recv_pkts[] = {
    </p>
    <p>
      { H4_RECV_ACL,&#xa0;&#xa0;&#xa0;.recv = hci_recv_frame },
    </p>
    <p>
      { H4_RECV_SCO,&#xa0;&#xa0;&#xa0;.recv = hci_recv_frame },
    </p>
    <p>
      { H4_RECV_EVENT, .recv = hci_recv_frame },
    </p>
    <p>
      &#xa0;};
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1476410145894" FOLDED="true" ID="ID_1591605326" MODIFIED="1510231150048" TEXT="tty&#x9a71;&#x52a8;&#x5c42;&#x7ed3;&#x6784;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1476413134844" FOLDED="true" ID="ID_1261360145" MODIFIED="1510231149016" TEXT="core&#x5c42;&#x4ee3;&#x7801;&#x5206;&#x6790;">
<node CREATED="1476413149260" FOLDED="true" ID="ID_1607329353" MODIFIED="1510231146328">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <font color="#1f22f4">1.&#x9996;&#x5148;&#x770b;&#x4e00;&#x4e0b;tty_driver&#x7684;&#x7ed3;&#x6784;&#x4f53;&#xff0c;tty_driver&#x901a;&#x5e38;&#x662f;&#x5728; </font>
    </p>
    <p>
      <font color="#1f22f4">&#x4e32;&#x53e3;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x5f53;&#x4e2d;&#x88ab;&#x52a8;&#x6001;&#x5206;&#x914d;&#x7684;&#xff0c;&#x7136;&#x540e;&#x8c03;&#x7528;tty&#x5c42;&#x7684;&#x63a5;&#x53e3; </font>
    </p>
    <p>
      <font color="#1f22f4">&#x8fdb;&#x884c;&#x6ce8;&#x518c;&#x3002;</font>
    </p>
    <p>
      <b><i>struct tty_driver { </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;int magic;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* magic number for this structure */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct kref kref;&#xa0;&#xa0;&#xa0;/* Reference management */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct cdev *cdevs; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct module&#xa0;&#xa0;&#xa0;*owner; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;const char&#xa0;&#xa0;*driver_name; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;const char&#xa0;&#xa0;*name; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;int name_base;&#xa0;&#xa0;/* offset of printed name */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;int major;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* major device number */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;int minor_start;&#xa0;&#xa0;&#xa0;&#xa0;/* start of minor device number */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;unsigned int&#xa0;&#xa0;&#xa0;&#xa0;num;&#xa0;&#xa0;&#xa0;&#xa0;/* number of devices allocated */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;short&#xa0;&#xa0;&#xa0;type;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* type of tty driver */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;short&#xa0;&#xa0;&#xa0;subtype;&#xa0;&#xa0;&#xa0;&#xa0;/* subtype of tty driver */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct ktermios init_termios; /* Initial termios */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;unsigned long&#xa0;&#xa0;&#xa0;flags;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;/* tty driver flags */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct proc_dir_entry *proc_entry; /* /proc fs entry */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct tty_driver *other; /* only used for the PTY driver */ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;/* </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Pointer to the tty data structures </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/ </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct tty_struct **ttys; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct tty_port **ports; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct ktermios **termios; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;void *driver_state; </i></b>
    </p>
    <p>
      
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;/* </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;* Driver methods </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;*/ </i></b>
    </p>
    <p>
      
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;const struct tty_operations *ops; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct list_head tty_drivers; </i></b>
    </p>
    <p>
      <b><i>}; </i></b>
    </p>
    <p>
      <b><font color="#ee1515">tty_driver&#x6de1;&#x5316;&#x4e86;device&#x7684;&#x6982;&#x5ff5;&#xff0c;&#x7740;&#x91cd;&#x7a81;&#x51fa;&#x4e86;driver,&#x6211;&#x4eec;&#x770b;&#x5230;tty_driver&#x7ed3;&#x6784;&#x4f53;&#x91cc;&#x9762;&#x5305;&#x542b;&#x4e86;&#x8ddf;device&#x6709;&#x5173;&#x7684;&#x4e00;&#x4e9b;cdev</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1509258452314" ID="ID_781773938" MODIFIED="1509258490454">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      tty struct&#x5728;tty driver&#x770b;&#x6765;&#x4ee3;&#x8868;&#x8fd9;&#x4e00;&#x4e2a;&#x8bbe;&#x5907;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1509259849842" ID="ID_1892938043" MODIFIED="1509980974290">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      TTY struct&#x662f;TTY&#x8bbe;&#x5907;&#x7684;&#x201c;&#x52a8;&#x6001;&#x62bd;&#x8c61;&#x201d;&#xff0c;&#x4fdd;&#x5b58;&#x4e86;TTY&#x8bbe;&#x5907;&#x8bbf;&#x95ee;&#x8fc7;&#x7a0b;&#x4e2d;&#x7684;&#x4e00;&#x4e9b;&#x4e34;&#x65f6;&#x4fe1;&#x606f;&#xff0c;&#x8fd9;&#x4e9b;&#x4fe1;&#x606f;&#x662f;&#x6709;&#x751f;&#x547d;&#x5468;&#x671f;&#x7684;&#xff1a;&#x4ece;&#x6253;&#x5f00;TTY&#x8bbe;&#x5907;&#x5f00;&#x59cb;&#xff0c;&#x5230;&#x5173;&#x95ed;TTY&#x8bbe;&#x5907;&#x7ed3;&#x675f;
    </p>
    <p>
      TTY port&#x662f;TTY&#x8bbe;&#x5907;&#x56fa;&#x6709;&#x5c5e;&#x6027;&#x7684;&#x201c;&#x9759;&#x6001;&#x62bd;&#x8c61;&#x201d;&#xff0c;&#x4fdd;&#x5b58;&#x4e86;&#x8be5;&#x8bbe;&#x5907;&#x7684;&#x4e00;&#x4e9b;&#x56fa;&#x5b9a;&#x4e0d;&#x53d8;&#x7684;&#x5c5e;&#x6027;&#x503c;&#xff0c;&#x4f8b;&#x5982;&#x662f;&#x5426;&#x662f;&#x4e00;&#x4e2a;&#x63a7;&#x5236;&#x53f0;&#x8bbe;&#x5907;&#xff08;console&#xff09;&#x3001;&#x6253;&#x5f00;&#x5173;&#x95ed;&#x65f6;&#x662f;&#x5426;&#x9700;&#x8981;&#x4e00;&#x4e9b;delay&#x64cd;&#x4f5c;&#x3001;&#x7b49;&#x7b49;
    </p>
    <p>
      &#x53e6;&#x5916;&#xff08;&#x8fd9;&#x4e00;&#x70b9;&#x5f88;&#x91cd;&#x8981;&#xff09;&#xff0c;TTY core&#x8d1f;&#x8d23;&#x7684;&#x662f;&#x903b;&#x8f91;&#x4e0a;&#x7684;&#x62bd;&#x8c61;&#xff0c;&#x5e76;&#x4e0d;&#x5173;&#x5fc3;&#x8fd9;&#x4e9b;&#x56fa;&#x6709;&#x5c5e;&#x6027;&#x3002;&#x56e0;&#x6b64;&#x4ece;&#x5c42;&#x6b21;&#x4e0a;&#x770b;&#xff0c;&#x8fd9;&#x4e9b;&#x5c5e;&#x6027;&#x5b8c;&#x5168;&#x53ef;&#x4ee5;&#x7531;&#x5177;&#x4f53;&#x7684;TTY driver&#x81ea;&#x884c;&#x7ef4;&#x62a4;
    </p>
    <p>
      &#x4e0d;&#x8fc7;&#xff0c;&#x7531;&#x4e8e;&#x4e0d;&#x540c;TTY&#x8bbe;&#x5907;&#x7684;&#x5c5e;&#x6027;&#x6709;&#x5f88;&#x591a;&#x5171;&#x6027;&#xff0c;&#x5982;&#x679c;&#x6bcf;&#x4e2a;TTY driver&#x90fd;&#x7ef4;&#x62a4;&#x4e00;&#x4e2a;&#x79c1;&#x6709;&#x7684;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff0c;&#x5c06;&#x5e26;&#x6765;&#x4ee3;&#x7801;&#x7684;&#x5197;&#x4f59;&#x3002;&#x6240;&#x4ee5;TTY framework&#x5c31;&#x5c06;&#x8fd9;&#x4e9b;&#x5171;&#x540c;&#x7684;&#x5c5e;&#x6027;&#x62bd;&#x8c61;&#x51fa;&#x6765;&#xff0c;
    </p>
    <p>
      &#x4fdd;&#x5b58;&#x5728;struct tty_port&#x6570;&#x636e;&#x7ed3;&#x6784;&#x4e2d;&#xff0c;&#x540c;&#x65f6;&#x63d0;&#x4f9b;&#x4e00;&#x4e9b;&#x901a;&#x7528;&#x7684;&#x64cd;&#x4f5c;&#x63a5;&#x53e3;&#xff0c;&#x4f9b;&#x5177;&#x4f53;&#x7684;TTY driver&#x4f7f;&#x7528;
    </p>
    <p>
      <font color="#eb1818">&#x56e0;&#x6b64;&#xff0c;&#x603b;&#x7ed3;&#x6765;&#x8bf4;&#xff1a;TTY struct&#x662f;TTY core&#x7684;&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff0c;&#x7531;TTY core&#x63d0;&#x4f9b;&#x5e76;&#x4f7f;&#x7528;&#xff0c;&#x5fc5;&#x8981;&#x7684;&#x65f6;&#x5019;&#x53ef;&#x4ee5;&#x501f;&#x7ed9;&#x5177;&#x4f53;&#x7684;TTY driver&#x4f7f;&#x7528; </font>
    </p>
    <p>
      <font color="#eb1818">TTY port&#x662f;TTY driver&#x7684;&#x4e00;&#x4e2a;&#x6570;&#x636e;&#x7ed3;&#x6784;&#xff0c;&#x7531;TTY core&#x63d0;&#x4f9b;&#xff0c;&#x7531;&#x5177;&#x4f53;&#x7684;TTY driver&#x4f7f;&#x7528;&#xff0c;TTY core&#x5b8c;&#x5168;&#x4e0d;&#x5173;&#x5fc3;&#x3002;</font>
    </p>
  </body>
</html></richcontent>
<font NAME="SansSerif" SIZE="12"/>
</node>
</node>
<node CREATED="1476413768877" FOLDED="true" ID="ID_1579064263" MODIFIED="1510231142081">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>2.&#x770b;&#x4e00;&#x4e0b;&#x51fd;&#x6570; int tty_register_driver(struct tty_driver *driver)</b>
    </p>
    <p>
      a. &#x9996;&#x5148;&#x52a8;&#x6001;&#x6216;&#x8005;&#x9759;&#x6001;&#x5730;&#x5206;&#x914d;dev_t, &#x5982;&#x679c;&#x662f;&#x52a8;&#x6001;&#x5206;&#x914d;&#x7684;&#xff0c;&#x5219;&#x5c06;driver&#x91cc;&#x9762;&#x7684;&#x4e24;&#x4e2a;
    </p>
    <p>
      &#x53c2;&#x6570;&#x8fdb;&#x884c;&#x8d4b;&#x503c;&#x64cd;&#x4f5c;
    </p>
    <p>
      driver-&gt;major = MAJOR(dev);
    </p>
    <p>
      driver-&gt;minor_start = MINOR(dev);
    </p>
    <p>
      b. &#x7136;&#x540e;&#x8be5;&#x51fd;&#x6570;&#x4f1a;&#x6839;&#x636e;driver-&gt;flags&#x7684;&#x6807;&#x5fd7;&#x4f4d;&#x8fdb;&#x884c;&#x76f8;&#x5e94;&#x7684;&#x52a8;&#x4f5c;:
    </p>
    <p>
      &#x5982;&#x679c;&#x8bbe;&#x7f6e;&#x4e86;<b>TTY_DRIVER_DYNAMIC_ALLOC</b>&#x6807;&#x5fd7;&#x4f4d;&#xff0c;&#x90a3;&#x4e48;
    </p>
    <p>
      &#x53ea;&#x4f1a;&#x5bf9;driver-&gt;cdev[0]&#x8bbe;&#x7f6e;&#x5bf9;&#x5e94;&#x7684;&#x5b57;&#x7b26;&#x8bbe;&#x5907;&#x64cd;&#x4f5c;&#x51fd;&#x6570;fops
    </p>
    <p>
      &#x4e0d;&#x4f1a;&#x5bf9;&#x5176;&#x4ed6;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x8fdb;&#x884c;&#x76f8;&#x5e94;&#x7684;fops&#x7684;&#x8bbe;&#x7f6e;&#x548c;&#x8282;&#x70b9;&#x7684;&#x663e;&#x793a;,&#x4e00;&#x822c;&#x6765;&#x8bb2;
    </p>
    <p>
      &#x4e32;&#x53e3;&#x9a71;&#x52a8;&#x5728;&#x5206;&#x914d;driver&#x7684;&#x65f6;&#x5019;&#x662f;&#x4e0d;&#x4f1a;&#x8bbe;&#x7f6e;&#x8be5;&#x6807;&#x5fd7;&#x4f4d;&#x7684;&#x3002;
    </p>
    <p>
      &#x5982;&#x679c;&#x6ca1;&#x6709;&#x8bbe;&#x7f6e;<b>TTY_DRIVER_DYNAMIC_DEV</b>&#x6807;&#x5fd7;&#x4f4d;&#xff0c;&#x5219;&#x5bf9;&#x6bcf;&#x4e00;&#x4e2a;
    </p>
    <p>
      &#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x8c03;&#x7528;<font color="#e60808">tty_register_device</font>&#x5206;&#x914d;struct device&#x7ed3;&#x6784;&#x4f53;&#xff0c;&#x5e76;&#x4e14;&#x8bbe;&#x7f6e;&#x5bf9;&#x5e94;&#x7684;cdev&#x7684;fops
    </p>
    <p>
      &#x5728;tty_register_device&#x51fd;&#x6570;&#x4e2d;&#x8bbe;&#x7f6e;tty&#x7684;&#x8bbe;&#x5907;&#x7684;&#x540d;&#x79f0;&#xff0c;&#x8be5;&#x540d;&#x79f0;&#x662f;&#x4ece;
    </p>
    <p>
      <font color="#ec0b0b">tty_driver&#x5f53;&#x4e2d;&#x83b7;&#x5f97;&#x7684;&#xff0c;&#x800c;tty_deriver&#x7684;name&#x662f;&#x4ece;uart_driver&#x5f53;&#x4e2d;&#x8d4b;&#x503c;&#x800c;&#x6765;&#x7684;</font>
    </p>
    <p>
      &#x4e00;&#x822c;&#x5728;&#x4e32;&#x53e3;&#x9a71;&#x52a8;&#x5f53;&#x4e2d;<b>TTY_DRIVER_DYNAMIC_ALLOC&#xff0c;TTY_DRIVER_DYNAMIC_DEV </b>
    </p>
    <p>
      &#x53d8;&#x91cf;&#x90fd;&#x4e0d;&#x4f1a;&#x88ab;&#x8bbe;&#x7f6e;&#xff0c;&#x4e5f;&#x5c31;&#x662f;&#x8bf4;&#x4e32;&#x53e3;&#x9a71;&#x52a8;&#x7a0b;&#x5e8f;&#x5728;&#x8c03;&#x7528;tty_register_driver&#x63a5;&#x53e3;
    </p>
    <p>
      &#x7684;&#x65f6;&#x5019;&#x4f1a;&#x9ed8;&#x8ba4;&#x8981;&#x5bf9;&#x6240;&#x6709;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#x8fdb;&#x884c;&#x5206;&#x914d;&#x3002;<font color="#e20909">&#x53ef;&#x4ee5;&#x770b;&#x51fa;&#x8fd9;&#x4e24;&#x4e2a;&#x6807;&#x5fd7;&#x4f4d;&#x5728;&#x5185;&#x6838;&#x4e2d; </font>
    </p>
    <p>
      <font color="#e20909">&#x662f;&#x4e3a;&#x4e86;&#x8282;&#x7701;&#x5185;&#x5b58;&#x800c;&#x8bbe;&#x7f6e;&#x7684;&#x3002;</font>
    </p>
  </body>
</html></richcontent>
<linktarget COLOR="#d80606" DESTINATION="ID_1579064263" ENDARROW="Default" ENDINCLINATION="325;0;" ID="Arrow_ID_1375331762" SOURCE="ID_1551873706" STARTARROW="None" STARTINCLINATION="734;0;"/>
<node CREATED="1476415508655" FOLDED="true" ID="ID_1113658622" MODIFIED="1510231140913">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>&#x770b;&#x4e00;&#x4e0b;&#x8ddf;tty&#x8282;&#x70b9;&#x64cd;&#x4f5c;&#x76f8;&#x5173;&#x7684;fops&#x7684;&#x7ed3;&#x6784;&#x4f53;</i></b>
    </p>
    <p>
      static const struct file_operations tty_fops = {
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.llseek&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= no_llseek,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.read&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= tty_read,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.write&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= tty_write,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.poll&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= tty_poll,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.unlocked_ioctl = tty_ioctl,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.compat_ioctl&#xa0;&#xa0;&#xa0;= tty_compat_ioctl,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.open&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= tty_open,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.release&#xa0;&#xa0;&#xa0;&#xa0;= tty_release,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;.fasync&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;= tty_fasync,
    </p>
    <p>
      };
    </p>
  </body>
</html></richcontent>
<node CREATED="1476423699133" ID="ID_1295788636" MODIFIED="1476436057900">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5206;&#x6790;&#x4e00;&#x4e0b;tty_open&#x8fd9;&#x4e2a;&#x51fd;&#x6570;:</b>
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x9996;&#x5148;&#x4f1a;&#x901a;&#x8fc7;dev_t device = inode-&gt;i_rdev
    </p>
    <p>
      &#x6765;&#x5224;&#x65ad;&#x6253;&#x5f00;&#x7684;&#x662f;&#x4e0d;&#x662f;&#x5185;&#x6838;&#x5df2;&#x7ecf;&#x5b9a;&#x4e49;&#x597d;&#x7684;&#x63a7;&#x5236;&#x7ec8;&#x7aef;&#xff0c;&#x5982;&#x679c;&#x4e0d;&#x662f;&#x5219;
    </p>
    <p>
      &#x901a;&#x8fc7;<b>get_tty_driver(device, index</b>)&#x51fd;&#x6570;&#x67e5;&#x627e;&#x6211;&#x4eec;&#x5df2;&#x7ecf;&#x6ce8;&#x518c;&#x5230;
    </p>
    <p>
      &#x5185;&#x6838;&#x94fe;&#x8868;tty_drivers&#x5f53;&#x4e2d;&#x7684;struct tty_driver&#x6307;&#x9488;&#x3002;
    </p>
    <p>
      &#x8c03;&#x7528;<b>tty_driver_lookup_tty(driver, inode, index)</b>&#x51fd;&#x6570;&#xff0c;&#x5728;&#x8be5;&#x51fd;&#x6570;&#x91cc;&#x9762;
    </p>
    <p>
      &#x901a;&#x8fc7;driver-&gt;ops-&gt;lookup&#x51fd;&#x6570;&#x6216;&#x8005;driver-&gt;ttys[idx]&#x6570;&#x7ec4;&#x6765;&#x8fd4;&#x56de;&#x8be5;
    </p>
    <p>
      tty_driver&#x6240;&#x5bf9;&#x5e94;&#x7684;struct tty_struct&#x6307;&#x9488;,&#x5982;&#x679c;index&#x5bf9;&#x5e94;&#x7684;tty&#x8fd8;&#x6ca1;&#x6709;&#x5206;&#x914d;&#xff0c;
    </p>
    <p>
      &#x5219;&#x8be5;&#x51fd;&#x6570;&#x8fd4;&#x56de;&#x7684;&#x662f;&#x7a7a;&#x6307;&#x9488;&#xff0c;&#x6b64;&#x65f6;&#x6211;&#x4eec;&#x9700;&#x8981;&#x8c03;&#x7528;&#x51fd;&#x6570;
    </p>
    <p>
      <b>tty = tty_init_dev(driver, index) </b>
    </p>
    <p>
      &#x8be5;&#x51fd;&#x6570;&#x8c03;&#x7528;tty = alloc_tty_struct(driver, idx)&#x51fd;&#x6570;&#xff0c; alloc_tty_struct&#x51fd;&#x6570;
    </p>
    <p>
      &#x505a;&#x4e86;&#x91cd;&#x8981;&#x7684;&#x4e00;&#x6b65;:&#xa0; <font color="#ef0c0c">tty-&gt;ops = driver-&gt;ops,&#x5373;tty-&gt;ops&#x5b9e;&#x9645;&#x4e0a;&#x6307;&#x5411;tty_driver-&gt;ops</font>
    </p>
    <p>
      &#x7136;&#x540e;&#x8c03;&#x7528;tty_add_file(tty, filp)&#x51fd;&#x6570;&#x6765;&#x5c06;&#x6253;&#x5f00;&#x6587;&#x4ef6;&#x7684;&#x6307;&#x9488;&#x6dfb;&#x52a0;&#x5230;&#x8be5;
    </p>
    <p>
      tty&#x7684;&#x961f;&#x5217;&#x91cc;&#x9762;&#x3002;
    </p>
    <p>
      &#x7136;&#x540e;&#x8c03;&#x7528;retval = tty-&gt;ops-&gt;open(tty, filp)
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1476429728996" ID="ID_1569370671" MODIFIED="1476429751876">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><i>struct tty_struct { </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;int magic; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct kref kref; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct device *dev; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;struct tty_driver *driver; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;const struct tty_operations *ops; </i></b>
    </p>
    <p>
      <b><i>&#xa0;&#xa0;&#xa0;&#xa0;int index; </i></b>
    </p>
    <p>
      <b><i>............ </i></b>
    </p>
    <p>
      <b><i>}</i></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1476430145091" ID="ID_725202802" MODIFIED="1476430565315">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x7ebf;&#x8def;&#x89c4;&#x7a0b;,&#x4e0d;&#x540c;&#x7c7b;&#x578b;&#x7684;tty&#x8bbe;&#x5907;&#x5177;&#x6709;&#x4e0d;&#x540c;&#x7c7b;&#x578b;&#x7684;&#x7ebf;&#x8def;&#x89c4;&#x7a0b;&#xff0c;
    </p>
    <p>
      &#x8fd9;&#x4e00;&#x5c42;&#x7684;&#x5b9e;&#x73b0;&#x4e3b;&#x8981;&#x662f;&#x5728;&#x6587;&#x4ef6;n_tty.c&#x5f53;&#x4e2d;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1509260954128" FOLDED="true" ID="ID_1061845081" MODIFIED="1510231143368" TEXT="&#x8ddf;tty driver&#x6709;&#x5173;&#x7684;API">
<font BOLD="true" NAME="SansSerif" SIZE="14"/>
<node CREATED="1509260986905" ID="ID_733957184" MODIFIED="1509261375481">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4" color="#143bed">include/linux/tty_driver.h</font></b>
    </p>
    <p>
      extern struct list_head tty_drivers;
    </p>
    <p>
      
    </p>
    <p>
      extern struct tty_driver *__tty_alloc_driver(unsigned int lines,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;struct module *owner, unsigned long flags);
    </p>
    <p>
      extern void put_tty_driver(struct tty_driver *driver);
    </p>
    <p>
      extern void tty_set_operations(struct tty_driver *driver,
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;const struct tty_operations *op);
    </p>
    <p>
      extern struct tty_driver *tty_find_polling_driver(char *name, int *line);
    </p>
    <p>
      
    </p>
    <p>
      extern void tty_driver_kref_put(struct tty_driver *driver);
    </p>
    <p>
      
    </p>
    <p>
      /* Use TTY_DRIVER_* flags below */
    </p>
    <p>
      #define tty_alloc_driver(lines, flags) \
    </p>
    <p>
      &#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;__tty_alloc_driver(lines, THIS_MODULE, flags)
    </p>
    <p>
      
    </p>
    <p>
      <b><i><font color="#ae0b0b">extern int tty_register_driver(struct tty_driver *driver); </font></i></b>
    </p>
    <p>
      <b><i><font color="#ae0b0b">extern int tty_unregister_driver(struct tty_driver *driver);</font></i></b>
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1562490165944" FOLDED="true" ID="ID_954737831" MODIFIED="1565876733795" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>Hexagon V62 Program Ref</b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1562490210617" FOLDED="true" ID="ID_923313477" MODIFIED="1565876732570">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x529f;&#x80fd;&#x6a21;&#x578b;
    </p>
  </body>
</html></richcontent>
<node CREATED="1562490237152" FOLDED="true" ID="ID_406414224" MODIFIED="1565876731507" TEXT="&#x6307;&#x4ee4;&#x96c6;">
<node CREATED="1562490286449" ID="ID_967454978" MODIFIED="1562491090754">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x5bfb;&#x5740;&#x6a21;&#x5f0f;&#xff1a;&#x652f;&#x6301;&#x5982;&#x4e0b;&#x7684;&#x5bfb;&#x5740;&#x6a21;&#x5f0f;
    </p>
    <p>
      32-bit absolute R2 = memw(##myvariable)
    </p>
    <p>
      32-bit absolute-set R2 = memw(R3==##myvariable)
    </p>
    <p>
      absolute with register offset R2 = memw(R4&lt;&lt;#3+##myvariable)
    </p>
    <p>
      Global pointer with relative offset R2 = memw(GP+#200)
    </p>
    <p>
      Indirect R2 = memw(R1)
    </p>
    <p>
      Indirect with offset R2 = memw(R3+#100)
    </p>
    <p>
      Indirect with register offset R2 = memw(R3 + R4&lt;&lt;#3)
    </p>
    <p>
      Indirect with auto increment R2 = memw(R3++#4)
    </p>
    <p>
      Circular with auto-increment R2 = memw(R0++M1)
    </p>
    <p>
      Bi-reversed with auto-increment register
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1562491597711" ID="ID_1129721366" MODIFIED="1562492094471">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      scaler&#x64cd;&#x4f5c;&#xff1a;&#x5b9a;&#x70b9;&#x6570;&#x6709;&#x5982;&#x4e0b;&#x7684;&#x64cd;&#x4f5c;
    </p>
    <p>
      16bit, 32bit&#x6216;&#x8005;&#x66f4;&#x590d;&#x6742;&#x6570;&#x636e;&#x7684;&#x4e58;&#x6cd5;
    </p>
    <p>
      16bit, 32bit, 64bit&#x7684;&#x51cf;&#x6cd5;&#x6216;&#x8005;&#x9664;&#x6cd5;
    </p>
    <p>
      &#x903b;&#x8f91;&#x64cd;&#x4f5c;
    </p>
    <p>
      &#x79fb;&#x4f4d;&#x64cd;&#x4f5c;
    </p>
    <p>
      &#x6bd4;&#x8f83;&#x64cd;&#x4f5c;
    </p>
    <p>
      &#x6709;&#x7b26;&#x53f7;&#x6570;&#x548c;0&#x7684;&#x6269;&#x5c55;
    </p>
    <p>
      bit&#x64cd;&#x4f5c;
    </p>
    <p>
      Predicate operations
    </p>
    <p>
      
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1562492288053" ID="ID_1572176317" MODIFIED="1562493874659">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      vector operation
    </p>
    <p>
      The Hexagon processor includes the following vector operations on fixed-point data:
    </p>
    <p>
      &#x25a0; Multiplication (halfwords, word by half, vector reduce, dual multiply)
    </p>
    <p>
      &#x25a0; Addition and subtraction of word and halfword data
    </p>
    <p>
      &#x25a0; Shifts on word and halfword data (arithmetic and logical)
    </p>
    <p>
      &#x25a0; Min/max, average, negative average, absolute difference, absolute value
    </p>
    <p>
      &#x25a0; Compares of word, halfword, and byte data
    </p>
    <p>
      &#x25a0; Reduce, sum of absolute differences on unsigned bytes
    </p>
    <p>
      &#x25a0; Special-purpose data arrangement (such as pack, splat, shuffle, align, saturate,
    </p>
    <p>
      splice, truncate, complex conjugate, complex rotate, zero extend)
    </p>
    <p>
      
    </p>
    <p>
      For example, the following instruction performs a vector operation:
    </p>
    <p>
      R1:0 += vrmpyh(R3:2,R5:4)
    </p>
    <p>
      It is defined to perform the following operations in one cycle:
    </p>
    <p>
      R1:0 += ((R2.L * R4.L) +
    </p>
    <p>
      (R2.H * R4.H) +
    </p>
    <p>
      (R3.L * R5.L) +
    </p>
    <p>
      (R3.H * R5.H)
    </p>
    <p>
      )
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1562494214222" ID="ID_1610610884" MODIFIED="1562494234626">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x6d6e;&#x70b9;&#x64cd;&#x4f5c;&#xff1a;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1562494599395" ID="ID_1912041016" MODIFIED="1562495082016">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      Program Flow
    </p>
    <p>
      &#x786c;&#x4ef6;&#x5faa;&#x73af;
    </p>
    <p>
      loop0(start,#3)
    </p>
    <p>
      // loop 3 times
    </p>
    <p>
      start:
    </p>
    <p>
      { R0 = mpyi(R0,R0) } :endloop0
    </p>
    <p>
      &#x6761;&#x4ef6;&#x68c0;&#x6d4b;
    </p>
    <p>
      P1 = cmp.eq(R2, R3)
    </p>
    <p>
      if (P1) jump end
    </p>
    <p>
      &#x8df3;&#x8f6c;&#x548c;&#x5b50;&#x51fd;&#x6570;&#x8c03;&#x7528;&#xff0c;&#x652f;&#x6301;pc&#x6307;&#x9488;&#x76f8;&#x5bf9;&#x4f4d;&#x7f6e;&#x8df3;&#x8f6c;&#x548c;&#x5bc4;&#x5b58;&#x5668;&#x95f4;&#x63a5;&#x5730;&#x5740;&#x8df3;&#x8f6c;
    </p>
    <p>
      jump end
    </p>
    <p>
      jumpr R1
    </p>
    <p>
      call function
    </p>
    <p>
      callr R2
    </p>
    <p>
      
    </p>
    <p>
      The subroutine call instructions store the return address in register R31 . Subroutine
    </p>
    <p>
      returns are performed using a jump indirect instruction through this register. For example:
    </p>
    <p>
      jumpr R31
    </p>
    <p>
      1.3.6
    </p>
    <p>
      // subroutine return &#x8fd4;&#x56de;&#x6307;&#x4ee4;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1563765494937" FOLDED="true" ID="ID_943634925" MODIFIED="1572247217612" POSITION="left" TEXT="SPI&#x9a71;&#x52a8;&#x6846;&#x67b6;&#x5206;&#x6790;">
<font BOLD="true" NAME="SansSerif" SIZE="12"/>
<node CREATED="1563767343737" ID="ID_1288655755" MODIFIED="1563767366204">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/ecp5-spi.PNG"/>
  </body>
</html></richcontent>
<node CREATED="1563774286904" ID="ID_1560621599" MODIFIED="1563774324782">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      GPIO94 ----- MOSI
    </p>
    <p>
      GPIO93 ----- MISO
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1566805163368" ID="ID_446003199" MODIFIED="1566818225649">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b>&#x5199;&#x5165;&#x7684;&#x6570;&#x636e;&#x548c;&#x547d;&#x4ee4;&#x662f;&#x5728;&#x65f6;&#x949f;&#x7684;&#x4e0a;&#x5347;&#x6cbf;&#x8fdb;&#x884c;&#x4f20;&#x8f93;&#x7684; <font color="#ff0000">mode0</font>&#xff0c; </b>
    </p>
    <p>
      <b>&#x8bfb;&#x53d6;&#x6570;&#x636e;&#x662f;&#x5728;&#x65f6;&#x949f;&#x7684;&#x4e0b;&#x964d;&#x6cbf;&#x8fdb;&#x884c;&#x7684; <font color="#ff3300">mode1</font></b>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1566805825831" ID="ID_1121206807" MODIFIED="1566805836111" TEXT="readh&#x548c;write&#x65f6;&#x5e8f;">
<node CREATED="1566805840932" ID="ID_1583677698" MODIFIED="1566805849013">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/spi-read.PNG"/>
  </body>
</html></richcontent>
</node>
<node CREATED="1566805852257" ID="ID_1308728702" MODIFIED="1566805861915">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/spi-write.PNG"/>
  </body>
</html></richcontent>
</node>
</node>
</node>
<node CREATED="1566804885554" ID="ID_1168999576" MODIFIED="1566804901076" TEXT="&#x7b2c;&#x4e00;&#x90e8;&#x5206;&#xff1a;spi&#x534f;&#x8bae;&#x76f8;&#x5173;&#x77e5;&#x8bc6;">
<node CREATED="1566804910108" ID="ID_1749696604" MODIFIED="1566804917816" TEXT="1.spi&#x7684;&#x56db;&#x79cd;&#x6a21;&#x5f0f;">
<node CREATED="1566804922199" ID="ID_1628018183" MODIFIED="1566805136528">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/spi-4mode.png"/>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
<node CREATED="1557470622128" FOLDED="true" ID="ID_894117428" MODIFIED="1574938642867" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <b><font size="4">Android Boot&#x6d41;&#x7a0b;&#x5206;&#x6790;</font></b>
    </p>
  </body>
</html></richcontent>
<node CREATED="1557470667044" FOLDED="true" ID="ID_1944955025" MODIFIED="1574938641370" TEXT="Qualcomm&#x67b6;&#x6784;">
<node CREATED="1557470733790" FOLDED="true" ID="ID_121653938" MODIFIED="1574938640184" TEXT="8998">
<node CREATED="1557471105667" ID="ID_1180715066" MODIFIED="1557471738111">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#x57fa;&#x672c;&#x6982;&#x5ff5;&#xff1a;
    </p>
    <p>
      &#x9ad8;&#x901a;&#x4ece;8996&#x5e73;&#x53f0;&#x5f00;&#x59cb;&#x5f15;&#x5165;&#x4e86;UEFI&#x7684;&#x6982;&#x5ff5;&#xff0c;&#x65b9;&#x4fbf;&#x5728;android&#x548c;windows&#x4e4b;&#x95f4;&#x8fdb;&#x884c;&#x5207;&#x6362;&#x3002;
    </p>
    <p>
      &#x4e3a;&#x4e86;&#x4f7f;&#x7528;UEFI&#xff0c;&#x5f15;&#x5165;&#x4e86;eXtensible Boot Loader(XBL)&#x7684;&#x6982;&#x5ff5;&#xff0c;XBL&#x662f;&#x5bf9;UEFI&#x7406;&#x5ff5;&#x7684;&#x5b9e;&#x73b0;&#x3002;
    </p>
    <p>
      XBL&#x5206;&#x4e3a;&#x4e24;&#x4e2a;&#x90e8;&#x5206;&#xff1a;1. SEC&#x7a0b;&#x5e8f;&#xff0c;&#x8be5;&#x7a0b;&#x5e8f;&#x7406;&#x89e3;&#x6210;&#x89e3;&#x538b;&#x7f29;&#x7684;&#x7a0b;&#x5e8f;&#xff0c;&#x7528;&#x4e8e;&#x52a0;&#x8f7d;xbl core
    </p>
    <p>
      2. xbl core&#x5b9e;&#x73b0;&#x4e86;UEFI&#x7684;&#x529f;&#x80fd;&#xff0c;&#x91cc;&#x9762;&#x6709;&#x975e;&#x5e38;&#x591a;&#x7684;&#x5b50;&#x6a21;&#x5757;&#xff0c;&#x7528;&#x6765;&#x7ba1;&#x7406;&#x7cfb;&#x7edf;&#x5404;&#x4e2a;&#x5b50;&#x6a21;&#x5757;&#x548c;&#x8fdb;&#x884c;
    </p>
    <p>
      debug&#x4f7f;&#x7528;&#xff0c; xbl core&#x4f1a;&#x52a0;&#x8f7d;abl<b><i>(</i></b>&#x5373;&#x771f;&#x6b63;&#x7684;android bootloader,abl&#x91cc;&#x9762;&#x5b9e;&#x73b0;&#x4e86;Fastboot&#x529f;&#x80fd;&#xff0c;&#x5b9e;&#x73b0;&#x4e86;&#x52a0;&#x8f7d;linux&#x955c;&#x50cf;
    </p>
    <p>
      &#x7684;&#x529f;&#x80fd;&#xff0c;&#x9ad8;&#x901a;&#x7684;abl&#x5bf9;&#x5e94;&#x7684;&#x662f;edk2&#x5f00;&#x6e90;&#x9879;&#x76ee;<b><i>) </i></b>
    </p>
    <p>
      
    </p>
    <p>
      &#x53c2;&#x8003;&#x7f51;&#x5740;&#xff1a; https://worthdoingbadly.com/qcomxbl/
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1557470745499" ID="ID_440698534" MODIFIED="1557470747939" TEXT="8996"/>
<node CREATED="1557470751064" ID="ID_1380476289" MODIFIED="1557470753364" TEXT="845"/>
</node>
<node CREATED="1557470682455" ID="ID_475138963" MODIFIED="1557470686466" TEXT="MTK&#x67b6;&#x6784;"/>
<node CREATED="1557470690505" ID="ID_921250273" MODIFIED="1557470705965" TEXT="RockChip&#x67b6;&#x6784;"/>
<node CREATED="1557470715483" ID="ID_19352377" MODIFIED="1557470724978" TEXT="&#x6d77;&#x601d;&#x67b6;&#x6784;"/>
</node>
<node CREATED="1571798251358" FOLDED="true" ID="ID_1900135638" MODIFIED="1574938645114" POSITION="left">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      <i><font size="5" face="Simplified Arabic" color="#009933"><b>&#x6587;&#x4ef6;&#x7cfb;&#x7edf;&#x7814;&#x7a76;</b></font></i>
    </p>
  </body>
</html></richcontent>
<node CREATED="1571798325013" ID="ID_59403276" MODIFIED="1571798783951">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <img src="lddpic/&#x9ad8;&#x901a;filesystem&#x5927;&#x5c0f;&#x4fee;&#x6539;.png"/>
  </body>
</html></richcontent>
</node>
</node>
</node>
</map>
